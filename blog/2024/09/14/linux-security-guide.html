<!DOCTYPE html>
<html lang="en">

<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="stylesheet" href="/infra-blog/assets/css/style.css">
<link rel="stylesheet" href="/infra-blog/assets/css/post-detail.css">
<style>
/* Post Detail Page Styling */
.post-container article {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  padding: 40px;
  margin: 30px auto;
  max-width: 800px;
}

@media screen and (max-width: 768px) {
  .post-container article {
    margin: 20px;
    padding: 25px;
    border-radius: 8px;
  }
}

.post-container article .post-header {
  border-bottom: 2px solid #f5f5f5;
  padding-bottom: 25px;
  margin-bottom: 30px;
}

.post-container article .post-header .post-title {
  font-size: 2.2em;
  font-weight: 700;
  color: #2c3e50;
  line-height: 1.3;
  margin-bottom: 15px;
}

@media screen and (max-width: 768px) {
  .post-container article .post-header .post-title {
    font-size: 1.8em;
  }
}

.post-container article .post-header .post-meta {
  display: flex;
  align-items: center;
  gap: 20px;
  flex-wrap: wrap;
}

.post-container article .post-header .post-meta .post-date {
  display: flex;
  align-items: center;
  color: #666;
  font-size: 0.9em;
}

.post-container article .post-header .post-meta .post-date i {
  margin-right: 8px;
  color: #888;
}

.post-container article .post-header .post-meta .post-categories-wrapper {
  display: flex;
  align-items: center;
}

.post-container article .post-header .post-meta .post-categories-wrapper i {
  margin-right: 8px;
  color: #888;
}

.post-container article .post-header .post-meta .post-categories-wrapper .post-categories {
  display: flex;
  gap: 8px;
  list-style: none;
  margin: 0;
  padding: 0;
}

.post-container article .post-header .post-meta .post-categories-wrapper .post-categories li {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.8em;
  font-weight: 500;
  text-transform: capitalize;
}

.post-container article .post-content {
  font-size: 1.1em;
  line-height: 1.8;
  color: #333;
}

.post-container article .post-content p {
  margin-bottom: 1.2em;
}

.post-container article .post-content h1,
.post-container article .post-content h2,
.post-container article .post-content h3,
.post-container article .post-content h4,
.post-container article .post-content h5,
.post-container article .post-content h6 {
  color: #2c3e50;
  margin: 1.5em 0 0.8em 0;
  font-weight: 600;
}

.post-container article .post-content h2 {
  font-size: 1.8em;
  border-bottom: 2px solid #3498db;
  padding-bottom: 10px;
}

.post-container article .post-content h3 {
  font-size: 1.5em;
  color: #34495e;
}

.post-container article .post-content code {
  background: #f8f9fa;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 0.9em;
  color: #e74c3c;
}

.post-container article .post-content pre {
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 6px;
  padding: 15px;
  overflow-x: auto;
  margin: 1.5em 0;
}

.post-container article .post-content pre code {
  background: none;
  color: #333;
  padding: 0;
}

.post-container article .post-content blockquote {
  border-left: 4px solid #3498db;
  background: #f8f9fa;
  padding: 15px 20px;
  margin: 1.5em 0;
  font-style: italic;
  color: #555;
}

.post-container article .post-content img {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
  margin: 1.5em 0;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.post-container article .post-content ul,
.post-container article .post-content ol {
  padding-left: 1.5em;
  margin-bottom: 1.2em;
}

.post-container article .post-content ul li,
.post-container article .post-content ol li {
  margin-bottom: 0.5em;
}

.post-container article .post-content a {
  color: #3498db;
  text-decoration: none;
  border-bottom: 1px solid transparent;
  transition: all 0.3s ease;
}

.post-container article .post-content a:hover {
  border-bottom-color: #3498db;
}

.post-container article .post-footer {
  border-top: 2px solid #f5f5f5;
  padding-top: 25px;
  margin-top: 40px;
}

.post-container article .post-footer .post-navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 20px;
}

@media screen and (max-width: 768px) {
  .post-container article .post-footer .post-navigation {
    flex-direction: column;
    gap: 15px;
  }
}

.post-container article .post-footer .post-navigation .nav-previous,
.post-container article .post-footer .post-navigation .nav-next {
  flex: 1;
}

.post-container article .post-footer .post-navigation .nav-previous a,
.post-container article .post-footer .post-navigation .nav-next a {
  display: flex;
  align-items: center;
  padding: 15px 20px;
  background: #f8f9fa;
  border-radius: 8px;
  text-decoration: none;
  color: #333;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.post-container article .post-footer .post-navigation .nav-previous a:hover,
.post-container article .post-footer .post-navigation .nav-next a:hover {
  background: #e9ecef;
  border-color: #3498db;
  transform: translateY(-2px);
}

.post-container article .post-footer .post-navigation .nav-previous a i,
.post-container article .post-footer .post-navigation .nav-next a i {
  color: #3498db;
  margin: 0 8px;
}

.post-container article .post-footer .post-navigation .nav-previous a .nav-title,
.post-container article .post-footer .post-navigation .nav-next a .nav-title {
  font-weight: 500;
}

.post-container article .post-footer .post-navigation .nav-previous a {
  justify-content: flex-start;
}

.post-container article .post-footer .post-navigation .nav-next a {
  justify-content: flex-end;
  text-align: right;
}
</style>
<title>ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ | Complete Linux Security Guide - ì‹œìŠ¤í…œ ë³´ì•ˆë¶€í„° ê³ ê¸‰ ë³´ì•ˆ ê¸°ë²•ê¹Œì§€</title>

<script type="text/javascript" src="/infra-blog/assets/js/darkmode.js"></script>

</head><body>
  <main class="container">
    <section class="about">
      <div class="about-header condensed">
      <div class="about-title">
      <a href="/infra-blog/">
        
        <img src="/infra-blog/assets/portfolio.png" alt="Infrastructure Engineer" />
        
      </a>
      <h2 id="title">
        <a href="/infra-blog/">Infrastructure Engineer</a>
      </h2>
      </div><p class="tagline">DevOps & Cloud Infrastructure Specialist</p></div>
      
      <ul class="social about-footer condensed"><a href="https://github.com/leeyonghe" target="_blank">
          <li>
            <i class="icon-github-circled"></i>
          </li>
        </a><a href="https://www.linkedin.com/in/lee-yong-hee-18912454/" target="_blank">
          <li>
            <i class="icon-linkedin-squared"></i>
          </li>
        </a><!----></ul><p class="about-footer condensed">&copy;
        2025</p><div class="about-footer condensed">
        <p>Dark Mode
          <i class="icon-moon"></i>
          <label class="switch">
            <input type="checkbox" class="dark-mode-toggle">
            <span class="slider round" onclick="toggleDarkMode()"></span>
          </label>
        </p>
      </div>
    </section>
    <section class="content">
      <style>
/* Post Detail Page Styling - Direct Inline */
.post-container article {
  background: #fff !important;
  border: none !important;
  border-top: none !important;
  border-right: none !important;
  border-bottom: none !important;
  border-left: none !important;
  border-width: 0 !important;
  border-style: none !important;
  outline: none !important;
  border-radius: 12px !important;
  box-shadow: none !important;
  padding: 40px !important;
  margin: 30px auto !important;
  max-width: 800px !important;
}

.post-container article .post-header .post-title {
  font-size: 2.2em !important;
  font-weight: 700 !important;
  color: #2c3e50 !important;
  line-height: 1.3 !important;
}

.post-container article .post-header {
  border-bottom: none !important;
  padding-bottom: 25px !important;
  margin-bottom: 30px !important;
}

.post-container article .post-content {
  font-size: 1.1em !important;
  line-height: 1.8 !important;
  color: #333 !important;
}

.post-container article .post-content h2 {
  font-size: 1.8em !important;
  border-bottom: none !important;
  padding-bottom: 10px !important;
  color: #2c3e50 !important;
}

.post-container article .post-header .post-meta .post-categories li {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
  color: white !important;
  padding: 4px 12px !important;
  border-radius: 20px !important;
  font-size: 0.8em !important;
  list-style: none !important;
  display: inline-block !important;
  margin-right: 8px !important;
}

.post-container article .post-footer {
  border-top: none !important;
  padding-top: 25px !important;
  margin-top: 40px !important;
}

/* ëª¨ë“  borderì™€ box-shadow ê°•ì œ ì œê±° */
.post-container article *,
.post-container article *::before,
.post-container article *::after {
  border: none !important;
  border-top: none !important;
  border-right: none !important;
  border-bottom: none !important;
  border-left: none !important;
  border-width: 0 !important;
  border-style: none !important;
  outline: none !important;
  box-shadow: none !important;
}

/* ì½”ë“œ ë¸”ë¡ê³¼ pre íƒœê·¸ë„ border, box-shadow ì œê±° */
.post-container article pre,
.post-container article code,
.post-container article .highlight,
.post-container article .highlighter-rouge {
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
}
</style><div class="post-container">
  <article>
    <header class="post-header">
    <h1 class="post-title">ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ | Complete Linux Security Guide - ì‹œìŠ¤í…œ ë³´ì•ˆë¶€í„° ê³ ê¸‰ ë³´ì•ˆ ê¸°ë²•ê¹Œì§€</h1>
    <div class="post-meta">
      <div class="post-date">
        <i class="icon-calendar"></i>
        <time datetime="2024-09-14T03:00:00+00:00">Sep 14, 2024</time>
      </div><div class="post-categories-wrapper">
        <i class="icon-tag"></i>
        <ul class="post-categories"><li>Security</li><li>Linux</li></ul>
      </div></div>
  </header>

  <div class="post-content">
    <p>ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œì˜ ë³´ì•ˆì„ ì²´ê³„ì ìœ¼ë¡œ êµ¬ì¶•í•˜ê³  ê´€ë¦¬í•˜ëŠ” ì™„ì „í•œ ê°€ì´ë“œì…ë‹ˆë‹¤. ê¸°ì´ˆë¶€í„° ê³ ê¸‰ ë³´ì•ˆ ê¸°ë²•ê¹Œì§€ ì‹¤ë¬´ì— ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ë‚´ìš©ìœ¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.</p>

<h2 id="ë¦¬ëˆ…ìŠ¤-ë³´ì•ˆ-ê¸°ì´ˆ--linux-security-fundamentals">ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ê¸°ì´ˆ | Linux Security Fundamentals</h2>

<h3 id="-ì‚¬ìš©ì-ê³„ì •-ë³´ì•ˆ">ğŸ” ì‚¬ìš©ì ê³„ì • ë³´ì•ˆ</h3>

<h4 id="íŒ¨ìŠ¤ì›Œë“œ-ì •ì±…-ê°•í™”">íŒ¨ìŠ¤ì›Œë“œ ì •ì±… ê°•í™”</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># íŒ¨ìŠ¤ì›Œë“œ ë³µì¡ì„± ì •ì±… ì„¤ì •</span>
<span class="c"># /etc/pam.d/common-password (Ubuntu/Debian)</span>
password requisite pam_pwquality.so <span class="nv">retry</span><span class="o">=</span>3 <span class="nv">minlen</span><span class="o">=</span>12 <span class="nv">minclass</span><span class="o">=</span>3 <span class="nv">maxrepeat</span><span class="o">=</span>2 <span class="nv">ucredit</span><span class="o">=</span><span class="nt">-1</span> <span class="nv">lcredit</span><span class="o">=</span><span class="nt">-1</span> <span class="nv">dcredit</span><span class="o">=</span><span class="nt">-1</span> <span class="nv">ocredit</span><span class="o">=</span><span class="nt">-1</span>

<span class="c"># /etc/security/pwquality.conf</span>
minlen <span class="o">=</span> 12
minclass <span class="o">=</span> 3
maxrepeat <span class="o">=</span> 2
maxclasssrepeat <span class="o">=</span> 4
ucredit <span class="o">=</span> <span class="nt">-1</span>    <span class="c"># ìµœì†Œ ëŒ€ë¬¸ì 1ê°œ</span>
lcredit <span class="o">=</span> <span class="nt">-1</span>    <span class="c"># ìµœì†Œ ì†Œë¬¸ì 1ê°œ  </span>
dcredit <span class="o">=</span> <span class="nt">-1</span>    <span class="c"># ìµœì†Œ ìˆ«ì 1ê°œ</span>
ocredit <span class="o">=</span> <span class="nt">-1</span>    <span class="c"># ìµœì†Œ íŠ¹ìˆ˜ë¬¸ì 1ê°œ</span>
difok <span class="o">=</span> 3       <span class="c"># ì´ì „ íŒ¨ìŠ¤ì›Œë“œì™€ 3ê¸€ì ì´ìƒ ë‹¬ë¼ì•¼ í•¨</span>

<span class="c"># íŒ¨ìŠ¤ì›Œë“œ ì—ì´ì§• ì •ì±…</span>
<span class="c"># /etc/login.defs</span>
PASS_MAX_DAYS   90     <span class="c"># ìµœëŒ€ ìœ íš¨ê¸°ê°„</span>
PASS_MIN_DAYS   1      <span class="c"># ìµœì†Œ ë³€ê²½ ì£¼ê¸°</span>
PASS_MIN_LEN    12     <span class="c"># ìµœì†Œ ê¸¸ì´</span>
PASS_WARN_AGE   7      <span class="c"># ë§Œë£Œ ê²½ê³  ê¸°ê°„</span>

<span class="c"># ê¸°ì¡´ ì‚¬ìš©ìì—ê²Œ ì •ì±… ì ìš©</span>
chage <span class="nt">-M</span> 90 <span class="nt">-m</span> 1 <span class="nt">-W</span> 7 username

<span class="c"># ê³„ì • ì ê¸ˆ ì •ì±… (ì‹¤íŒ¨ ì‹œë„ ì œí•œ)</span>
<span class="c"># /etc/pam.d/common-auth</span>
auth required pam_tally2.so <span class="nv">deny</span><span class="o">=</span>5 <span class="nv">unlock_time</span><span class="o">=</span>1800 <span class="nv">onerr</span><span class="o">=</span>fail

<span class="c"># ì ê¸´ ê³„ì • í™•ì¸ ë° í•´ì œ</span>
pam_tally2 <span class="nt">--user</span> username
pam_tally2 <span class="nt">--user</span> username <span class="nt">--reset</span>
</code></pre></div></div>

<h4 id="ë£¨íŠ¸-ê³„ì •-ë³´ì•ˆ">ë£¨íŠ¸ ê³„ì • ë³´ì•ˆ</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë£¨íŠ¸ ì§ì ‘ ë¡œê·¸ì¸ ì°¨ë‹¨</span>
<span class="c"># /etc/ssh/sshd_config</span>
PermitRootLogin no
PasswordAuthentication no
PubkeyAuthentication <span class="nb">yes</span>

<span class="c"># ì½˜ì†” ë£¨íŠ¸ ë¡œê·¸ì¸ ì œí•œ</span>
<span class="c"># /etc/securetty (í—ˆìš©í•  í„°ë¯¸ë„ë§Œ ë‚¨ê¸°ê¸°)</span>
console
tty1

<span class="c"># sudo ê¶Œí•œ ì„¸ë°€í•˜ê²Œ ì œì–´</span>
<span class="c"># /etc/sudoers</span>
<span class="c"># íŠ¹ì • ëª…ë ¹ë§Œ í—ˆìš©</span>
webadmin <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> /usr/sbin/service apache2 <span class="k">*</span>, /usr/sbin/service nginx <span class="k">*</span>
<span class="c"># íŒ¨ìŠ¤ì›Œë“œ ì—†ì´ íŠ¹ì • ëª…ë ¹ ì‹¤í–‰</span>
backup <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> NOPASSWD: /usr/bin/rsync, /bin/tar

<span class="c"># sudo ì‚¬ìš© ë¡œê·¸ ê°•í™”</span>
<span class="c"># /etc/rsyslog.conf ë˜ëŠ” /etc/rsyslog.d/50-default.conf</span>
local2.<span class="k">*</span>                        /var/log/sudo.log

<span class="c"># /etc/sudoersì— ì¶”ê°€</span>
Defaults    <span class="nv">logfile</span><span class="o">=</span><span class="s2">"/var/log/sudo.log"</span>
Defaults    log_input, log_output
Defaults    <span class="nv">iolog_dir</span><span class="o">=</span><span class="s2">"/var/log/sudo-io"</span>
</code></pre></div></div>

<h3 id="-ssh-ë³´ì•ˆ-ê°•í™”">ğŸ”’ SSH ë³´ì•ˆ ê°•í™”</h3>

<h4 id="ssh-ì„œë²„-ë³´ì•ˆ-ì„¤ì •">SSH ì„œë²„ ë³´ì•ˆ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/ssh/sshd_config ë³´ì•ˆ ì„¤ì •</span>
Protocol 2
Port 2222                    <span class="c"># ê¸°ë³¸ í¬íŠ¸ ë³€ê²½</span>
PermitRootLogin no
PasswordAuthentication no
PubkeyAuthentication <span class="nb">yes
</span>AuthorizedKeysFile .ssh/authorized_keys
MaxAuthTries 3
MaxSessions 3
MaxStartups 3
LoginGraceTime 60
ClientAliveInterval 300
ClientAliveCountMax 2
UsePAM <span class="nb">yes
</span>X11Forwarding no
AllowTcpForwarding no
GatewayPorts no
PermitTunnel no

<span class="c"># íŠ¹ì • ì‚¬ìš©ì/ê·¸ë£¹ë§Œ SSH ì ‘ê·¼ í—ˆìš©</span>
AllowUsers admin developer
AllowGroups sshusers
DenyUsers guest anonymous
DenyGroups wheel

<span class="c"># íŠ¹ì • IPì—ì„œë§Œ ì ‘ê·¼ í—ˆìš©</span>
Match Address 192.168.1.0/24,10.0.0.0/8
    PasswordAuthentication <span class="nb">yes
    
</span>Match Address <span class="k">*</span>,!192.168.1.0/24,!10.0.0.0/8
    DenyUsers <span class="k">*</span>

<span class="c"># ì„œë¹„ìŠ¤ ì¬ì‹œì‘</span>
systemctl restart sshd
</code></pre></div></div>

<h4 id="ssh-í‚¤-ê¸°ë°˜-ì¸ì¦-êµ¬ì¶•">SSH í‚¤ ê¸°ë°˜ ì¸ì¦ êµ¬ì¶•</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í´ë¼ì´ì–¸íŠ¸ì—ì„œ í‚¤ ìƒì„± (ED25519 ê¶Œì¥)</span>
ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-b</span> 4096 <span class="nt">-C</span> <span class="s2">"your-email@domain.com"</span>
<span class="c"># ë˜ëŠ” RSA í‚¤ (ìµœì†Œ 4096ë¹„íŠ¸)</span>
ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-b</span> 4096 <span class="nt">-C</span> <span class="s2">"your-email@domain.com"</span>

<span class="c"># ê³µê°œí‚¤ ì„œë²„ì— ë³µì‚¬</span>
ssh-copy-id <span class="nt">-i</span> ~/.ssh/id_ed25519.pub username@server-ip

<span class="c"># ìˆ˜ë™ìœ¼ë¡œ ê³µê°œí‚¤ ì„¤ì •</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> ~/.ssh
<span class="nb">chmod </span>700 ~/.ssh
<span class="nb">cat</span> <span class="o">&gt;&gt;</span> ~/.ssh/authorized_keys <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIG... your-email@domain.com
</span><span class="no">EOF
</span><span class="nb">chmod </span>600 ~/.ssh/authorized_keys
<span class="nb">chown </span>username:username ~/.ssh <span class="nt">-R</span>

<span class="c"># SSH í‚¤ ê´€ë¦¬ - í‚¤ë³„ ì œí•œ ì„¤ì •</span>
<span class="c"># ~/.ssh/authorized_keys</span>
<span class="nb">command</span><span class="o">=</span><span class="s2">"/usr/local/bin/backup-script"</span>,no-port-forwarding,no-X11-forwarding,no-agent-forwarding ssh-rsa AAAAB3... backup@server
<span class="nv">from</span><span class="o">=</span><span class="s2">"192.168.1.100"</span>,no-port-forwarding ssh-rsa AAAAB3... admin@workstation

<span class="c"># SSH Certificate Authority êµ¬ì¶•</span>
<span class="c"># CA í‚¤ ìƒì„±</span>
ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-b</span> 4096 <span class="nt">-f</span> /etc/ssh/ca_key

<span class="c"># ì‚¬ìš©ì ì¸ì¦ì„œ ë°œê¸‰</span>
ssh-keygen <span class="nt">-s</span> /etc/ssh/ca_key <span class="nt">-I</span> <span class="s2">"user-certificate"</span> <span class="nt">-n</span> username <span class="nt">-V</span> +1w ~/.ssh/id_rsa.pub

<span class="c"># ì„œë²„ ì„¤ì •ì—ì„œ CA ì‹ ë¢°</span>
<span class="c"># /etc/ssh/sshd_config</span>
TrustedUserCAKeys /etc/ssh/ca_key.pub
</code></pre></div></div>

<h3 id="ï¸-ë°©í™”ë²½-ì„¤ì •">ğŸ›¡ï¸ ë°©í™”ë²½ ì„¤ì •</h3>

<h4 id="iptables-ê¸°ë³¸-ë³´ì•ˆ-ì„¤ì •">iptables ê¸°ë³¸ ë³´ì•ˆ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># ê°•ë ¥í•œ iptables ë³´ì•ˆ ì„¤ì •</span>

<span class="c"># ëª¨ë“  ê¸°ì¡´ ê·œì¹™ ì´ˆê¸°í™”</span>
iptables <span class="nt">-F</span>
iptables <span class="nt">-X</span>
iptables <span class="nt">-t</span> nat <span class="nt">-F</span>
iptables <span class="nt">-t</span> nat <span class="nt">-X</span>
iptables <span class="nt">-t</span> mangle <span class="nt">-F</span>
iptables <span class="nt">-t</span> mangle <span class="nt">-X</span>

<span class="c"># ê¸°ë³¸ ì •ì±…: ëª¨ë“  íŠ¸ë˜í”½ ì°¨ë‹¨</span>
iptables <span class="nt">-P</span> INPUT DROP
iptables <span class="nt">-P</span> FORWARD DROP
iptables <span class="nt">-P</span> OUTPUT DROP

<span class="c"># Loopback í—ˆìš©</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-i</span> lo <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-o</span> lo <span class="nt">-j</span> ACCEPT

<span class="c"># ê¸°ì¡´ ì—°ê²° ìœ ì§€</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED,RELATED <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED <span class="nt">-j</span> ACCEPT

<span class="c"># SSH ì ‘ê·¼ í—ˆìš© (ë¸Œë£¨íŠ¸í¬ìŠ¤ ë°©ì§€)</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 2222 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW <span class="nt">-m</span> recent <span class="nt">--set</span> <span class="nt">--name</span> SSH
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 2222 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW <span class="nt">-m</span> recent <span class="nt">--update</span> <span class="nt">--seconds</span> 60 <span class="nt">--hitcount</span> 4 <span class="nt">--name</span> SSH <span class="nt">-j</span> DROP
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 2222 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--sport</span> 2222 <span class="nt">-j</span> ACCEPT

<span class="c"># DNS í—ˆìš© (í•„ìˆ˜)</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> udp <span class="nt">--dport</span> 53 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 53 <span class="nt">-j</span> ACCEPT

<span class="c"># NTP í—ˆìš©</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> udp <span class="nt">--dport</span> 123 <span class="nt">-j</span> ACCEPT

<span class="c"># HTTP/HTTPS ì•„ì›ƒë°”ìš´ë“œ í—ˆìš©</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 80 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 443 <span class="nt">-j</span> ACCEPT

<span class="c"># ì›¹ ì„œë²„ê°€ ìˆë‹¤ë©´ ì¸ë°”ìš´ë“œë„ í—ˆìš©</span>
<span class="c"># iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span>
<span class="c"># iptables -A INPUT -p tcp --dport 443 -j ACCEPT</span>

<span class="c"># ICMP ì œí•œì  í—ˆìš© (ping)</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> icmp <span class="nt">--icmp-type</span> echo-request <span class="nt">-m</span> limit <span class="nt">--limit</span> 1/second <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> icmp <span class="nt">--icmp-type</span> echo-reply <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> icmp <span class="nt">--icmp-type</span> echo-request <span class="nt">-j</span> ACCEPT

<span class="c"># ë¡œê¹… ì„¤ì • (DDoS ë°©ì§€)</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-m</span> limit <span class="nt">--limit</span> 5/min <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"iptables INPUT denied: "</span> <span class="nt">--log-level</span> 7

<span class="c"># ì„¤ì • ì €ì¥</span>
iptables-save <span class="o">&gt;</span> /etc/iptables/rules.v4

<span class="c"># ë¶€íŒ… ì‹œ ìë™ ë¡œë“œ</span>
<span class="nb">echo</span> <span class="s1">'#!/bin/bash'</span> <span class="o">&gt;</span> /etc/network/if-pre-up.d/iptables
<span class="nb">echo</span> <span class="s1">'iptables-restore &lt; /etc/iptables/rules.v4'</span> <span class="o">&gt;&gt;</span> /etc/network/if-pre-up.d/iptables
<span class="nb">chmod</span> +x /etc/network/if-pre-up.d/iptables
</code></pre></div></div>

<h4 id="ufw-uncomplicated-firewall-í™œìš©">UFW (Uncomplicated Firewall) í™œìš©</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># UFW ì´ˆê¸°í™” ë° ê¸°ë³¸ ì„¤ì •</span>
ufw <span class="nt">--force</span> reset
ufw default deny incoming
ufw default deny outgoing
ufw default deny forward

<span class="c"># í•„ìˆ˜ ì•„ì›ƒë°”ìš´ë“œ í—ˆìš©</span>
ufw allow out 53      <span class="c"># DNS</span>
ufw allow out 80      <span class="c"># HTTP</span>
ufw allow out 443     <span class="c"># HTTPS</span>
ufw allow out 123     <span class="c"># NTP</span>

<span class="c"># SSH ì ‘ê·¼ í—ˆìš© (í¬íŠ¸ ë³€ê²½í–ˆë‹¤ë©´)</span>
ufw allow from 192.168.1.0/24 to any port 2222

<span class="c"># ì• í”Œë¦¬ì¼€ì´ì…˜ë³„ í—ˆìš©</span>
ufw allow <span class="s2">"Apache Full"</span>
ufw allow <span class="s2">"Nginx Full"</span>

<span class="c"># ê³ ê¸‰ ê·œì¹™</span>
ufw allow from 10.0.0.0/8 to any port 3306  <span class="c"># MySQL</span>
ufw deny from 192.168.1.100                 <span class="c"># íŠ¹ì • IP ì°¨ë‹¨</span>

<span class="c"># ë¡œê¹… í™œì„±í™”</span>
ufw logging on

<span class="c"># ë°©í™”ë²½ í™œì„±í™”</span>
ufw <span class="nb">enable</span>

<span class="c"># ìƒíƒœ í™•ì¸</span>
ufw status verbose
ufw status numbered
</code></pre></div></div>

<h2 id="selinuxapparmor-ë³´ì•ˆ--mandatory-access-control">SELinux/AppArmor ë³´ì•ˆ | Mandatory Access Control</h2>

<h3 id="-selinux-êµ¬ì„±-ë°-ê´€ë¦¬">ğŸ” SELinux êµ¬ì„± ë° ê´€ë¦¬</h3>

<h4 id="selinux-ê¸°ë³¸-ì„¤ì •">SELinux ê¸°ë³¸ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># SELinux ìƒíƒœ í™•ì¸</span>
sestatus
getenforce

<span class="c"># SELinux ëª¨ë“œ ë³€ê²½</span>
<span class="c"># /etc/selinux/config</span>
<span class="nv">SELINUX</span><span class="o">=</span>enforcing     <span class="c"># enforcing, permissive, disabled</span>
<span class="nv">SELINUXTYPE</span><span class="o">=</span>targeted  <span class="c"># targeted, minimum, mls</span>

<span class="c"># ì„ì‹œ ëª¨ë“œ ë³€ê²½</span>
setenforce 1  <span class="c"># enforcing</span>
setenforce 0  <span class="c"># permissive</span>

<span class="c"># ì»¨í…ìŠ¤íŠ¸ í™•ì¸</span>
<span class="nb">ls</span> <span class="nt">-lZ</span> /var/www/html/
ps auxZ | <span class="nb">grep </span>httpd
<span class="nb">id</span> <span class="nt">-Z</span>

<span class="c"># íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ ë³µì›</span>
restorecon <span class="nt">-Rv</span> /var/www/html/
restorecon <span class="nt">-Rv</span> /home/username/

<span class="c"># ì»¨í…ìŠ¤íŠ¸ ìˆ˜ë™ ì„¤ì •</span>
<span class="nb">chcon</span> <span class="nt">-t</span> httpd_exec_t /usr/local/apache2/bin/httpd
semanage fcontext <span class="nt">-a</span> <span class="nt">-t</span> httpd_exec_t <span class="s2">"/usr/local/apache2/bin/httpd"</span>
</code></pre></div></div>

<h4 id="selinux-ì •ì±…-ê´€ë¦¬">SELinux ì •ì±… ê´€ë¦¬</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë¶ˆë¦° ê°’ í™•ì¸ ë° ì„¤ì •</span>
getsebool <span class="nt">-a</span> | <span class="nb">grep </span>httpd
setsebool <span class="nt">-P</span> httpd_can_network_connect on
setsebool <span class="nt">-P</span> httpd_can_sendmail on

<span class="c"># í¬íŠ¸ ë¼ë²¨ ê´€ë¦¬</span>
semanage port <span class="nt">-l</span> | <span class="nb">grep </span>http
semanage port <span class="nt">-a</span> <span class="nt">-t</span> http_port_t <span class="nt">-p</span> tcp 8080

<span class="c"># ì‚¬ìš©ì ë§¤í•‘</span>
semanage login <span class="nt">-l</span>
semanage user <span class="nt">-l</span>
semanage login <span class="nt">-a</span> <span class="nt">-s</span> user_u regularuser

<span class="c"># ì»¤ìŠ¤í…€ ì •ì±… ëª¨ë“ˆ ìƒì„±</span>
<span class="c"># audit.logì—ì„œ ì •ì±… ìƒì„±</span>
<span class="nb">grep </span>httpd /var/log/audit/audit.log | audit2allow <span class="nt">-m</span> myhttpd
<span class="nb">grep </span>httpd /var/log/audit/audit.log | audit2allow <span class="nt">-M</span> myhttpd
semodule <span class="nt">-i</span> myhttpd.pp

<span class="c"># ì •ì±… ëª¨ë“ˆ ê´€ë¦¬</span>
semodule <span class="nt">-l</span> | <span class="nb">grep </span>my
semodule <span class="nt">-r</span> myhttpd
</code></pre></div></div>

<h3 id="ï¸-apparmor-í”„ë¡œíŒŒì¼-ì‘ì„±">ğŸ›¡ï¸ AppArmor í”„ë¡œíŒŒì¼ ì‘ì„±</h3>

<h4 id="apparmor-ê¸°ë³¸-ê´€ë¦¬">AppArmor ê¸°ë³¸ ê´€ë¦¬</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># AppArmor ìƒíƒœ í™•ì¸</span>
aa-status
aa-enabled

<span class="c"># í”„ë¡œíŒŒì¼ ëª¨ë“œ í™•ì¸</span>
aa-status | <span class="nb">grep </span>profiles

<span class="c"># í”„ë¡œíŒŒì¼ ëª¨ë“œ ë³€ê²½</span>
aa-enforce /etc/apparmor.d/usr.bin.firefox
aa-complain /etc/apparmor.d/usr.bin.firefox
aa-disable /etc/apparmor.d/usr.bin.firefox

<span class="c"># í”„ë¡œíŒŒì¼ ì¬ë¡œë“œ</span>
apparmor_parser <span class="nt">-r</span> /etc/apparmor.d/usr.bin.firefox
</code></pre></div></div>

<h4 id="ì»¤ìŠ¤í…€-apparmor-í”„ë¡œíŒŒì¼-ì‘ì„±">ì»¤ìŠ¤í…€ AppArmor í”„ë¡œíŒŒì¼ ì‘ì„±</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ìƒˆë¡œìš´ ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œíŒŒì¼ ìƒì„±</span>
<span class="c"># /etc/apparmor.d/usr.local.bin.myapp</span>
<span class="c">#include &lt;tunables/global&gt;</span>

/usr/local/bin/myapp <span class="o">{</span>
  <span class="c">#include &lt;abstractions/base&gt;</span>
  <span class="c">#include &lt;abstractions/nameservice&gt;</span>
  
  <span class="c"># ì‹¤í–‰ íŒŒì¼</span>
  /usr/local/bin/myapp mr,
  
  <span class="c"># ë¼ì´ë¸ŒëŸ¬ë¦¬</span>
  /lib<span class="o">{</span>,32,64<span class="o">}</span>/<span class="k">**</span> mr,
  /usr/lib<span class="o">{</span>,32,64<span class="o">}</span>/<span class="k">**</span> mr,
  
  <span class="c"># ì„¤ì • íŒŒì¼ (ì½ê¸° ì „ìš©)</span>
  /etc/myapp/<span class="k">**</span> r,
  owner /home/<span class="k">*</span>/.myapp/<span class="k">**</span> rw,
  
  <span class="c"># ë°ì´í„° ë””ë ‰í† ë¦¬</span>
  /var/lib/myapp/<span class="k">**</span> rw,
  /var/log/myapp/<span class="k">**</span> w,
  
  <span class="c"># ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼</span>
  network inet stream,
  network inet6 stream,
  
  <span class="c"># í”„ë¡œì„¸ìŠ¤ ì œì–´</span>
  capability setuid,
  capability setgid,
  
  <span class="c"># ì„ì‹œ íŒŒì¼</span>
  /tmp/myapp.<span class="k">**</span> rw,
  owner /tmp/myapp-<span class="k">**</span> rw,
  
  <span class="c"># ê±°ë¶€í•  ì ‘ê·¼</span>
  deny /etc/passwd r,
  deny /etc/shadow r,
  deny owner /home/<span class="k">*</span>/.ssh/<span class="k">**</span> rw,
  
  <span class="c"># í•˜ìœ„ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰</span>
  /bin/dash ix,
  /usr/bin/python3 ix,
<span class="o">}</span>

<span class="c"># í”„ë¡œíŒŒì¼ ë¡œë“œ ë° í™œì„±í™”</span>
apparmor_parser <span class="nt">-r</span> /etc/apparmor.d/usr.local.bin.myapp
aa-enforce /etc/apparmor.d/usr.local.bin.myapp

<span class="c"># í”„ë¡œíŒŒì¼ ê°œë°œ ëª¨ë“œ (í•™ìŠµ)</span>
aa-genprof /usr/local/bin/myapp
<span class="c"># ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰í•˜ë©° ë™ì‘ í™•ì¸</span>
aa-logprof
</code></pre></div></div>

<h2 id="ì‹œìŠ¤í…œ-í•˜ë“œë‹--system-hardening">ì‹œìŠ¤í…œ í•˜ë“œë‹ | System Hardening</h2>

<h3 id="-ì»¤ë„-ë³´ì•ˆ-ë§¤ê°œë³€ìˆ˜-ì¡°ì •">ğŸ”§ ì»¤ë„ ë³´ì•ˆ ë§¤ê°œë³€ìˆ˜ ì¡°ì •</h3>

<h4 id="sysctl-ë³´ì•ˆ-ì„¤ì •">sysctl ë³´ì•ˆ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/sysctl.d/99-security.conf</span>
<span class="c"># ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ</span>
net.ipv4.ip_forward <span class="o">=</span> 0
net.ipv4.conf.all.send_redirects <span class="o">=</span> 0
net.ipv4.conf.default.send_redirects <span class="o">=</span> 0
net.ipv4.conf.all.accept_redirects <span class="o">=</span> 0
net.ipv4.conf.default.accept_redirects <span class="o">=</span> 0
net.ipv4.conf.all.secure_redirects <span class="o">=</span> 0
net.ipv4.conf.default.secure_redirects <span class="o">=</span> 0
net.ipv6.conf.all.accept_redirects <span class="o">=</span> 0
net.ipv6.conf.default.accept_redirects <span class="o">=</span> 0
net.ipv4.conf.all.accept_source_route <span class="o">=</span> 0
net.ipv4.conf.default.accept_source_route <span class="o">=</span> 0
net.ipv6.conf.all.accept_source_route <span class="o">=</span> 0
net.ipv6.conf.default.accept_source_route <span class="o">=</span> 0

<span class="c"># SYN í”ŒëŸ¬ë“œ ë°©ì§€</span>
net.ipv4.tcp_syncookies <span class="o">=</span> 1
net.ipv4.tcp_max_syn_backlog <span class="o">=</span> 2048
net.ipv4.tcp_synack_retries <span class="o">=</span> 2
net.ipv4.tcp_syn_retries <span class="o">=</span> 5

<span class="c"># ICMP ë³´ì•ˆ</span>
net.ipv4.icmp_echo_ignore_broadcasts <span class="o">=</span> 1
net.ipv4.icmp_ignore_bogus_error_responses <span class="o">=</span> 1
net.ipv4.icmp_echo_ignore_all <span class="o">=</span> 0

<span class="c"># IP ìŠ¤í‘¸í•‘ ë°©ì§€</span>
net.ipv4.conf.all.rp_filter <span class="o">=</span> 1
net.ipv4.conf.default.rp_filter <span class="o">=</span> 1

<span class="c"># IPv6 ë³´ì•ˆ</span>
net.ipv6.conf.all.disable_ipv6 <span class="o">=</span> 1
net.ipv6.conf.default.disable_ipv6 <span class="o">=</span> 1

<span class="c"># ë©”ëª¨ë¦¬ ë³´ì•ˆ</span>
kernel.randomize_va_space <span class="o">=</span> 2
kernel.exec-shield <span class="o">=</span> 1
kernel.dmesg_restrict <span class="o">=</span> 1
kernel.kptr_restrict <span class="o">=</span> 2

<span class="c"># í”„ë¡œì„¸ìŠ¤ ë³´ì•ˆ  </span>
fs.suid_dumpable <span class="o">=</span> 0
kernel.core_uses_pid <span class="o">=</span> 1
kernel.ctrl-alt-del <span class="o">=</span> 0

<span class="c"># ì„¤ì • ì ìš©</span>
sysctl <span class="nt">-p</span> /etc/sysctl.d/99-security.conf
</code></pre></div></div>

<h4 id="íŒŒì¼-ì‹œìŠ¤í…œ-ë³´ì•ˆ">íŒŒì¼ ì‹œìŠ¤í…œ ë³´ì•ˆ</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì¤‘ìš” ë””ë ‰í† ë¦¬ ë§ˆìš´íŠ¸ ì˜µì…˜ ê°•í™”</span>
<span class="c"># /etc/fstab</span>
/tmp        /tmp        tmpfs   defaults,nodev,nosuid,noexec    0 0
/var/tmp    /var/tmp    tmpfs   defaults,nodev,nosuid,noexec    0 0
/dev/shm    /dev/shm    tmpfs   defaults,nodev,nosuid,noexec    0 0

<span class="c"># íŒŒì¼ ê¶Œí•œ ê°•í™”</span>
<span class="nb">chmod </span>700 /root
<span class="nb">chmod </span>600 /etc/ssh/sshd_config
<span class="nb">chmod </span>600 /etc/passwd-
<span class="nb">chmod </span>600 /etc/shadow
<span class="nb">chmod </span>600 /etc/gshadow
<span class="nb">chmod </span>644 /etc/group

<span class="c"># ë¶ˆí•„ìš”í•œ SUID/SGID ì œê±°</span>
find / <span class="nt">-type</span> f <span class="se">\(</span> <span class="nt">-perm</span> <span class="nt">-4000</span> <span class="nt">-o</span> <span class="nt">-perm</span> <span class="nt">-2000</span> <span class="se">\)</span> <span class="nt">-print</span> <span class="o">&gt;</span> /tmp/suid_sgid_files
<span class="c"># ê²€í†  í›„ í•„ìš”ì—†ëŠ” ê²ƒë“¤ ì œê±°</span>
<span class="nb">chmod </span>u-s /usr/bin/unnecessary-suid-program

<span class="c"># ìˆ¨ê²¨ì§„ íŒŒì¼ ë° ë””ë ‰í† ë¦¬ ê²€ì‚¬</span>
find / <span class="nt">-name</span> <span class="s2">".*"</span> <span class="nt">-type</span> f <span class="nt">-exec</span> <span class="nb">ls</span> <span class="nt">-la</span> <span class="o">{}</span> <span class="se">\;</span> 2&gt;/dev/null
find / <span class="nt">-name</span> <span class="s2">".*"</span> <span class="nt">-type</span> d <span class="nt">-exec</span> <span class="nb">ls</span> <span class="nt">-lad</span> <span class="o">{}</span> <span class="se">\;</span> 2&gt;/dev/null

<span class="c"># ëŒ€ìš©ëŸ‰ íŒŒì¼ ê²€ì‚¬ (backdoor ê°€ëŠ¥ì„±)</span>
find / <span class="nt">-size</span> +10M <span class="nt">-type</span> f <span class="nt">-exec</span> <span class="nb">ls</span> <span class="nt">-la</span> <span class="o">{}</span> <span class="se">\;</span> 2&gt;/dev/null

<span class="c"># ìµœê·¼ ìˆ˜ì •ëœ íŒŒì¼ ê²€ì‚¬</span>
find / <span class="nt">-mtime</span> <span class="nt">-7</span> <span class="nt">-type</span> f <span class="nt">-exec</span> <span class="nb">ls</span> <span class="nt">-la</span> <span class="o">{}</span> <span class="se">\;</span> 2&gt;/dev/null
</code></pre></div></div>

<h3 id="-ì„œë¹„ìŠ¤-ë°-ë°ëª¬-ë³´ì•ˆ">ğŸ” ì„œë¹„ìŠ¤ ë° ë°ëª¬ ë³´ì•ˆ</h3>

<h4 id="ë¶ˆí•„ìš”í•œ-ì„œë¹„ìŠ¤-ì œê±°">ë¶ˆí•„ìš”í•œ ì„œë¹„ìŠ¤ ì œê±°</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤ í™•ì¸</span>
systemctl list-units <span class="nt">--type</span><span class="o">=</span>service <span class="nt">--state</span><span class="o">=</span>running
netstat <span class="nt">-tulpn</span>
ss <span class="nt">-tulpn</span>

<span class="c"># ë¶ˆí•„ìš”í•œ ì„œë¹„ìŠ¤ ì¤‘ì§€ ë° ë¹„í™œì„±í™”</span>
systemctl stop cups
systemctl disable cups
systemctl mask cups

<span class="c"># ìœ„í—˜í•œ ì„œë¹„ìŠ¤ë“¤ (ì¼ë°˜ì ìœ¼ë¡œ ë¹„í™œì„±í™”)</span>
<span class="nv">services_to_disable</span><span class="o">=(</span>
    <span class="s2">"telnet"</span>
    <span class="s2">"rsh"</span>
    <span class="s2">"rlogin"</span>
    <span class="s2">"tftp"</span>
    <span class="s2">"xinetd"</span>
    <span class="s2">"sendmail"</span>
    <span class="s2">"postfix"</span>
    <span class="s2">"dovecot"</span>
    <span class="s2">"cups"</span>
    <span class="s2">"avahi-daemon"</span>
    <span class="s2">"bluetooth"</span>
<span class="o">)</span>

<span class="k">for </span>service <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">services_to_disable</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
    if </span>systemctl is-enabled <span class="s2">"</span><span class="nv">$service</span><span class="s2">"</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Disabling </span><span class="nv">$service</span><span class="s2">..."</span>
        systemctl stop <span class="s2">"</span><span class="nv">$service</span><span class="s2">"</span>
        systemctl disable <span class="s2">"</span><span class="nv">$service</span><span class="s2">"</span>
        systemctl mask <span class="s2">"</span><span class="nv">$service</span><span class="s2">"</span>
    <span class="k">fi
done</span>

<span class="c"># ë„¤íŠ¸ì›Œí¬ ì„œë¹„ìŠ¤ ì ê²€</span>
lsof <span class="nt">-i</span>
netstat <span class="nt">-anp</span> | <span class="nb">grep </span>LISTEN
</code></pre></div></div>

<h4 id="ì• í”Œë¦¬ì¼€ì´ì…˜ë³„-ë³´ì•ˆ-ì„¤ì •">ì• í”Œë¦¬ì¼€ì´ì…˜ë³„ ë³´ì•ˆ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Apache ë³´ì•ˆ ì„¤ì •</span>
<span class="c"># /etc/apache2/conf-available/security.conf</span>
ServerTokens Prod
ServerSignature Off
TraceEnable Off
Header always <span class="nb">set </span>X-Content-Type-Options nosniff
Header always <span class="nb">set </span>X-Frame-Options DENY
Header always <span class="nb">set </span>X-XSS-Protection <span class="s2">"1; mode=block"</span>
Header always <span class="nb">set </span>Strict-Transport-Security <span class="s2">"max-age=63072000; includeSubDomains; preload"</span>

<span class="c"># Nginx ë³´ì•ˆ ì„¤ì •</span>
<span class="c"># /etc/nginx/nginx.conf</span>
server_tokens off<span class="p">;</span>
add_header X-Frame-Options DENY<span class="p">;</span>
add_header X-Content-Type-Options nosniff<span class="p">;</span>
add_header X-XSS-Protection <span class="s2">"1; mode=block"</span><span class="p">;</span>
add_header Strict-Transport-Security <span class="s2">"max-age=63072000; includeSubDomains; preload"</span><span class="p">;</span>

<span class="c"># MySQL/MariaDB ë³´ì•ˆ</span>
mysql_secure_installation

<span class="c"># PostgreSQL ë³´ì•ˆ ì„¤ì •</span>
<span class="c"># /etc/postgresql/*/main/postgresql.conf</span>
ssl <span class="o">=</span> on
ssl_ciphers <span class="o">=</span> <span class="s1">'HIGH:MEDIUM:+3DES:!aNULL'</span>
ssl_prefer_server_ciphers <span class="o">=</span> on

<span class="c"># /etc/postgresql/*/main/pg_hba.conf</span>
<span class="c"># TYPE  DATABASE        USER            ADDRESS                 METHOD</span>
<span class="nb">local   </span>all             all                                     md5
host    all             all             127.0.0.1/32            md5
host    all             all             ::1/128                 md5
</code></pre></div></div>

<h2 id="ì¹¨ì…-íƒì§€-ì‹œìŠ¤í…œ--intrusion-detection-systems">ì¹¨ì… íƒì§€ ì‹œìŠ¤í…œ | Intrusion Detection Systems</h2>

<h3 id="-aide-advanced-intrusion-detection-environment">ğŸš¨ AIDE (Advanced Intrusion Detection Environment)</h3>

<h4 id="aide-ì„¤ì¹˜-ë°-êµ¬ì„±">AIDE ì„¤ì¹˜ ë° êµ¬ì„±</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># AIDE ì„¤ì¹˜</span>
apt-get <span class="nb">install </span>aide aide-common

<span class="c"># ì„¤ì • íŒŒì¼ ìˆ˜ì •</span>
<span class="c"># /etc/aide/aide.conf</span>
<span class="nv">database</span><span class="o">=</span>file:/var/lib/aide/aide.db
<span class="nv">database_out</span><span class="o">=</span>file:/var/lib/aide/aide.db.new
<span class="nv">gzip_dbout</span><span class="o">=</span><span class="nb">yes
</span><span class="nv">report_url</span><span class="o">=</span>file:/var/log/aide/aide.log
<span class="nv">report_url</span><span class="o">=</span>stdout

<span class="c"># ê·œì¹™ ì •ì˜</span>
/boot   f+p+u+g+s+b+m+c+md5+sha1
/bin    f+p+u+g+s+b+m+c+md5+sha1
/sbin   f+p+u+g+s+b+m+c+md5+sha1
/lib    f+p+u+g+s+b+m+c+md5+sha1
/opt    f+p+u+g+s+b+m+c+md5+sha1
/usr    f+p+u+g+s+b+m+c+md5+sha1
/root   f+p+u+g+s+b+m+c+md5+sha1
/etc    f+p+u+g+s+b+m+c+md5+sha1

<span class="c"># ì œì™¸í•  ë””ë ‰í† ë¦¬</span>
<span class="o">!</span>/var/log/.<span class="k">*</span>
<span class="o">!</span>/var/spool/.<span class="k">*</span>
<span class="o">!</span>/var/run/.<span class="k">*</span>
<span class="o">!</span>/var/lock/.<span class="k">*</span>
<span class="o">!</span>/proc/.<span class="k">*</span>
<span class="o">!</span>/sys/.<span class="k">*</span>
<span class="o">!</span>/dev/.<span class="k">*</span>
<span class="o">!</span>/tmp/.<span class="k">*</span>

<span class="c"># ì´ˆê¸° ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±</span>
aideinit

<span class="c"># ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸</span>
<span class="nb">cp</span> /var/lib/aide/aide.db.new /var/lib/aide/aide.db

<span class="c"># ë¬´ê²°ì„± ê²€ì‚¬ ì‹¤í–‰</span>
aide <span class="nt">--check</span>

<span class="c"># ìë™í™” ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/aide-check.sh</span>
<span class="nv">AIDE_LOG</span><span class="o">=</span><span class="s2">"/var/log/aide/aide-</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span><span class="s2">.log"</span>

aide <span class="nt">--check</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$AIDE_LOG</span><span class="s2">"</span> 2&gt;&amp;1
<span class="nv">EXIT_CODE</span><span class="o">=</span><span class="nv">$?</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$EXIT_CODE</span> <span class="nt">-ne</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"AIDE detected changes on </span><span class="si">$(</span><span class="nb">hostname</span><span class="si">)</span><span class="s2">"</span> | <span class="se">\</span>
    mail <span class="nt">-s</span> <span class="s2">"AIDE Alert - File Integrity Check Failed"</span> admin@company.com <span class="se">\</span>
    <span class="nt">-A</span> <span class="s2">"</span><span class="nv">$AIDE_LOG</span><span class="s2">"</span>
<span class="k">fi</span>

<span class="c"># cron ì„¤ì •</span>
<span class="c"># /etc/cron.d/aide</span>
0 2 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> root /usr/local/bin/aide-check.sh
</code></pre></div></div>

<h3 id="-fail2ban-ì„¤ì •">ğŸ” Fail2Ban ì„¤ì •</h3>

<h4 id="fail2ban-êµ¬ì„±-ë°-ì»¤ìŠ¤í„°ë§ˆì´ì§•">Fail2Ban êµ¬ì„± ë° ì»¤ìŠ¤í„°ë§ˆì´ì§•</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Fail2Ban ì„¤ì¹˜</span>
apt-get <span class="nb">install </span>fail2ban

<span class="c"># ê¸°ë³¸ ì„¤ì • íŒŒì¼ ë³µì‚¬</span>
<span class="nb">cp</span> /etc/fail2ban/jail.conf /etc/fail2ban/jail.local

<span class="c"># /etc/fail2ban/jail.local ì„¤ì •</span>
<span class="o">[</span>DEFAULT]
bantime <span class="o">=</span> 3600
findtime <span class="o">=</span> 600
maxretry <span class="o">=</span> 3
backend <span class="o">=</span> systemd
banaction <span class="o">=</span> iptables-multiport
banaction_allports <span class="o">=</span> iptables-allports
ignoreip <span class="o">=</span> 127.0.0.1/8 192.168.1.0/24 10.0.0.0/8

<span class="c"># SSH ë³´í˜¸</span>
<span class="o">[</span>sshd]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> 2222
logpath <span class="o">=</span> /var/log/auth.log
maxretry <span class="o">=</span> 3
bantime <span class="o">=</span> 3600

<span class="c"># Apache ë³´í˜¸</span>
<span class="o">[</span>apache-auth]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> http,https
logpath <span class="o">=</span> /var/log/apache2/error.log

<span class="o">[</span>apache-badbots]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> http,https
logpath <span class="o">=</span> /var/log/apache2/access.log

<span class="o">[</span>apache-noscript]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> http,https
logpath <span class="o">=</span> /var/log/apache2/access.log

<span class="c"># ì»¤ìŠ¤í…€ í•„í„° ìƒì„±</span>
<span class="c"># /etc/fail2ban/filter.d/custom-app.conf</span>
<span class="o">[</span>Definition]
failregex <span class="o">=</span> ^.<span class="k">*</span>Failed login attempt from &lt;HOST&gt;.<span class="k">*</span><span class="err">$</span>
            ^.<span class="k">*</span>Invalid user .<span class="k">*</span> from &lt;HOST&gt;.<span class="k">*</span><span class="err">$</span>
            ^.<span class="k">*</span>authentication failure.<span class="k">*</span><span class="nv">rhost</span><span class="o">=</span>&lt;HOST&gt;.<span class="k">*</span><span class="err">$</span>
ignoreregex <span class="o">=</span>

<span class="c"># ì»¤ìŠ¤í…€ jail ì„¤ì •</span>
<span class="c"># /etc/fail2ban/jail.localì— ì¶”ê°€</span>
<span class="o">[</span>custom-app]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> 8080
logpath <span class="o">=</span> /var/log/custom-app.log
filter <span class="o">=</span> custom-app
maxretry <span class="o">=</span> 5
bantime <span class="o">=</span> 7200

<span class="c"># Fail2Ban ê´€ë¦¬ ëª…ë ¹</span>
fail2ban-client status
fail2ban-client status sshd
fail2ban-client unban 192.168.1.100
fail2ban-client reload
</code></pre></div></div>

<h3 id="-ossecwazuh-ì„¤ì¹˜">ğŸ” OSSEC/Wazuh ì„¤ì¹˜</h3>

<h4 id="wazuh-agent-ì„¤ì¹˜-ë°-êµ¬ì„±">Wazuh Agent ì„¤ì¹˜ ë° êµ¬ì„±</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Wazuh ì €ì¥ì†Œ ì¶”ê°€</span>
curl <span class="nt">-s</span> https://packages.wazuh.com/key/GPG-KEY-WAZUH | apt-key add -
<span class="nb">echo</span> <span class="s2">"deb https://packages.wazuh.com/4.x/apt/ stable main"</span> <span class="o">&gt;</span> /etc/apt/sources.list.d/wazuh.list
apt-get update

<span class="c"># Wazuh Agent ì„¤ì¹˜</span>
apt-get <span class="nb">install </span>wazuh-agent

<span class="c"># ì—ì´ì „íŠ¸ ì„¤ì •</span>
<span class="c"># /var/ossec/etc/ossec.conf</span>
&lt;ossec_config&gt;
  &lt;client&gt;
    &lt;server&gt;
      &lt;address&gt;MANAGER_IP&lt;/address&gt;
      &lt;port&gt;1514&lt;/port&gt;
      &lt;protocol&gt;tcp&lt;/protocol&gt;
    &lt;/server&gt;
    &lt;config-profile&gt;linux, ubuntu, ubuntu20,&lt;/config-profile&gt;
    &lt;notify_time&gt;10&lt;/notify_time&gt;
    &lt;time-reconnect&gt;60&lt;/time-reconnect&gt;
    &lt;auto_restart&gt;yes&lt;/auto_restart&gt;
    &lt;crypto_method&gt;aes&lt;/crypto_method&gt;
  &lt;/client&gt;

  &lt;<span class="o">!</span><span class="nt">--</span> ë¡œê·¸ ëª¨ë‹ˆí„°ë§ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;localfile&gt;
    &lt;log_format&gt;syslog&lt;/log_format&gt;
    &lt;location&gt;/var/log/auth.log&lt;/location&gt;
  &lt;/localfile&gt;

  &lt;localfile&gt;
    &lt;log_format&gt;syslog&lt;/log_format&gt;
    &lt;location&gt;/var/log/syslog&lt;/location&gt;
  &lt;/localfile&gt;

  &lt;localfile&gt;
    &lt;log_format&gt;apache&lt;/log_format&gt;
    &lt;location&gt;/var/log/apache2/access.log&lt;/location&gt;
  &lt;/localfile&gt;

  &lt;<span class="o">!</span><span class="nt">--</span> íŒŒì¼ ë¬´ê²°ì„± ëª¨ë‹ˆí„°ë§ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;syscheck&gt;
    &lt;disabled&gt;no&lt;/disabled&gt;
    &lt;frequency&gt;43200&lt;/frequency&gt;
    &lt;scan_on_start&gt;yes&lt;/scan_on_start&gt;
    
    &lt;directories <span class="nv">check_all</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">realtime</span><span class="o">=</span><span class="s2">"yes"</span><span class="o">&gt;</span>/etc&lt;/directories&gt;
    &lt;directories <span class="nv">check_all</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">realtime</span><span class="o">=</span><span class="s2">"yes"</span><span class="o">&gt;</span>/usr/bin&lt;/directories&gt;
    &lt;directories <span class="nv">check_all</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">realtime</span><span class="o">=</span><span class="s2">"yes"</span><span class="o">&gt;</span>/usr/sbin&lt;/directories&gt;
    &lt;directories <span class="nv">check_all</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">realtime</span><span class="o">=</span><span class="s2">"yes"</span><span class="o">&gt;</span>/bin&lt;/directories&gt;
    &lt;directories <span class="nv">check_all</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">realtime</span><span class="o">=</span><span class="s2">"yes"</span><span class="o">&gt;</span>/sbin&lt;/directories&gt;
    
    &lt;ignore&gt;/etc/mtab&lt;/ignore&gt;
    &lt;ignore&gt;/etc/hosts.deny&lt;/ignore&gt;
    &lt;ignore&gt;/etc/mail/statistics&lt;/ignore&gt;
    &lt;ignore&gt;/etc/random-seed&lt;/ignore&gt;
    &lt;ignore&gt;/etc/adjtime&lt;/ignore&gt;
  &lt;/syscheck&gt;

  &lt;<span class="o">!</span><span class="nt">--</span> ë£¨íŠ¸í‚· íƒì§€ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;rootcheck&gt;
    &lt;disabled&gt;no&lt;/disabled&gt;
    &lt;check_files&gt;yes&lt;/check_files&gt;
    &lt;check_trojans&gt;yes&lt;/check_trojans&gt;
    &lt;check_dev&gt;yes&lt;/check_dev&gt;
    &lt;check_sys&gt;yes&lt;/check_sys&gt;
    &lt;check_pids&gt;yes&lt;/check_pids&gt;
    &lt;check_ports&gt;yes&lt;/check_ports&gt;
    &lt;check_if&gt;yes&lt;/check_if&gt;
  &lt;/rootcheck&gt;

  &lt;<span class="o">!</span><span class="nt">--</span> í™œì„± ì‘ë‹µ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;active-response&gt;
    &lt;disabled&gt;no&lt;/disabled&gt;
    &lt;ca_store&gt;/var/ossec/etc/wpk_root.pem&lt;/ca_store&gt;
    &lt;ca_verification&gt;yes&lt;/ca_verification&gt;
  &lt;/active-response&gt;
&lt;/ossec_config&gt;

<span class="c"># ì„œë¹„ìŠ¤ ì‹œì‘</span>
systemctl <span class="nb">enable </span>wazuh-agent
systemctl start wazuh-agent

<span class="c"># ìƒíƒœ í™•ì¸</span>
systemctl status wazuh-agent
/var/ossec/bin/ossec-control status
</code></pre></div></div>

<h2 id="ì»¨í…Œì´ë„ˆ-ë³´ì•ˆ--container-security">ì»¨í…Œì´ë„ˆ ë³´ì•ˆ | Container Security</h2>

<h3 id="-docker-ë³´ì•ˆ-ì„¤ì •">ğŸ³ Docker ë³´ì•ˆ ì„¤ì •</h3>

<h4 id="docker-ë°ëª¬-ë³´ì•ˆ-ê°•í™”">Docker ë°ëª¬ ë³´ì•ˆ ê°•í™”</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Docker ë°ëª¬ ì„¤ì •</span>
<span class="c"># /etc/docker/daemon.json</span>
<span class="o">{</span>
    <span class="s2">"icc"</span>: <span class="nb">false</span>,
    <span class="s2">"userns-remap"</span>: <span class="s2">"default"</span>,
    <span class="s2">"no-new-privileges"</span>: <span class="nb">true</span>,
    <span class="s2">"seccomp-profile"</span>: <span class="s2">"/etc/docker/seccomp.json"</span>,
    <span class="s2">"selinux-enabled"</span>: <span class="nb">true</span>,
    <span class="s2">"disable-legacy-registry"</span>: <span class="nb">true</span>,
    <span class="s2">"live-restore"</span>: <span class="nb">true</span>,
    <span class="s2">"userland-proxy"</span>: <span class="nb">false</span>,
    <span class="s2">"experimental"</span>: <span class="nb">false</span>,
    <span class="s2">"metrics-addr"</span>: <span class="s2">"127.0.0.1:9323"</span>,
    <span class="s2">"log-driver"</span>: <span class="s2">"json-file"</span>,
    <span class="s2">"log-opts"</span>: <span class="o">{</span>
        <span class="s2">"max-size"</span>: <span class="s2">"10m"</span>,
        <span class="s2">"max-file"</span>: <span class="s2">"3"</span>
    <span class="o">}</span>,
    <span class="s2">"storage-driver"</span>: <span class="s2">"overlay2"</span>,
    <span class="s2">"default-ulimits"</span>: <span class="o">{</span>
        <span class="s2">"nofile"</span>: <span class="o">{</span>
            <span class="s2">"name"</span>: <span class="s2">"nofile"</span>,
            <span class="s2">"hard"</span>: 64000,
            <span class="s2">"soft"</span>: 64000
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c"># ì‹œìŠ¤í…œ ì¬ì‹œì‘</span>
systemctl restart docker

<span class="c"># ë³´ì•ˆ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì˜ˆì‹œ</span>
docker run <span class="nt">-d</span> <span class="se">\</span>
  <span class="nt">--name</span> secure-app <span class="se">\</span>
  <span class="nt">--read-only</span> <span class="se">\</span>
  <span class="nt">--tmpfs</span> /tmp <span class="se">\</span>
  <span class="nt">--tmpfs</span> /var/run <span class="se">\</span>
  <span class="nt">--tmpfs</span> /var/lock <span class="se">\</span>
  <span class="nt">--user</span> 1000:1000 <span class="se">\</span>
  <span class="nt">--cap-drop</span> ALL <span class="se">\</span>
  <span class="nt">--cap-add</span> NET_BIND_SERVICE <span class="se">\</span>
  <span class="nt">--security-opt</span> no-new-privileges:true <span class="se">\</span>
  <span class="nt">--security-opt</span> apparmor:docker-default <span class="se">\</span>
  <span class="nt">--memory</span> 512m <span class="se">\</span>
  <span class="nt">--cpus</span><span class="o">=</span><span class="s2">"0.5"</span> <span class="se">\</span>
  <span class="nt">--pids-limit</span> 100 <span class="se">\</span>
  <span class="nt">--restart</span> unless-stopped <span class="se">\</span>
  nginx:alpine
</code></pre></div></div>

<h4 id="dockerfile-ë³´ì•ˆ-ëª¨ë²”-ì‚¬ë¡€">Dockerfile ë³´ì•ˆ ëª¨ë²” ì‚¬ë¡€</h4>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë³´ì•ˆ ê°•í™” Dockerfile ì˜ˆì‹œ</span>
<span class="k">FROM</span><span class="s"> alpine:3.18</span>

<span class="c"># ë³´ì•ˆ ì—…ë°ì´íŠ¸ ì ìš©</span>
<span class="k">RUN </span>apk update <span class="o">&amp;&amp;</span> apk upgrade <span class="o">&amp;&amp;</span> <span class="se">\
</span>    apk add <span class="nt">--no-cache</span> tini <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">rm</span> <span class="nt">-rf</span> /var/cache/apk/<span class="k">*</span>

<span class="c"># ë¹„íŠ¹ê¶Œ ì‚¬ìš©ì ìƒì„±</span>
<span class="k">RUN </span>addgroup <span class="nt">-g</span> 1000 <span class="nt">-S</span> appgroup <span class="o">&amp;&amp;</span> <span class="se">\
</span>    adduser <span class="nt">-u</span> 1000 <span class="nt">-S</span> appuser <span class="nt">-G</span> appgroup

<span class="c"># ì• í”Œë¦¬ì¼€ì´ì…˜ ë””ë ‰í† ë¦¬ ìƒì„± ë° ê¶Œí•œ ì„¤ì •</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> --chown=appuser:appgroup . .</span>

<span class="c"># ì‹¤í–‰ íŒŒì¼ ê¶Œí•œë§Œ ë¶€ì—¬</span>
<span class="k">RUN </span><span class="nb">chmod </span>755 /app/entrypoint.sh <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">chmod </span>644 /app/<span class="k">*</span>.conf

<span class="c"># ë¹„íŠ¹ê¶Œ ì‚¬ìš©ìë¡œ ì „í™˜</span>
<span class="k">USER</span><span class="s"> appuser:appgroup</span>

<span class="c"># ì‹œê·¸ë„ ì²˜ë¦¬ë¥¼ ìœ„í•œ tini ì‚¬ìš©</span>
<span class="k">ENTRYPOINT</span><span class="s"> ["/sbin/tini", "--"]</span>
<span class="k">CMD</span><span class="s"> ["./entrypoint.sh"]</span>

<span class="c"># ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ í¬íŠ¸ ë…¸ì¶œ ê¸ˆì§€</span>
<span class="c"># EXPOSE 80 (í•„ìš”í•œ ê²½ìš°ë§Œ)</span>

<span class="c"># í—¬ìŠ¤ì²´í¬ ì¶”ê°€</span>
<span class="k">HEALTHCHECK</span><span class="s"> --interval=30s --timeout=3s --start-period=5s --retries=3 \</span>
  CMD curl -f http://localhost:8080/health || exit 1
</code></pre></div></div>

<h3 id="-kubernetes-ë³´ì•ˆ">âš“ Kubernetes ë³´ì•ˆ</h3>

<h4 id="pod-security-standards-ì ìš©">Pod Security Standards ì ìš©</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Pod Security Policy (deprecated, use Pod Security Standards)</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Namespace</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">secure-namespace</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">pod-security.kubernetes.io/enforce</span><span class="pi">:</span> <span class="s">restricted</span>
    <span class="na">pod-security.kubernetes.io/audit</span><span class="pi">:</span> <span class="s">restricted</span>
    <span class="na">pod-security.kubernetes.io/warn</span><span class="pi">:</span> <span class="s">restricted</span>

<span class="nn">---</span>
<span class="c1"># ë³´ì•ˆ ê°•í™” Pod ì˜ˆì‹œ</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">secure-pod</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">secure-namespace</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">securityContext</span><span class="pi">:</span>
    <span class="na">runAsNonRoot</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">1000</span>
    <span class="na">runAsGroup</span><span class="pi">:</span> <span class="m">1000</span>
    <span class="na">fsGroup</span><span class="pi">:</span> <span class="m">1000</span>
    <span class="na">seccompProfile</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">RuntimeDefault</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">app</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
    <span class="na">securityContext</span><span class="pi">:</span>
      <span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="kc">false</span>
      <span class="na">readOnlyRootFilesystem</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="na">runAsNonRoot</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">1000</span>
      <span class="na">capabilities</span><span class="pi">:</span>
        <span class="na">drop</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">ALL</span>
        <span class="na">add</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">NET_BIND_SERVICE</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">limits</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">256Mi"</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">200m"</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">128Mi"</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">100m"</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">tmp-volume</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/tmp</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">var-cache-nginx</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/cache/nginx</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">var-run</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/run</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">tmp-volume</span>
    <span class="na">emptyDir</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">var-cache-nginx</span>
    <span class="na">emptyDir</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">var-run</span>
    <span class="na">emptyDir</span><span class="pi">:</span> <span class="pi">{}</span>

<span class="nn">---</span>
<span class="c1"># Network Policy</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NetworkPolicy</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">default-deny-all</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">secure-namespace</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">podSelector</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="na">policyTypes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">Ingress</span>
  <span class="pi">-</span> <span class="s">Egress</span>

<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NetworkPolicy</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">allow-web-traffic</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">secure-namespace</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">podSelector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">web</span>
  <span class="na">policyTypes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">Ingress</span>
  <span class="pi">-</span> <span class="s">Egress</span>
  <span class="na">ingress</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">from</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">namespaceSelector</span><span class="pi">:</span>
        <span class="na">matchLabels</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-system</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
  <span class="na">egress</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">to</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">podSelector</span><span class="pi">:</span>
        <span class="na">matchLabels</span><span class="pi">:</span>
          <span class="na">app</span><span class="pi">:</span> <span class="s">database</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">5432</span>
  <span class="pi">-</span> <span class="na">to</span><span class="pi">:</span> <span class="pi">{}</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">UDP</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">53</span>
</code></pre></div></div>

<h2 id="ì»´í”Œë¼ì´ì–¸ìŠ¤ì™€-ê°ì‚¬--compliance-and-auditing">ì»´í”Œë¼ì´ì–¸ìŠ¤ì™€ ê°ì‚¬ | Compliance and Auditing</h2>

<h3 id="-cis-benchmark-ì ìš©">ğŸ“‹ CIS Benchmark ì ìš©</h3>

<h4 id="cis-controls-ìë™í™”-ìŠ¤í¬ë¦½íŠ¸">CIS Controls ìë™í™” ìŠ¤í¬ë¦½íŠ¸</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># CIS Ubuntu 20.04 LTS Benchmark ìë™ ì ìš© ìŠ¤í¬ë¦½íŠ¸</span>

<span class="nb">echo</span> <span class="s2">"CIS Benchmark ìë™ ì ìš©ì„ ì‹œì‘í•©ë‹ˆë‹¤..."</span>

<span class="c"># 1. íŒŒì¼ ì‹œìŠ¤í…œ êµ¬ì„±</span>
<span class="nb">echo</span> <span class="s2">"1. íŒŒì¼ ì‹œìŠ¤í…œ ë³´ì•ˆ ì„¤ì •..."</span>

<span class="c"># 1.1 ì„ì‹œ íŒŒì¼ ì‹œìŠ¤í…œ ë³´ì•ˆ</span>
<span class="k">if</span> <span class="o">!</span> <span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"/tmp.*nodev"</span> /etc/fstab<span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"/tmp /tmp tmpfs defaults,rw,nosuid,nodev,noexec,relatime 0 0"</span> <span class="o">&gt;&gt;</span> /etc/fstab
<span class="k">fi</span>

<span class="c"># 1.2 ë¶ˆí•„ìš”í•œ íŒŒì¼ ì‹œìŠ¤í…œ ë¹„í™œì„±í™”</span>
<span class="nb">cat</span> <span class="o">&gt;&gt;</span> /etc/modprobe.d/blacklist-rare-filesystems.conf <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
install cramfs /bin/true
install freevxfs /bin/true
install jffs2 /bin/true
install hfs /bin/true
install hfsplus /bin/true
install squashfs /bin/true
install udf /bin/true
install fat /bin/true
install vfat /bin/true
install usb-storage /bin/true
</span><span class="no">EOF

</span><span class="c"># 2. ì„œë¹„ìŠ¤ ì„¤ì •</span>
<span class="nb">echo</span> <span class="s2">"2. ì„œë¹„ìŠ¤ ë³´ì•ˆ ì„¤ì •..."</span>

<span class="c"># 2.1 ì‹œê°„ ë™ê¸°í™”</span>
systemctl <span class="nb">enable </span>ntp
systemctl start ntp

<span class="c"># 2.2 ë¶ˆí•„ìš”í•œ ì„œë¹„ìŠ¤ ë¹„í™œì„±í™”</span>
<span class="nv">services_to_disable</span><span class="o">=(</span>
    <span class="s2">"autofs"</span>
    <span class="s2">"avahi-daemon"</span> 
    <span class="s2">"cups"</span>
    <span class="s2">"dhcpd"</span>
    <span class="s2">"slapd"</span>
    <span class="s2">"nfs"</span>
    <span class="s2">"rpcbind"</span>
    <span class="s2">"bind9"</span>
    <span class="s2">"vsftpd"</span>
    <span class="s2">"apache2"</span>
    <span class="s2">"dovecot"</span>
    <span class="s2">"smbd"</span>
    <span class="s2">"squid"</span>
    <span class="s2">"snmpd"</span>
    <span class="s2">"rsync"</span>
<span class="o">)</span>

<span class="k">for </span>service <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">services_to_disable</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
    if </span>systemctl is-enabled <span class="s2">"</span><span class="nv">$service</span><span class="s2">"</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
        </span>systemctl disable <span class="s2">"</span><span class="nv">$service</span><span class="s2">"</span>
        systemctl stop <span class="s2">"</span><span class="nv">$service</span><span class="s2">"</span>
    <span class="k">fi
done</span>

<span class="c"># 3. ë„¤íŠ¸ì›Œí¬ ë§¤ê°œë³€ìˆ˜ ì„¤ì •</span>
<span class="nb">echo</span> <span class="s2">"3. ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ ì„¤ì •..."</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/sysctl.d/99-cis.conf <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
net.ipv4.ip_forward = 0
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.secure_redirects = 0
net.ipv4.conf.all.log_martians = 1
net.ipv4.conf.default.log_martians = 1
net.ipv4.icmp_echo_ignore_broadcasts = 1
net.ipv4.icmp_ignore_bogus_error_responses = 1
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.default.rp_filter = 1
net.ipv4.tcp_syncookies = 1
net.ipv6.conf.all.accept_ra = 0
net.ipv6.conf.default.accept_ra = 0
net.ipv6.conf.all.accept_redirects = 0
net.ipv6.conf.default.accept_redirects = 0
net.ipv6.conf.all.disable_ipv6 = 1
</span><span class="no">EOF

</span>sysctl <span class="nt">-p</span> /etc/sysctl.d/99-cis.conf

<span class="c"># 4. ë¡œê¹… ë° ê°ì‚¬ ì„¤ì •</span>
<span class="nb">echo</span> <span class="s2">"4. ë¡œê¹… ë° ê°ì‚¬ ì„¤ì •..."</span>

<span class="c"># 4.1 auditd ì„¤ì¹˜ ë° êµ¬ì„±</span>
apt-get <span class="nb">install</span> <span class="nt">-y</span> auditd audispd-plugins

<span class="nb">cat</span> <span class="o">&gt;</span> /etc/audit/rules.d/cis.rules <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
# ì‹œê°„ ë³€ê²½ ê°ì‚¬
-a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time-change
-a always,exit -F arch=b32 -S adjtimex -S settimeofday -S stime -k time-change
-a always,exit -F arch=b64 -S clock_settime -k time-change
-a always,exit -F arch=b32 -S clock_settime -k time-change
-w /etc/localtime -p wa -k time-change

# ì‚¬ìš©ì/ê·¸ë£¹ ì •ë³´ ê°ì‚¬
-w /etc/group -p wa -k identity
-w /etc/passwd -p wa -k identity
-w /etc/gshadow -p wa -k identity
-w /etc/shadow -p wa -k identity
-w /etc/security/opasswd -p wa -k identity

# ë„¤íŠ¸ì›Œí¬ í™˜ê²½ ê°ì‚¬
-a always,exit -F arch=b64 -S sethostname -S setdomainname -k system-locale
-a always,exit -F arch=b32 -S sethostname -S setdomainname -k system-locale
-w /etc/issue -p wa -k system-locale
-w /etc/issue.net -p wa -k system-locale
-w /etc/hosts -p wa -k system-locale
-w /etc/network -p wa -k system-locale

# MAC ì •ì±… ë³€ê²½ ê°ì‚¬
-w /etc/selinux/ -p wa -k MAC-policy
-w /usr/share/selinux/ -p wa -k MAC-policy

# ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ê°ì‚¬
-w /var/log/faillog -p wa -k logins
-w /var/log/lastlog -p wa -k logins
-w /var/log/tallylog -p wa -k logins

# ì„¸ì…˜ ì‹œì‘ ì •ë³´ ê°ì‚¬
-w /var/run/utmp -p wa -k session
-w /var/log/wtmp -p wa -k logins
-w /var/log/btmp -p wa -k logins

# ê¶Œí•œ ë³€ê²½ ê°ì‚¬
-a always,exit -F arch=b64 -S chmod -S fchmod -S fchmodat -F auid&gt;=1000 -F auid!=4294967295 -k perm_mod
-a always,exit -F arch=b32 -S chmod -S fchmod -S fchmodat -F auid&gt;=1000 -F auid!=4294967295 -k perm_mod
-a always,exit -F arch=b64 -S chown -S fchown -S fchownat -S lchown -F auid&gt;=1000 -F auid!=4294967295 -k perm_mod
-a always,exit -F arch=b32 -S chown -S fchown -S fchownat -S lchown -F auid&gt;=1000 -F auid!=4294967295 -k perm_mod

# ê´€ë¦¬ì ì•¡ì„¸ìŠ¤ ê°ì‚¬
-w /etc/sudoers -p wa -k scope
-w /etc/sudoers.d/ -p wa -k scope

# ì»¤ë„ ëª¨ë“ˆ ë¡œë”©/ì–¸ë¡œë”© ê°ì‚¬
-w /sbin/insmod -p x -k modules
-w /sbin/rmmod -p x -k modules
-w /sbin/modprobe -p x -k modules
-a always,exit -F arch=b64 -S init_module -S delete_module -k modules

# íŒŒì¼ ì‚­ì œ ê°ì‚¬
-a always,exit -F arch=b64 -S unlink -S unlinkat -S rename -S renameat -F auid&gt;=1000 -F auid!=4294967295 -k delete
-a always,exit -F arch=b32 -S unlink -S unlinkat -S rename -S renameat -F auid&gt;=1000 -F auid!=4294967295 -k delete

# ì„¤ì • ë¶ˆë³€ì„±
-e 2
</span><span class="no">EOF

</span>systemctl <span class="nb">enable </span>auditd
systemctl start auditd

<span class="c"># 5. ì•¡ì„¸ìŠ¤ ì œì–´ ì„¤ì •</span>
<span class="nb">echo</span> <span class="s2">"5. ì•¡ì„¸ìŠ¤ ì œì–´ ì„¤ì •..."</span>

<span class="c"># 5.1 cron ì ‘ê·¼ ì œí•œ</span>
<span class="nb">echo</span> <span class="s2">"root"</span> <span class="o">&gt;</span> /etc/cron.allow
<span class="nb">chmod </span>600 /etc/cron.allow
<span class="nb">rm</span> <span class="nt">-f</span> /etc/cron.deny

<span class="c"># 5.2 SSH ë³´ì•ˆ ê°•í™” (ì´ë¯¸ ì•ì—ì„œ ë‹¤ë£¸)</span>
<span class="c"># 5.3 PAM ì„¤ì • ê°•í™” (ì´ë¯¸ ì•ì—ì„œ ë‹¤ë£¸)</span>

<span class="c"># 6. ì‹œìŠ¤í…œ ìœ ì§€ë³´ìˆ˜</span>
<span class="nb">echo</span> <span class="s2">"6. ì‹œìŠ¤í…œ ìœ ì§€ë³´ìˆ˜ ì„¤ì •..."</span>

<span class="c"># 6.1 íŒŒì¼ ê¶Œí•œ ì ê²€</span>
find /etc <span class="nt">-type</span> f <span class="nt">-perm</span> /g+w,o+w <span class="nt">-exec</span> <span class="nb">chmod </span>go-w <span class="o">{}</span> <span class="se">\;</span>

<span class="c"># 6.2 SUID/SGID ì ê²€ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /usr/local/bin/check-suid-sgid.sh <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
#!/bin/bash
find / </span><span class="se">\(</span><span class="sh"> -perm -4000 -o -perm -2000 </span><span class="se">\)</span><span class="sh"> -type f -exec ls -ld {} </span><span class="se">\;</span><span class="sh"> 2&gt;/dev/null | </span><span class="se">\</span><span class="sh">
while read line; do
    echo "</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="sh">: </span><span class="nv">$line</span><span class="sh">" &gt;&gt; /var/log/suid-sgid.log
done
</span><span class="no">EOF

</span><span class="nb">chmod</span> +x /usr/local/bin/check-suid-sgid.sh

<span class="c"># 6.3 ì •ê¸° ë³´ì•ˆ ì ê²€ cron ì„¤ì •</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/cron.daily/security-check <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
#!/bin/bash
/usr/local/bin/check-suid-sgid.sh
/usr/bin/aide --check 2&gt;&amp;1 | logger -t aide
</span><span class="no">EOF

</span><span class="nb">chmod</span> +x /etc/cron.daily/security-check

<span class="nb">echo</span> <span class="s2">"CIS Benchmark ì ìš© ì™„ë£Œ!"</span>
<span class="nb">echo</span> <span class="s2">"ì‹œìŠ¤í…œì„ ì¬ë¶€íŒ…í•˜ì—¬ ëª¨ë“  ì„¤ì •ì„ ì ìš©í•˜ì„¸ìš”."</span>
</code></pre></div></div>

<h3 id="-ë³´ì•ˆ-ëª¨ë‹ˆí„°ë§-ëŒ€ì‹œë³´ë“œ">ğŸ“Š ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</h3>

<h4 id="prometheus--grafana-ë³´ì•ˆ-ë©”íŠ¸ë¦­">Prometheus + Grafana ë³´ì•ˆ ë©”íŠ¸ë¦­</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># prometheus-rules.yml</span>
<span class="na">groups</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">security_rules</span>
  <span class="na">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">alert</span><span class="pi">:</span> <span class="s">HighFailedLoginRate</span>
    <span class="na">expr</span><span class="pi">:</span> <span class="s">rate(node_auth_failed_total[5m]) &gt; </span><span class="m">0.1</span>
    <span class="na">for</span><span class="pi">:</span> <span class="s">2m</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">severity</span><span class="pi">:</span> <span class="s">warning</span>
    <span class="na">annotations</span><span class="pi">:</span>
      <span class="na">summary</span><span class="pi">:</span> <span class="s2">"</span><span class="s">High</span><span class="nv"> </span><span class="s">failed</span><span class="nv"> </span><span class="s">login</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">detected"</span>
      <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.instance</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">has</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">high</span><span class="nv"> </span><span class="s">failed</span><span class="nv"> </span><span class="s">login</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">per</span><span class="nv"> </span><span class="s">second"</span>

  <span class="pi">-</span> <span class="na">alert</span><span class="pi">:</span> <span class="s">RootLoginDetected</span>
    <span class="na">expr</span><span class="pi">:</span> <span class="s">increase(node_auth_success_total{user="root"}[1m]) &gt; </span><span class="m">0</span>
    <span class="na">for</span><span class="pi">:</span> <span class="s">0m</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">severity</span><span class="pi">:</span> <span class="s">critical</span>
    <span class="na">annotations</span><span class="pi">:</span>
      <span class="na">summary</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Root</span><span class="nv"> </span><span class="s">login</span><span class="nv"> </span><span class="s">detected"</span>
      <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Root</span><span class="nv"> </span><span class="s">user</span><span class="nv"> </span><span class="s">login</span><span class="nv"> </span><span class="s">detected</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.instance</span><span class="nv"> </span><span class="s">}}"</span>

  <span class="pi">-</span> <span class="na">alert</span><span class="pi">:</span> <span class="s">SudoCommandExecuted</span>
    <span class="na">expr</span><span class="pi">:</span> <span class="s">increase(node_sudo_commands_total[1m]) &gt; </span><span class="m">0</span>
    <span class="na">for</span><span class="pi">:</span> <span class="s">0m</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">severity</span><span class="pi">:</span> <span class="s">info</span>
    <span class="na">annotations</span><span class="pi">:</span>
      <span class="na">summary</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Sudo</span><span class="nv"> </span><span class="s">command</span><span class="nv"> </span><span class="s">executed"</span>
      <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Sudo</span><span class="nv"> </span><span class="s">command</span><span class="nv"> </span><span class="s">executed</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.instance</span><span class="nv"> </span><span class="s">}}"</span>

  <span class="pi">-</span> <span class="na">alert</span><span class="pi">:</span> <span class="s">FileSystemModification</span>
    <span class="na">expr</span><span class="pi">:</span> <span class="s">rate(node_filesystem_files_free[5m]) &lt; -0.1</span>
    <span class="na">for</span><span class="pi">:</span> <span class="s">5m</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">severity</span><span class="pi">:</span> <span class="s">warning</span>
    <span class="na">annotations</span><span class="pi">:</span>
      <span class="na">summary</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Rapid</span><span class="nv"> </span><span class="s">file</span><span class="nv"> </span><span class="s">system</span><span class="nv"> </span><span class="s">changes</span><span class="nv"> </span><span class="s">detected"</span>
      <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Rapid</span><span class="nv"> </span><span class="s">file</span><span class="nv"> </span><span class="s">system</span><span class="nv"> </span><span class="s">changes</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.instance</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.mountpoint</span><span class="nv"> </span><span class="s">}}"</span>
</code></pre></div></div>

<h4 id="ë³´ì•ˆ-ë¡œê·¸-ë¶„ì„-ìŠ¤í¬ë¦½íŠ¸">ë³´ì•ˆ ë¡œê·¸ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="n">re</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="n">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="n">argparse</span>

<span class="k">class</span> <span class="nc">SecurityLogAnalyzer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">failed_logins</span> <span class="o">=</span> <span class="nf">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">successful_logins</span> <span class="o">=</span> <span class="nf">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sudo_commands</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">self</span><span class="p">.</span><span class="n">suspicious_activities</span> <span class="o">=</span> <span class="p">[]</span>
        
    <span class="k">def</span> <span class="nf">parse_auth_log</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">log_file</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì¸ì¦ ë¡œê·¸ íŒŒì‹±</span><span class="sh">"""</span>
        <span class="n">patterns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">failed_login</span><span class="sh">'</span><span class="p">:</span> <span class="sa">r</span><span class="sh">'</span><span class="s">(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*Failed password for (\w+) from (\d+\.\d+\.\d+\.\d+)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">successful_login</span><span class="sh">'</span><span class="p">:</span> <span class="sa">r</span><span class="sh">'</span><span class="s">(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*Accepted password for (\w+) from (\d+\.\d+\.\d+\.\d+)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">sudo_command</span><span class="sh">'</span><span class="p">:</span> <span class="sa">r</span><span class="sh">'</span><span class="s">(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*sudo.*USER=(\w+).*COMMAND=(.*)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">invalid_user</span><span class="sh">'</span><span class="p">:</span> <span class="sa">r</span><span class="sh">'</span><span class="s">(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*Invalid user (\w+) from (\d+\.\d+\.\d+\.\d+)</span><span class="sh">'</span>
        <span class="p">}</span>
        
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="c1"># ì‹¤íŒ¨í•œ ë¡œê·¸ì¸ ì‹œë„
</span>                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">patterns</span><span class="p">[</span><span class="sh">'</span><span class="s">failed_login</span><span class="sh">'</span><span class="p">],</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">timestamp</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">ip</span> <span class="o">=</span> <span class="k">match</span><span class="p">.</span><span class="nf">groups</span><span class="p">()</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">failed_logins</span><span class="p">[</span><span class="n">ip</span><span class="p">].</span><span class="nf">append</span><span class="p">({</span>
                        <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">ip</span><span class="sh">'</span><span class="p">:</span> <span class="n">ip</span>
                    <span class="p">})</span>
                
                <span class="c1"># ì„±ê³µí•œ ë¡œê·¸ì¸
</span>                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">patterns</span><span class="p">[</span><span class="sh">'</span><span class="s">successful_login</span><span class="sh">'</span><span class="p">],</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">timestamp</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">ip</span> <span class="o">=</span> <span class="k">match</span><span class="p">.</span><span class="nf">groups</span><span class="p">()</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">successful_logins</span><span class="p">[</span><span class="n">ip</span><span class="p">].</span><span class="nf">append</span><span class="p">({</span>
                        <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">ip</span><span class="sh">'</span><span class="p">:</span> <span class="n">ip</span>
                    <span class="p">})</span>
                
                <span class="c1"># sudo ëª…ë ¹
</span>                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">patterns</span><span class="p">[</span><span class="sh">'</span><span class="s">sudo_command</span><span class="sh">'</span><span class="p">],</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">timestamp</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="k">match</span><span class="p">.</span><span class="nf">groups</span><span class="p">()</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">sudo_commands</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                        <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">command</span><span class="sh">'</span><span class="p">:</span> <span class="n">command</span>
                    <span class="p">})</span>
                
                <span class="c1"># ì˜ëª»ëœ ì‚¬ìš©ì
</span>                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">patterns</span><span class="p">[</span><span class="sh">'</span><span class="s">invalid_user</span><span class="sh">'</span><span class="p">],</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">timestamp</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">ip</span> <span class="o">=</span> <span class="k">match</span><span class="p">.</span><span class="nf">groups</span><span class="p">()</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">suspicious_activities</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                        <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">invalid_user</span><span class="sh">'</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">ip</span><span class="sh">'</span><span class="p">:</span> <span class="n">ip</span>
                    <span class="p">})</span>
    
    <span class="k">def</span> <span class="nf">detect_brute_force</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¸Œë£¨íŠ¸í¬ìŠ¤ ê³µê²© íƒì§€</span><span class="sh">"""</span>
        <span class="n">brute_force_ips</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">attempts</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">failed_logins</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">attempts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="n">brute_force_ips</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">'</span><span class="s">ip</span><span class="sh">'</span><span class="p">:</span> <span class="n">ip</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">attempts</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">attempts</span><span class="p">),</span>
                    <span class="sh">'</span><span class="s">users_targeted</span><span class="sh">'</span><span class="p">:</span> <span class="nf">list</span><span class="p">(</span><span class="nf">set</span><span class="p">([</span><span class="n">attempt</span><span class="p">[</span><span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">]</span> <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="n">attempts</span><span class="p">])),</span>
                    <span class="sh">'</span><span class="s">first_attempt</span><span class="sh">'</span><span class="p">:</span> <span class="n">attempts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">],</span>
                    <span class="sh">'</span><span class="s">last_attempt</span><span class="sh">'</span><span class="p">:</span> <span class="n">attempts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">]</span>
                <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">brute_force_ips</span>
    
    <span class="k">def</span> <span class="nf">detect_privilege_escalation</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ê¶Œí•œ ìƒìŠ¹ íƒì§€</span><span class="sh">"""</span>
        <span class="n">privilege_escalations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">dangerous_commands</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sh">'</span><span class="s">passwd</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">useradd</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">usermod</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">userdel</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">chmod 777</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">chmod 4755</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">chown root</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">systemctl</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">service</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">crontab -e</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">/bin/bash</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">/bin/sh</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">su -</span><span class="sh">'</span>
        <span class="p">]</span>
        
        <span class="k">for</span> <span class="n">sudo_cmd</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">sudo_commands</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dangerous_cmd</span> <span class="ow">in</span> <span class="n">dangerous_commands</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dangerous_cmd</span> <span class="ow">in</span> <span class="n">sudo_cmd</span><span class="p">[</span><span class="sh">'</span><span class="s">command</span><span class="sh">'</span><span class="p">]:</span>
                    <span class="n">privilege_escalations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                        <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">sudo_cmd</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">],</span>
                        <span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">:</span> <span class="n">sudo_cmd</span><span class="p">[</span><span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">],</span>
                        <span class="sh">'</span><span class="s">command</span><span class="sh">'</span><span class="p">:</span> <span class="n">sudo_cmd</span><span class="p">[</span><span class="sh">'</span><span class="s">command</span><span class="sh">'</span><span class="p">],</span>
                        <span class="sh">'</span><span class="s">risk_level</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span> <span class="k">if</span> <span class="n">dangerous_cmd</span> <span class="ow">in</span> <span class="p">[</span><span class="sh">'</span><span class="s">passwd</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">useradd</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">/bin/bash</span><span class="sh">'</span><span class="p">]</span> <span class="k">else</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span>
                    <span class="p">})</span>
                    <span class="k">break</span>
        
        <span class="k">return</span> <span class="n">privilege_escalations</span>
    
    <span class="k">def</span> <span class="nf">analyze_login_patterns</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¡œê·¸ì¸ íŒ¨í„´ ë¶„ì„</span><span class="sh">"""</span>
        <span class="n">patterns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">geographic_anomalies</span><span class="sh">'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="sh">'</span><span class="s">time_anomalies</span><span class="sh">'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="sh">'</span><span class="s">user_anomalies</span><span class="sh">'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        
        <span class="c1"># ì‚¬ìš©ìë³„ ë¡œê·¸ì¸ ë¹ˆë„ ë¶„ì„
</span>        <span class="n">user_login_count</span> <span class="o">=</span> <span class="nc">Counter</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">logins</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">successful_logins</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">login</span> <span class="ow">in</span> <span class="n">logins</span><span class="p">:</span>
                <span class="n">user_login_count</span><span class="p">[</span><span class="n">login</span><span class="p">[</span><span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># ë¹„ì •ìƒì ìœ¼ë¡œ ë§ì€ ë¡œê·¸ì¸
</span>        <span class="n">avg_logins</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">user_login_count</span><span class="p">.</span><span class="nf">values</span><span class="p">())</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">user_login_count</span><span class="p">)</span> <span class="k">if</span> <span class="n">user_login_count</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">user</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">user_login_count</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">avg_logins</span> <span class="o">*</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># í‰ê· ì˜ 3ë°° ì´ìƒ
</span>                <span class="n">patterns</span><span class="p">[</span><span class="sh">'</span><span class="s">user_anomalies</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">login_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">anomaly_type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">excessive_logins</span><span class="sh">'</span>
                <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">patterns</span>
    
    <span class="k">def</span> <span class="nf">generate_report</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë³´ì•ˆ ë¶„ì„ ë¦¬í¬íŠ¸ ìƒì„±</span><span class="sh">"""</span>
        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">analysis_date</span><span class="sh">'</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">isoformat</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">total_failed_logins</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">attempts</span><span class="p">)</span> <span class="k">for</span> <span class="n">attempts</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">failed_logins</span><span class="p">.</span><span class="nf">values</span><span class="p">()),</span>
                <span class="sh">'</span><span class="s">total_successful_logins</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">logins</span><span class="p">)</span> <span class="k">for</span> <span class="n">logins</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">successful_logins</span><span class="p">.</span><span class="nf">values</span><span class="p">()),</span>
                <span class="sh">'</span><span class="s">total_sudo_commands</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">sudo_commands</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">suspicious_activities</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">suspicious_activities</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="sh">'</span><span class="s">brute_force_attacks</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">detect_brute_force</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">privilege_escalations</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">detect_privilege_escalation</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">login_patterns</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">analyze_login_patterns</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">suspicious_activities</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">suspicious_activities</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        
        <span class="c1"># ì¶”ì²œì‚¬í•­ ìƒì„±
</span>        <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="sh">'</span><span class="s">brute_force_attacks</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">report</span><span class="p">[</span><span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span>
                <span class="sh">"</span><span class="s">ë¸Œë£¨íŠ¸í¬ìŠ¤ ê³µê²©ì´ íƒì§€ë˜ì—ˆìŠµë‹ˆë‹¤. fail2ban ì„¤ì •ì„ ê²€í† í•˜ê³  IP ì°¨ë‹¨ì„ ê³ ë ¤í•˜ì„¸ìš”.</span><span class="sh">"</span>
            <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="sh">'</span><span class="s">privilege_escalations</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">report</span><span class="p">[</span><span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span>
                <span class="sh">"</span><span class="s">ê¶Œí•œ ìƒìŠ¹ í™œë™ì´ íƒì§€ë˜ì—ˆìŠµë‹ˆë‹¤. sudo ì‚¬ìš©ì„ ê²€í† í•˜ê³  í•„ìš”ì‹œ ê¶Œí•œì„ ì œí•œí•˜ì„¸ìš”.</span><span class="sh">"</span>
            <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">total_failed_logins</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">report</span><span class="p">[</span><span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span>
                <span class="sh">"</span><span class="s">ê³¼ë„í•œ ì‹¤íŒ¨ ë¡œê·¸ì¸ ì‹œë„ê°€ ìˆìŠµë‹ˆë‹¤. íŒ¨ìŠ¤ì›Œë“œ ì •ì±…ì„ ê°•í™”í•˜ì„¸ìš”.</span><span class="sh">"</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">report</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="nc">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sh">'</span><span class="s">Security Log Analyzer</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">--log-file</span><span class="sh">'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="sh">'</span><span class="s">/var/log/auth.log</span><span class="sh">'</span><span class="p">,</span> 
                       <span class="nb">help</span><span class="o">=</span><span class="sh">'</span><span class="s">Path to authentication log file</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">--output</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">-o</span><span class="sh">'</span><span class="p">,</span> <span class="nb">help</span><span class="o">=</span><span class="sh">'</span><span class="s">Output file for JSON report</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">--threshold</span><span class="sh">'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                       <span class="nb">help</span><span class="o">=</span><span class="sh">'</span><span class="s">Brute force detection threshold</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="nf">parse_args</span><span class="p">()</span>
    
    <span class="n">analyzer</span> <span class="o">=</span> <span class="nc">SecurityLogAnalyzer</span><span class="p">()</span>
    <span class="n">analyzer</span><span class="p">.</span><span class="nf">parse_auth_log</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">log_file</span><span class="p">)</span>
    
    <span class="n">report</span> <span class="o">=</span> <span class="n">analyzer</span><span class="p">.</span><span class="nf">generate_report</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">output</span><span class="p">:</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">output</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="ë§ˆë¬´ë¦¬ì™€-ë‹¤ìŒ-ë‹¨ê³„">ë§ˆë¬´ë¦¬ì™€ ë‹¤ìŒ ë‹¨ê³„</h2>

<p>ì´ ì¢…í•©ì ì¸ ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ê°€ì´ë“œë¥¼ í†µí•´ ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ ë‹¤ë¤˜ìŠµë‹ˆë‹¤:</p>

<h3 id="-ë‹¤ë£¬-ì£¼ìš”-ë‚´ìš©">âœ… ë‹¤ë£¬ ì£¼ìš” ë‚´ìš©</h3>
<ul>
  <li><strong>ê¸°ì´ˆ ë³´ì•ˆ</strong>: ì‚¬ìš©ì ê³„ì •, SSH, ë°©í™”ë²½ ì„¤ì •</li>
  <li><strong>ê³ ê¸‰ ë³´ì•ˆ</strong>: SELinux/AppArmor, ì‹œìŠ¤í…œ í•˜ë“œë‹</li>
  <li><strong>ì¹¨ì… íƒì§€</strong>: AIDE, Fail2Ban, Wazuh êµ¬ì¶•</li>
  <li><strong>ì»¨í…Œì´ë„ˆ ë³´ì•ˆ</strong>: Docker/Kubernetes ë³´ì•ˆ ì„¤ì •</li>
  <li><strong>ì»´í”Œë¼ì´ì–¸ìŠ¤</strong>: CIS Benchmark ì ìš©</li>
  <li><strong>ëª¨ë‹ˆí„°ë§</strong>: ë³´ì•ˆ ë¡œê·¸ ë¶„ì„ ë° ëŒ€ì‹œë³´ë“œ</li>
</ul>

<h3 id="-ë‹¤ìŒ-ë‹¨ê³„-ê¶Œì¥ì‚¬í•­">ğŸš€ ë‹¤ìŒ ë‹¨ê³„ ê¶Œì¥ì‚¬í•­</h3>

<ol>
  <li><strong>ì •ê¸°ì ì¸ ë³´ì•ˆ ì ê²€</strong> - ì›”ê°„ ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸ ìš´ì˜</li>
  <li><strong>ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸</strong> - ë¶„ê¸°ë³„ ëª¨ì˜ í•´í‚¹ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰</li>
  <li><strong>ë³´ì•ˆ êµìœ¡</strong> - íŒ€ì› ëŒ€ìƒ ë³´ì•ˆ ì¸ì‹ êµìœ¡</li>
  <li><strong>ì¸ì‹œë˜íŠ¸ ëŒ€ì‘</strong> - ë³´ì•ˆ ì‚¬ê³  ëŒ€ì‘ ì ˆì°¨ ìˆ˜ë¦½</li>
  <li><strong>ë°±ì—… ë° ë³µêµ¬</strong> - ì •ê¸°ì ì¸ ë°±ì—… ë° ë³µêµ¬ í…ŒìŠ¤íŠ¸</li>
</ol>

<h3 id="-ì¶”ê°€-í•™ìŠµ-ìë£Œ">ğŸ“š ì¶”ê°€ í•™ìŠµ ìë£Œ</h3>
<ul>
  <li><strong>ì¸ì¦</strong>: CompTIA Security+, CISSP, CEH</li>
  <li><strong>ë„êµ¬</strong>: Metasploit, Nessus, OpenVAS</li>
  <li><strong>í‘œì¤€</strong>: NIST Cybersecurity Framework, ISO 27001</li>
</ul>

<p>ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆì€ ì§€ì†ì ì¸ ê³¼ì •ì…ë‹ˆë‹¤. í•­ìƒ ìµœì‹  ìœ„í˜‘ ë™í–¥ì„ íŒŒì•…í•˜ê³  ë³´ì•ˆ ì„¤ì •ì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”! ğŸ”’ğŸ›¡ï¸</p>

  </div>

  <footer class="post-footer">
    <div class="post-navigation"><div class="nav-previous">
        <a href="/infra-blog/blog/2024/08/22/networking-guide-part2.html" rel="prev">
          <i class="icon-left-arrow"></i>
          <span class="nav-title">ë„¤íŠ¸ì›Œí‚¹ ì™„ì „ ê°€ì´ë“œ 2í¸ - IP ì£¼ì†Œì™€ ì„œë¸Œë„¤íŒ… ë§ˆìŠ¤í„°í•˜ê¸° | Complete N...</span>
        </a>
      </div><div class="nav-next">
        <a href="/infra-blog/blog/2024/10/26/linux-security-guide-part1.html" rel="next">
          <span class="nav-title">ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ 1í¸ - ê¸°ì´ˆ ë³´ì•ˆ ì„¤ì • | Linux Security Gu...</span>
          <i class="icon-right-arrow"></i>
        </a>
      </div></div>
  </footer>
  </article></div>

    </section>
    <footer class="condensed">
      <ul class="social about-footer condensed"><a href="https://github.com/leeyonghe" target="_blank">
          <li>
            <i class="icon-github-circled"></i>
          </li>
        </a><a href="https://www.linkedin.com/in/lee-yong-hee-18912454/" target="_blank">
          <li>
            <i class="icon-linkedin-squared"></i>
          </li>
        </a><!----></ul><p class="about-footer condensed">&copy;
        2025</p><div class="about-footer condensed">
        <p>Dark Mode
          <i class="icon-moon"></i>
          <label class="switch">
            <input type="checkbox" class="dark-mode-toggle">
            <span class="slider round" onclick="toggleDarkMode()"></span>
          </label>
        </p>
      </div>
    </footer>
  </main>
  
  <script type="text/javascript" src="/infra-blog/assets/js/darkmode.js"></script>
  
  <script src="/infra-blog/assets/js/simple-jekyll-search.min.js"></script>
  <script src="/infra-blog/assets/js/search.js"></script>
  
</body>

</html>
