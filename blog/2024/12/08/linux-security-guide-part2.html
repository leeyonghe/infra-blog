<!DOCTYPE html>
<html lang="en">

<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="stylesheet" href="/infra-blog/assets/css/style.css">
<link rel="stylesheet" href="/infra-blog/assets/css/post-detail.css">
<style>
/* Post Detail Page Styling */
.post-container article {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  padding: 40px;
  margin: 30px auto;
  max-width: 800px;
}

@media screen and (max-width: 768px) {
  .post-container article {
    margin: 20px;
    padding: 25px;
    border-radius: 8px;
  }
}

.post-container article .post-header {
  border-bottom: 2px solid #f5f5f5;
  padding-bottom: 25px;
  margin-bottom: 30px;
}

.post-container article .post-header .post-title {
  font-size: 2.2em;
  font-weight: 700;
  color: #2c3e50;
  line-height: 1.3;
  margin-bottom: 15px;
}

@media screen and (max-width: 768px) {
  .post-container article .post-header .post-title {
    font-size: 1.8em;
  }
}

.post-container article .post-header .post-meta {
  display: flex;
  align-items: center;
  gap: 20px;
  flex-wrap: wrap;
}

.post-container article .post-header .post-meta .post-date {
  display: flex;
  align-items: center;
  color: #666;
  font-size: 0.9em;
}

.post-container article .post-header .post-meta .post-date i {
  margin-right: 8px;
  color: #888;
}

.post-container article .post-header .post-meta .post-categories-wrapper {
  display: flex;
  align-items: center;
}

.post-container article .post-header .post-meta .post-categories-wrapper i {
  margin-right: 8px;
  color: #888;
}

.post-container article .post-header .post-meta .post-categories-wrapper .post-categories {
  display: flex;
  gap: 8px;
  list-style: none;
  margin: 0;
  padding: 0;
}

.post-container article .post-header .post-meta .post-categories-wrapper .post-categories li {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.8em;
  font-weight: 500;
  text-transform: capitalize;
}

.post-container article .post-content {
  font-size: 1.1em;
  line-height: 1.8;
  color: #333;
}

.post-container article .post-content p {
  margin-bottom: 1.2em;
}

.post-container article .post-content h1,
.post-container article .post-content h2,
.post-container article .post-content h3,
.post-container article .post-content h4,
.post-container article .post-content h5,
.post-container article .post-content h6 {
  color: #2c3e50;
  margin: 1.5em 0 0.8em 0;
  font-weight: 600;
}

.post-container article .post-content h2 {
  font-size: 1.8em;
  border-bottom: 2px solid #3498db;
  padding-bottom: 10px;
}

.post-container article .post-content h3 {
  font-size: 1.5em;
  color: #34495e;
}

.post-container article .post-content code {
  background: #f8f9fa;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 0.9em;
  color: #e74c3c;
}

.post-container article .post-content pre {
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 6px;
  padding: 15px;
  overflow-x: auto;
  margin: 1.5em 0;
}

.post-container article .post-content pre code {
  background: none;
  color: #333;
  padding: 0;
}

.post-container article .post-content blockquote {
  border-left: 4px solid #3498db;
  background: #f8f9fa;
  padding: 15px 20px;
  margin: 1.5em 0;
  font-style: italic;
  color: #555;
}

.post-container article .post-content img {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
  margin: 1.5em 0;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.post-container article .post-content ul,
.post-container article .post-content ol {
  padding-left: 1.5em;
  margin-bottom: 1.2em;
}

.post-container article .post-content ul li,
.post-container article .post-content ol li {
  margin-bottom: 0.5em;
}

.post-container article .post-content a {
  color: #3498db;
  text-decoration: none;
  border-bottom: 1px solid transparent;
  transition: all 0.3s ease;
}

.post-container article .post-content a:hover {
  border-bottom-color: #3498db;
}

.post-container article .post-footer {
  border-top: 2px solid #f5f5f5;
  padding-top: 25px;
  margin-top: 40px;
}

.post-container article .post-footer .post-navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 20px;
}

@media screen and (max-width: 768px) {
  .post-container article .post-footer .post-navigation {
    flex-direction: column;
    gap: 15px;
  }
}

.post-container article .post-footer .post-navigation .nav-previous,
.post-container article .post-footer .post-navigation .nav-next {
  flex: 1;
}

.post-container article .post-footer .post-navigation .nav-previous a,
.post-container article .post-footer .post-navigation .nav-next a {
  display: flex;
  align-items: center;
  padding: 15px 20px;
  background: #f8f9fa;
  border-radius: 8px;
  text-decoration: none;
  color: #333;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.post-container article .post-footer .post-navigation .nav-previous a:hover,
.post-container article .post-footer .post-navigation .nav-next a:hover {
  background: #e9ecef;
  border-color: #3498db;
  transform: translateY(-2px);
}

.post-container article .post-footer .post-navigation .nav-previous a i,
.post-container article .post-footer .post-navigation .nav-next a i {
  color: #3498db;
  margin: 0 8px;
}

.post-container article .post-footer .post-navigation .nav-previous a .nav-title,
.post-container article .post-footer .post-navigation .nav-next a .nav-title {
  font-weight: 500;
}

.post-container article .post-footer .post-navigation .nav-previous a {
  justify-content: flex-start;
}

.post-container article .post-footer .post-navigation .nav-next a {
  justify-content: flex-end;
  text-align: right;
}
</style>
<title>ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ 2í¸ - SSH ê³ ê¸‰ ë³´ì•ˆê³¼ ë°©í™”ë²½ | Linux Security Guide Part 2 - Advanced SSH Security & Firewall</title>

<script type="text/javascript" src="/infra-blog/assets/js/darkmode.js"></script>

</head><body>
  <main class="container">
    <section class="about">
      <div class="about-header condensed">
      <div class="about-title">
      <a href="/infra-blog/">
        
        <img src="/infra-blog/assets/portfolio.png" alt="Infrastructure Engineer" />
        
      </a>
      <h2 id="title">
        <a href="/infra-blog/">Infrastructure Engineer</a>
      </h2>
      </div><p class="tagline">DevOps & Cloud Infrastructure Specialist</p></div>
      
      <ul class="social about-footer condensed"><a href="https://github.com/leeyonghe" target="_blank">
          <li>
            <i class="icon-github-circled"></i>
          </li>
        </a><a href="https://www.linkedin.com/in/lee-yong-hee-18912454/" target="_blank">
          <li>
            <i class="icon-linkedin-squared"></i>
          </li>
        </a><!----></ul><p class="about-footer condensed">&copy;
        2025</p><div class="about-footer condensed">
        <p>Dark Mode
          <i class="icon-moon"></i>
          <label class="switch">
            <input type="checkbox" class="dark-mode-toggle">
            <span class="slider round" onclick="toggleDarkMode()"></span>
          </label>
        </p>
      </div>
    </section>
    <section class="content">
      <style>
/* Post Detail Page Styling - Direct Inline */
.post-container article {
  background: #fff !important;
  border: none !important;
  border-top: none !important;
  border-right: none !important;
  border-bottom: none !important;
  border-left: none !important;
  border-width: 0 !important;
  border-style: none !important;
  outline: none !important;
  border-radius: 12px !important;
  box-shadow: none !important;
  padding: 40px !important;
  margin: 30px auto !important;
  max-width: 800px !important;
}

.post-container article .post-header .post-title {
  font-size: 2.2em !important;
  font-weight: 700 !important;
  color: #2c3e50 !important;
  line-height: 1.3 !important;
}

.post-container article .post-header {
  border-bottom: none !important;
  padding-bottom: 25px !important;
  margin-bottom: 30px !important;
}

.post-container article .post-content {
  font-size: 1.1em !important;
  line-height: 1.8 !important;
  color: #333 !important;
}

.post-container article .post-content h2 {
  font-size: 1.8em !important;
  border-bottom: none !important;
  padding-bottom: 10px !important;
  color: #2c3e50 !important;
}

.post-container article .post-header .post-meta .post-categories li {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
  color: white !important;
  padding: 4px 12px !important;
  border-radius: 20px !important;
  font-size: 0.8em !important;
  list-style: none !important;
  display: inline-block !important;
  margin-right: 8px !important;
}

.post-container article .post-footer {
  border-top: none !important;
  padding-top: 25px !important;
  margin-top: 40px !important;
}

/* ëª¨ë“  borderì™€ box-shadow ê°•ì œ ì œê±° */
.post-container article *,
.post-container article *::before,
.post-container article *::after {
  border: none !important;
  border-top: none !important;
  border-right: none !important;
  border-bottom: none !important;
  border-left: none !important;
  border-width: 0 !important;
  border-style: none !important;
  outline: none !important;
  box-shadow: none !important;
}

/* ì½”ë“œ ë¸”ë¡ê³¼ pre íƒœê·¸ë„ border, box-shadow ì œê±° */
.post-container article pre,
.post-container article code,
.post-container article .highlight,
.post-container article .highlighter-rouge {
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
}
</style><div class="post-container">
  <article>
    <header class="post-header">
    <h1 class="post-title">ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ 2í¸ - SSH ê³ ê¸‰ ë³´ì•ˆê³¼ ë°©í™”ë²½ | Linux Security Guide Part 2 - Advanced SSH Security &amp; Firewall</h1>
    <div class="post-meta">
      <div class="post-date">
        <i class="icon-calendar"></i>
        <time datetime="2024-12-08T00:00:00+00:00">Dec 8, 2024</time>
      </div><div class="post-categories-wrapper">
        <i class="icon-tag"></i>
        <ul class="post-categories"><li>Security</li><li>Linux</li></ul>
      </div></div>
  </header>

  <div class="post-content">
    <p>SSH ë³´ì•ˆì„ í•œ ë‹¨ê³„ ë†’ì´ê³  ê°•ë ¥í•œ ë°©í™”ë²½ ì •ì±…ì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ì™„ë²½í•˜ê²Œ ë§ˆìŠ¤í„°í•´ë³´ê² ìŠµë‹ˆë‹¤. SSH í‚¤ ê´€ë¦¬ë¶€í„° ê³ ê¸‰ ë°©í™”ë²½ ì„¤ì •ê¹Œì§€ ì‹¤ë¬´ì—ì„œ ë°”ë¡œ í™œìš©í•  ìˆ˜ ìˆëŠ” ë‚´ìš©ìœ¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.</p>

<h2 id="ssh-ê³ ê¸‰-ë³´ì•ˆ-ì„¤ì •--advanced-ssh-security">SSH ê³ ê¸‰ ë³´ì•ˆ ì„¤ì • | Advanced SSH Security</h2>

<h3 id="-ssh-í‚¤-ê¸°ë°˜-ì¸ì¦-ì™„ë²½-êµ¬ì¶•">ğŸ”‘ SSH í‚¤ ê¸°ë°˜ ì¸ì¦ ì™„ë²½ êµ¬ì¶•</h3>

<h4 id="ê°•í™”ëœ-ssh-í‚¤-ìƒì„±-ë°-ê´€ë¦¬">ê°•í™”ëœ SSH í‚¤ ìƒì„± ë° ê´€ë¦¬</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ìµœì‹  ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•œ í‚¤ ìƒì„±</span>
<span class="c"># ED25519 (ê¶Œì¥ - ë¹ ë¥´ê³  ì•ˆì „)</span>
ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-b</span> 4096 <span class="nt">-C</span> <span class="s2">"admin@company.com-</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span><span class="s2">"</span> <span class="nt">-f</span> ~/.ssh/id_ed25519_admin

<span class="c"># RSA í‚¤ (í˜¸í™˜ì„±ì´ í•„ìš”í•œ ê²½ìš°)</span>
ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-b</span> 4096 <span class="nt">-C</span> <span class="s2">"admin@company.com-</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span><span class="s2">"</span> <span class="nt">-f</span> ~/.ssh/id_rsa_admin

<span class="c"># ECDSA í‚¤ (ëŒ€ì•ˆ)</span>
ssh-keygen <span class="nt">-t</span> ecdsa <span class="nt">-b</span> 521 <span class="nt">-C</span> <span class="s2">"admin@company.com-</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span><span class="s2">"</span> <span class="nt">-f</span> ~/.ssh/id_ecdsa_admin

<span class="c"># í‚¤ ìƒì„± ì‹œ ë³´ì•ˆ ì˜µì…˜</span>
ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-b</span> 4096 <span class="se">\</span>
    <span class="nt">-C</span> <span class="s2">"admin@company.com-</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">-f</span> ~/.ssh/id_ed25519_admin <span class="se">\</span>
    <span class="nt">-N</span> <span class="s2">"</span><span class="si">$(</span>openssl rand <span class="nt">-base64</span> 32<span class="si">)</span><span class="s2">"</span> <span class="se">\ </span> <span class="c"># ê°•ë ¥í•œ íŒ¨ìŠ¤í”„ë ˆì´ì¦ˆ ìë™ ìƒì„±</span>
    <span class="nt">-o</span> <span class="se">\ </span>                              <span class="c"># OpenSSH í˜•ì‹ ì‚¬ìš©</span>
    <span class="nt">-a</span> 100                            <span class="c"># KDF ë¼ìš´ë“œ ìˆ˜ ì¦ê°€</span>

<span class="c"># í‚¤ ê¶Œí•œ ì„¤ì • (ì¤‘ìš”!)</span>
<span class="nb">chmod </span>700 ~/.ssh
<span class="nb">chmod </span>600 ~/.ssh/id_<span class="k">*</span>
<span class="nb">chmod </span>644 ~/.ssh/id_<span class="k">*</span>.pub
<span class="nb">chmod </span>600 ~/.ssh/authorized_keys
<span class="nb">chmod </span>600 ~/.ssh/config

<span class="c"># í‚¤ í•‘ê±°í”„ë¦°íŠ¸ í™•ì¸</span>
ssh-keygen <span class="nt">-lf</span> ~/.ssh/id_ed25519_admin.pub
ssh-keygen <span class="nt">-E</span> sha256 <span class="nt">-lf</span> ~/.ssh/id_ed25519_admin.pub  <span class="c"># SHA256 í•´ì‹œ</span>

<span class="c"># í‚¤ ë§Œë£Œì¼ ì„¤ì • (OpenSSH 8.2+)</span>
ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-V</span> +365d <span class="nt">-C</span> <span class="s2">"expires-</span><span class="si">$(</span><span class="nb">date</span> <span class="nt">-d</span> <span class="s1">'+1 year'</span> +%Y%m%d<span class="si">)</span><span class="s2">"</span>
</code></pre></div></div>

<h4 id="ssh-í´ë¼ì´ì–¸íŠ¸-ì„¤ì •-ìµœì í™”">SSH í´ë¼ì´ì–¸íŠ¸ ì„¤ì • ìµœì í™”</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ~/.ssh/config - í´ë¼ì´ì–¸íŠ¸ ì„¤ì •</span>
<span class="c"># ê¸°ë³¸ ì„¤ì •</span>
Host <span class="k">*</span>
    <span class="c"># ë³´ì•ˆ ì„¤ì •</span>
    Protocol 2
    HashKnownHosts <span class="nb">yes
    </span>VisualHostKey <span class="nb">yes
    </span>StrictHostKeyChecking ask
    UserKnownHostsFile ~/.ssh/known_hosts
    
    <span class="c"># ì—°ê²° ì„¤ì •</span>
    ServerAliveInterval 60
    ServerAliveCountMax 3
    ConnectTimeout 10
    TCPKeepAlive no
    
    <span class="c"># ì•”í˜¸í™” ì„¤ì •</span>
    Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com
    KexAlgorithms curve25519-sha256@libssh.org,diffie-hellman-group16-sha512
    MACs hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com
    HostKeyAlgorithms ssh-ed25519,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521
    
    <span class="c"># ì¸ì¦ ì„¤ì •</span>
    PreferredAuthentications publickey,keyboard-interactive,password
    PubkeyAuthentication <span class="nb">yes
    </span>PasswordAuthentication no
    GSSAPIAuthentication no
    
    <span class="c"># í¬ì›Œë”© ì„¤ì • (ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”)</span>
    ForwardAgent no
    ForwardX11 no
    ForwardX11Trusted no

<span class="c"># ì„œë²„ë³„ ê°œë³„ ì„¤ì •</span>
Host production-server
    HostName 192.168.1.100
    Port 2222
    User admin
    IdentityFile ~/.ssh/id_ed25519_admin
    IdentitiesOnly <span class="nb">yes
    </span>RequestTTY <span class="nb">yes
    </span>RemoteForward 9000 localhost:9000
    
Host development-<span class="k">*</span>
    Port 22
    User developer
    IdentityFile ~/.ssh/id_ed25519_dev
    StrictHostKeyChecking no        <span class="c"># ê°œë°œ ì„œë²„ìš©</span>
    UserKnownHostsFile /dev/null
    LogLevel QUIET

Host bastion
    HostName bastion.company.com
    Port 2222
    User jumpuser
    IdentityFile ~/.ssh/id_ed25519_jump
    ControlMaster auto
    ControlPath ~/.ssh/control-%h-%p-%r
    ControlPersist 600

<span class="c"># ë² ìŠ¤ì²œ í˜¸ìŠ¤íŠ¸ë¥¼ í†µí•œ ì ‘ê·¼</span>
Host internal-<span class="k">*</span>
    ProxyJump bastion
    User admin
    IdentityFile ~/.ssh/id_ed25519_admin

<span class="c"># í‚¤ ì—ì´ì „íŠ¸ ì„¤ì •</span>
<span class="c"># ~/.bashrcì— ì¶”ê°€</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$SSH_AUTH_SOCK</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">eval</span> <span class="si">$(</span>ssh-agent <span class="nt">-s</span><span class="si">)</span>
    ssh-add ~/.ssh/id_ed25519_admin
    ssh-add ~/.ssh/id_ed25519_dev
<span class="k">fi</span>

<span class="c"># í‚¤ ë§Œë£Œ í™•ì¸ ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/check-ssh-keys.sh</span>
<span class="k">for </span>keyfile <span class="k">in</span> ~/.ssh/id_<span class="k">*</span><span class="p">;</span> <span class="k">do
    if</span> <span class="o">[[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$keyfile</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="s2">"</span><span class="nv">$keyfile</span><span class="s2">"</span> <span class="o">==</span> <span class="k">*</span>.pub <span class="o">]]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Checking </span><span class="nv">$keyfile</span><span class="s2">..."</span>
        ssh-keygen <span class="nt">-l</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$keyfile</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"  Invalid or encrypted key"</span>
    <span class="k">fi
done</span>
</code></pre></div></div>

<h4 id="ssh-certificate-authority-ca-êµ¬ì¶•">SSH Certificate Authority (CA) êµ¬ì¶•</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1. CA í‚¤ ìƒì„± (ë³´ì•ˆì´ ì¤‘ìš”í•œ ë³„ë„ ì‹œìŠ¤í…œì—ì„œ)</span>
ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-f</span> /etc/ssh/ca_key <span class="nt">-C</span> <span class="s2">"SSH-CA-</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span><span class="s2">"</span>
<span class="nb">chmod </span>600 /etc/ssh/ca_key
<span class="nb">chmod </span>644 /etc/ssh/ca_key.pub

<span class="c"># 2. ì‚¬ìš©ì ì¸ì¦ì„œ ë°œê¸‰</span>
<span class="c"># ë‹¨ê¸°ê°„ ìœ íš¨í•œ ì‚¬ìš©ì ì¸ì¦ì„œ (1ì£¼ì¼)</span>
ssh-keygen <span class="nt">-s</span> /etc/ssh/ca_key <span class="se">\</span>
    <span class="nt">-I</span> <span class="s2">"john-doe-</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">-n</span> john,admin <span class="se">\</span>
    <span class="nt">-V</span> +7d <span class="se">\</span>
    <span class="nt">-z</span> 1001 <span class="se">\</span>
    ~/.ssh/id_ed25519.pub

<span class="c"># í˜¸ìŠ¤íŠ¸ë³„ ì œí•œëœ ì¸ì¦ì„œ</span>
ssh-keygen <span class="nt">-s</span> /etc/ssh/ca_key <span class="se">\</span>
    <span class="nt">-I</span> <span class="s2">"backup-service"</span> <span class="se">\</span>
    <span class="nt">-n</span> backup <span class="se">\</span>
    <span class="nt">-V</span> +1d <span class="se">\</span>
    <span class="nt">-O</span> clear <span class="se">\</span>
    <span class="nt">-O</span> source-address<span class="o">=</span><span class="s2">"192.168.1.100/32"</span> <span class="se">\</span>
    <span class="nt">-O</span> force-command<span class="o">=</span><span class="s2">"/usr/local/bin/backup-script"</span> <span class="se">\</span>
    ~/.ssh/id_ed25519_backup.pub

<span class="c"># ê¶Œí•œ ì œí•œ ì¸ì¦ì„œ</span>
ssh-keygen <span class="nt">-s</span> /etc/ssh/ca_key <span class="se">\</span>
    <span class="nt">-I</span> <span class="s2">"readonly-access"</span> <span class="se">\</span>
    <span class="nt">-n</span> <span class="nb">readonly</span> <span class="se">\</span>
    <span class="nt">-V</span> +1h <span class="se">\</span>
    <span class="nt">-O</span> clear <span class="se">\</span>
    <span class="nt">-O</span> no-agent-forwarding <span class="se">\</span>
    <span class="nt">-O</span> no-port-forwarding <span class="se">\</span>
    <span class="nt">-O</span> no-pty <span class="se">\</span>
    <span class="nt">-O</span> no-user-rc <span class="se">\</span>
    ~/.ssh/id_ed25519_readonly.pub

<span class="c"># 3. ì„œë²„ ì„¤ì •ì—ì„œ CA ì‹ ë¢°</span>
<span class="c"># /etc/ssh/sshd_config</span>
TrustedUserCAKeys /etc/ssh/ca_key.pub
AuthorizedPrincipalsFile /etc/ssh/auth_principals/%u
PubkeyAuthentication <span class="nb">yes
</span>CertificateAuthentication <span class="nb">yes</span>

<span class="c"># 4. ì‚¬ìš©ìë³„ ì£¼ì²´(principal) ì„¤ì •</span>
<span class="c"># /etc/ssh/auth_principals/john</span>
john
admin
developer

<span class="c"># /etc/ssh/auth_principals/backup</span>
backup

<span class="c"># 5. í˜¸ìŠ¤íŠ¸ ì¸ì¦ì„œë„ êµ¬ì¶•</span>
<span class="c"># í˜¸ìŠ¤íŠ¸ í‚¤ì— ëŒ€í•œ ì¸ì¦ì„œ ë°œê¸‰</span>
ssh-keygen <span class="nt">-s</span> /etc/ssh/ca_key <span class="se">\</span>
    <span class="nt">-I</span> <span class="s2">"server1.company.com"</span> <span class="se">\</span>
    <span class="nt">-h</span> <span class="se">\</span>
    <span class="nt">-n</span> server1.company.com,server1,192.168.1.100 <span class="se">\</span>
    <span class="nt">-V</span> +365d <span class="se">\</span>
    /etc/ssh/ssh_host_ed25519_key.pub

<span class="c"># í´ë¼ì´ì–¸íŠ¸ì—ì„œ í˜¸ìŠ¤íŠ¸ CA ì‹ ë¢°</span>
<span class="c"># ~/.ssh/known_hostsì— ì¶”ê°€</span>
@cert-authority <span class="k">*</span>.company.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICAKeyFromCA...

<span class="c"># 6. ì¸ì¦ì„œ ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/ssh-cert-manager.sh</span>

<span class="nv">ACTION</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">USER</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">DAYS</span><span class="o">=</span><span class="k">${</span><span class="nv">3</span><span class="k">:-</span><span class="nv">7</span><span class="k">}</span>

<span class="k">case</span> <span class="nv">$ACTION</span> <span class="k">in</span>
    <span class="s2">"issue"</span><span class="p">)</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$USER</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> issue &lt;username&gt; [days]"</span>
            <span class="nb">exit </span>1
        <span class="k">fi
        
        </span><span class="nv">USER_KEY</span><span class="o">=</span><span class="s2">"/home/</span><span class="nv">$USER</span><span class="s2">/.ssh/id_ed25519.pub"</span>
        <span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$USER_KEY</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"User key not found: </span><span class="nv">$USER_KEY</span><span class="s2">"</span>
            <span class="nb">exit </span>1
        <span class="k">fi
        
        </span>ssh-keygen <span class="nt">-s</span> /etc/ssh/ca_key <span class="se">\</span>
            <span class="nt">-I</span> <span class="s2">"</span><span class="nv">$USER</span><span class="s2">-</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d-%H%M%S<span class="si">)</span><span class="s2">"</span> <span class="se">\</span>
            <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$USER</span><span class="s2">"</span> <span class="se">\</span>
            <span class="nt">-V</span> <span class="s2">"+</span><span class="k">${</span><span class="nv">DAYS</span><span class="k">}</span><span class="s2">d"</span> <span class="se">\</span>
            <span class="s2">"</span><span class="nv">$USER_KEY</span><span class="s2">"</span>
        
        <span class="nb">echo</span> <span class="s2">"Certificate issued for </span><span class="nv">$USER</span><span class="s2">, valid for </span><span class="nv">$DAYS</span><span class="s2"> days"</span>
        <span class="p">;;</span>
        
    <span class="s2">"revoke"</span><span class="p">)</span>
        <span class="c"># ì¸ì¦ì„œ íê¸° ëª©ë¡ ê´€ë¦¬</span>
        <span class="nv">CERT_SERIAL</span><span class="o">=</span><span class="si">$(</span>ssh-keygen <span class="nt">-L</span> <span class="nt">-f</span> <span class="s2">"/home/</span><span class="nv">$USER</span><span class="s2">/.ssh/id_ed25519-cert.pub"</span> | <span class="nb">grep </span>Serial | <span class="nb">awk</span> <span class="s1">'{print $2}'</span><span class="si">)</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$CERT_SERIAL</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /etc/ssh/revoked_keys
        <span class="nb">echo</span> <span class="s2">"Certificate revoked for </span><span class="nv">$USER</span><span class="s2">"</span>
        <span class="p">;;</span>
        
    <span class="s2">"list"</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Active certificates:"</span>
        <span class="k">for </span>cert <span class="k">in</span> /home/<span class="k">*</span>/.ssh/<span class="k">*</span><span class="nt">-cert</span>.pub<span class="p">;</span> <span class="k">do
            if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$cert</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
                </span><span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">basename</span> <span class="si">$(</span><span class="nb">dirname</span> <span class="nv">$cert</span><span class="si">))</span><span class="s2">: </span><span class="si">$(</span>ssh-keygen <span class="nt">-L</span> <span class="nt">-f</span> <span class="nv">$cert</span> | <span class="nb">grep </span>Valid<span class="si">)</span><span class="s2">"</span>
            <span class="k">fi
        done</span>
        <span class="p">;;</span>
        
    <span class="k">*</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> {issue|revoke|list} &lt;username&gt; [days]"</span>
        <span class="nb">exit </span>1
        <span class="p">;;</span>
<span class="k">esac</span>
</code></pre></div></div>

<h3 id="ï¸-ssh-ì„œë²„-ê³ ê¸‰-ë³´ì•ˆ-ì„¤ì •">ğŸ›¡ï¸ SSH ì„œë²„ ê³ ê¸‰ ë³´ì•ˆ ì„¤ì •</h3>

<h4 id="ê°•í™”ëœ-sshd_config-ì„¤ì •">ê°•í™”ëœ sshd_config ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/ssh/sshd_config - ìµœê³  ë³´ì•ˆ ìˆ˜ì¤€ ì„¤ì •</span>
<span class="c"># ê¸°ë³¸ ì„¤ì •</span>
Protocol 2
Port 2222                           <span class="c"># ê¸°ë³¸ í¬íŠ¸ ë³€ê²½</span>
AddressFamily inet                  <span class="c"># IPv4ë§Œ ì‚¬ìš© (í•„ìš”ì‹œ)</span>
ListenAddress 192.168.1.100        <span class="c"># íŠ¹ì • IPë§Œ ë°”ì¸ë”©</span>

<span class="c"># ì•”í˜¸í™” ë° í‚¤ êµí™˜</span>
Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr
MACs hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha2-256,hmac-sha2-512
KexAlgorithms curve25519-sha256@libssh.org,ecdh-sha2-nistp521,ecdh-sha2-nistp384,ecdh-sha2-nistp256,diffie-hellman-group16-sha512

<span class="c"># í˜¸ìŠ¤íŠ¸ í‚¤ ì„¤ì • (ì•½í•œ í‚¤ ì œê±°)</span>
HostKey /etc/ssh/ssh_host_ed25519_key
HostKey /etc/ssh/ssh_host_ecdsa_key
<span class="c"># RSA í‚¤ëŠ” 4096ë¹„íŠ¸ ì´ìƒë§Œ ì‚¬ìš©</span>
HostKey /etc/ssh/ssh_host_rsa_key

<span class="c"># ì¸ì¦ ì„¤ì •</span>
PubkeyAuthentication <span class="nb">yes
</span>AuthorizedKeysFile .ssh/authorized_keys
PasswordAuthentication no
PermitEmptyPasswords no
ChallengeResponseAuthentication no
GSSAPIAuthentication no
HostbasedAuthentication no
IgnoreUserKnownHosts <span class="nb">yes
</span>PermitRootLogin no

<span class="c"># ë¡œê·¸ì¸ ì œí•œ</span>
LoginGraceTime 30
MaxAuthTries 3
MaxSessions 3
MaxStartups 3:30:10
ClientAliveInterval 300
ClientAliveCountMax 2

<span class="c"># ì‚¬ìš©ì/ê·¸ë£¹ ì œí•œ</span>
AllowUsers admin developer
AllowGroups sshusers
DenyUsers guest anonymous backup
DenyGroups wheel nogroup

<span class="c"># ê¸°ëŠ¥ ì œí•œ</span>
X11Forwarding no
AllowTcpForwarding no
GatewayPorts no
PermitTunnel no
PermitUserEnvironment no
PermitUserRC no
PrintMotd <span class="nb">yes
</span>PrintLastLog <span class="nb">yes
</span>TCPKeepAlive no
Compression no                      <span class="c"># ì••ì¶• ë¹„í™œì„±í™” (ë³´ì•ˆ)</span>

<span class="c"># ë¡œê¹…</span>
SyslogFacility AUTH
LogLevel VERBOSE                    <span class="c"># ìƒì„¸ ë¡œê¹…</span>

<span class="c"># Chroot ì„¤ì • (SFTP ì „ìš© ì‚¬ìš©ì)</span>
Subsystem sftp /usr/lib/openssh/sftp-server

<span class="c"># ì¡°ê±´ë¶€ ì„¤ì •</span>
Match User sftpuser
    ChrootDirectory /var/sftp/%u
    ForceCommand internal-sftp
    AllowTcpForwarding no
    X11Forwarding no
    PermitTunnel no

Match Address 192.168.1.0/24
    PasswordAuthentication <span class="nb">yes
    </span>MaxAuthTries 5

Match Address 10.0.0.0/8
    AllowTcpForwarding <span class="nb">local
    </span>GatewayPorts no

Match Group developers
    AllowTcpForwarding <span class="nb">yes
    </span>PermitOpen localhost:3000 localhost:8080

<span class="c"># ì„¤ì • ê²€ì¦</span>
sshd <span class="nt">-t</span>
sshd <span class="nt">-T</span> | <span class="nb">grep</span> <span class="nt">-i</span> cipher          <span class="c"># ì•”í˜¸í™” ì„¤ì • í™•ì¸</span>
sshd <span class="nt">-T</span> | <span class="nb">grep</span> <span class="nt">-i</span> mac             <span class="c"># MAC ì„¤ì • í™•ì¸</span>
</code></pre></div></div>

<h4 id="ssh-ì ‘ê·¼-ì œì–´-ë°-ëª¨ë‹ˆí„°ë§">SSH ì ‘ê·¼ ì œì–´ ë° ëª¨ë‹ˆí„°ë§</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1. TCP Wrapper ì„¤ì •</span>
<span class="c"># /etc/hosts.allow</span>
sshd: 192.168.1.0/24 : ALLOW
sshd: 10.0.0.0/8 : ALLOW
sshd: ALL : spawn <span class="o">(</span>/usr/local/bin/log-ssh-attempt %a %d<span class="o">)</span> : DENY

<span class="c"># /etc/hosts.deny</span>
sshd: ALL

<span class="c"># 2. SSH ì ‘ê·¼ ë¡œê¹… ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/log-ssh-attempt</span>
<span class="nv">CLIENT_IP</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">DAEMON</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">TIMESTAMP</span><span class="o">=</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span>

<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$TIMESTAMP</span><span class="s2">: Blocked SSH attempt from </span><span class="nv">$CLIENT_IP</span><span class="s2"> to </span><span class="nv">$DAEMON</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /var/log/ssh-blocked.log

<span class="c"># ì§€ë¦¬ì  ìœ„ì¹˜ í™•ì¸ (ì„ íƒì‚¬í•­)</span>
<span class="c"># LOCATION=$(geoiplookup $CLIENT_IP 2&gt;/dev/null | cut -d: -f2)</span>
<span class="c"># echo "$TIMESTAMP: $CLIENT_IP ($LOCATION) blocked" &gt;&gt; /var/log/ssh-geo.log</span>

<span class="c"># 3. SSH ì„¸ì…˜ ëª¨ë‹ˆí„°ë§</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/ssh-monitor.sh</span>

<span class="c"># í™œì„± SSH ì„¸ì…˜ ëª¨ë‹ˆí„°ë§</span>
<span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do
    </span><span class="nv">ACTIVE_SESSIONS</span><span class="o">=</span><span class="si">$(</span><span class="nb">who</span> | <span class="nb">grep</span> <span class="nt">-c</span> <span class="s2">"pts/"</span><span class="si">)</span>
    <span class="nv">SSH_PROCESSES</span><span class="o">=</span><span class="si">$(</span>pgrep <span class="nt">-c</span> sshd<span class="si">)</span>
    
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$ACTIVE_SESSIONS</span> <span class="nt">-gt</span> 10 <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">: High SSH session count: </span><span class="nv">$ACTIVE_SESSIONS</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /var/log/ssh-monitor.log
        <span class="c"># ì•Œë¦¼ ë°œì†¡</span>
        <span class="nb">echo</span> <span class="s2">"High SSH session count detected: </span><span class="nv">$ACTIVE_SESSIONS</span><span class="s2"> active sessions"</span> | <span class="se">\</span>
        mail <span class="nt">-s</span> <span class="s2">"SSH Monitor Alert"</span> admin@company.com
    <span class="k">fi</span>
    
    <span class="c"># ì¥ì‹œê°„ ìœ ì§€ë˜ëŠ” ì„¸ì…˜ í™•ì¸</span>
    <span class="nb">who</span> | <span class="k">while </span><span class="nb">read </span>user <span class="nb">tty time </span>rest<span class="p">;</span> <span class="k">do</span>
        <span class="c"># 12ì‹œê°„ ì´ìƒ ìœ ì§€ëœ ì„¸ì…˜ í™•ì¸</span>
        <span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$time</span><span class="s2">"</span> &lt; <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span> <span class="nt">-d</span> <span class="s1">'12 hours ago'</span> <span class="s1">'+%H:%M'</span><span class="si">)</span><span class="s2">"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">: Long running session: </span><span class="nv">$user</span><span class="s2"> on </span><span class="nv">$tty</span><span class="s2"> since </span><span class="nv">$time</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /var/log/ssh-monitor.log
        <span class="k">fi
    done
    
    </span><span class="nb">sleep </span>60
<span class="k">done</span>

<span class="c"># 4. SSH í‚¤ ë¡œí…Œì´ì…˜ ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/ssh-key-rotation.sh</span>

<span class="c"># 90ì¼ë§ˆë‹¤ í˜¸ìŠ¤íŠ¸ í‚¤ ë¡œí…Œì´ì…˜</span>
<span class="nv">HOSTKEY_AGE</span><span class="o">=</span><span class="si">$(</span>find /etc/ssh/ssh_host_<span class="k">*</span>_key <span class="nt">-mtime</span> +90 2&gt;/dev/null | <span class="nb">wc</span> <span class="nt">-l</span><span class="si">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$HOSTKEY_AGE</span> <span class="nt">-gt</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">: Host keys are older than 90 days. Rotation recommended."</span> <span class="o">&gt;&gt;</span> /var/log/ssh-key-rotation.log
    
    <span class="c"># ë°±ì—…</span>
    <span class="nb">cp</span> <span class="nt">-r</span> /etc/ssh /etc/ssh.backup.<span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span>
    
    <span class="c"># ìƒˆ í‚¤ ìƒì„±</span>
    ssh-keygen <span class="nt">-A</span>
    
    <span class="c"># ì„œë¹„ìŠ¤ ì¬ì‹œì‘</span>
    systemctl restart sshd
    
    <span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">: Host keys rotated successfully"</span> <span class="o">&gt;&gt;</span> /var/log/ssh-key-rotation.log
<span class="k">fi</span>

<span class="c"># ì‚¬ìš©ì í‚¤ ë§Œë£Œ í™•ì¸</span>
<span class="k">for </span>user_home <span class="k">in</span> /home/<span class="k">*</span><span class="p">;</span> <span class="k">do
    </span><span class="nv">username</span><span class="o">=</span><span class="si">$(</span><span class="nb">basename</span> <span class="nv">$user_home</span><span class="si">)</span>
    <span class="nv">auth_keys</span><span class="o">=</span><span class="s2">"</span><span class="nv">$user_home</span><span class="s2">/.ssh/authorized_keys"</span>
    
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$auth_keys</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        while </span><span class="nb">read</span> <span class="nt">-r</span> key<span class="p">;</span> <span class="k">do
            if</span> <span class="o">[[</span> <span class="nv">$key</span> <span class="o">=</span>~ ^ssh- <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
                <span class="c"># í‚¤ ìƒì„±ì¼ í™•ì¸ (ì½”ë©˜íŠ¸ì—ì„œ ë‚ ì§œ ì¶”ì¶œ)</span>
                <span class="nv">key_date</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$key</span> | <span class="nb">grep</span> <span class="nt">-o</span> <span class="s1">'[0-9]\{8\}'</span> | <span class="nb">head</span> <span class="nt">-1</span><span class="si">)</span>
                <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$key_date</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
                    </span><span class="nv">key_age</span><span class="o">=</span><span class="k">$((</span> <span class="o">(</span><span class="si">$(</span><span class="nb">date</span> +%s<span class="si">)</span> <span class="o">-</span> <span class="si">$(</span><span class="nb">date</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$key_date</span><span class="s2">"</span> +%s<span class="si">)</span><span class="o">)</span> <span class="o">/</span> <span class="m">86400</span> <span class="k">))</span>
                    <span class="k">if</span> <span class="o">[</span> <span class="nv">$key_age</span> <span class="nt">-gt</span> 365 <span class="o">]</span><span class="p">;</span> <span class="k">then
                        </span><span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">: User </span><span class="nv">$username</span><span class="s2"> has key older than 1 year (</span><span class="nv">$key_age</span><span class="s2"> days)"</span> <span class="o">&gt;&gt;</span> /var/log/ssh-key-rotation.log
                    <span class="k">fi
                fi
            fi
        done</span> &lt; <span class="s2">"</span><span class="nv">$auth_keys</span><span class="s2">"</span>
    <span class="k">fi
done</span>
</code></pre></div></div>

<h3 id="-ë°©í™”ë²½-ë³´ì•ˆ-ì„¤ì •">ğŸ”¥ ë°©í™”ë²½ ë³´ì•ˆ ì„¤ì •</h3>

<h4 id="iptables-ê³ ê¸‰-ë³´ì•ˆ-ê·œì¹™">iptables ê³ ê¸‰ ë³´ì•ˆ ê·œì¹™</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/setup-iptables-advanced.sh</span>
<span class="c"># ê³ ê¸‰ iptables ë³´ì•ˆ ì„¤ì • ìŠ¤í¬ë¦½íŠ¸</span>

<span class="c"># ê¸°ì¡´ ê·œì¹™ ì´ˆê¸°í™”</span>
iptables <span class="nt">-F</span>
iptables <span class="nt">-X</span>
iptables <span class="nt">-t</span> nat <span class="nt">-F</span>
iptables <span class="nt">-t</span> nat <span class="nt">-X</span>
iptables <span class="nt">-t</span> mangle <span class="nt">-F</span>
iptables <span class="nt">-t</span> mangle <span class="nt">-X</span>
iptables <span class="nt">-t</span> raw <span class="nt">-F</span>
iptables <span class="nt">-t</span> raw <span class="nt">-X</span>

<span class="c"># ê¸°ë³¸ ì •ì±… ì„¤ì • (ëª¨ë“  íŠ¸ë˜í”½ ì°¨ë‹¨)</span>
iptables <span class="nt">-P</span> INPUT DROP
iptables <span class="nt">-P</span> FORWARD DROP
iptables <span class="nt">-P</span> OUTPUT DROP

<span class="c"># 1. ê¸°ë³¸ í—ˆìš© ê·œì¹™</span>
<span class="c"># Loopback ì¸í„°í˜ì´ìŠ¤ í—ˆìš©</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-i</span> lo <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-o</span> lo <span class="nt">-j</span> ACCEPT

<span class="c"># ê¸°ì¡´ ì—°ê²° ìœ ì§€</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED,RELATED <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> FORWARD <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED,RELATED <span class="nt">-j</span> ACCEPT

<span class="c"># 2. SSH ë³´ì•ˆ ê·œì¹™ (ê³ ê¸‰)</span>
<span class="c"># SSH ë¸Œë£¨íŠ¸í¬ìŠ¤ ë°©ì§€ (ë³µí•©ì  ì ‘ê·¼)</span>
iptables <span class="nt">-N</span> SSH_BRUTEFORCE
iptables <span class="nt">-A</span> SSH_BRUTEFORCE <span class="nt">-m</span> recent <span class="nt">--set</span> <span class="nt">--name</span> SSH_ATTACK
iptables <span class="nt">-A</span> SSH_BRUTEFORCE <span class="nt">-m</span> recent <span class="nt">--update</span> <span class="nt">--seconds</span> 3600 <span class="nt">--hitcount</span> 3 <span class="nt">--name</span> SSH_ATTACK <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"SSH Bruteforce: "</span>
iptables <span class="nt">-A</span> SSH_BRUTEFORCE <span class="nt">-m</span> recent <span class="nt">--update</span> <span class="nt">--seconds</span> 3600 <span class="nt">--hitcount</span> 3 <span class="nt">--name</span> SSH_ATTACK <span class="nt">-j</span> DROP
iptables <span class="nt">-A</span> SSH_BRUTEFORCE <span class="nt">-j</span> ACCEPT

<span class="c"># SSH ì ‘ê·¼ ì œí•œ</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 2222 <span class="nt">-s</span> 192.168.1.0/24 <span class="nt">-j</span> SSH_BRUTEFORCE
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 2222 <span class="nt">-s</span> 10.0.0.0/8 <span class="nt">-j</span> SSH_BRUTEFORCE
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 2222 <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"SSH Unauthorized: "</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 2222 <span class="nt">-j</span> DROP

<span class="c"># 3. ì›¹ ì„œë²„ ë³´ì•ˆ (ìˆëŠ” ê²½ìš°)</span>
<span class="c"># HTTP/HTTPS with rate limiting</span>
iptables <span class="nt">-N</span> WEB_RATE_LIMIT
iptables <span class="nt">-A</span> WEB_RATE_LIMIT <span class="nt">-m</span> limit <span class="nt">--limit</span> 25/minute <span class="nt">--limit-burst</span> 100 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> WEB_RATE_LIMIT <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"HTTP Rate Limit: "</span>
iptables <span class="nt">-A</span> WEB_RATE_LIMIT <span class="nt">-j</span> DROP

iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 80 <span class="nt">-j</span> WEB_RATE_LIMIT
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 443 <span class="nt">-j</span> WEB_RATE_LIMIT

<span class="c"># 4. DDoS ë°©ì§€ ê·œì¹™</span>
<span class="c"># SYN Flood ë°©ì§€</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--syn</span> <span class="nt">-m</span> limit <span class="nt">--limit</span> 1/second <span class="nt">--limit-burst</span> 3 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--syn</span> <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"SYN Flood: "</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--syn</span> <span class="nt">-j</span> DROP

<span class="c"># Ping Flood ë°©ì§€</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> icmp <span class="nt">--icmp-type</span> echo-request <span class="nt">-m</span> limit <span class="nt">--limit</span> 1/second <span class="nt">--limit-burst</span> 2 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> icmp <span class="nt">--icmp-type</span> echo-request <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"Ping Flood: "</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> icmp <span class="nt">--icmp-type</span> echo-request <span class="nt">-j</span> DROP

<span class="c"># Port Scan ë°©ì§€</span>
iptables <span class="nt">-N</span> PORT_SCAN
iptables <span class="nt">-A</span> PORT_SCAN <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> SYN,ACK,FIN,RST RST <span class="nt">-m</span> limit <span class="nt">--limit</span> 1/s <span class="nt">--limit-burst</span> 2 <span class="nt">-j</span> RETURN
iptables <span class="nt">-A</span> PORT_SCAN <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"Port Scan: "</span>
iptables <span class="nt">-A</span> PORT_SCAN <span class="nt">-j</span> DROP
iptables <span class="nt">-A</span> INPUT <span class="nt">-j</span> PORT_SCAN

<span class="c"># 5. ì•„ì›ƒë°”ìš´ë“œ íŠ¸ë˜í”½ ì œì–´</span>
<span class="c"># DNS í—ˆìš© (í•„ìˆ˜)</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> udp <span class="nt">--dport</span> 53 <span class="nt">-d</span> 8.8.8.8 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> udp <span class="nt">--dport</span> 53 <span class="nt">-d</span> 1.1.1.1 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 53 <span class="nt">-j</span> ACCEPT

<span class="c"># NTP í—ˆìš©</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> udp <span class="nt">--dport</span> 123 <span class="nt">-j</span> ACCEPT

<span class="c"># HTTP/HTTPS ì•„ì›ƒë°”ìš´ë“œ (ì—…ë°ì´íŠ¸ìš©)</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 80 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 443 <span class="nt">-j</span> ACCEPT

<span class="c"># SMTP ì•„ì›ƒë°”ìš´ë“œ (ì´ë©”ì¼)</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 587 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 25 <span class="nt">-j</span> ACCEPT

<span class="c"># SSH ì•„ì›ƒë°”ìš´ë“œ (ê´€ë¦¬ìš©)</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 22 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 2222 <span class="nt">-j</span> ACCEPT

<span class="c"># 6. ì§€ë¦¬ì  IP ì°¨ë‹¨ (GeoIP ì‚¬ìš©)</span>
<span class="c"># íŠ¹ì • êµ­ê°€ IP ì°¨ë‹¨ (ì˜ˆ: ëŸ¬ì‹œì•„, ì¤‘êµ­, ë¶í•œ)</span>
<span class="c"># iptables -A INPUT -m geoip --src-cc RU,CN,KP -j LOG --log-prefix "GeoIP Block: "</span>
<span class="c"># iptables -A INPUT -m geoip --src-cc RU,CN,KP -j DROP</span>

<span class="c"># 7. ì• í”Œë¦¬ì¼€ì´ì…˜ë³„ ë³´ì•ˆ ê·œì¹™</span>
<span class="c"># ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ì œí•œ (ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ë§Œ)</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 3306 <span class="nt">-s</span> 192.168.1.0/24 <span class="nt">-j</span> ACCEPT  <span class="c"># MySQL</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 5432 <span class="nt">-s</span> 192.168.1.0/24 <span class="nt">-j</span> ACCEPT  <span class="c"># PostgreSQL</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 3306 <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"MySQL Unauthorized: "</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 3306 <span class="nt">-j</span> DROP
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 5432 <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"PostgreSQL Unauthorized: "</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 5432 <span class="nt">-j</span> DROP

<span class="c"># 8. ì•…ì„± íŠ¸ë˜í”½ ì°¨ë‹¨</span>
<span class="c"># Invalid íŒ¨í‚· ì°¨ë‹¨</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> INVALID <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"Invalid Packet: "</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> INVALID <span class="nt">-j</span> DROP

<span class="c"># NULL ìŠ¤ìº” ì°¨ë‹¨</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> ALL NONE <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"NULL Scan: "</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> ALL NONE <span class="nt">-j</span> DROP

<span class="c"># XMAS ìŠ¤ìº” ì°¨ë‹¨</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> ALL ALL <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"XMAS Scan: "</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> ALL ALL <span class="nt">-j</span> DROP

<span class="c"># 9. ë¡œê¹… ì„¤ì • (ìµœì¢… ë‹¨ê³„)</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-m</span> limit <span class="nt">--limit</span> 5/min <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"INPUT DROP: "</span> <span class="nt">--log-level</span> 7
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-m</span> limit <span class="nt">--limit</span> 5/min <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"OUTPUT DROP: "</span> <span class="nt">--log-level</span> 7

<span class="c"># 10. ì„¤ì • ì €ì¥</span>
iptables-save <span class="o">&gt;</span> /etc/iptables/rules.v4

<span class="c"># 11. ë¶€íŒ… ì‹œ ìë™ ë¡œë“œ ì„¤ì •</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/systemd/system/iptables-restore.service <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
[Unit]
Description=Restore iptables rules
After=network.target

[Service]
Type=oneshot
ExecStart=/sbin/iptables-restore /etc/iptables/rules.v4
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
</span><span class="no">EOF

</span>systemctl <span class="nb">enable </span>iptables-restore.service

<span class="nb">echo</span> <span class="s2">"Advanced iptables configuration completed!"</span>
<span class="nb">echo</span> <span class="s2">"Rules saved to /etc/iptables/rules.v4"</span>
<span class="nb">echo</span> <span class="s2">"Service enabled for boot: iptables-restore.service"</span>

<span class="c"># ê·œì¹™ í™•ì¸</span>
iptables <span class="nt">-L</span> <span class="nt">-n</span> <span class="nt">-v</span> <span class="nt">--line-numbers</span>
</code></pre></div></div>

<h4 id="ufw-ê³ ê¸‰-ì„¤ì •-ë°-ìë™í™”">UFW ê³ ê¸‰ ì„¤ì • ë° ìë™í™”</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/setup-ufw-advanced.sh</span>
<span class="c"># UFW ê³ ê¸‰ ë³´ì•ˆ ì„¤ì •</span>

<span class="c"># UFW ì´ˆê¸°í™” ë° ê¸°ë³¸ ì„¤ì •</span>
ufw <span class="nt">--force</span> reset
ufw default deny incoming
ufw default deny outgoing
ufw default deny forward

<span class="c"># ê¸°ë³¸ ì„œë¹„ìŠ¤ í—ˆìš©</span>
<span class="nb">echo</span> <span class="s2">"Setting up basic services..."</span>

<span class="c"># SSH (ë³´ì•ˆ í¬íŠ¸)</span>
ufw allow from 192.168.1.0/24 to any port 2222 comment <span class="s1">'SSH from LAN'</span>
ufw allow from 10.0.0.0/8 to any port 2222 comment <span class="s1">'SSH from VPN'</span>

<span class="c"># ì•„ì›ƒë°”ìš´ë“œ í•„ìˆ˜ ì„œë¹„ìŠ¤</span>
ufw allow out 53 comment <span class="s1">'DNS'</span>
ufw allow out 123 comment <span class="s1">'NTP'</span>
ufw allow out 80 comment <span class="s1">'HTTP'</span>
ufw allow out 443 comment <span class="s1">'HTTPS'</span>

<span class="c"># ë©”ì¼ ë°œì†¡</span>
ufw allow out 587 comment <span class="s1">'SMTP-TLS'</span>
ufw allow out 25 comment <span class="s1">'SMTP'</span>

<span class="c"># ì›¹ ì„œë²„ (ìˆëŠ” ê²½ìš°)</span>
<span class="c"># ufw allow 80 comment 'HTTP Server'</span>
<span class="c"># ufw allow 443 comment 'HTTPS Server'</span>

<span class="c"># ê³ ê¸‰ ê·œì¹™ ì„¤ì •</span>
<span class="nb">echo</span> <span class="s2">"Setting up advanced rules..."</span>

<span class="c"># 1. ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œíŒŒì¼ ìƒì„±</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/ufw/applications.d/custom-apps <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
[SSH-Custom]
title=SSH Custom Port
description=SSH on custom port 2222
ports=2222/tcp

[Database-Internal]
title=Database Internal Access
description=MySQL/PostgreSQL for internal network
ports=3306,5432/tcp

[Monitoring]
title=Monitoring Services
description=Prometheus, Grafana, etc.
ports=9090,3000,9100/tcp
</span><span class="no">EOF

</span>ufw app update SSH-Custom
ufw allow SSH-Custom

<span class="c"># 2. Rate limiting ì„¤ì •</span>
ufw limit ssh comment <span class="s1">'Rate limit SSH'</span>
ufw limit 80/tcp comment <span class="s1">'Rate limit HTTP'</span>
ufw limit 443/tcp comment <span class="s1">'Rate limit HTTPS'</span>

<span class="c"># 3. íŠ¹ì • IP ì°¨ë‹¨ (ì˜ˆì‹œ)</span>
<span class="c"># ì•Œë ¤ì§„ ì•…ì„± IP ì°¨ë‹¨</span>
<span class="nv">MALICIOUS_IPS</span><span class="o">=(</span>
    <span class="s2">"192.0.2.100"</span>
    <span class="s2">"203.0.113.50"</span>
<span class="o">)</span>

<span class="k">for </span>ip <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">MALICIOUS_IPS</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
    </span>ufw deny from <span class="s2">"</span><span class="nv">$ip</span><span class="s2">"</span> comment <span class="s2">"Known malicious IP"</span>
<span class="k">done</span>

<span class="c"># 4. ì§€ì—­ë³„ ì ‘ê·¼ ì œí•œ (ì˜ˆì‹œ)</span>
<span class="c"># ê´€ë¦¬ ì„œë¹„ìŠ¤ëŠ” êµ­ë‚´ IPë§Œ í—ˆìš©</span>
ufw allow from 220.0.0.0/8 to any port 22 comment <span class="s1">'Korea Telecom range'</span>
ufw allow from 121.0.0.0/8 to any port 22 comment <span class="s1">'SK Broadband range'</span>

<span class="c"># 5. ë¡œê¹… ì„¤ì •</span>
ufw logging on

<span class="c"># 6. UFW í™œì„±í™”</span>
ufw <span class="nt">--force</span> <span class="nb">enable</span>

<span class="c"># 7. ìƒíƒœ ì¶œë ¥</span>
ufw status verbose

<span class="c"># 8. UFW ë¡œê·¸ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /usr/local/bin/ufw-log-monitor.sh <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
#!/bin/bash
# UFW ë¡œê·¸ ëª¨ë‹ˆí„°ë§ ë° ë¶„ì„

UFW_LOG="/var/log/ufw.log"
ALERT_EMAIL="admin@company.com"

# ë¡œê·¸ íŒ¨í„´ ë¶„ì„
analyze_ufw_logs() {
    echo "=== UFW Log Analysis Report </span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="sh"> ==="
    
    # ìµœê·¼ 1ì‹œê°„ ë™ì•ˆì˜ ì°¨ë‹¨ëœ ì—°ê²°
    echo "Top blocked IPs (last hour):"
    grep "</span><span class="si">$(</span><span class="nb">date</span> <span class="nt">-d</span> <span class="s1">'1 hour ago'</span> <span class="s1">'+%b %d %H'</span><span class="si">)</span><span class="sh">" "</span><span class="nv">$UFW_LOG</span><span class="sh">" 2&gt;/dev/null | </span><span class="se">\</span><span class="sh">
    grep "BLOCK" | awk '{print </span><span class="si">$(</span>NF-1<span class="si">)</span><span class="sh">}' | cut -d= -f2 | </span><span class="se">\</span><span class="sh">
    sort | uniq -c | sort -nr | head -10
    
    echo ""
    
    # í¬íŠ¸ë³„ ê³µê²© í†µê³„
    echo "Top attacked ports (last hour):"
    grep "</span><span class="si">$(</span><span class="nb">date</span> <span class="nt">-d</span> <span class="s1">'1 hour ago'</span> <span class="s1">'+%b %d %H'</span><span class="si">)</span><span class="sh">" "</span><span class="nv">$UFW_LOG</span><span class="sh">" 2&gt;/dev/null | </span><span class="se">\</span><span class="sh">
    grep "BLOCK" | grep -o "DPT=[0-9]*" | cut -d= -f2 | </span><span class="se">\</span><span class="sh">
    sort | uniq -c | sort -nr | head -10
    
    echo ""
    
    # í”„ë¡œí† ì½œë³„ í†µê³„
    echo "Protocol statistics (last hour):"
    grep "</span><span class="si">$(</span><span class="nb">date</span> <span class="nt">-d</span> <span class="s1">'1 hour ago'</span> <span class="s1">'+%b %d %H'</span><span class="si">)</span><span class="sh">" "</span><span class="nv">$UFW_LOG</span><span class="sh">" 2&gt;/dev/null | </span><span class="se">\</span><span class="sh">
    grep "BLOCK" | grep -o "PROTO=[A-Z]*" | cut -d= -f2 | </span><span class="se">\</span><span class="sh">
    sort | uniq -c | sort -nr
    
    echo "=================================="
}

# ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
monitor_realtime() {
    tail -f "</span><span class="nv">$UFW_LOG</span><span class="sh">" | while read line; do
        if echo "</span><span class="nv">$line</span><span class="sh">" | grep -q "BLOCK"; then
            src_ip=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-o</span> <span class="s2">"SRC=[0-9.]*"</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="o">=</span> <span class="nt">-f2</span><span class="si">)</span><span class="sh">
            dst_port=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-o</span> <span class="s2">"DPT=[0-9]*"</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="o">=</span> <span class="nt">-f2</span><span class="si">)</span><span class="sh">
            
            # ë†’ì€ ë¹ˆë„ ê³µê²© ê°ì§€
            recent_blocks=</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-c</span> <span class="s2">"</span><span class="nv">$src_ip</span><span class="s2">"</span> &lt;<span class="o">(</span><span class="nb">tail</span> <span class="nt">-100</span> <span class="s2">"</span><span class="nv">$UFW_LOG</span><span class="s2">"</span><span class="o">)</span><span class="si">)</span><span class="sh">
            
            if [ "</span><span class="nv">$recent_blocks</span><span class="sh">" -gt 10 ]; then
                echo "</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="sh">: High frequency attack from </span><span class="nv">$src_ip</span><span class="sh"> (port </span><span class="nv">$dst_port</span><span class="sh">)"
                # ìë™ ì°¨ë‹¨ ê°•í™” (ì„ íƒì‚¬í•­)
                # ufw insert 1 deny from "</span><span class="nv">$src_ip</span><span class="sh">" comment "Auto-blocked: high frequency"
            fi
        fi
    done
}

case "</span><span class="nv">$1</span><span class="sh">" in
    "analyze")
        analyze_ufw_logs
        ;;
    "monitor")
        echo "Starting real-time UFW monitoring... (Ctrl+C to stop)"
        monitor_realtime
        ;;
    "report")
        analyze_ufw_logs | mail -s "UFW Security Report" "</span><span class="nv">$ALERT_EMAIL</span><span class="sh">"
        ;;
    *)
        echo "Usage: </span><span class="nv">$0</span><span class="sh"> {analyze|monitor|report}"
        exit 1
        ;;
esac
</span><span class="no">EOF

</span><span class="nb">chmod</span> +x /usr/local/bin/ufw-log-monitor.sh

<span class="c"># 9. ì •ê¸°ì ì¸ ë¡œê·¸ ë¶„ì„ ì„¤ì •</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/cron.hourly/ufw-analysis <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
#!/bin/bash
/usr/local/bin/ufw-log-monitor.sh analyze &gt;&gt; /var/log/ufw-analysis.log
</span><span class="no">EOF

</span><span class="nb">chmod</span> +x /etc/cron.hourly/ufw-analysis

<span class="nb">echo</span> <span class="s2">"UFW advanced configuration completed!"</span>
<span class="nb">echo</span> <span class="s2">"Monitor logs with: /usr/local/bin/ufw-log-monitor.sh monitor"</span>
<span class="nb">echo</span> <span class="s2">"View status with: ufw status verbose"</span>
</code></pre></div></div>

<h2 id="ë‹¤ìŒ-í¸-ì˜ˆê³ ">ë‹¤ìŒ í¸ ì˜ˆê³ </h2>

<p>ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” <strong>SELinux/AppArmorì™€ ì‹œìŠ¤í…œ í•˜ë“œë‹</strong>ì„ ìì„¸íˆ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤:</p>
<ul>
  <li>SELinux ì •ì±… ì‘ì„± ë° ê´€ë¦¬</li>
  <li>AppArmor í”„ë¡œíŒŒì¼ ì»¤ìŠ¤í„°ë§ˆì´ì§•</li>
  <li>ì»¤ë„ ë³´ì•ˆ ë§¤ê°œë³€ìˆ˜ ìµœì í™”</li>
  <li>íŒŒì¼ ì‹œìŠ¤í…œ ë³´ì•ˆ ê°•í™”</li>
</ul>

<p>SSHì™€ ë°©í™”ë²½ ë³´ì•ˆì„ ì™„ë²½í•˜ê²Œ ë§ˆìŠ¤í„°í•˜ì…¨ë‚˜ìš”? ğŸ”ğŸ›¡ï¸</p>

  </div>

  <footer class="post-footer">
    <div class="post-navigation"><div class="nav-previous">
        <a href="/infra-blog/blog/2024/11/04/deployment-strategies-guide.html" rel="prev">
          <i class="icon-left-arrow"></i>
          <span class="nav-title">ë°°í¬ ì „ëµ ì™„ì „ ê°€ì´ë“œ | Complete Deployment Strategies G...</span>
        </a>
      </div><div class="nav-next">
        <a href="/infra-blog/blog/2025/01/18/networking-guide-part4.html" rel="next">
          <span class="nav-title">ë„¤íŠ¸ì›Œí‚¹ ì™„ì „ ê°€ì´ë“œ 4í¸ - ë¬´ì„  ë„¤íŠ¸ì›Œí‚¹ê³¼ ìµœì‹  ê¸°ìˆ  | Complete Netw...</span>
          <i class="icon-right-arrow"></i>
        </a>
      </div></div>
  </footer>
  </article></div>

    </section>
    <footer class="condensed">
      <ul class="social about-footer condensed"><a href="https://github.com/leeyonghe" target="_blank">
          <li>
            <i class="icon-github-circled"></i>
          </li>
        </a><a href="https://www.linkedin.com/in/lee-yong-hee-18912454/" target="_blank">
          <li>
            <i class="icon-linkedin-squared"></i>
          </li>
        </a><!----></ul><p class="about-footer condensed">&copy;
        2025</p><div class="about-footer condensed">
        <p>Dark Mode
          <i class="icon-moon"></i>
          <label class="switch">
            <input type="checkbox" class="dark-mode-toggle">
            <span class="slider round" onclick="toggleDarkMode()"></span>
          </label>
        </p>
      </div>
    </footer>
  </main>
  
  <script type="text/javascript" src="/infra-blog/assets/js/darkmode.js"></script>
  
  <script src="/infra-blog/assets/js/simple-jekyll-search.min.js"></script>
  <script src="/infra-blog/assets/js/search.js"></script>
  
</body>

</html>
