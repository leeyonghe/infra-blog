<!DOCTYPE html>
<html lang="en">

<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="stylesheet" href="/infra-blog/assets/css/style.css">
<link rel="stylesheet" href="/infra-blog/assets/css/post-detail.css">
<style>
/* Post Detail Page Styling */
.post-container article {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  padding: 40px;
  margin: 30px auto;
  max-width: 800px;
}

@media screen and (max-width: 768px) {
  .post-container article {
    margin: 20px;
    padding: 25px;
    border-radius: 8px;
  }
}

.post-container article .post-header {
  border-bottom: 2px solid #f5f5f5;
  padding-bottom: 25px;
  margin-bottom: 30px;
}

.post-container article .post-header .post-title {
  font-size: 2.2em;
  font-weight: 700;
  color: #2c3e50;
  line-height: 1.3;
  margin-bottom: 15px;
}

@media screen and (max-width: 768px) {
  .post-container article .post-header .post-title {
    font-size: 1.8em;
  }
}

.post-container article .post-header .post-meta {
  display: flex;
  align-items: center;
  gap: 20px;
  flex-wrap: wrap;
}

.post-container article .post-header .post-meta .post-date {
  display: flex;
  align-items: center;
  color: #666;
  font-size: 0.9em;
}

.post-container article .post-header .post-meta .post-date i {
  margin-right: 8px;
  color: #888;
}

.post-container article .post-header .post-meta .post-categories-wrapper {
  display: flex;
  align-items: center;
}

.post-container article .post-header .post-meta .post-categories-wrapper i {
  margin-right: 8px;
  color: #888;
}

.post-container article .post-header .post-meta .post-categories-wrapper .post-categories {
  display: flex;
  gap: 8px;
  list-style: none;
  margin: 0;
  padding: 0;
}

.post-container article .post-header .post-meta .post-categories-wrapper .post-categories li {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.8em;
  font-weight: 500;
  text-transform: capitalize;
}

.post-container article .post-content {
  font-size: 1.1em;
  line-height: 1.8;
  color: #333;
}

.post-container article .post-content p {
  margin-bottom: 1.2em;
}

.post-container article .post-content h1,
.post-container article .post-content h2,
.post-container article .post-content h3,
.post-container article .post-content h4,
.post-container article .post-content h5,
.post-container article .post-content h6 {
  color: #2c3e50;
  margin: 1.5em 0 0.8em 0;
  font-weight: 600;
}

.post-container article .post-content h2 {
  font-size: 1.8em;
  border-bottom: 2px solid #3498db;
  padding-bottom: 10px;
}

.post-container article .post-content h3 {
  font-size: 1.5em;
  color: #34495e;
}

.post-container article .post-content code {
  background: #f8f9fa;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 0.9em;
  color: #e74c3c;
}

.post-container article .post-content pre {
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 6px;
  padding: 15px;
  overflow-x: auto;
  margin: 1.5em 0;
}

.post-container article .post-content pre code {
  background: none;
  color: #333;
  padding: 0;
}

.post-container article .post-content blockquote {
  border-left: 4px solid #3498db;
  background: #f8f9fa;
  padding: 15px 20px;
  margin: 1.5em 0;
  font-style: italic;
  color: #555;
}

.post-container article .post-content img {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
  margin: 1.5em 0;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.post-container article .post-content ul,
.post-container article .post-content ol {
  padding-left: 1.5em;
  margin-bottom: 1.2em;
}

.post-container article .post-content ul li,
.post-container article .post-content ol li {
  margin-bottom: 0.5em;
}

.post-container article .post-content a {
  color: #3498db;
  text-decoration: none;
  border-bottom: 1px solid transparent;
  transition: all 0.3s ease;
}

.post-container article .post-content a:hover {
  border-bottom-color: #3498db;
}

.post-container article .post-footer {
  border-top: 2px solid #f5f5f5;
  padding-top: 25px;
  margin-top: 40px;
}

.post-container article .post-footer .post-navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 20px;
}

@media screen and (max-width: 768px) {
  .post-container article .post-footer .post-navigation {
    flex-direction: column;
    gap: 15px;
  }
}

.post-container article .post-footer .post-navigation .nav-previous,
.post-container article .post-footer .post-navigation .nav-next {
  flex: 1;
}

.post-container article .post-footer .post-navigation .nav-previous a,
.post-container article .post-footer .post-navigation .nav-next a {
  display: flex;
  align-items: center;
  padding: 15px 20px;
  background: #f8f9fa;
  border-radius: 8px;
  text-decoration: none;
  color: #333;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.post-container article .post-footer .post-navigation .nav-previous a:hover,
.post-container article .post-footer .post-navigation .nav-next a:hover {
  background: #e9ecef;
  border-color: #3498db;
  transform: translateY(-2px);
}

.post-container article .post-footer .post-navigation .nav-previous a i,
.post-container article .post-footer .post-navigation .nav-next a i {
  color: #3498db;
  margin: 0 8px;
}

.post-container article .post-footer .post-navigation .nav-previous a .nav-title,
.post-container article .post-footer .post-navigation .nav-next a .nav-title {
  font-weight: 500;
}

.post-container article .post-footer .post-navigation .nav-previous a {
  justify-content: flex-start;
}

.post-container article .post-footer .post-navigation .nav-next a {
  justify-content: flex-end;
  text-align: right;
}
</style>
<title>Nginx 고급 설정 가이드 Part 3 - 리버스 프록시, 캐싱, 압축 최적화</title>

<script type="text/javascript" src="/infra-blog/assets/js/darkmode.js"></script>

</head><body>
  <main class="container">
    <section class="about">
      <div class="about-header condensed">
      <div class="about-title">
      <a href="/infra-blog/">
        
        <img src="/infra-blog/assets/portfolio.png" alt="Infrastructure Engineer" />
        
      </a>
      <h2 id="title">
        <a href="/infra-blog/">Infrastructure Engineer</a>
      </h2>
      </div><p class="tagline">DevOps & Cloud Infrastructure Specialist</p></div>
      
      <ul class="social about-footer condensed"><a href="https://github.com/leeyonghe" target="_blank">
          <li>
            <i class="icon-github-circled"></i>
          </li>
        </a><a href="https://www.linkedin.com/in/lee-yong-hee-18912454/" target="_blank">
          <li>
            <i class="icon-linkedin-squared"></i>
          </li>
        </a><!----></ul><p class="about-footer condensed">&copy;
        2025</p><div class="about-footer condensed">
        <p>Dark Mode
          <i class="icon-moon"></i>
          <label class="switch">
            <input type="checkbox" class="dark-mode-toggle">
            <span class="slider round" onclick="toggleDarkMode()"></span>
          </label>
        </p>
      </div>
    </section>
    <section class="content">
      <style>
/* Post Detail Page Styling - Direct Inline */
.post-container article {
  background: #fff !important;
  border: none !important;
  border-top: none !important;
  border-right: none !important;
  border-bottom: none !important;
  border-left: none !important;
  border-width: 0 !important;
  border-style: none !important;
  outline: none !important;
  border-radius: 12px !important;
  box-shadow: none !important;
  padding: 40px !important;
  margin: 30px auto !important;
  max-width: 800px !important;
}

.post-container article .post-header .post-title {
  font-size: 2.2em !important;
  font-weight: 700 !important;
  color: #2c3e50 !important;
  line-height: 1.3 !important;
}

.post-container article .post-header {
  border-bottom: none !important;
  padding-bottom: 25px !important;
  margin-bottom: 30px !important;
}

.post-container article .post-content {
  font-size: 1.1em !important;
  line-height: 1.8 !important;
  color: #333 !important;
}

.post-container article .post-content h2 {
  font-size: 1.8em !important;
  border-bottom: none !important;
  padding-bottom: 10px !important;
  color: #2c3e50 !important;
}

.post-container article .post-header .post-meta .post-categories li {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
  color: white !important;
  padding: 4px 12px !important;
  border-radius: 20px !important;
  font-size: 0.8em !important;
  list-style: none !important;
  display: inline-block !important;
  margin-right: 8px !important;
}

.post-container article .post-footer {
  border-top: none !important;
  padding-top: 25px !important;
  margin-top: 40px !important;
}

/* 모든 border와 box-shadow 강제 제거 */
.post-container article *,
.post-container article *::before,
.post-container article *::after {
  border: none !important;
  border-top: none !important;
  border-right: none !important;
  border-bottom: none !important;
  border-left: none !important;
  border-width: 0 !important;
  border-style: none !important;
  outline: none !important;
  box-shadow: none !important;
}

/* 코드 블록과 pre 태그도 border, box-shadow 제거 */
.post-container article pre,
.post-container article code,
.post-container article .highlight,
.post-container article .highlighter-rouge {
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
}
</style><div class="post-container">
  <article>
    <header class="post-header">
    <h1 class="post-title">Nginx 고급 설정 가이드 Part 3 - 리버스 프록시, 캐싱, 압축 최적화</h1>
    <div class="post-meta">
      <div class="post-date">
        <i class="icon-calendar"></i>
        <time datetime="2024-05-17T00:00:00+00:00">May 17, 2024</time>
      </div><div class="post-categories-wrapper">
        <i class="icon-tag"></i>
        <ul class="post-categories"><li>Infrastructure</li><li>Nginx</li><li>Performance</li></ul>
      </div></div>
  </header>

  <div class="post-content">
    <h1 id="nginx-고급-설정-가이드-part-3---리버스-프록시-캐싱-압축-최적화">Nginx 고급 설정 가이드 Part 3 - 리버스 프록시, 캐싱, 압축 최적화</h1>

<p>이번 포스트에서는 Nginx의 성능 최적화를 위한 고급 기능들을 다룹니다. 리버스 프록시 설정부터 캐싱 전략, 압축 최적화까지 웹 서버의 성능을 극대화하는 방법을 학습합니다.</p>

<!--more-->

<h2 id="목차">목차</h2>
<ol>
  <li><a href="#리버스-프록시-고급-설정">리버스 프록시 고급 설정</a></li>
  <li><a href="#캐싱-전략">캐싱 전략</a></li>
  <li><a href="#압축-최적화">압축 최적화</a></li>
  <li><a href="#정적-파일-서빙-최적화">정적 파일 서빙 최적화</a></li>
  <li><a href="#리다이렉션과-url-재작성">리다이렉션과 URL 재작성</a></li>
  <li><a href="#성능-튜닝">성능 튜닝</a></li>
</ol>

<h2 id="리버스-프록시-고급-설정">리버스 프록시 고급 설정</h2>

<h3 id="기본-프록시-설정">기본 프록시 설정</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">app.example.com</span><span class="p">;</span>
    
    <span class="kn">location</span> <span class="n">/</span> <span class="p">{</span>
        <span class="kn">proxy_pass</span> <span class="s">http://backend_app</span><span class="p">;</span>
        
        <span class="c1"># 필수 헤더 설정</span>
        <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-Proto</span> <span class="nv">$scheme</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-Host</span> <span class="nv">$server_name</span><span class="p">;</span>
        
        <span class="c1"># 타임아웃 설정</span>
        <span class="kn">proxy_connect_timeout</span> <span class="s">30s</span><span class="p">;</span>
        <span class="kn">proxy_send_timeout</span> <span class="s">30s</span><span class="p">;</span>
        <span class="kn">proxy_read_timeout</span> <span class="s">30s</span><span class="p">;</span>
        
        <span class="c1"># 버퍼링 설정</span>
        <span class="kn">proxy_buffering</span> <span class="no">on</span><span class="p">;</span>
        <span class="kn">proxy_buffer_size</span> <span class="mi">128k</span><span class="p">;</span>
        <span class="kn">proxy_buffers</span> <span class="mi">4</span> <span class="mi">256k</span><span class="p">;</span>
        <span class="kn">proxy_busy_buffers_size</span> <span class="mi">256k</span><span class="p">;</span>
        <span class="kn">proxy_temp_file_write_size</span> <span class="mi">256k</span><span class="p">;</span>
        
        <span class="c1"># HTTP 버전 및 연결 유지</span>
        <span class="kn">proxy_http_version</span> <span class="mf">1.1</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">""</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="websocket-프록시">WebSocket 프록시</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">map</span> <span class="nv">$http_upgrade</span> <span class="nv">$connection_upgrade</span> <span class="p">{</span>
    <span class="kn">default</span> <span class="s">upgrade</span><span class="p">;</span>
    <span class="kn">''</span> <span class="s">close</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">upstream</span> <span class="s">websocket</span> <span class="p">{</span>
    <span class="kn">server</span> <span class="nf">backend1.example.com</span><span class="p">:</span><span class="mi">8080</span><span class="p">;</span>
    <span class="kn">server</span> <span class="nf">backend2.example.com</span><span class="p">:</span><span class="mi">8080</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">ws.example.com</span><span class="p">;</span>
    
    <span class="kn">location</span> <span class="n">/ws/</span> <span class="p">{</span>
        <span class="kn">proxy_pass</span> <span class="s">http://websocket</span><span class="p">;</span>
        
        <span class="c1"># WebSocket 헤더</span>
        <span class="kn">proxy_http_version</span> <span class="mf">1.1</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Upgrade</span> <span class="nv">$http_upgrade</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="nv">$connection_upgrade</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
        
        <span class="c1"># WebSocket 타임아웃</span>
        <span class="kn">proxy_read_timeout</span> <span class="mi">86400</span><span class="p">;</span>
        <span class="kn">proxy_send_timeout</span> <span class="mi">86400</span><span class="p">;</span>
        
        <span class="c1"># 버퍼링 비활성화</span>
        <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="마이크로서비스-프록시">마이크로서비스 프록시</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># API 라우팅</span>
<span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">api.example.com</span><span class="p">;</span>
    
    <span class="c1"># 인증 서비스</span>
    <span class="kn">location</span> <span class="n">/auth/</span> <span class="p">{</span>
        <span class="kn">proxy_pass</span> <span class="s">http://auth-service/</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
        
        <span class="c1"># 인증 응답 캐싱</span>
        <span class="kn">proxy_cache</span> <span class="s">auth_cache</span><span class="p">;</span>
        <span class="kn">proxy_cache_valid</span> <span class="mi">200</span> <span class="mi">5m</span><span class="p">;</span>
        <span class="kn">proxy_cache_key</span> <span class="s">"</span><span class="nv">$scheme$request_method$host$request_uri</span><span class="s">"</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1"># 사용자 서비스</span>
    <span class="kn">location</span> <span class="n">/users/</span> <span class="p">{</span>
        <span class="kn">auth_request</span> <span class="n">/auth/verify</span><span class="p">;</span>
        <span class="kn">proxy_pass</span> <span class="s">http://user-service/</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-User-ID</span> <span class="nv">$upstream_http_user_id</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1"># 주문 서비스</span>
    <span class="kn">location</span> <span class="n">/orders/</span> <span class="p">{</span>
        <span class="kn">auth_request</span> <span class="n">/auth/verify</span><span class="p">;</span>
        <span class="kn">proxy_pass</span> <span class="s">http://order-service/</span><span class="p">;</span>
        
        <span class="c1"># 주문 생성은 캐시하지 않음</span>
        <span class="kn">proxy_cache_bypass</span> <span class="nv">$request_method</span> <span class="p">~</span><span class="sr">*</span> <span class="s">^(POST|PUT|DELETE)</span>$<span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1"># 내부 인증 확인</span>
    <span class="kn">location</span> <span class="p">=</span> <span class="n">/auth/verify</span> <span class="p">{</span>
        <span class="kn">internal</span><span class="p">;</span>
        <span class="kn">proxy_pass</span> <span class="s">http://auth-service/verify</span><span class="p">;</span>
        <span class="kn">proxy_pass_request_body</span> <span class="no">off</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Content-Length</span> <span class="s">""</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Original-URI</span> <span class="nv">$request_uri</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="캐싱-전략">캐싱 전략</h2>

<h3 id="프록시-캐시-설정">프록시 캐시 설정</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">http</span> <span class="p">{</span>
    <span class="c1"># 캐시 경로 및 설정</span>
    <span class="kn">proxy_cache_path</span> <span class="n">/var/cache/nginx/proxy</span> 
                     <span class="s">levels=1:2</span> 
                     <span class="s">keys_zone=my_cache:10m</span> 
                     <span class="s">max_size=1g</span> 
                     <span class="s">inactive=60m</span> 
                     <span class="s">use_temp_path=off</span><span class="p">;</span>
    
    <span class="c1"># FastCGI 캐시 (PHP용)</span>
    <span class="kn">fastcgi_cache_path</span> <span class="n">/var/cache/nginx/fastcgi</span> 
                       <span class="s">levels=1:2</span> 
                       <span class="s">keys_zone=php_cache:10m</span> 
                       <span class="s">max_size=1g</span> 
                       <span class="s">inactive=60m</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">example.com</span><span class="p">;</span>
    
    <span class="c1"># 정적 파일 캐싱</span>
    <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="err">\</span><span class="s">.(jpg|jpeg|png|gif|ico|css|js|pdf)</span>$ <span class="p">{</span>
        <span class="kn">expires</span> <span class="s">1y</span><span class="p">;</span>
        <span class="kn">add_header</span> <span class="s">Cache-Control</span> <span class="s">"public,</span> <span class="s">immutable"</span><span class="p">;</span>
        <span class="kn">add_header</span> <span class="s">Vary</span> <span class="s">Accept-Encoding</span><span class="p">;</span>
        
        <span class="c1"># 조건부 캐싱</span>
        <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="err">\</span><span class="s">.(css|js)</span>$ <span class="p">{</span>
            <span class="kn">expires</span> <span class="mi">1M</span><span class="p">;</span>
            <span class="kn">add_header</span> <span class="s">Cache-Control</span> <span class="s">"public"</span><span class="p">;</span>
            
            <span class="c1"># 압축 설정</span>
            <span class="kn">gzip_static</span> <span class="no">on</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1"># API 응답 캐싱</span>
    <span class="kn">location</span> <span class="n">/api/</span> <span class="p">{</span>
        <span class="kn">proxy_pass</span> <span class="s">http://backend</span><span class="p">;</span>
        <span class="kn">proxy_cache</span> <span class="s">my_cache</span><span class="p">;</span>
        <span class="kn">proxy_cache_revalidate</span> <span class="no">on</span><span class="p">;</span>
        <span class="kn">proxy_cache_min_uses</span> <span class="mi">1</span><span class="p">;</span>
        <span class="kn">proxy_cache_use_stale</span> <span class="s">error</span> <span class="s">timeout</span> <span class="s">invalid_header</span> <span class="s">http_500</span> <span class="s">http_502</span> <span class="s">http_503</span> <span class="s">http_504</span><span class="p">;</span>
        <span class="kn">proxy_cache_background_update</span> <span class="no">on</span><span class="p">;</span>
        <span class="kn">proxy_cache_lock</span> <span class="no">on</span><span class="p">;</span>
        
        <span class="c1"># 캐시 키 설정</span>
        <span class="kn">proxy_cache_key</span> <span class="s">"</span><span class="nv">$scheme$request_method$host$request_uri$is_args$args</span><span class="s">"</span><span class="p">;</span>
        
        <span class="c1"># 캐시 유효 시간</span>
        <span class="kn">proxy_cache_valid</span> <span class="mi">200</span> <span class="mi">302</span> <span class="mi">10m</span><span class="p">;</span>
        <span class="kn">proxy_cache_valid</span> <span class="mi">301</span> <span class="s">1h</span><span class="p">;</span>
        <span class="kn">proxy_cache_valid</span> <span class="s">any</span> <span class="mi">1m</span><span class="p">;</span>
        
        <span class="c1"># 캐시 우회 조건</span>
        <span class="kn">proxy_cache_bypass</span> <span class="nv">$cookie_nocache</span> <span class="nv">$arg_nocache</span> <span class="nv">$arg_comment</span><span class="p">;</span>
        <span class="kn">proxy_cache_bypass</span> <span class="nv">$http_pragma</span> <span class="nv">$http_authorization</span><span class="p">;</span>
        
        <span class="c1"># 캐시 상태 헤더</span>
        <span class="kn">add_header</span> <span class="s">X-Cache-Status</span> <span class="nv">$upstream_cache_status</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1"># PHP 캐싱</span>
    <span class="kn">location</span> <span class="p">~</span> <span class="sr">\.php$</span> <span class="p">{</span>
        <span class="kn">include</span> <span class="nc">snippets/fastcgi-php</span><span class="s">.conf</span><span class="p">;</span>
        <span class="kn">fastcgi_pass</span> <span class="s">unix:/var/run/php/php8.1-fpm.sock</span><span class="p">;</span>
        
        <span class="kn">fastcgi_cache</span> <span class="s">php_cache</span><span class="p">;</span>
        <span class="kn">fastcgi_cache_valid</span> <span class="mi">200</span> <span class="mi">301</span> <span class="mi">302</span> <span class="s">1h</span><span class="p">;</span>
        <span class="kn">fastcgi_cache_valid</span> <span class="mi">404</span> <span class="mi">10m</span><span class="p">;</span>
        <span class="kn">fastcgi_cache_min_uses</span> <span class="mi">2</span><span class="p">;</span>
        <span class="kn">fastcgi_cache_use_stale</span> <span class="s">error</span> <span class="s">timeout</span> <span class="s">invalid_header</span> <span class="s">http_500</span><span class="p">;</span>
        
        <span class="c1"># 동적 콘텐츠 캐시 우회</span>
        <span class="kn">fastcgi_cache_bypass</span> <span class="nv">$cookie_PHPSESSID</span><span class="p">;</span>
        <span class="kn">fastcgi_cache_bypass</span> <span class="nv">$http_x_requested_with</span><span class="p">;</span>
        
        <span class="kn">add_header</span> <span class="s">X-FastCGI-Cache</span> <span class="nv">$upstream_cache_status</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="캐시-제거-및-관리">캐시 제거 및 관리</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 캐시 퍼지 위치 (특정 모듈 필요)</span>
<span class="k">location</span> <span class="p">~</span> <span class="sr">/purge(/.*)</span> <span class="p">{</span>
    <span class="kn">allow</span> <span class="mf">127.0</span><span class="s">.0.1</span><span class="p">;</span>
    <span class="kn">allow</span> <span class="mf">192.168</span><span class="s">.1.0/24</span><span class="p">;</span>
    <span class="kn">deny</span> <span class="s">all</span><span class="p">;</span>
    
    <span class="kn">proxy_cache_purge</span> <span class="s">my_cache</span> <span class="s">"</span><span class="nv">$scheme$request_method$host$1</span><span class="s">"</span><span class="p">;</span>
    <span class="kn">return</span> <span class="mi">200</span> <span class="s">"Purged</span><span class="err">\</span><span class="s">n"</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># 캐시 상태 확인</span>
<span class="k">location</span> <span class="n">/cache-status</span> <span class="p">{</span>
    <span class="kn">allow</span> <span class="mf">127.0</span><span class="s">.0.1</span><span class="p">;</span>
    <span class="kn">deny</span> <span class="s">all</span><span class="p">;</span>
    
    <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">return</span> <span class="mi">200</span> <span class="s">"Cache</span> <span class="s">Status:</span> <span class="nv">$upstream_cache_status</span><span class="err">\</span><span class="s">n"</span><span class="p">;</span>
    <span class="kn">add_header</span> <span class="s">Content-Type</span> <span class="nc">text/plain</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="압축-최적화">압축 최적화</h2>

<h3 id="gzip-압축">Gzip 압축</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">http</span> <span class="p">{</span>
    <span class="c1"># Gzip 설정</span>
    <span class="kn">gzip</span> <span class="no">on</span><span class="p">;</span>
    <span class="kn">gzip_vary</span> <span class="no">on</span><span class="p">;</span>
    <span class="kn">gzip_min_length</span> <span class="mi">1024</span><span class="p">;</span>
    <span class="kn">gzip_proxied</span> <span class="s">any</span><span class="p">;</span>
    <span class="kn">gzip_comp_level</span> <span class="mi">6</span><span class="p">;</span>
    <span class="kn">gzip_types</span>
        <span class="nc">application/atom</span><span class="s">+xml</span>
        <span class="nc">application/geo</span><span class="s">+json</span>
        <span class="nc">application/javascript</span>
        <span class="nc">application/x-javascript</span>
        <span class="nc">application/json</span>
        <span class="nc">application/ld</span><span class="s">+json</span>
        <span class="nc">application/manifest</span><span class="s">+json</span>
        <span class="nc">application/rdf</span><span class="s">+xml</span>
        <span class="nc">application/rss</span><span class="s">+xml</span>
        <span class="nc">application/xhtml</span><span class="s">+xml</span>
        <span class="nc">application/xml</span>
        <span class="nc">font/eot</span>
        <span class="nc">font/otf</span>
        <span class="nc">font/ttf</span>
        <span class="nc">image/svg</span><span class="s">+xml</span>
        <span class="nc">text/css</span>
        <span class="nc">text/javascript</span>
        <span class="nc">text/plain</span>
        <span class="nc">text/xml</span><span class="p">;</span>
    
    <span class="c1"># Gzip static</span>
    <span class="kn">gzip_static</span> <span class="no">on</span><span class="p">;</span>
    
    <span class="c1"># Brotli 압축 (모듈 필요)</span>
    <span class="kn">brotli</span> <span class="no">on</span><span class="p">;</span>
    <span class="kn">brotli_comp_level</span> <span class="mi">6</span><span class="p">;</span>
    <span class="kn">brotli_types</span>
        <span class="nc">application/atom</span><span class="s">+xml</span>
        <span class="nc">application/javascript</span>
        <span class="nc">application/json</span>
        <span class="nc">application/rss</span><span class="s">+xml</span>
        <span class="nc">application/vnd</span><span class="s">.ms-fontobject</span>
        <span class="nc">application/x-font-opentype</span>
        <span class="nc">application/x-font-truetype</span>
        <span class="nc">application/x-font-ttf</span>
        <span class="nc">application/x-javascript</span>
        <span class="nc">application/xhtml</span><span class="s">+xml</span>
        <span class="nc">application/xml</span>
        <span class="nc">font/eot</span>
        <span class="nc">font/opentype</span>
        <span class="nc">font/otf</span>
        <span class="nc">font/truetype</span>
        <span class="nc">image/svg</span><span class="s">+xml</span>
        <span class="nc">image/vnd</span><span class="s">.microsoft.icon</span>
        <span class="nc">image/x-icon</span>
        <span class="nc">image/x-win-bitmap</span>
        <span class="nc">text/css</span>
        <span class="nc">text/javascript</span>
        <span class="nc">text/plain</span>
        <span class="nc">text/xml</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="이미지-최적화">이미지 최적화</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">cdn.example.com</span><span class="p">;</span>
    <span class="kn">root</span> <span class="n">/var/www/images</span><span class="p">;</span>
    
    <span class="c1"># 이미지 변환 (ImageFilter 모듈)</span>
    <span class="kn">location</span> <span class="p">~</span> <span class="sr">^/resize/(\d+)x(\d+)/(.*)</span> <span class="p">{</span>
        <span class="kn">set</span> <span class="nv">$width</span> <span class="nv">$1</span><span class="p">;</span>
        <span class="kn">set</span> <span class="nv">$height</span> <span class="nv">$2</span><span class="p">;</span>
        <span class="kn">set</span> <span class="nv">$image_path</span> <span class="nv">$3</span><span class="p">;</span>
        
        <span class="kn">image_filter</span> <span class="s">resize</span> <span class="nv">$width</span> <span class="nv">$height</span><span class="p">;</span>
        <span class="kn">image_filter_jpeg_quality</span> <span class="mi">85</span><span class="p">;</span>
        <span class="kn">image_filter_webp_quality</span> <span class="mi">85</span><span class="p">;</span>
        <span class="kn">image_filter_buffer</span> <span class="mi">5M</span><span class="p">;</span>
        
        <span class="kn">try_files</span> <span class="n">/</span><span class="nv">$image_path</span> <span class="p">=</span><span class="mi">404</span><span class="p">;</span>
        
        <span class="kn">expires</span> <span class="s">1y</span><span class="p">;</span>
        <span class="kn">add_header</span> <span class="s">Cache-Control</span> <span class="s">"public,</span> <span class="s">immutable"</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1"># WebP 변환 지원</span>
    <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="err">\</span><span class="s">.(png|jpe?g)</span>$ <span class="p">{</span>
        <span class="kn">add_header</span> <span class="s">Vary</span> <span class="s">Accept</span><span class="p">;</span>
        <span class="kn">try_files</span> <span class="nv">$uri$webp_suffix</span> <span class="nv">$uri</span> <span class="p">=</span><span class="mi">404</span><span class="p">;</span>
        
        <span class="kn">expires</span> <span class="s">1y</span><span class="p">;</span>
        <span class="kn">add_header</span> <span class="s">Cache-Control</span> <span class="s">"public,</span> <span class="s">immutable"</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1"># WebP 확장자 매핑</span>
    <span class="kn">map</span> <span class="nv">$http_accept</span> <span class="nv">$webp_suffix</span> <span class="p">{</span>
        <span class="kn">default</span> <span class="s">""</span><span class="p">;</span>
        <span class="kn">"~*webp"</span> <span class="s">".webp"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="정적-파일-서빙-최적화">정적 파일 서빙 최적화</h2>

<h3 id="정적-파일-설정">정적 파일 설정</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">static.example.com</span><span class="p">;</span>
    <span class="kn">root</span> <span class="n">/var/www/static</span><span class="p">;</span>
    
    <span class="c1"># 보안 설정</span>
    <span class="kn">add_header</span> <span class="s">X-Frame-Options</span> <span class="s">"SAMEORIGIN"</span> <span class="s">always</span><span class="p">;</span>
    <span class="kn">add_header</span> <span class="s">X-Content-Type-Options</span> <span class="s">"nosniff"</span> <span class="s">always</span><span class="p">;</span>
    
    <span class="c1"># 파일 타입별 캐시 설정</span>
    <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="err">\</span><span class="s">.(jpg|jpeg|png|gif|webp|avif)</span>$ <span class="p">{</span>
        <span class="kn">expires</span> <span class="s">1y</span><span class="p">;</span>
        <span class="kn">add_header</span> <span class="s">Cache-Control</span> <span class="s">"public,</span> <span class="s">immutable"</span><span class="p">;</span>
        <span class="kn">add_header</span> <span class="s">Vary</span> <span class="s">Accept-Encoding</span><span class="p">;</span>
        
        <span class="c1"># 조건부 요청 처리</span>
        <span class="kn">if_modified_since</span> <span class="s">exact</span><span class="p">;</span>
        <span class="kn">etag</span> <span class="no">on</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="err">\</span><span class="s">.(css|js)</span>$ <span class="p">{</span>
        <span class="kn">expires</span> <span class="mi">1M</span><span class="p">;</span>
        <span class="kn">add_header</span> <span class="s">Cache-Control</span> <span class="s">"public"</span><span class="p">;</span>
        
        <span class="c1"># 소스맵 처리</span>
        <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="err">\</span><span class="s">.map</span>$ <span class="p">{</span>
            <span class="kn">expires</span> <span class="s">1d</span><span class="p">;</span>
            <span class="kn">add_header</span> <span class="s">Cache-Control</span> <span class="s">"public,</span> <span class="s">no-transform"</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="err">\</span><span class="s">.(woff2?|eot|ttf|otf)</span>$ <span class="p">{</span>
        <span class="kn">expires</span> <span class="s">1y</span><span class="p">;</span>
        <span class="kn">add_header</span> <span class="s">Cache-Control</span> <span class="s">"public,</span> <span class="s">immutable"</span><span class="p">;</span>
        <span class="kn">add_header</span> <span class="s">Access-Control-Allow-Origin</span> <span class="s">"*"</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="err">\</span><span class="s">.(pdf|doc|docx|zip|tar</span><span class="err">\</span><span class="s">.gz)</span>$ <span class="p">{</span>
        <span class="kn">expires</span> <span class="s">1w</span><span class="p">;</span>
        <span class="kn">add_header</span> <span class="s">Cache-Control</span> <span class="s">"public,</span> <span class="s">no-transform"</span><span class="p">;</span>
        <span class="kn">add_header</span> <span class="s">Content-Disposition</span> <span class="s">"attachment"</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1"># 대용량 파일 스트리밍</span>
    <span class="kn">location</span> <span class="n">/downloads/</span> <span class="p">{</span>
        <span class="kn">sendfile</span> <span class="no">on</span><span class="p">;</span>
        <span class="kn">tcp_nopush</span> <span class="no">on</span><span class="p">;</span>
        <span class="kn">tcp_nodelay</span> <span class="no">on</span><span class="p">;</span>
        
        <span class="c1"># 대역폭 제한</span>
        <span class="kn">limit_rate</span> <span class="mi">1m</span><span class="p">;</span>
        
        <span class="c1"># 범위 요청 지원</span>
        <span class="kn">add_header</span> <span class="s">Accept-Ranges</span> <span class="s">bytes</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="cdn-통합">CDN 통합</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># CDN 오리진 서버 설정</span>
<span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">origin.example.com</span><span class="p">;</span>
    
    <span class="c1"># CDN 전용 헤더</span>
    <span class="kn">add_header</span> <span class="s">X-Origin-Server</span> <span class="nv">$hostname</span><span class="p">;</span>
    <span class="kn">add_header</span> <span class="s">Cache-Control</span> <span class="s">"public,</span> <span class="s">max-age=31536000"</span><span class="p">;</span>
    
    <span class="c1"># 캐시 검증 헤더</span>
    <span class="kn">etag</span> <span class="no">on</span><span class="p">;</span>
    <span class="kn">if_modified_since</span> <span class="s">exact</span><span class="p">;</span>
    
    <span class="kn">location</span> <span class="n">/assets/</span> <span class="p">{</span>
        <span class="kn">root</span> <span class="n">/var/www</span><span class="p">;</span>
        
        <span class="c1"># CDN 캐시 제어</span>
        <span class="kn">expires</span> <span class="s">1y</span><span class="p">;</span>
        <span class="kn">add_header</span> <span class="s">Cache-Control</span> <span class="s">"public,</span> <span class="s">immutable"</span><span class="p">;</span>
        
        <span class="c1"># 압축 활성화</span>
        <span class="kn">gzip_static</span> <span class="no">on</span><span class="p">;</span>
        
        <span class="c1"># CORS 헤더</span>
        <span class="kn">add_header</span> <span class="s">Access-Control-Allow-Origin</span> <span class="s">"*"</span><span class="p">;</span>
        <span class="kn">add_header</span> <span class="s">Access-Control-Allow-Methods</span> <span class="s">"GET,</span> <span class="s">HEAD,</span> <span class="s">OPTIONS"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="리다이렉션과-url-재작성">리다이렉션과 URL 재작성</h2>

<h3 id="url-리라이팅">URL 리라이팅</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">example.com</span><span class="p">;</span>
    
    <span class="c1"># 기본 리라이팅 규칙</span>
    <span class="kn">location</span> <span class="n">/</span> <span class="p">{</span>
        <span class="c1"># SEO 친화적 URL</span>
        <span class="kn">rewrite</span> <span class="s">^/product/([0-9]+)/?</span>$ <span class="n">/product.php?id=</span><span class="nv">$1</span> <span class="s">last</span><span class="p">;</span>
        <span class="kn">rewrite</span> <span class="s">^/category/([a-zA-Z0-9-]+)/?</span>$ <span class="n">/category.php?slug=</span><span class="nv">$1</span> <span class="s">last</span><span class="p">;</span>
        
        <span class="c1"># API 버전 라우팅</span>
        <span class="kn">rewrite</span> <span class="s">^/api/v1/(.*)</span>$ <span class="n">/api/v1.php/</span><span class="nv">$1</span> <span class="s">last</span><span class="p">;</span>
        <span class="kn">rewrite</span> <span class="s">^/api/v2/(.*)</span>$ <span class="n">/api/v2.php/</span><span class="nv">$1</span> <span class="s">last</span><span class="p">;</span>
        
        <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri</span><span class="n">/</span> <span class="s">@fallback</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1"># 조건부 리다이렉트</span>
    <span class="kn">if</span> <span class="s">(</span><span class="nv">$host</span> <span class="s">!=</span> <span class="s">'www.example.com')</span> <span class="p">{</span>
        <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://www.example.com</span><span class="nv">$request_uri</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1"># 레거시 URL 처리</span>
    <span class="kn">location</span> <span class="n">/old-blog</span> <span class="p">{</span>
        <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://blog.example.com</span><span class="nv">$request_uri</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1"># 모바일 리다이렉트</span>
    <span class="kn">if</span> <span class="s">(</span><span class="nv">$http_user_agent</span> <span class="p">~</span><span class="sr">*</span> <span class="s">"(Mobile|Android|iPhone)")</span> <span class="p">{</span>
        <span class="kn">return</span> <span class="mi">302</span> <span class="s">https://m.example.com</span><span class="nv">$request_uri</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1"># 폴백 처리</span>
    <span class="kn">location</span> <span class="s">@fallback</span> <span class="p">{</span>
        <span class="kn">proxy_pass</span> <span class="s">http://backend</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="정규식-기반-라우팅">정규식 기반 라우팅</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 복잡한 URL 패턴</span>
<span class="k">location</span> <span class="p">~</span> <span class="sr">^/user/([0-9]+)/posts/([0-9]+)/?$</span> <span class="p">{</span>
    <span class="kn">set</span> <span class="nv">$user_id</span> <span class="nv">$1</span><span class="p">;</span>
    <span class="kn">set</span> <span class="nv">$post_id</span> <span class="nv">$2</span><span class="p">;</span>
    
    <span class="kn">proxy_pass</span> <span class="s">http://backend/api/users/</span><span class="nv">$user_id</span><span class="n">/posts/</span><span class="nv">$post_id</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">X-User-ID</span> <span class="nv">$user_id</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">X-Post-ID</span> <span class="nv">$post_id</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># 다국어 지원</span>
<span class="k">location</span> <span class="p">~</span> <span class="sr">^/([a-z]</span><span class="p">{</span><span class="kn">2</span><span class="err">}</span><span class="s">)/(.*)</span>$ <span class="p">{</span>
    <span class="kn">set</span> <span class="nv">$lang</span> <span class="nv">$1</span><span class="p">;</span>
    <span class="kn">set</span> <span class="nv">$path</span> <span class="nv">$2</span><span class="p">;</span>
    
    <span class="kn">proxy_pass</span> <span class="s">http://backend/</span><span class="nv">$path</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">Accept-Language</span> <span class="nv">$lang</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">X-Language</span> <span class="nv">$lang</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="성능-튜닝">성능 튜닝</h2>

<h3 id="워커-프로세스-최적화">워커 프로세스 최적화</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># nginx.conf</span>
<span class="k">user</span> <span class="s">www-data</span><span class="p">;</span>
<span class="k">worker_processes</span> <span class="s">auto</span><span class="p">;</span>  <span class="c1"># CPU 코어 수에 맞게 자동 설정</span>
<span class="k">worker_cpu_affinity</span> <span class="s">auto</span><span class="p">;</span>
<span class="k">worker_rlimit_nofile</span> <span class="mi">65535</span><span class="p">;</span>

<span class="k">events</span> <span class="p">{</span>
    <span class="kn">worker_connections</span> <span class="mi">8192</span><span class="p">;</span>
    <span class="kn">use</span> <span class="s">epoll</span><span class="p">;</span>  <span class="c1"># Linux에서 최적</span>
    <span class="kn">multi_accept</span> <span class="no">on</span><span class="p">;</span>
    <span class="kn">accept_mutex</span> <span class="no">off</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">http</span> <span class="p">{</span>
    <span class="c1"># 연결 최적화</span>
    <span class="kn">sendfile</span> <span class="no">on</span><span class="p">;</span>
    <span class="kn">tcp_nopush</span> <span class="no">on</span><span class="p">;</span>
    <span class="kn">tcp_nodelay</span> <span class="no">on</span><span class="p">;</span>
    
    <span class="c1"># 타임아웃 최적화</span>
    <span class="kn">keepalive_timeout</span> <span class="mi">65</span><span class="p">;</span>
    <span class="kn">keepalive_requests</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="kn">client_header_timeout</span> <span class="mi">60</span><span class="p">;</span>
    <span class="kn">client_body_timeout</span> <span class="mi">60</span><span class="p">;</span>
    <span class="kn">send_timeout</span> <span class="mi">60</span><span class="p">;</span>
    
    <span class="c1"># 버퍼 최적화</span>
    <span class="kn">client_header_buffer_size</span> <span class="mi">4k</span><span class="p">;</span>
    <span class="kn">large_client_header_buffers</span> <span class="mi">4</span> <span class="mi">8k</span><span class="p">;</span>
    <span class="kn">client_body_buffer_size</span> <span class="mi">128k</span><span class="p">;</span>
    <span class="kn">client_max_body_size</span> <span class="mi">100m</span><span class="p">;</span>
    
    <span class="c1"># 해시 테이블 최적화</span>
    <span class="kn">server_names_hash_bucket_size</span> <span class="mi">128</span><span class="p">;</span>
    <span class="kn">server_names_hash_max_size</span> <span class="mi">2048</span><span class="p">;</span>
    <span class="kn">types_hash_max_size</span> <span class="mi">2048</span><span class="p">;</span>
    <span class="kn">variables_hash_max_size</span> <span class="mi">2048</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="메모리-최적화">메모리 최적화</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 프록시 버퍼 최적화</span>
<span class="k">proxy_buffering</span> <span class="no">on</span><span class="p">;</span>
<span class="k">proxy_buffer_size</span> <span class="mi">128k</span><span class="p">;</span>
<span class="k">proxy_buffers</span> <span class="mi">4</span> <span class="mi">256k</span><span class="p">;</span>
<span class="k">proxy_busy_buffers_size</span> <span class="mi">256k</span><span class="p">;</span>
<span class="k">proxy_temp_file_write_size</span> <span class="mi">256k</span><span class="p">;</span>
<span class="k">proxy_max_temp_file_size</span> <span class="mi">1024m</span><span class="p">;</span>

<span class="c1"># FastCGI 버퍼 최적화</span>
<span class="k">fastcgi_buffering</span> <span class="no">on</span><span class="p">;</span>
<span class="k">fastcgi_buffer_size</span> <span class="mi">128k</span><span class="p">;</span>
<span class="k">fastcgi_buffers</span> <span class="mi">4</span> <span class="mi">256k</span><span class="p">;</span>
<span class="k">fastcgi_busy_buffers_size</span> <span class="mi">256k</span><span class="p">;</span>

<span class="c1"># 캐시 최적화</span>
<span class="k">proxy_cache_path</span> <span class="n">/var/cache/nginx/proxy</span> 
                 <span class="s">levels=1:2</span> 
                 <span class="s">keys_zone=cache:100m</span> 
                 <span class="s">max_size=10g</span> 
                 <span class="s">inactive=60m</span> 
                 <span class="s">use_temp_path=off</span> 
                 <span class="s">loader_threshold=300</span> 
                 <span class="s">loader_files=200</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="모니터링-설정">모니터링 설정</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 상태 페이지</span>
<span class="k">location</span> <span class="n">/nginx_status</span> <span class="p">{</span>
    <span class="kn">stub_status</span> <span class="no">on</span><span class="p">;</span>
    <span class="kn">allow</span> <span class="mf">127.0</span><span class="s">.0.1</span><span class="p">;</span>
    <span class="kn">allow</span> <span class="mf">192.168</span><span class="s">.1.0/24</span><span class="p">;</span>
    <span class="kn">deny</span> <span class="s">all</span><span class="p">;</span>
    
    <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># 실시간 액세스 로그</span>
<span class="k">location</span> <span class="n">/access_log</span> <span class="p">{</span>
    <span class="kn">allow</span> <span class="mf">127.0</span><span class="s">.0.1</span><span class="p">;</span>
    <span class="kn">deny</span> <span class="s">all</span><span class="p">;</span>
    
    <span class="kn">content_by_lua_block</span> <span class="p">{</span>
        <span class="kn">local</span> <span class="s">file</span> <span class="p">=</span> <span class="s">io.open("/var/log/nginx/access.log",</span> <span class="s">"r")</span>
        <span class="s">if</span> <span class="s">file</span> <span class="s">then</span>
            <span class="s">file:seek("end",</span> <span class="s">-1024)</span>
            <span class="s">local</span> <span class="s">content</span> <span class="p">=</span> <span class="s">file:read("*a")</span>
            <span class="s">file:close()</span>
            <span class="s">ngx.say(content)</span>
        <span class="s">end</span>
    <span class="err">}</span>
<span class="err">}</span>
</code></pre></div></div>

<h2 id="실습-예제">실습 예제</h2>

<h3 id="고성능-정적-파일-서버">고성능 정적 파일 서버</h3>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># /etc/nginx/sites-available/static-server</span>
<span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">static.example.com</span><span class="p">;</span>
    <span class="kn">root</span> <span class="n">/var/www/static</span><span class="p">;</span>
    
    <span class="c1"># 로그 최소화</span>
    <span class="kn">access_log</span> <span class="n">/var/log/nginx/static.log</span> <span class="s">main</span> <span class="s">buffer=32k</span> <span class="s">flush=5m</span><span class="p">;</span>
    <span class="kn">error_log</span> <span class="n">/var/log/nginx/static.error.log</span> <span class="s">warn</span><span class="p">;</span>
    
    <span class="c1"># 보안 헤더</span>
    <span class="kn">add_header</span> <span class="s">X-Frame-Options</span> <span class="s">"SAMEORIGIN"</span> <span class="s">always</span><span class="p">;</span>
    <span class="kn">add_header</span> <span class="s">X-Content-Type-Options</span> <span class="s">"nosniff"</span> <span class="s">always</span><span class="p">;</span>
    
    <span class="c1"># 메인 정적 파일</span>
    <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="err">\</span><span class="s">.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)</span>$ <span class="p">{</span>
        <span class="kn">expires</span> <span class="s">1y</span><span class="p">;</span>
        <span class="kn">add_header</span> <span class="s">Cache-Control</span> <span class="s">"public,</span> <span class="s">immutable"</span><span class="p">;</span>
        <span class="kn">add_header</span> <span class="s">Vary</span> <span class="s">Accept-Encoding</span><span class="p">;</span>
        
        <span class="c1"># 압축 최적화</span>
        <span class="kn">gzip_static</span> <span class="no">on</span><span class="p">;</span>
        <span class="kn">brotli_static</span> <span class="no">on</span><span class="p">;</span>
        
        <span class="c1"># 성능 최적화</span>
        <span class="kn">sendfile</span> <span class="no">on</span><span class="p">;</span>
        <span class="kn">tcp_nopush</span> <span class="no">on</span><span class="p">;</span>
        <span class="kn">tcp_nodelay</span> <span class="no">on</span><span class="p">;</span>
        
        <span class="c1"># 조건부 요청</span>
        <span class="kn">if_modified_since</span> <span class="s">exact</span><span class="p">;</span>
        <span class="kn">etag</span> <span class="no">on</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1"># API 프록시</span>
    <span class="kn">location</span> <span class="n">/api/</span> <span class="p">{</span>
        <span class="kn">proxy_pass</span> <span class="s">http://api_backend/</span><span class="p">;</span>
        
        <span class="c1"># 캐시 설정</span>
        <span class="kn">proxy_cache</span> <span class="s">api_cache</span><span class="p">;</span>
        <span class="kn">proxy_cache_valid</span> <span class="mi">200</span> <span class="mi">5m</span><span class="p">;</span>
        <span class="kn">proxy_cache_valid</span> <span class="mi">404</span> <span class="mi">1m</span><span class="p">;</span>
        
        <span class="c1"># 성능 최적화</span>
        <span class="kn">proxy_buffering</span> <span class="no">on</span><span class="p">;</span>
        <span class="kn">proxy_http_version</span> <span class="mf">1.1</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">""</span><span class="p">;</span>
        
        <span class="kn">add_header</span> <span class="s">X-Cache-Status</span> <span class="nv">$upstream_cache_status</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="다음-단계">다음 단계</h2>

<p>다음 포스트에서는 Nginx 운영 관리에 대해 다루겠습니다:</p>

<ul>
  <li>프로세스 관리 및 모니터링</li>
  <li>로그 관리 및 분석</li>
  <li>백업 및 복구 전략</li>
  <li>성능 튜닝 가이드</li>
</ul>

<h2 id="참고-자료">참고 자료</h2>

<ul>
  <li><a href="https://www.nginx.com/blog/tuning-nginx/">Nginx Performance Tuning</a></li>
  <li><a href="https://www.nginx.com/blog/nginx-caching-guide/">Nginx Caching Guide</a></li>
  <li><a href="https://www.nginx.com/blog/nginx-1-13-9-http2-server-push/">HTTP/2 Server Push</a></li>
</ul>

  </div>

  <footer class="post-footer">
    <div class="post-navigation"><div class="nav-previous">
        <a href="/infra-blog/blog/2024/05/16/nginx-configuration-guide-part2.html" rel="prev">
          <i class="icon-left-arrow"></i>
          <span class="nav-title">Nginx 설정 가이드 Part 2 - Virtual Host, 로드 밸런싱, SSL...</span>
        </a>
      </div><div class="nav-next">
        <a href="/infra-blog/blog/2024/06/10/nginx-operations-guide-part1.html" rel="next">
          <span class="nav-title">Nginx 운영 가이드 Part 1 - 프로세스 관리, 서비스 제어, 로그 관리</span>
          <i class="icon-right-arrow"></i>
        </a>
      </div></div>
  </footer>
  </article></div>

    </section>
    <footer class="condensed">
      <ul class="social about-footer condensed"><a href="https://github.com/leeyonghe" target="_blank">
          <li>
            <i class="icon-github-circled"></i>
          </li>
        </a><a href="https://www.linkedin.com/in/lee-yong-hee-18912454/" target="_blank">
          <li>
            <i class="icon-linkedin-squared"></i>
          </li>
        </a><!----></ul><p class="about-footer condensed">&copy;
        2025</p><div class="about-footer condensed">
        <p>Dark Mode
          <i class="icon-moon"></i>
          <label class="switch">
            <input type="checkbox" class="dark-mode-toggle">
            <span class="slider round" onclick="toggleDarkMode()"></span>
          </label>
        </p>
      </div>
    </footer>
  </main>
  
  <script type="text/javascript" src="/infra-blog/assets/js/darkmode.js"></script>
  
  <script src="/infra-blog/assets/js/simple-jekyll-search.min.js"></script>
  <script src="/infra-blog/assets/js/search.js"></script>
  
</body>

</html>
