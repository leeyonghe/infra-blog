<!DOCTYPE html>
<html lang="en">

<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="stylesheet" href="/infra-blog/assets/css/style.css">
<link rel="stylesheet" href="/infra-blog/assets/css/post-detail.css">
<style>
/* Post Detail Page Styling */
.post-container article {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  padding: 40px;
  margin: 30px auto;
  max-width: 800px;
}

@media screen and (max-width: 768px) {
  .post-container article {
    margin: 20px;
    padding: 25px;
    border-radius: 8px;
  }
}

.post-container article .post-header {
  border-bottom: 2px solid #f5f5f5;
  padding-bottom: 25px;
  margin-bottom: 30px;
}

.post-container article .post-header .post-title {
  font-size: 2.2em;
  font-weight: 700;
  color: #2c3e50;
  line-height: 1.3;
  margin-bottom: 15px;
}

@media screen and (max-width: 768px) {
  .post-container article .post-header .post-title {
    font-size: 1.8em;
  }
}

.post-container article .post-header .post-meta {
  display: flex;
  align-items: center;
  gap: 20px;
  flex-wrap: wrap;
}

.post-container article .post-header .post-meta .post-date {
  display: flex;
  align-items: center;
  color: #666;
  font-size: 0.9em;
}

.post-container article .post-header .post-meta .post-date i {
  margin-right: 8px;
  color: #888;
}

.post-container article .post-header .post-meta .post-categories-wrapper {
  display: flex;
  align-items: center;
}

.post-container article .post-header .post-meta .post-categories-wrapper i {
  margin-right: 8px;
  color: #888;
}

.post-container article .post-header .post-meta .post-categories-wrapper .post-categories {
  display: flex;
  gap: 8px;
  list-style: none;
  margin: 0;
  padding: 0;
}

.post-container article .post-header .post-meta .post-categories-wrapper .post-categories li {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.8em;
  font-weight: 500;
  text-transform: capitalize;
}

.post-container article .post-content {
  font-size: 1.1em;
  line-height: 1.8;
  color: #333;
}

.post-container article .post-content p {
  margin-bottom: 1.2em;
}

.post-container article .post-content h1,
.post-container article .post-content h2,
.post-container article .post-content h3,
.post-container article .post-content h4,
.post-container article .post-content h5,
.post-container article .post-content h6 {
  color: #2c3e50;
  margin: 1.5em 0 0.8em 0;
  font-weight: 600;
}

.post-container article .post-content h2 {
  font-size: 1.8em;
  border-bottom: 2px solid #3498db;
  padding-bottom: 10px;
}

.post-container article .post-content h3 {
  font-size: 1.5em;
  color: #34495e;
}

.post-container article .post-content code {
  background: #f8f9fa;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 0.9em;
  color: #e74c3c;
}

.post-container article .post-content pre {
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 6px;
  padding: 15px;
  overflow-x: auto;
  margin: 1.5em 0;
}

.post-container article .post-content pre code {
  background: none;
  color: #333;
  padding: 0;
}

.post-container article .post-content blockquote {
  border-left: 4px solid #3498db;
  background: #f8f9fa;
  padding: 15px 20px;
  margin: 1.5em 0;
  font-style: italic;
  color: #555;
}

.post-container article .post-content img {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
  margin: 1.5em 0;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.post-container article .post-content ul,
.post-container article .post-content ol {
  padding-left: 1.5em;
  margin-bottom: 1.2em;
}

.post-container article .post-content ul li,
.post-container article .post-content ol li {
  margin-bottom: 0.5em;
}

.post-container article .post-content a {
  color: #3498db;
  text-decoration: none;
  border-bottom: 1px solid transparent;
  transition: all 0.3s ease;
}

.post-container article .post-content a:hover {
  border-bottom-color: #3498db;
}

.post-container article .post-footer {
  border-top: 2px solid #f5f5f5;
  padding-top: 25px;
  margin-top: 40px;
}

.post-container article .post-footer .post-navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 20px;
}

@media screen and (max-width: 768px) {
  .post-container article .post-footer .post-navigation {
    flex-direction: column;
    gap: 15px;
  }
}

.post-container article .post-footer .post-navigation .nav-previous,
.post-container article .post-footer .post-navigation .nav-next {
  flex: 1;
}

.post-container article .post-footer .post-navigation .nav-previous a,
.post-container article .post-footer .post-navigation .nav-next a {
  display: flex;
  align-items: center;
  padding: 15px 20px;
  background: #f8f9fa;
  border-radius: 8px;
  text-decoration: none;
  color: #333;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.post-container article .post-footer .post-navigation .nav-previous a:hover,
.post-container article .post-footer .post-navigation .nav-next a:hover {
  background: #e9ecef;
  border-color: #3498db;
  transform: translateY(-2px);
}

.post-container article .post-footer .post-navigation .nav-previous a i,
.post-container article .post-footer .post-navigation .nav-next a i {
  color: #3498db;
  margin: 0 8px;
}

.post-container article .post-footer .post-navigation .nav-previous a .nav-title,
.post-container article .post-footer .post-navigation .nav-next a .nav-title {
  font-weight: 500;
}

.post-container article .post-footer .post-navigation .nav-previous a {
  justify-content: flex-start;
}

.post-container article .post-footer .post-navigation .nav-next a {
  justify-content: flex-end;
  text-align: right;
}
</style>
<title>ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ 1í¸ - ê¸°ì´ˆ ë³´ì•ˆ ì„¤ì • | Linux Security Guide Part 1 - Basic Security Configuration</title>

<script type="text/javascript" src="/infra-blog/assets/js/darkmode.js"></script>

</head><body>
  <main class="container">
    <section class="about">
      <div class="about-header condensed">
      <div class="about-title">
      <a href="/infra-blog/">
        
        <img src="/infra-blog/assets/portfolio.png" alt="Infrastructure Engineer" />
        
      </a>
      <h2 id="title">
        <a href="/infra-blog/">Infrastructure Engineer</a>
      </h2>
      </div><p class="tagline">DevOps & Cloud Infrastructure Specialist</p></div>
      
      <ul class="social about-footer condensed"><a href="https://github.com/leeyonghe" target="_blank">
          <li>
            <i class="icon-github-circled"></i>
          </li>
        </a><a href="https://www.linkedin.com/in/lee-yong-hee-18912454/" target="_blank">
          <li>
            <i class="icon-linkedin-squared"></i>
          </li>
        </a><!----></ul><p class="about-footer condensed">&copy;
        2025</p><div class="about-footer condensed">
        <p>Dark Mode
          <i class="icon-moon"></i>
          <label class="switch">
            <input type="checkbox" class="dark-mode-toggle">
            <span class="slider round" onclick="toggleDarkMode()"></span>
          </label>
        </p>
      </div>
    </section>
    <section class="content">
      <style>
/* Post Detail Page Styling - Direct Inline */
.post-container article {
  background: #fff !important;
  border: none !important;
  border-top: none !important;
  border-right: none !important;
  border-bottom: none !important;
  border-left: none !important;
  border-width: 0 !important;
  border-style: none !important;
  outline: none !important;
  border-radius: 12px !important;
  box-shadow: none !important;
  padding: 40px !important;
  margin: 30px auto !important;
  max-width: 800px !important;
}

.post-container article .post-header .post-title {
  font-size: 2.2em !important;
  font-weight: 700 !important;
  color: #2c3e50 !important;
  line-height: 1.3 !important;
}

.post-container article .post-header {
  border-bottom: none !important;
  padding-bottom: 25px !important;
  margin-bottom: 30px !important;
}

.post-container article .post-content {
  font-size: 1.1em !important;
  line-height: 1.8 !important;
  color: #333 !important;
}

.post-container article .post-content h2 {
  font-size: 1.8em !important;
  border-bottom: none !important;
  padding-bottom: 10px !important;
  color: #2c3e50 !important;
}

.post-container article .post-header .post-meta .post-categories li {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
  color: white !important;
  padding: 4px 12px !important;
  border-radius: 20px !important;
  font-size: 0.8em !important;
  list-style: none !important;
  display: inline-block !important;
  margin-right: 8px !important;
}

.post-container article .post-footer {
  border-top: none !important;
  padding-top: 25px !important;
  margin-top: 40px !important;
}

/* ëª¨ë“  borderì™€ box-shadow ê°•ì œ ì œê±° */
.post-container article *,
.post-container article *::before,
.post-container article *::after {
  border: none !important;
  border-top: none !important;
  border-right: none !important;
  border-bottom: none !important;
  border-left: none !important;
  border-width: 0 !important;
  border-style: none !important;
  outline: none !important;
  box-shadow: none !important;
}

/* ì½”ë“œ ë¸”ë¡ê³¼ pre íƒœê·¸ë„ border, box-shadow ì œê±° */
.post-container article pre,
.post-container article code,
.post-container article .highlight,
.post-container article .highlighter-rouge {
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
}
</style><div class="post-container">
  <article>
    <header class="post-header">
    <h1 class="post-title">ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ 1í¸ - ê¸°ì´ˆ ë³´ì•ˆ ì„¤ì • | Linux Security Guide Part 1 - Basic Security Configuration</h1>
    <div class="post-meta">
      <div class="post-date">
        <i class="icon-calendar"></i>
        <time datetime="2024-10-26T00:00:00+00:00">Oct 26, 2024</time>
      </div><div class="post-categories-wrapper">
        <i class="icon-tag"></i>
        <ul class="post-categories"><li>Security</li><li>Linux</li></ul>
      </div></div>
  </header>

  <div class="post-content">
    <p>ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œ ë³´ì•ˆì˜ ì²« ë²ˆì§¸ ë‹¨ê³„ì¸ ê¸°ì´ˆ ë³´ì•ˆ ì„¤ì •ì„ ì™„ë²½í•˜ê²Œ ë§ˆìŠ¤í„°í•´ë³´ê² ìŠµë‹ˆë‹¤. ì‚¬ìš©ì ê³„ì • ê´€ë¦¬ë¶€í„° SSH ë³´ì•ˆ ê°•í™”ê¹Œì§€ ì‹¤ë¬´ì—ì„œ ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ë‚´ìš©ìœ¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.</p>

<h2 id="ì‚¬ìš©ì-ê³„ì •-ë³´ì•ˆ-ê°•í™”--user-account-security">ì‚¬ìš©ì ê³„ì • ë³´ì•ˆ ê°•í™” | User Account Security</h2>

<h3 id="-ì‚¬ìš©ì-ê³„ì •-ê´€ë¦¬-ê¸°ì´ˆ">ğŸ‘¤ ì‚¬ìš©ì ê³„ì • ê´€ë¦¬ ê¸°ì´ˆ</h3>

<h4 id="ì•ˆì „í•œ-ì‚¬ìš©ì-ìƒì„±-ë°-ê´€ë¦¬">ì•ˆì „í•œ ì‚¬ìš©ì ìƒì„± ë° ê´€ë¦¬</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë³´ì•ˆì„ ê³ ë ¤í•œ ì‚¬ìš©ì ìƒì„±</span>
<span class="c"># ì‹œìŠ¤í…œ ì‚¬ìš©ì (ì„œë¹„ìŠ¤ìš©)</span>
useradd <span class="nt">-r</span> <span class="nt">-s</span> /usr/sbin/nologin <span class="nt">-d</span> /var/lib/myservice <span class="nt">-c</span> <span class="s2">"MyService System User"</span> myservice

<span class="c"># ì¼ë°˜ ì‚¬ìš©ì ìƒì„± (í™ˆ ë””ë ‰í† ë¦¬ ê¶Œí•œ ê°•í™”)</span>
useradd <span class="nt">-m</span> <span class="nt">-s</span> /bin/bash <span class="nt">-c</span> <span class="s2">"John Doe"</span> <span class="nt">-G</span> <span class="nb">users </span>john
<span class="nb">chmod </span>750 /home/john
<span class="nb">chown </span>john:john /home/john

<span class="c"># ì‚¬ìš©ì ì •ë³´ í™•ì¸</span>
<span class="nb">id </span>john
<span class="nb">groups </span>john
finger john
last john

<span class="c"># ì‚¬ìš©ì ê³„ì • ì ê¸ˆ/í•´ì œ</span>
usermod <span class="nt">-L</span> john    <span class="c"># ê³„ì • ì ê¸ˆ</span>
usermod <span class="nt">-U</span> john    <span class="c"># ê³„ì • í•´ì œ</span>
passwd <span class="nt">-l</span> john     <span class="c"># íŒ¨ìŠ¤ì›Œë“œ ì ê¸ˆ</span>
passwd <span class="nt">-u</span> john     <span class="c"># íŒ¨ìŠ¤ì›Œë“œ í•´ì œ</span>

<span class="c"># ê³„ì • ë§Œë£Œ ì„¤ì •</span>
usermod <span class="nt">-e</span> 2024-12-31 john    <span class="c"># ê³„ì • ë§Œë£Œì¼ ì„¤ì •</span>
chage <span class="nt">-E</span> 2024-12-31 john      <span class="c"># ë™ì¼í•œ ê¸°ëŠ¥</span>

<span class="c"># ë¹„í™œì„± ì‚¬ìš©ì ê³„ì • ì°¾ê¸°</span>
lastlog | <span class="nb">awk</span> <span class="s1">'$2 == "Never" || $2 &lt; "'</span><span class="si">$(</span><span class="nb">date</span> <span class="nt">-d</span> <span class="s1">'90 days ago'</span> <span class="s1">'+%Y-%m-%d'</span><span class="si">)</span><span class="s1">'" {print $1}'</span>

<span class="c"># ë¶ˆí•„ìš”í•œ ê³„ì • ì œê±°</span>
userdel <span class="nt">-r</span> olduser    <span class="c"># í™ˆ ë””ë ‰í† ë¦¬ë„ í•¨ê»˜ ì‚­ì œ</span>
</code></pre></div></div>

<h4 id="ê°•ë ¥í•œ-íŒ¨ìŠ¤ì›Œë“œ-ì •ì±…-êµ¬í˜„">ê°•ë ¥í•œ íŒ¨ìŠ¤ì›Œë“œ ì •ì±… êµ¬í˜„</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># PAM ê¸°ë°˜ íŒ¨ìŠ¤ì›Œë“œ ë³µì¡ì„± ì„¤ì •</span>
<span class="c"># /etc/pam.d/common-password (Ubuntu/Debian)</span>
password requisite pam_pwquality.so <span class="nv">retry</span><span class="o">=</span>3 <span class="nv">minlen</span><span class="o">=</span>14 <span class="nv">minclass</span><span class="o">=</span>4 <span class="nv">maxrepeat</span><span class="o">=</span>2 <span class="nv">ucredit</span><span class="o">=</span><span class="nt">-2</span> <span class="nv">lcredit</span><span class="o">=</span><span class="nt">-2</span> <span class="nv">dcredit</span><span class="o">=</span><span class="nt">-2</span> <span class="nv">ocredit</span><span class="o">=</span><span class="nt">-2</span> <span class="nv">difok</span><span class="o">=</span>4 <span class="nv">gecoscheck</span><span class="o">=</span>1 <span class="nv">dictcheck</span><span class="o">=</span>1

<span class="c"># /etc/security/pwquality.conf ìƒì„¸ ì„¤ì •</span>
<span class="c"># íŒ¨ìŠ¤ì›Œë“œ ê¸¸ì´ ë° ë³µì¡ì„±</span>
minlen <span class="o">=</span> 14              <span class="c"># ìµœì†Œ 14ì</span>
minclass <span class="o">=</span> 4             <span class="c"># 4ê°œ ë¬¸ì í´ë˜ìŠ¤ ëª¨ë‘ í¬í•¨</span>
maxrepeat <span class="o">=</span> 2            <span class="c"># ì—°ì† ë™ì¼ ë¬¸ì 2ê°œ ì´í•˜</span>
maxclasssrepeat <span class="o">=</span> 3      <span class="c"># ë™ì¼ í´ë˜ìŠ¤ ì—°ì† 3ê°œ ì´í•˜</span>

<span class="c"># ë¬¸ìë³„ ìµœì†Œ ê°œìˆ˜ (ìŒìˆ˜ëŠ” í•„ìˆ˜)</span>
ucredit <span class="o">=</span> <span class="nt">-2</span>             <span class="c"># ëŒ€ë¬¸ì ìµœì†Œ 2ê°œ</span>
lcredit <span class="o">=</span> <span class="nt">-2</span>             <span class="c"># ì†Œë¬¸ì ìµœì†Œ 2ê°œ  </span>
dcredit <span class="o">=</span> <span class="nt">-2</span>             <span class="c"># ìˆ«ì ìµœì†Œ 2ê°œ</span>
ocredit <span class="o">=</span> <span class="nt">-2</span>             <span class="c"># íŠ¹ìˆ˜ë¬¸ì ìµœì†Œ 2ê°œ</span>

<span class="c"># íŒ¨ìŠ¤ì›Œë“œ í’ˆì§ˆ ê²€ì‚¬</span>
difok <span class="o">=</span> 4                <span class="c"># ì´ì „ íŒ¨ìŠ¤ì›Œë“œì™€ ìµœì†Œ 4ê¸€ì ì°¨ì´</span>
gecoscheck <span class="o">=</span> 1           <span class="c"># GECOS í•„ë“œ(ì´ë¦„ ë“±) í¬í•¨ ê¸ˆì§€</span>
dictcheck <span class="o">=</span> 1            <span class="c"># ì‚¬ì „ ë‹¨ì–´ ì‚¬ìš© ê¸ˆì§€</span>
usercheck <span class="o">=</span> 1            <span class="c"># ì‚¬ìš©ìëª… í¬í•¨ ê¸ˆì§€</span>
enforcing <span class="o">=</span> 1            <span class="c"># ì—„ê²©í•œ ì •ì±… ì ìš©</span>

<span class="c"># ê¸ˆì§€ íŒ¨ìŠ¤ì›Œë“œ ëª©ë¡</span>
badwords <span class="o">=</span> password 123456 qwerty admin root

<span class="c"># íŒ¨ìŠ¤ì›Œë“œ ì—ì´ì§• ì •ì±… (ê³ ê¸‰)</span>
<span class="c"># /etc/login.defs</span>
PASS_MAX_DAYS   60       <span class="c"># ìµœëŒ€ 60ì¼ ìœ íš¨</span>
PASS_MIN_DAYS   7        <span class="c"># ìµœì†Œ 7ì¼ í›„ ë³€ê²½ ê°€ëŠ¥</span>
PASS_MIN_LEN    14       <span class="c"># ìµœì†Œ 14ì</span>
PASS_WARN_AGE   7        <span class="c"># ë§Œë£Œ 7ì¼ ì „ ê²½ê³ </span>
ENCRYPT_METHOD  SHA512   <span class="c"># ê°•ë ¥í•œ í•´ì‹œ ì•Œê³ ë¦¬ì¦˜</span>

<span class="c"># ê¸°ì¡´ ì‚¬ìš©ìì—ê²Œ ì •ì±… ì ìš© ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="k">for </span>user <span class="k">in</span> <span class="si">$(</span><span class="nb">cut</span> <span class="nt">-d</span>: <span class="nt">-f1</span> /etc/passwd | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"^#"</span> | <span class="nb">sort</span><span class="si">)</span><span class="p">;</span> <span class="k">do</span>
    <span class="c"># ì‹œìŠ¤í…œ ê³„ì •ì€ ì œì™¸ (UID 1000 ë¯¸ë§Œ)</span>
    <span class="nv">uid</span><span class="o">=</span><span class="si">$(</span><span class="nb">id</span> <span class="nt">-u</span> <span class="s2">"</span><span class="nv">$user</span><span class="s2">"</span> 2&gt;/dev/null<span class="si">)</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="nv">$uid</span> <span class="nt">-ge</span> 1000 <span class="o">&amp;&amp;</span> <span class="nv">$uid</span> <span class="nt">-le</span> 60000 <span class="o">]]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Applying password policy to </span><span class="nv">$user</span><span class="s2">..."</span>
        chage <span class="nt">-M</span> 60 <span class="nt">-m</span> 7 <span class="nt">-W</span> 7 <span class="s2">"</span><span class="nv">$user</span><span class="s2">"</span>
        <span class="c"># ë‹¤ìŒ ë¡œê·¸ì¸ ì‹œ íŒ¨ìŠ¤ì›Œë“œ ë³€ê²½ ê°•ì œ</span>
        chage <span class="nt">-d</span> 0 <span class="s2">"</span><span class="nv">$user</span><span class="s2">"</span>
    <span class="k">fi
done</span>
</code></pre></div></div>

<h4 id="ê³„ì •-ì ê¸ˆ-ë°-ë¸Œë£¨íŠ¸í¬ìŠ¤-ë°©ì§€">ê³„ì • ì ê¸ˆ ë° ë¸Œë£¨íŠ¸í¬ìŠ¤ ë°©ì§€</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># PAM ê¸°ë°˜ ê³„ì • ì ê¸ˆ ì„¤ì • (ìµœì‹  ë°©ì‹)</span>
<span class="c"># /etc/pam.d/common-auth</span>
auth required pam_faillock.so preauth silent audit <span class="nv">deny</span><span class="o">=</span>5 <span class="nv">unlock_time</span><span class="o">=</span>900 <span class="nv">fail_interval</span><span class="o">=</span>900
auth <span class="o">[</span><span class="nv">default</span><span class="o">=</span>die] pam_faillock.so authfail audit <span class="nv">deny</span><span class="o">=</span>5 <span class="nv">unlock_time</span><span class="o">=</span>900 <span class="nv">fail_interval</span><span class="o">=</span>900
auth sufficient pam_unix.so nullok_secure
auth <span class="o">[</span><span class="nv">default</span><span class="o">=</span>die] pam_faillock.so authsucc audit <span class="nv">deny</span><span class="o">=</span>5 <span class="nv">unlock_time</span><span class="o">=</span>900 <span class="nv">fail_interval</span><span class="o">=</span>900

<span class="c"># /etc/pam.d/common-accountì— ì¶”ê°€</span>
account required pam_faillock.so

<span class="c"># faillock ì„¤ì • íŒŒì¼</span>
<span class="c"># /etc/security/faillock.conf</span>
<span class="nb">dir</span> <span class="o">=</span> /var/run/faillock
audit
silent
deny <span class="o">=</span> 5
fail_interval <span class="o">=</span> 900      <span class="c"># 15ë¶„ ê°„ê²©</span>
unlock_time <span class="o">=</span> 1800       <span class="c"># 30ë¶„ ì ê¸ˆ</span>
even_deny_root          <span class="c"># ë£¨íŠ¸ë„ ì ê¸ˆ ì ìš©</span>
root_unlock_time <span class="o">=</span> 60    <span class="c"># ë£¨íŠ¸ëŠ” 1ë¶„ë§Œ ì ê¸ˆ</span>

<span class="c"># faillock ê´€ë¦¬ ëª…ë ¹</span>
faillock <span class="nt">--user</span> john     <span class="c"># ì‚¬ìš©ì ì‹¤íŒ¨ íšŸìˆ˜ í™•ì¸</span>
faillock <span class="nt">--user</span> john <span class="nt">--reset</span>   <span class="c"># ì‚¬ìš©ì ì ê¸ˆ í•´ì œ</span>
faillock <span class="nt">--reset</span>        <span class="c"># ëª¨ë“  ì‚¬ìš©ì ì ê¸ˆ í•´ì œ</span>

<span class="c"># ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/monitor-auth-failures.sh</span>
<span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">"/var/log/auth.log"</span>
<span class="nv">ALERT_THRESHOLD</span><span class="o">=</span>3

<span class="nb">tail</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$LOG_FILE</span><span class="s2">"</span> | <span class="k">while </span><span class="nb">read </span>line<span class="p">;</span> <span class="k">do
    if </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"authentication failure"</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">user</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-o</span> <span class="s2">"user=[^ ]*"</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="o">=</span> <span class="nt">-f2</span><span class="si">)</span>
        <span class="nv">ip</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-o</span> <span class="s2">"rhost=[^ ]*"</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="o">=</span> <span class="nt">-f2</span><span class="si">)</span>
        
        <span class="c"># ìµœê·¼ 5ë¶„ê°„ ì‹¤íŒ¨ íšŸìˆ˜ ê³„ì‚°</span>
        <span class="nv">failures</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-c</span> <span class="s2">"authentication failure.*user=</span><span class="nv">$user</span><span class="s2">.*rhost=</span><span class="nv">$ip</span><span class="s2">"</span> <span class="se">\</span>
                  &lt;<span class="o">(</span><span class="nb">tail</span> <span class="nt">-n</span> 1000 <span class="s2">"</span><span class="nv">$LOG_FILE</span><span class="s2">"</span> | <span class="se">\</span>
                    <span class="nb">awk</span> <span class="nt">-v</span> <span class="nv">since</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">date</span> <span class="nt">-d</span> <span class="s1">'5 minutes ago'</span> <span class="s1">'+%b %d %H:%M'</span><span class="si">)</span><span class="s2">"</span> <span class="se">\</span>
                    <span class="s1">'$0 &gt;= since'</span><span class="o">)</span><span class="si">)</span>
        
        <span class="k">if</span> <span class="o">[[</span> <span class="nv">$failures</span> <span class="nt">-ge</span> <span class="nv">$ALERT_THRESHOLD</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">: ALERT - Multiple auth failures for user </span><span class="nv">$user</span><span class="s2"> from </span><span class="nv">$ip</span><span class="s2"> (</span><span class="nv">$failures</span><span class="s2"> attempts)"</span>
            <span class="c"># ì•Œë¦¼ ë°œì†¡ (ì„ íƒì‚¬í•­)</span>
            <span class="c"># echo "Authentication attack detected: $user from $ip" | \</span>
            <span class="c"># mail -s "Security Alert" admin@company.com</span>
        <span class="k">fi
    fi
done</span>
</code></pre></div></div>

<h3 id="-ë£¨íŠ¸-ê³„ì •-ë³´ì•ˆ-ê°•í™”">ğŸ” ë£¨íŠ¸ ê³„ì • ë³´ì•ˆ ê°•í™”</h3>

<h4 id="ë£¨íŠ¸-ì ‘ê·¼-ì œí•œ-ë°-sudo-êµ¬ì„±">ë£¨íŠ¸ ì ‘ê·¼ ì œí•œ ë° sudo êµ¬ì„±</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë£¨íŠ¸ ì§ì ‘ ë¡œê·¸ì¸ ì™„ì „ ì°¨ë‹¨</span>
<span class="c"># /etc/ssh/sshd_config</span>
PermitRootLogin no

<span class="c"># ì½˜ì†” ë£¨íŠ¸ ë¡œê·¸ì¸ ì œí•œ</span>
<span class="c"># /etc/securetty (ë¹„ì–´ìˆê²Œ í•˜ë©´ ì½˜ì†” ë¡œê·¸ì¸ ì°¨ë‹¨)</span>
<span class="o">&gt;</span> /etc/securetty

<span class="c"># ë˜ëŠ” íŠ¹ì • í„°ë¯¸ë„ë§Œ í—ˆìš©</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/securetty <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
console
tty1
</span><span class="no">EOF

</span><span class="c"># sudo ê¶Œí•œ ì„¸ë°€í•œ ì œì–´</span>
<span class="c"># /etc/sudoers.d/custom-rules</span>

<span class="c"># 1. ê·¸ë£¹ ê¸°ë°˜ ê¶Œí•œ ì„¤ì •</span>
%wheel <span class="nv">ALL</span><span class="o">=(</span>ALL:ALL<span class="o">)</span> ALL
%admin <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> NOPASSWD: /usr/bin/systemctl restart <span class="k">*</span>, /usr/bin/systemctl reload <span class="k">*</span>

<span class="c"># 2. ì‚¬ìš©ìë³„ ì„¸ë¶€ ê¶Œí•œ</span>
<span class="c"># ì›¹ ì„œë²„ ê´€ë¦¬ì</span>
webadmin <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> /usr/sbin/service apache2 <span class="k">*</span>, /usr/sbin/service nginx <span class="k">*</span>, <span class="se">\</span>
              /usr/bin/systemctl restart apache2, /usr/bin/systemctl reload nginx, <span class="se">\</span>
              /usr/bin/tail <span class="nt">-f</span> /var/log/apache2/<span class="k">*</span>, /usr/bin/tail <span class="nt">-f</span> /var/log/nginx/<span class="k">*</span>

<span class="c"># ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ì  </span>
dbadmin <span class="nv">ALL</span><span class="o">=(</span>postgres<span class="o">)</span> NOPASSWD: /usr/bin/psql, /usr/bin/pg_dump, /usr/bin/pg_restore
dbadmin <span class="nv">ALL</span><span class="o">=(</span>mysql<span class="o">)</span> NOPASSWD: /usr/bin/mysql, /usr/bin/mysqldump

<span class="c"># ë°±ì—… ê´€ë¦¬ì</span>
backup <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> NOPASSWD: /usr/bin/rsync, /bin/tar, /bin/gzip, /usr/bin/find /home <span class="nt">-name</span> <span class="s2">"*"</span>

<span class="c"># 3. ëª…ë ¹ ì œí•œ ë° ì¸ìˆ˜ ì œí•œ</span>
developer <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> /usr/bin/systemctl status <span class="k">*</span>, <span class="o">!</span>/usr/bin/systemctl <span class="k">*</span> <span class="nt">--force</span>

<span class="c"># 4. ì‹œê°„ ì œí•œ</span>
nightshift <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> NOPASSWD: /usr/bin/systemctl restart <span class="k">*</span> <span class="se">\</span>
    <span class="c"># ì•¼ê°„ ê·¼ë¬´ ì‹œê°„ì—ë§Œ í—ˆìš© (ì˜ˆì‹œ)</span>

<span class="c"># 5. í˜¸ìŠ¤íŠ¸ ê¸°ë°˜ ì œí•œ</span>
john <span class="nv">server1</span><span class="o">=(</span>ALL<span class="o">)</span> /bin/ls, /bin/cat /var/log/<span class="k">*</span>

<span class="c"># sudo ë¡œê¹… ê°•í™”</span>
<span class="c"># /etc/sudoersì— ì¶”ê°€</span>
Defaults    <span class="nv">logfile</span><span class="o">=</span><span class="s2">"/var/log/sudo.log"</span>
Defaults    log_input, log_output      <span class="c"># ì…ì¶œë ¥ ë¡œê¹…</span>
Defaults    <span class="nv">iolog_dir</span><span class="o">=</span><span class="s2">"/var/log/sudo-io/%{user}/%{time}"</span>
Defaults    <span class="nv">timestamp_timeout</span><span class="o">=</span>0        <span class="c"># ìºì‹œ ë¹„í™œì„±í™”</span>
Defaults    <span class="nv">passwd_tries</span><span class="o">=</span>3            <span class="c"># 3íšŒ ì‹œë„ í›„ ì‹¤íŒ¨</span>
Defaults    <span class="nv">passwd_timeout</span><span class="o">=</span>5          <span class="c"># 5ë¶„ íƒ€ì„ì•„ì›ƒ</span>
Defaults    env_reset                 <span class="c"># í™˜ê²½ë³€ìˆ˜ ì´ˆê¸°í™”</span>
Defaults    mail_badpass              <span class="c"># ì˜ëª»ëœ íŒ¨ìŠ¤ì›Œë“œ ì‹œ ë©”ì¼</span>
Defaults    <span class="nv">secure_path</span><span class="o">=</span><span class="s2">"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span>

<span class="c"># sudo ì„¸ì…˜ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/sudo-monitor.sh</span>
<span class="nv">SUDO_LOG</span><span class="o">=</span><span class="s2">"/var/log/sudo.log"</span>
<span class="nv">ALERT_EMAIL</span><span class="o">=</span><span class="s2">"admin@company.com"</span>

<span class="c"># ìœ„í—˜í•œ ëª…ë ¹ì–´ íŒ¨í„´</span>
<span class="nv">DANGEROUS_PATTERNS</span><span class="o">=(</span>
    <span class="s2">"rm -rf /"</span>
    <span class="s2">"dd if="</span>
    <span class="s2">"mkfs</span><span class="se">\.</span><span class="s2">"</span>
    <span class="s2">"fdisk"</span>
    <span class="s2">"parted"</span>
    <span class="s2">"chmod 777"</span>
    <span class="s2">"chown root"</span>
    <span class="s2">"/bin/bash"</span>
    <span class="s2">"/bin/sh"</span>
    <span class="s2">"su -"</span>
    <span class="s2">"passwd root"</span>
    <span class="s2">"userdel"</span>
    <span class="s2">"usermod -u 0"</span>
<span class="o">)</span>

<span class="nb">tail</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$SUDO_LOG</span><span class="s2">"</span> | <span class="k">while </span><span class="nb">read </span>line<span class="p">;</span> <span class="k">do
    for </span>pattern <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">DANGEROUS_PATTERNS</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
        if </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-i</span> <span class="s2">"</span><span class="nv">$pattern</span><span class="s2">"</span> <span class="o">&gt;</span>/dev/null<span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">: DANGEROUS SUDO COMMAND DETECTED: </span><span class="nv">$line</span><span class="s2">"</span>
            <span class="nb">echo</span> <span class="s2">"Dangerous sudo command executed: </span><span class="nv">$line</span><span class="s2">"</span> | <span class="se">\</span>
            mail <span class="nt">-s</span> <span class="s2">"SECURITY ALERT: Dangerous Command"</span> <span class="s2">"</span><span class="nv">$ALERT_EMAIL</span><span class="s2">"</span>
        <span class="k">fi
    done
done</span>
</code></pre></div></div>

<h3 id="-ê³ ê¸‰-ì¸ì¦-ë©”ì»¤ë‹ˆì¦˜">ğŸ”‘ ê³ ê¸‰ ì¸ì¦ ë©”ì»¤ë‹ˆì¦˜</h3>

<h4 id="ë‹¤ì¤‘-ì¸ì¦-ìš”ì†Œ-mfa-êµ¬í˜„">ë‹¤ì¤‘ ì¸ì¦ ìš”ì†Œ (MFA) êµ¬í˜„</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Google Authenticator (TOTP) ì„¤ì •</span>
<span class="c"># 1. íŒ¨í‚¤ì§€ ì„¤ì¹˜</span>
apt-get <span class="nb">install </span>libpam-google-authenticator

<span class="c"># 2. ì‚¬ìš©ìë³„ ì„¤ì • (ê° ì‚¬ìš©ìê°€ ì‹¤í–‰)</span>
google-authenticator
<span class="c"># - ì‹œê°„ ê¸°ë°˜ í† í° ì‚¬ìš©: y</span>
<span class="c"># - QR ì½”ë“œ í‘œì‹œ í›„ ì•±ì— ë“±ë¡</span>
<span class="c"># - ê¸´ê¸‰ ìŠ¤í¬ë˜ì¹˜ ì½”ë“œ ì €ì¥</span>
<span class="c"># - í† í° ì¬ì‚¬ìš© ë°©ì§€: y</span>
<span class="c"># - ì‹œê°„ í—ˆìš© ì˜¤ì°¨: y</span>

<span class="c"># 3. SSHì—ì„œ MFA í™œì„±í™”</span>
<span class="c"># /etc/pam.d/sshdì— ì¶”ê°€ (password ì¤„ ìœ„ì—)</span>
auth required pam_google_authenticator.so

<span class="c"># /etc/ssh/sshd_config ìˆ˜ì •</span>
ChallengeResponseAuthentication <span class="nb">yes
</span>AuthenticationMethods publickey,keyboard-interactive

<span class="c"># 4. sudoì—ì„œ MFA ì ìš©</span>
<span class="c"># /etc/pam.d/sudoì— ì¶”ê°€</span>
auth required pam_google_authenticator.so

<span class="c"># 5. MFA ë°±ì—… ë° ë³µêµ¬</span>
<span class="c"># ì‚¬ìš©ìë³„ ì„¤ì • ë°±ì—…</span>
<span class="nb">cp</span> ~/.google_authenticator ~/.google_authenticator.backup

<span class="c"># ê´€ë¦¬ììš© ê¸´ê¸‰ ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/mfa-recovery.sh</span>
<span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"Username: "</span> username
<span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"Emergency scratch code: "</span> scratch_code

<span class="k">if </span><span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"</span><span class="nv">$scratch_code</span><span class="s2">"</span> <span class="s2">"/home/</span><span class="nv">$username</span><span class="s2">/.google_authenticator"</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"Valid scratch code. Temporarily disabling MFA..."</span>
    <span class="nb">mv</span> <span class="s2">"/home/</span><span class="nv">$username</span><span class="s2">/.google_authenticator"</span> <span class="s2">"/home/</span><span class="nv">$username</span><span class="s2">/.google_authenticator.disabled"</span>
    <span class="nb">echo</span> <span class="s2">"MFA disabled for </span><span class="nv">$username</span><span class="s2">. Re-enable after password reset."</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"Invalid scratch code."</span>
<span class="k">fi</span>
</code></pre></div></div>

<h4 id="ldapactive-directory-í†µí•©-ì¸ì¦">LDAP/Active Directory í†µí•© ì¸ì¦</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># SSSDë¥¼ ì´ìš©í•œ AD í†µí•© (Ubuntu/CentOS)</span>
<span class="c"># 1. í•„ìš” íŒ¨í‚¤ì§€ ì„¤ì¹˜</span>
apt-get <span class="nb">install </span>sssd sssd-tools realmd adcli packagekit

<span class="c"># 2. ë„ë©”ì¸ ë°œê²¬ ë° ê°€ì…</span>
realm discover company.local
realm <span class="nb">join</span> <span class="nt">-U</span> administrator company.local

<span class="c"># 3. SSSD êµ¬ì„±</span>
<span class="c"># /etc/sssd/sssd.conf</span>
<span class="o">[</span>sssd]
domains <span class="o">=</span> company.local
config_file_version <span class="o">=</span> 2
services <span class="o">=</span> nss, pam

<span class="o">[</span>domain/company.local]
default_shell <span class="o">=</span> /bin/bash
krb5_store_password_if_offline <span class="o">=</span> True
cache_credentials <span class="o">=</span> True
krb5_realm <span class="o">=</span> COMPANY.LOCAL
realmd_tags <span class="o">=</span> manages-system joined-with-adcli
id_provider <span class="o">=</span> ad
fallback_homedir <span class="o">=</span> /home/%u@%d
ad_domain <span class="o">=</span> company.local
use_fully_qualified_names <span class="o">=</span> True
ldap_id_mapping <span class="o">=</span> True
access_provider <span class="o">=</span> ad

<span class="c"># íŠ¹ì • ê·¸ë£¹ë§Œ í—ˆìš©</span>
ad_access_filter <span class="o">=</span> <span class="o">(</span><span class="nv">memberOf</span><span class="o">=</span><span class="nv">CN</span><span class="o">=</span>Linux-Users,OU<span class="o">=</span>Groups,DC<span class="o">=</span>company,DC<span class="o">=</span><span class="nb">local</span><span class="o">)</span>

<span class="nb">chmod </span>600 /etc/sssd/sssd.conf
systemctl <span class="nb">enable </span>sssd
systemctl start sssd

<span class="c"># 4. í™ˆ ë””ë ‰í† ë¦¬ ìë™ ìƒì„±</span>
<span class="c"># /etc/pam.d/common-sessionì— ì¶”ê°€</span>
session required pam_mkhomedir.so <span class="nv">skel</span><span class="o">=</span>/etc/skel <span class="nb">umask</span><span class="o">=</span>0022

<span class="c"># 5. sudo ê¶Œí•œ ì„¤ì • (AD ê·¸ë£¹ ê¸°ë°˜)</span>
<span class="c"># /etc/sudoers.d/ad-groups</span>
%domain<span class="se">\ </span>admins@company.local <span class="nv">ALL</span><span class="o">=(</span>ALL:ALL<span class="o">)</span> ALL
%linux-administrators@company.local <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> NOPASSWD: /usr/bin/systemctl <span class="k">*</span>, /usr/sbin/service <span class="k">*</span>

<span class="c"># 6. ì—°ê²° í…ŒìŠ¤íŠ¸</span>
getent passwd user@company.local
<span class="nb">id </span>user@company.local
su - user@company.local
</code></pre></div></div>

<h3 id="-ì„¸ì…˜-ë°-ë¡œê·¸ì¸-ì œì–´">ğŸ›‚ ì„¸ì…˜ ë° ë¡œê·¸ì¸ ì œì–´</h3>

<h4 id="ê³ ê¸‰-ë¡œê·¸ì¸-ì œì–´-ì„¤ì •">ê³ ê¸‰ ë¡œê·¸ì¸ ì œì–´ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/security/access.conf - ì•¡ì„¸ìŠ¤ ì œì–´</span>
<span class="c"># í˜•ì‹: ê¶Œí•œ:ì‚¬ìš©ì/ê·¸ë£¹:í„°ë¯¸ë„/í˜¸ìŠ¤íŠ¸</span>

<span class="c"># ë£¨íŠ¸ëŠ” ë¡œì»¬ì—ì„œë§Œ ë¡œê·¸ì¸ í—ˆìš©</span>
+ : root : LOCAL
- : root : ALL

<span class="c"># admin ê·¸ë£¹ì€ íŠ¹ì • IPì—ì„œë§Œ</span>
+ : @admin : 192.168.1.0/24
- : @admin : ALL

<span class="c"># íŠ¹ì • ì‚¬ìš©ìëŠ” íŠ¹ì • ì‹œê°„ì—ë§Œ</span>
+ : nightshift : ALL EXCEPT HOLIDAYS
- : nightshift : Wl0800-1800

<span class="c"># ì‹œê°„ ê¸°ë°˜ ì ‘ê·¼ ì œì–´</span>
<span class="c"># /etc/security/time.conf</span>
login<span class="p">;</span><span class="k">*</span><span class="p">;</span><span class="nb">users</span><span class="p">;</span>Al0800-1800
sshd<span class="p">;</span><span class="k">*</span><span class="p">;</span>developers<span class="p">;</span>MoTuWeThFr0900-1800

<span class="c"># ë¡œê·¸ì¸ ì‹œë„ ì œí•œ</span>
<span class="c"># /etc/security/limits.conf</span>
<span class="c"># ì‚¬ìš©ìë³„ ë™ì‹œ ë¡œê·¸ì¸ ì„¸ì…˜ ì œí•œ</span>
@users hard maxlogins 2
john hard maxlogins 1

<span class="c"># í”„ë¡œì„¸ìŠ¤ ìˆ˜ ì œí•œ (í¬í¬ í­íƒ„ ë°©ì§€)</span>
@users hard <span class="nb">nproc </span>1024
@developers hard <span class="nb">nproc </span>2048

<span class="c"># ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì œí•œ</span>
@users hard as 1048576    <span class="c"># 1GB</span>

<span class="c"># íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ì œí•œ</span>
@users hard nofile 4096

<span class="c"># ì½”ì–´ ë¤í”„ ë¹„í™œì„±í™”</span>
<span class="k">*</span> hard core 0

<span class="c"># ë¡œê·¸ì¸ ë°°ë„ˆ ì„¤ì •</span>
<span class="c"># /etc/issue (ì½˜ì†” ë¡œê·¸ì¸)</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/issue <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
**********************************************************************
*                        WARNING NOTICE                             *
*                                                                    *
* This system is for authorized users only. All activities may be   *
* monitored and recorded. Unauthorized access is prohibited and     *
* will be prosecuted to the full extent of the law.                *
*                                                                    *
**********************************************************************
</span><span class="no">
EOF

</span><span class="c"># /etc/issue.net (ë„¤íŠ¸ì›Œí¬ ë¡œê·¸ì¸)</span>
<span class="nb">cp</span> /etc/issue /etc/issue.net

<span class="c"># /etc/motd (ë¡œê·¸ì¸ í›„ ë©”ì‹œì§€)</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/motd <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
System Information:
- Last system update: </span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="sh">
- Security policy: https://company.com/security-policy
- Report security incidents: security@company.com
</span><span class="no">
EOF

</span><span class="c"># ë™ì  MOTD ìƒì„± ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /etc/update-motd.d/10-sysinfo</span>
<span class="nb">echo</span> <span class="s2">"System Status as of </span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"======================================"</span>
<span class="nb">echo</span> <span class="s2">"Hostname: </span><span class="si">$(</span><span class="nb">hostname</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Kernel: </span><span class="si">$(</span><span class="nb">uname</span> <span class="nt">-r</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Uptime: </span><span class="si">$(</span><span class="nb">uptime</span> <span class="nt">-p</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Load: </span><span class="si">$(</span><span class="nb">cat</span> /proc/loadavg | <span class="nb">awk</span> <span class="s1">'{print $1", "$2", "$3}'</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Memory: </span><span class="si">$(</span>free <span class="nt">-h</span> | <span class="nb">awk</span> <span class="s1">'NR==2{printf "%.1fG/%.1fG (%.1f%%)", $3/1024, $2/1024, $3*100/$2}'</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Disk: </span><span class="si">$(</span><span class="nb">df</span> <span class="nt">-h</span> / | <span class="nb">awk</span> <span class="s1">'NR==2{printf "%s/%s (%s)", $3, $2, $5}'</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">""</span>

<span class="c"># ë³´ì•ˆ ìƒíƒœ í™•ì¸</span>
<span class="k">if </span>systemctl is-active <span class="nt">--quiet</span> fail2ban<span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"âœ“ Fail2ban: Active"</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"âœ— Fail2ban: Inactive"</span>
<span class="k">fi

if </span>systemctl is-active <span class="nt">--quiet</span> sshd<span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"âœ“ SSH: Active"</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"âœ— SSH: Inactive"</span>  
<span class="k">fi

</span><span class="nb">echo</span> <span class="s2">"======================================"</span>
<span class="nb">echo</span> <span class="s2">""</span>

<span class="nb">chmod</span> +x /etc/update-motd.d/10-sysinfo
</code></pre></div></div>

<h3 id="-ì¸ì¦-ë¡œê·¸-ëª¨ë‹ˆí„°ë§-ë°-ë¶„ì„">ğŸ“Š ì¸ì¦ ë¡œê·¸ ëª¨ë‹ˆí„°ë§ ë° ë¶„ì„</h3>

<h4 id="ì‹¤ì‹œê°„-ë¡œê·¸ì¸-ëª¨ë‹ˆí„°ë§-ì‹œìŠ¤í…œ">ì‹¤ì‹œê°„ ë¡œê·¸ì¸ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
# /usr/local/bin/auth-monitor.py
</span><span class="kn">import</span> <span class="n">re</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">subprocess</span>
<span class="kn">import</span> <span class="n">smtplib</span>
<span class="kn">from</span> <span class="n">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>
<span class="kn">from</span> <span class="n">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">deque</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="k">class</span> <span class="nc">AuthenticationMonitor</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">failed_attempts</span> <span class="o">=</span> <span class="nf">defaultdict</span><span class="p">(</span><span class="n">deque</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">successful_logins</span> <span class="o">=</span> <span class="nf">defaultdict</span><span class="p">(</span><span class="n">deque</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">suspicious_ips</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">alert_threshold</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">self</span><span class="p">.</span><span class="n">time_window</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># 5 minutes
</span>        
    <span class="k">def</span> <span class="nf">parse_log_line</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¡œê·¸ ë¼ì¸ íŒŒì‹±</span><span class="sh">"""</span>
        <span class="n">patterns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">failed_password</span><span class="sh">'</span><span class="p">:</span> <span class="sa">r</span><span class="sh">'</span><span class="s">(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*Failed password for (\w+) from (\d+\.\d+\.\d+\.\d+)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">accepted_password</span><span class="sh">'</span><span class="p">:</span> <span class="sa">r</span><span class="sh">'</span><span class="s">(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*Accepted password for (\w+) from (\d+\.\d+\.\d+\.\d+)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">invalid_user</span><span class="sh">'</span><span class="p">:</span> <span class="sa">r</span><span class="sh">'</span><span class="s">(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*Invalid user (\w+) from (\d+\.\d+\.\d+\.\d+)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">sudo_command</span><span class="sh">'</span><span class="p">:</span> <span class="sa">r</span><span class="sh">'</span><span class="s">(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*sudo.*USER=(\w+).*COMMAND=(.*)</span><span class="sh">'</span>
        <span class="p">}</span>
        
        <span class="k">for</span> <span class="n">event_type</span><span class="p">,</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">event_type</span><span class="p">,</span> <span class="k">match</span><span class="p">.</span><span class="nf">groups</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">is_suspicious_ip</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì˜ì‹¬ìŠ¤ëŸ¬ìš´ IP íŒë³„</span><span class="sh">"""</span>
        <span class="c1"># ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ IPëŠ” ì œì™¸
</span>        <span class="n">internal_ranges</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sh">'</span><span class="s">192.168.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">10.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.16.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.17.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.18.</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">172.19.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.20.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.21.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.22.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.23.</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">172.24.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.25.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.26.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.27.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.28.</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">172.29.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.30.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.31.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">127.</span><span class="sh">'</span>
        <span class="p">]</span>
        
        <span class="k">return</span> <span class="ow">not</span> <span class="nf">any</span><span class="p">(</span><span class="n">ip</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">internal_ranges</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">check_brute_force</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¸Œë£¨íŠ¸í¬ìŠ¤ ê³µê²© í™•ì¸</span><span class="sh">"""</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        
        <span class="c1"># ì˜¤ë˜ëœ ì‹œë„ ì œê±°
</span>        <span class="nf">while </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span> <span class="ow">and</span> 
               <span class="n">now</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">ip</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">self</span><span class="p">.</span><span class="n">time_window</span><span class="p">):</span>
            <span class="n">self</span><span class="p">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">ip</span><span class="p">].</span><span class="nf">popleft</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">ip</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">alert_threshold</span>
    
    <span class="k">def</span> <span class="nf">send_alert</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">alert_type</span><span class="p">,</span> <span class="n">details</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì•Œë¦¼ ë°œì†¡</span><span class="sh">"""</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"""</span><span class="s">
Security Alert: </span><span class="si">{</span><span class="n">alert_type</span><span class="si">}</span><span class="s">

Time: </span><span class="si">{</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%Y-%m-%d %H</span><span class="si">:</span><span class="o">%</span><span class="n">M</span><span class="si">:</span><span class="o">%</span><span class="n">S</span><span class="sh">'</span><span class="s">)</span><span class="si">}</span><span class="s">
Details: </span><span class="si">{</span><span class="n">details</span><span class="si">}</span><span class="s">

System: </span><span class="si">{</span><span class="n">subprocess</span><span class="p">.</span><span class="nf">check_output</span><span class="p">(</span><span class="sh">'</span><span class="s">hostname</span><span class="sh">'</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="nf">decode</span><span class="p">().</span><span class="nf">strip</span><span class="p">()</span><span class="si">}</span><span class="s">

Please investigate immediately.
        </span><span class="sh">"""</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ALERT: </span><span class="si">{</span><span class="n">alert_type</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">details</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># ì´ë©”ì¼ ë°œì†¡ (ì„ íƒì‚¬í•­)
</span>        <span class="c1"># self.send_email("Security Alert", message)
</span>        
        <span class="c1"># ë¡œê·¸ ê¸°ë¡
</span>        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">/var/log/security-alerts.log</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">isoformat</span><span class="p">()</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">alert_type</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">details</span><span class="si">}</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">monitor_log</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">log_file</span><span class="o">=</span><span class="sh">'</span><span class="s">/var/log/auth.log</span><span class="sh">'</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¡œê·¸ ëª¨ë‹ˆí„°ë§ ë©”ì¸ ë£¨í”„</span><span class="sh">"""</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Starting authentication monitoring on </span><span class="si">{</span><span class="n">log_file</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># ê¸°ì¡´ ë¡œê·¸ ì²˜ë¦¬ (ë§ˆì§€ë§‰ 100ì¤„)
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">readlines</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:]:</span>
                    <span class="n">self</span><span class="p">.</span><span class="nf">process_line</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="nf">strip</span><span class="p">())</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Log file </span><span class="si">{</span><span class="n">log_file</span><span class="si">}</span><span class="s"> not found</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
</span>        <span class="n">proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="nc">Popen</span><span class="p">([</span><span class="sh">'</span><span class="s">tail</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">-f</span><span class="sh">'</span><span class="p">,</span> <span class="n">log_file</span><span class="p">],</span> 
                               <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span> 
                               <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span>
                               <span class="n">universal_newlines</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nf">iter</span><span class="p">(</span><span class="n">proc</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">readline</span><span class="p">,</span> <span class="sh">''</span><span class="p">):</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">process_line</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="nf">strip</span><span class="p">())</span>
        <span class="k">except</span> <span class="nb">KeyboardInterrupt</span><span class="p">:</span>
            <span class="n">proc</span><span class="p">.</span><span class="nf">terminate</span><span class="p">()</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Monitoring stopped</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">process_line</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¡œê·¸ ë¼ì¸ ì²˜ë¦¬</span><span class="sh">"""</span>
        <span class="n">event_type</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">parse_log_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">event_type</span><span class="p">:</span>
            <span class="k">return</span>
            
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">event_type</span> <span class="o">==</span> <span class="sh">'</span><span class="s">failed_password</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">timestamp</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">self</span><span class="p">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">ip</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">current_time</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="nf">is_suspicious_ip</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="ow">and</span> <span class="n">self</span><span class="p">.</span><span class="nf">check_brute_force</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">send_alert</span><span class="p">(</span>
                    <span class="sh">"</span><span class="s">Brute Force Attack Detected</span><span class="sh">"</span><span class="p">,</span>
                    <span class="sa">f</span><span class="sh">"</span><span class="s">IP </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s"> failed </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">ip</span><span class="p">])</span><span class="si">}</span><span class="s"> login attempts for user </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="sh">"</span>
                <span class="p">)</span>
                <span class="n">self</span><span class="p">.</span><span class="n">suspicious_ips</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="sh">'</span><span class="s">accepted_password</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">timestamp</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">data</span>
            
            <span class="k">if</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">suspicious_ips</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">send_alert</span><span class="p">(</span>
                    <span class="sh">"</span><span class="s">Successful Login from Suspicious IP</span><span class="sh">"</span><span class="p">,</span>
                    <span class="sa">f</span><span class="sh">"</span><span class="s">User </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s"> logged in from previously suspicious IP </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="sh">"</span>
                <span class="p">)</span>
            
            <span class="c1"># ë¹„ì •ìƒ ì‹œê°„ëŒ€ ë¡œê·¸ì¸ í™•ì¸
</span>            <span class="n">current_hour</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="n">hour</span>
            <span class="k">if</span> <span class="n">current_hour</span> <span class="o">&lt;</span> <span class="mi">6</span> <span class="ow">or</span> <span class="n">current_hour</span> <span class="o">&gt;</span> <span class="mi">22</span><span class="p">:</span>  <span class="c1"># ì˜¤ì „ 6ì‹œ ì´ì „, ì˜¤í›„ 10ì‹œ ì´í›„
</span>                <span class="n">self</span><span class="p">.</span><span class="nf">send_alert</span><span class="p">(</span>
                    <span class="sh">"</span><span class="s">Off-Hours Login</span><span class="sh">"</span><span class="p">,</span>
                    <span class="sa">f</span><span class="sh">"</span><span class="s">User </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s"> logged in from </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s"> at unusual time: </span><span class="si">{</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%H</span><span class="si">:</span><span class="o">%</span><span class="n">M</span><span class="sh">'</span><span class="s">)</span><span class="si">}</span><span class="sh">"</span>
                <span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="sh">'</span><span class="s">invalid_user</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">timestamp</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">send_alert</span><span class="p">(</span>
                <span class="sh">"</span><span class="s">Invalid User Login Attempt</span><span class="sh">"</span><span class="p">,</span>
                <span class="sa">f</span><span class="sh">"</span><span class="s">Attempt to login as non-existent user </span><span class="sh">'</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="sh">'</span><span class="s"> from </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="sh">"</span>
            <span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="sh">'</span><span class="s">sudo_command</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">timestamp</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="n">data</span>
            
            <span class="c1"># ìœ„í—˜í•œ ëª…ë ¹ì–´ ê°ì§€
</span>            <span class="n">dangerous_patterns</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">rm -rf</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">dd if=</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">mkfs</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">fdisk</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">passwd root</span><span class="sh">'</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">dangerous_patterns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">command</span><span class="p">:</span>
                    <span class="n">self</span><span class="p">.</span><span class="nf">send_alert</span><span class="p">(</span>
                        <span class="sh">"</span><span class="s">Dangerous Sudo Command</span><span class="sh">"</span><span class="p">,</span>
                        <span class="sa">f</span><span class="sh">"</span><span class="s">User </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s"> executed: </span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="sh">"</span>
                    <span class="p">)</span>
                    <span class="k">break</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">monitor</span> <span class="o">=</span> <span class="nc">AuthenticationMonitor</span><span class="p">()</span>
    <span class="n">monitor</span><span class="p">.</span><span class="nf">monitor_log</span><span class="p">()</span>
</code></pre></div></div>

<h4 id="ë¡œê·¸ì¸-í†µê³„-ë°-ë¶„ì„-ë„êµ¬">ë¡œê·¸ì¸ í†µê³„ ë° ë¶„ì„ ë„êµ¬</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/auth-stats.sh</span>
<span class="c"># ì¸ì¦ ë¡œê·¸ í†µê³„ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸</span>

<span class="nb">echo</span> <span class="s2">"=== Linux Authentication Statistics Report ==="</span>
<span class="nb">echo</span> <span class="s2">"Generated on: </span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"=============================================="</span>
<span class="nb">echo</span>

<span class="c"># 1. ìµœê·¼ ì„±ê³µí•œ ë¡œê·¸ì¸</span>
<span class="nb">echo</span> <span class="s2">"ğŸ”‘ Recent Successful Logins (Last 24 hours):"</span>
last <span class="nt">-s</span> yesterday | <span class="nb">head</span> <span class="nt">-20</span>
<span class="nb">echo</span>

<span class="c"># 2. ì‹¤íŒ¨í•œ ë¡œê·¸ì¸ ì‹œë„ í†µê³„</span>
<span class="nb">echo</span> <span class="s2">"âŒ Failed Login Attempts (Last 7 days):"</span>
<span class="nb">grep</span> <span class="s2">"Failed password"</span> /var/log/auth.log<span class="k">*</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="s1">'{print $1, $2, $11}'</span> | <span class="se">\</span>
<span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="nb">sort</span> <span class="nt">-nr</span> | <span class="nb">head</span> <span class="nt">-10</span>
<span class="nb">echo</span>

<span class="c"># 3. ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ì‚¬ìš©ìëª… ì‹œë„</span>
<span class="nb">echo</span> <span class="s2">"ğŸ‘¤ Invalid User Attempts:"</span>
<span class="nb">grep</span> <span class="s2">"Invalid user"</span> /var/log/auth.log<span class="k">*</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="s1">'{print $8}'</span> | <span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="nb">sort</span> <span class="nt">-nr</span> | <span class="nb">head</span> <span class="nt">-10</span>
<span class="nb">echo</span>

<span class="c"># 4. IPë³„ ì ‘ê·¼ ì‹œë„ í†µê³„</span>
<span class="nb">echo</span> <span class="s2">"ğŸŒ Access Attempts by IP:"</span>
<span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"(Failed password|Accepted password)"</span> /var/log/auth.log<span class="k">*</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="s1">'{print $NF}'</span> | <span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="nb">sort</span> <span class="nt">-nr</span> | <span class="nb">head</span> <span class="nt">-10</span>
<span class="nb">echo</span>

<span class="c"># 5. ì‹œê°„ëŒ€ë³„ ë¡œê·¸ì¸ íŒ¨í„´</span>
<span class="nb">echo</span> <span class="s2">"â° Login Pattern by Hour:"</span>
<span class="nb">grep</span> <span class="s2">"Accepted password"</span> /var/log/auth.log<span class="k">*</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="s1">'{print $3}'</span> | <span class="nb">cut</span> <span class="nt">-d</span>: <span class="nt">-f1</span> | <span class="nb">sort</span> <span class="nt">-n</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="se">\</span>
<span class="k">while </span><span class="nb">read </span>count hour<span class="p">;</span> <span class="k">do
    </span><span class="nb">printf</span> <span class="s2">"%02d:00 %s %s</span><span class="se">\n</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$hour</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$count</span><span class="s2">"</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">printf</span> <span class="s2">"%*s"</span> <span class="k">$((</span>count/2<span class="k">))</span> <span class="s2">""</span> | <span class="nb">tr</span> <span class="s2">" "</span> <span class="s2">"â–‡"</span><span class="si">)</span><span class="s2">"</span>
<span class="k">done
</span><span class="nb">echo</span>

<span class="c"># 6. sudo ì‚¬ìš© í†µê³„</span>
<span class="nb">echo</span> <span class="s2">"ğŸ”§ Sudo Command Usage:"</span>
<span class="nb">grep</span> <span class="s2">"sudo"</span> /var/log/auth.log<span class="k">*</span> | <span class="se">\</span>
<span class="nb">grep</span> <span class="s2">"COMMAND="</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="nt">-F</span><span class="s1">'COMMAND='</span> <span class="s1">'{print $2}'</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="s1">'{print $1}'</span> | <span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="nb">sort</span> <span class="nt">-nr</span> | <span class="nb">head</span> <span class="nt">-10</span>
<span class="nb">echo</span>

<span class="c"># 7. ë³´ì•ˆ ì´ë²¤íŠ¸ ìš”ì•½</span>
<span class="nb">echo</span> <span class="s2">"ğŸš¨ Security Events Summary:"</span>
<span class="nv">total_failed</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-c</span> <span class="s2">"Failed password"</span> /var/log/auth.log<span class="k">*</span><span class="si">)</span>
<span class="nv">total_invalid</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-c</span> <span class="s2">"Invalid user"</span> /var/log/auth.log<span class="k">*</span><span class="si">)</span>
<span class="nv">total_sudo</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-c</span> <span class="s2">"sudo.*COMMAND="</span> /var/log/auth.log<span class="k">*</span><span class="si">)</span>

<span class="nb">echo</span> <span class="s2">"   Failed password attempts: </span><span class="nv">$total_failed</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"   Invalid user attempts: </span><span class="nv">$total_invalid</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"   Sudo commands executed: </span><span class="nv">$total_sudo</span><span class="s2">"</span>

<span class="c"># 8. ì¶”ì²œ ë³´ì•ˆ ì¡°ì¹˜</span>
<span class="nb">echo
echo</span> <span class="s2">"ğŸ’¡ Security Recommendations:"</span>

<span class="c"># ë†’ì€ ì‹¤íŒ¨ ì‹œë„ê°€ ìˆëŠ” IP í™•ì¸</span>
<span class="nv">high_fail_ips</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="s2">"Failed password"</span> /var/log/auth.log<span class="k">*</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="s1">'{print $NF}'</span> | <span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="s1">'$1 &gt; 50 {print $2}'</span> | <span class="nb">wc</span> <span class="nt">-l</span><span class="si">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$high_fail_ips</span> <span class="nt">-gt</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"   - Consider blocking IPs with high failure rates"</span>
<span class="k">fi</span>

<span class="c"># ë¹„ì •ìƒì ì¸ ì‹œê°„ëŒ€ ì ‘ê·¼ í™•ì¸</span>
<span class="nv">night_logins</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="s2">"Accepted password"</span> /var/log/auth.log<span class="k">*</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="s1">'{print $3}'</span> | <span class="nb">cut</span> <span class="nt">-d</span>: <span class="nt">-f1</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="s1">'$1 &lt; 6 || $1 &gt; 22'</span> | <span class="nb">wc</span> <span class="nt">-l</span><span class="si">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$night_logins</span> <span class="nt">-gt</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"   - Review off-hours login activity"</span>
<span class="k">fi

</span><span class="nb">echo</span> <span class="s2">"=============================================="</span>
</code></pre></div></div>

<h2 id="ë‹¤ìŒ-í¸-ì˜ˆê³ ">ë‹¤ìŒ í¸ ì˜ˆê³ </h2>

<p>ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” <strong>SSH ê³ ê¸‰ ë³´ì•ˆ ì„¤ì •ê³¼ í‚¤ ê´€ë¦¬</strong>ë¥¼ ìƒì„¸íˆ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤:</p>
<ul>
  <li>SSH í‚¤ ê¸°ë°˜ ì¸ì¦ êµ¬ì¶•</li>
  <li>SSH Certificate Authority ì„¤ì •</li>
  <li>í¬íŠ¸ í¬ì›Œë”© ë° í„°ë„ë§ ë³´ì•ˆ</li>
  <li>SSH ì ‘ê·¼ ì œì–´ ê³ ê¸‰ ê¸°ë²•</li>
</ul>

<p>ë¦¬ëˆ…ìŠ¤ ê¸°ì´ˆ ë³´ì•ˆ ì„¤ì •ì„ ì™„ë²½í•˜ê²Œ ë§ˆìŠ¤í„°í•˜ì…¨ë‚˜ìš”? ğŸ”âœ¨</p>

  </div>

  <footer class="post-footer">
    <div class="post-navigation"><div class="nav-previous">
        <a href="/infra-blog/blog/2024/09/14/linux-security-guide.html" rel="prev">
          <i class="icon-left-arrow"></i>
          <span class="nav-title">ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ | Complete Linux Security Guide -...</span>
        </a>
      </div><div class="nav-next">
        <a href="/infra-blog/blog/2024/11/03/networking-guide-part3.html" rel="next">
          <span class="nav-title">ë„¤íŠ¸ì›Œí‚¹ ì™„ì „ ê°€ì´ë“œ 3í¸ - ë¼ìš°íŒ…ê³¼ ìŠ¤ìœ„ì¹­ ì‹¬í™” | Complete Network...</span>
          <i class="icon-right-arrow"></i>
        </a>
      </div></div>
  </footer>
  </article></div>

    </section>
    <footer class="condensed">
      <ul class="social about-footer condensed"><a href="https://github.com/leeyonghe" target="_blank">
          <li>
            <i class="icon-github-circled"></i>
          </li>
        </a><a href="https://www.linkedin.com/in/lee-yong-hee-18912454/" target="_blank">
          <li>
            <i class="icon-linkedin-squared"></i>
          </li>
        </a><!----></ul><p class="about-footer condensed">&copy;
        2025</p><div class="about-footer condensed">
        <p>Dark Mode
          <i class="icon-moon"></i>
          <label class="switch">
            <input type="checkbox" class="dark-mode-toggle">
            <span class="slider round" onclick="toggleDarkMode()"></span>
          </label>
        </p>
      </div>
    </footer>
  </main>
  
  <script type="text/javascript" src="/infra-blog/assets/js/darkmode.js"></script>
  
  <script src="/infra-blog/assets/js/simple-jekyll-search.min.js"></script>
  <script src="/infra-blog/assets/js/search.js"></script>
  
</body>

</html>
