<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.4">Jekyll</generator><link href="https://leeyonghe.github.io/infra-blog/feed.xml" rel="self" type="application/atom+xml" /><link href="https://leeyonghe.github.io/infra-blog/" rel="alternate" type="text/html" /><updated>2025-10-21T11:01:33+00:00</updated><id>https://leeyonghe.github.io/infra-blog/feed.xml</id><title type="html">Infrastructure Technology Blog</title><subtitle>ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ì™€ ê´€ë ¨ëœ ëª¨ë“  ê¸°ìˆ ì„ ë‹¤ë£¨ëŠ” ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. í´ë¼ìš°ë“œ, ë°ë¸Œì˜µìŠ¤, ë„¤íŠ¸ì›Œí‚¹, ë³´ì•ˆ, ëª¨ë‹ˆí„°ë§ ë“± ì¸í”„ë¼ ìš´ì˜ê³¼ ê´€ë¦¬ì— í•„ìš”í•œ ëª¨ë“  ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. A comprehensive blog covering all infrastructure technologies including cloud, DevOps, networking, security, monitoring, and everything needed for infrastructure operations and management.
</subtitle><author><name>DevOps Engineer</name></author><entry><title type="html">ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ 5í¸ - Wazuh SIEMê³¼ ì»¨í…Œì´ë„ˆ ë³´ì•ˆ | Linux Security Guide Part 5 - Wazuh SIEM &amp;amp; Container Security</title><link href="https://leeyonghe.github.io/infra-blog/blog/2025/05/24/linux-security-guide-part5.html" rel="alternate" type="text/html" title="ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ 5í¸ - Wazuh SIEMê³¼ ì»¨í…Œì´ë„ˆ ë³´ì•ˆ | Linux Security Guide Part 5 - Wazuh SIEM &amp;amp; Container Security" /><published>2025-05-24T00:00:00+00:00</published><updated>2025-05-24T00:00:00+00:00</updated><id>https://leeyonghe.github.io/infra-blog/blog/2025/05/24/linux-security-guide-part5</id><content type="html" xml:base="https://leeyonghe.github.io/infra-blog/blog/2025/05/24/linux-security-guide-part5.html"><![CDATA[<p>ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆì˜ ìµœì¢… ì™„ì„± ë‹¨ê³„ì¸ Wazuh SIEM êµ¬ì¶•ê³¼ ì»¨í…Œì´ë„ˆ ë³´ì•ˆì„ ì™„ì „íˆ ë§ˆìŠ¤í„°í•´ë³´ê² ìŠµë‹ˆë‹¤. ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ë¶€í„° ìµœì‹  ì»¨í…Œì´ë„ˆ í™˜ê²½ ë³´ì•ˆê¹Œì§€, ì°¨ì„¸ëŒ€ ë³´ì•ˆ ì¸í”„ë¼ë¥¼ êµ¬ì¶•í•˜ëŠ” ëª¨ë“  ê²ƒì„ ë‹¤ë£¹ë‹ˆë‹¤.</p>

<h2 id="wazuh-siem-ì™„ì „-êµ¬ì¶•--complete-wazuh-siem-implementation">Wazuh SIEM ì™„ì „ êµ¬ì¶• | Complete Wazuh SIEM Implementation</h2>

<h3 id="-wazuh-ì•„í‚¤í…ì²˜-ë°-ì„¤ì¹˜">ğŸ” Wazuh ì•„í‚¤í…ì²˜ ë° ì„¤ì¹˜</h3>

<h4 id="wazuh-ì™„ì „-ì„¤ì¹˜-ìŠ¤í¬ë¦½íŠ¸">Wazuh ì™„ì „ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/wazuh-installer.sh</span>
<span class="c"># Wazuh SIEM ì™„ì „ ìë™ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸</span>

<span class="nb">set</span> <span class="nt">-e</span>

<span class="c"># ìƒ‰ìƒ ì •ì˜</span>
<span class="nv">RED</span><span class="o">=</span><span class="s1">'\033[0;31m'</span>
<span class="nv">GREEN</span><span class="o">=</span><span class="s1">'\033[0;32m'</span>
<span class="nv">YELLOW</span><span class="o">=</span><span class="s1">'\033[1;33m'</span>
<span class="nv">BLUE</span><span class="o">=</span><span class="s1">'\033[0;34m'</span>
<span class="nv">NC</span><span class="o">=</span><span class="s1">'\033[0m'</span>

print_color<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="k">${</span><span class="nv">2</span><span class="k">}${</span><span class="nv">1</span><span class="k">}${</span><span class="nv">NC</span><span class="k">}</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># ì‹œìŠ¤í…œ ì •ë³´ í™•ì¸</span>
<span class="nv">OS_ID</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> ^ID<span class="o">=</span> /etc/os-release | <span class="nb">cut</span> <span class="nt">-d</span><span class="o">=</span> <span class="nt">-f2</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'"'</span><span class="si">)</span>
<span class="nv">OS_VERSION</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> ^VERSION_ID<span class="o">=</span> /etc/os-release | <span class="nb">cut</span> <span class="nt">-d</span><span class="o">=</span> <span class="nt">-f2</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'"'</span><span class="si">)</span>

print_color <span class="s2">"=== Wazuh SIEM Installation Started ==="</span> <span class="s2">"</span><span class="nv">$BLUE</span><span class="s2">"</span>
print_color <span class="s2">"OS: </span><span class="nv">$OS_ID</span><span class="s2"> </span><span class="nv">$OS_VERSION</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$BLUE</span><span class="s2">"</span>

<span class="c"># ì „ì œ ì¡°ê±´ í™•ì¸</span>
check_prerequisites<span class="o">()</span> <span class="o">{</span>
    print_color <span class="s2">"Checking prerequisites..."</span> <span class="s2">"</span><span class="nv">$YELLOW</span><span class="s2">"</span>
    
    <span class="c"># ìµœì†Œ ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ í™•ì¸</span>
    <span class="nv">RAM_GB</span><span class="o">=</span><span class="si">$(</span>free <span class="nt">-g</span> | <span class="nb">awk</span> <span class="s1">'/^Mem:/{print $2}'</span><span class="si">)</span>
    <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$RAM_GB</span><span class="s2">"</span> <span class="nt">-lt</span> 2 <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>print_color <span class="s2">"WARNING: Minimum 2GB RAM recommended (Current: </span><span class="k">${</span><span class="nv">RAM_GB</span><span class="k">}</span><span class="s2">GB)"</span> <span class="s2">"</span><span class="nv">$RED</span><span class="s2">"</span>
    <span class="k">fi</span>
    
    <span class="c"># ë””ìŠ¤í¬ ê³µê°„ í™•ì¸</span>
    <span class="nv">DISK_GB</span><span class="o">=</span><span class="si">$(</span><span class="nb">df</span> / | <span class="nb">awk</span> <span class="s1">'NR==2{print int($4/1048576)}'</span><span class="si">)</span>
    <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$DISK_GB</span><span class="s2">"</span> <span class="nt">-lt</span> 10 <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>print_color <span class="s2">"WARNING: Minimum 10GB disk space recommended (Available: </span><span class="k">${</span><span class="nv">DISK_GB</span><span class="k">}</span><span class="s2">GB)"</span> <span class="s2">"</span><span class="nv">$RED</span><span class="s2">"</span>
    <span class="k">fi</span>
    
    <span class="c"># ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸</span>
    <span class="k">if</span> <span class="o">!</span> ping <span class="nt">-c</span> 1 packages.wazuh.com <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
        </span>print_color <span class="s2">"ERROR: Cannot reach Wazuh repository"</span> <span class="s2">"</span><span class="nv">$RED</span><span class="s2">"</span>
        <span class="nb">exit </span>1
    <span class="k">fi
    
    </span>print_color <span class="s2">"Prerequisites check completed"</span> <span class="s2">"</span><span class="nv">$GREEN</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># Wazuh ì €ì¥ì†Œ ì¶”ê°€</span>
setup_repository<span class="o">()</span> <span class="o">{</span>
    print_color <span class="s2">"Setting up Wazuh repository..."</span> <span class="s2">"</span><span class="nv">$YELLOW</span><span class="s2">"</span>
    
    <span class="k">case</span> <span class="nv">$OS_ID</span> <span class="k">in</span>
        <span class="s2">"centos"</span><span class="p">|</span><span class="s2">"rhel"</span><span class="p">|</span><span class="s2">"fedora"</span><span class="p">)</span>
            <span class="c"># CentOS/RHEL/Fedora</span>
            rpm <span class="nt">--import</span> https://packages.wazuh.com/key/GPG-KEY-WAZUH
            <span class="nb">cat</span> <span class="o">&gt;</span> /etc/yum.repos.d/wazuh.repo <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
[wazuh]
gpgcheck=1
gpgkey=https://packages.wazuh.com/key/GPG-KEY-WAZUH
enabled=1
name=EL-</span><span class="nv">$releasever</span><span class="sh"> - Wazuh
baseurl=https://packages.wazuh.com/4.x/yum/
protect=1
</span><span class="no">EOF
</span>            <span class="p">;;</span>
            
        <span class="s2">"ubuntu"</span><span class="p">|</span><span class="s2">"debian"</span><span class="p">)</span>
            <span class="c"># Ubuntu/Debian</span>
            curl <span class="nt">-s</span> https://packages.wazuh.com/key/GPG-KEY-WAZUH | gpg <span class="nt">--no-default-keyring</span> <span class="nt">--keyring</span> gnupg-ring:/usr/share/keyrings/wazuh.gpg <span class="nt">--import</span> <span class="o">&amp;&amp;</span> <span class="nb">chmod </span>644 /usr/share/keyrings/wazuh.gpg
            <span class="nb">echo</span> <span class="s2">"deb [signed-by=/usr/share/keyrings/wazuh.gpg] https://packages.wazuh.com/4.x/apt/ stable main"</span> | <span class="nb">tee</span> <span class="nt">-a</span> /etc/apt/sources.list.d/wazuh.list
            apt-get update
            <span class="p">;;</span>
            
        <span class="k">*</span><span class="p">)</span>
            print_color <span class="s2">"Unsupported OS: </span><span class="nv">$OS_ID</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$RED</span><span class="s2">"</span>
            <span class="nb">exit </span>1
            <span class="p">;;</span>
    <span class="k">esac</span>
    
    print_color <span class="s2">"Repository setup completed"</span> <span class="s2">"</span><span class="nv">$GREEN</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># Wazuh Manager ì„¤ì¹˜</span>
install_wazuh_manager<span class="o">()</span> <span class="o">{</span>
    print_color <span class="s2">"Installing Wazuh Manager..."</span> <span class="s2">"</span><span class="nv">$YELLOW</span><span class="s2">"</span>
    
    <span class="k">case</span> <span class="nv">$OS_ID</span> <span class="k">in</span>
        <span class="s2">"centos"</span><span class="p">|</span><span class="s2">"rhel"</span><span class="p">|</span><span class="s2">"fedora"</span><span class="p">)</span>
            yum <span class="nb">install</span> <span class="nt">-y</span> wazuh-manager
            <span class="p">;;</span>
        <span class="s2">"ubuntu"</span><span class="p">|</span><span class="s2">"debian"</span><span class="p">)</span>
            apt-get <span class="nb">install</span> <span class="nt">-y</span> wazuh-manager
            <span class="p">;;</span>
    <span class="k">esac</span>
    
    <span class="c"># ì„œë¹„ìŠ¤ í™œì„±í™”</span>
    systemctl daemon-reload
    systemctl <span class="nb">enable </span>wazuh-manager
    systemctl start wazuh-manager
    
    print_color <span class="s2">"Wazuh Manager installed successfully"</span> <span class="s2">"</span><span class="nv">$GREEN</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># Wazuh API ì„¤ì¹˜ ë° ì„¤ì •</span>
install_wazuh_api<span class="o">()</span> <span class="o">{</span>
    print_color <span class="s2">"Installing and configuring Wazuh API..."</span> <span class="s2">"</span><span class="nv">$YELLOW</span><span class="s2">"</span>
    
    <span class="k">case</span> <span class="nv">$OS_ID</span> <span class="k">in</span>
        <span class="s2">"centos"</span><span class="p">|</span><span class="s2">"rhel"</span><span class="p">|</span><span class="s2">"fedora"</span><span class="p">)</span>
            yum <span class="nb">install</span> <span class="nt">-y</span> nodejs npm
            <span class="p">;;</span>
        <span class="s2">"ubuntu"</span><span class="p">|</span><span class="s2">"debian"</span><span class="p">)</span>
            apt-get <span class="nb">install</span> <span class="nt">-y</span> nodejs npm
            <span class="p">;;</span>
    <span class="k">esac</span>
    
    <span class="c"># Wazuh API ì„¤ì¹˜</span>
    <span class="k">case</span> <span class="nv">$OS_ID</span> <span class="k">in</span>
        <span class="s2">"centos"</span><span class="p">|</span><span class="s2">"rhel"</span><span class="p">|</span><span class="s2">"fedora"</span><span class="p">)</span>
            yum <span class="nb">install</span> <span class="nt">-y</span> wazuh-api
            <span class="p">;;</span>
        <span class="s2">"ubuntu"</span><span class="p">|</span><span class="s2">"debian"</span><span class="p">)</span>
            apt-get <span class="nb">install</span> <span class="nt">-y</span> wazuh-api
            <span class="p">;;</span>
    <span class="k">esac</span>
    
    <span class="c"># API ì„¤ì •</span>
    <span class="nb">cat</span> <span class="o">&gt;</span> /var/ossec/api/configuration/config.js <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
var config = {};

config.port = "55000";
config.host = "0.0.0.0";
config.https = "no";
config.basic_auth = "yes";
config.BehindProxyServer = "no";
config.cors = "yes";

module.exports = config;
</span><span class="no">EOF
    
</span>    <span class="c"># API ì‚¬ìš©ì ìƒì„±</span>
    <span class="nb">cd</span> /var/ossec/api/scripts
    ./configure_api.sh
    
    systemctl <span class="nb">enable </span>wazuh-api
    systemctl start wazuh-api
    
    print_color <span class="s2">"Wazuh API configured successfully"</span> <span class="s2">"</span><span class="nv">$GREEN</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># Elastic Stack ì„¤ì¹˜</span>
install_elastic_stack<span class="o">()</span> <span class="o">{</span>
    print_color <span class="s2">"Installing Elastic Stack..."</span> <span class="s2">"</span><span class="nv">$YELLOW</span><span class="s2">"</span>
    
    <span class="c"># Elasticsearch ì €ì¥ì†Œ ì¶”ê°€</span>
    <span class="k">case</span> <span class="nv">$OS_ID</span> <span class="k">in</span>
        <span class="s2">"centos"</span><span class="p">|</span><span class="s2">"rhel"</span><span class="p">|</span><span class="s2">"fedora"</span><span class="p">)</span>
            rpm <span class="nt">--import</span> https://artifacts.elastic.co/GPG-KEY-elasticsearch
            <span class="nb">cat</span> <span class="o">&gt;</span> /etc/yum.repos.d/elasticsearch.repo <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
[elasticsearch]
name=Elasticsearch repository for 7.x packages
baseurl=https://artifacts.elastic.co/packages/7.x/yum
gpgcheck=1
gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
enabled=0
autorefresh=1
type=rpm-md
</span><span class="no">EOF
</span>            <span class="p">;;</span>
        <span class="s2">"ubuntu"</span><span class="p">|</span><span class="s2">"debian"</span><span class="p">)</span>
            wget <span class="nt">-qO</span> - https://artifacts.elastic.co/GPG-KEY-elasticsearch | apt-key add -
            <span class="nb">echo</span> <span class="s2">"deb https://artifacts.elastic.co/packages/7.x/apt stable main"</span> | <span class="nb">tee</span> /etc/apt/sources.list.d/elastic-7.x.list
            apt-get update
            <span class="p">;;</span>
    <span class="k">esac</span>
    
    <span class="c"># Java ì„¤ì¹˜ (Elasticsearch ìš”êµ¬ì‚¬í•­)</span>
    <span class="k">case</span> <span class="nv">$OS_ID</span> <span class="k">in</span>
        <span class="s2">"centos"</span><span class="p">|</span><span class="s2">"rhel"</span><span class="p">|</span><span class="s2">"fedora"</span><span class="p">)</span>
            yum <span class="nb">install</span> <span class="nt">-y</span> java-11-openjdk
            <span class="p">;;</span>
        <span class="s2">"ubuntu"</span><span class="p">|</span><span class="s2">"debian"</span><span class="p">)</span>
            apt-get <span class="nb">install</span> <span class="nt">-y</span> openjdk-11-jdk
            <span class="p">;;</span>
    <span class="k">esac</span>
    
    <span class="c"># Elasticsearch ì„¤ì¹˜</span>
    <span class="k">case</span> <span class="nv">$OS_ID</span> <span class="k">in</span>
        <span class="s2">"centos"</span><span class="p">|</span><span class="s2">"rhel"</span><span class="p">|</span><span class="s2">"fedora"</span><span class="p">)</span>
            yum <span class="nb">install</span> <span class="nt">--enablerepo</span><span class="o">=</span>elasticsearch <span class="nt">-y</span> elasticsearch
            <span class="p">;;</span>
        <span class="s2">"ubuntu"</span><span class="p">|</span><span class="s2">"debian"</span><span class="p">)</span>
            apt-get <span class="nb">install</span> <span class="nt">-y</span> elasticsearch
            <span class="p">;;</span>
    <span class="k">esac</span>
    
    <span class="c"># Elasticsearch ì„¤ì •</span>
    <span class="nb">cat</span> <span class="o">&gt;</span> /etc/elasticsearch/elasticsearch.yml <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
cluster.name: wazuh-cluster
node.name: wazuh-node
path.data: /var/lib/elasticsearch
path.logs: /var/log/elasticsearch
network.host: localhost
http.port: 9200
cluster.initial_master_nodes: ["wazuh-node"]
</span><span class="no">EOF
    
</span>    <span class="c"># JVM í™ í¬ê¸° ì„¤ì • (ì‹œìŠ¤í…œ ë©”ëª¨ë¦¬ì˜ 50%)</span>
    <span class="nv">HEAP_SIZE</span><span class="o">=</span><span class="k">$((</span>RAM_GB <span class="o">/</span> <span class="m">2</span><span class="k">))</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$HEAP_SIZE</span> <span class="nt">-lt</span> 1 <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">HEAP_SIZE</span><span class="o">=</span>1
    <span class="k">fi
    
    </span><span class="nb">cat</span> <span class="o">&gt;</span> /etc/elasticsearch/jvm.options.d/wazuh.options <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
-Xms</span><span class="k">${</span><span class="nv">HEAP_SIZE</span><span class="k">}</span><span class="sh">g
-Xmx</span><span class="k">${</span><span class="nv">HEAP_SIZE</span><span class="k">}</span><span class="sh">g
</span><span class="no">EOF
    
</span>    systemctl daemon-reload
    systemctl <span class="nb">enable </span>elasticsearch
    systemctl start elasticsearch
    
    <span class="c"># Elasticsearch ì‹œì‘ ëŒ€ê¸°</span>
    <span class="nb">sleep </span>30
    
    <span class="c"># Kibana ì„¤ì¹˜</span>
    <span class="k">case</span> <span class="nv">$OS_ID</span> <span class="k">in</span>
        <span class="s2">"centos"</span><span class="p">|</span><span class="s2">"rhel"</span><span class="p">|</span><span class="s2">"fedora"</span><span class="p">)</span>
            yum <span class="nb">install</span> <span class="nt">--enablerepo</span><span class="o">=</span>elasticsearch <span class="nt">-y</span> kibana
            <span class="p">;;</span>
        <span class="s2">"ubuntu"</span><span class="p">|</span><span class="s2">"debian"</span><span class="p">)</span>
            apt-get <span class="nb">install</span> <span class="nt">-y</span> kibana
            <span class="p">;;</span>
    <span class="k">esac</span>
    
    <span class="c"># Kibana ì„¤ì •</span>
    <span class="nb">cat</span> <span class="o">&gt;</span> /etc/kibana/kibana.yml <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
server.port: 5601
server.host: "0.0.0.0"
elasticsearch.hosts: ["http://localhost:9200"]
logging.dest: /var/log/kibana/kibana.log
</span><span class="no">EOF
    
</span>    systemctl <span class="nb">enable </span>kibana
    systemctl start kibana
    
    print_color <span class="s2">"Elastic Stack installed successfully"</span> <span class="s2">"</span><span class="nv">$GREEN</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># Wazuh Kibana í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜</span>
install_wazuh_kibana_plugin<span class="o">()</span> <span class="o">{</span>
    print_color <span class="s2">"Installing Wazuh Kibana plugin..."</span> <span class="s2">"</span><span class="nv">$YELLOW</span><span class="s2">"</span>
    
    <span class="c"># Kibana ì •ì§€</span>
    systemctl stop kibana
    
    <span class="c"># í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜</span>
    <span class="nb">sudo</span> <span class="nt">-u</span> kibana /usr/share/kibana/bin/kibana-plugin <span class="nb">install </span>https://packages.wazuh.com/4.x/ui/kibana/wazuh_kibana-4.8.0_7.17.0-1.zip
    
    <span class="c"># Kibana ì‹œì‘</span>
    systemctl start kibana
    
    print_color <span class="s2">"Wazuh Kibana plugin installed successfully"</span> <span class="s2">"</span><span class="nv">$GREEN</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># Filebeat ì„¤ì¹˜ ë° ì„¤ì •</span>
install_filebeat<span class="o">()</span> <span class="o">{</span>
    print_color <span class="s2">"Installing and configuring Filebeat..."</span> <span class="s2">"</span><span class="nv">$YELLOW</span><span class="s2">"</span>
    
    <span class="k">case</span> <span class="nv">$OS_ID</span> <span class="k">in</span>
        <span class="s2">"centos"</span><span class="p">|</span><span class="s2">"rhel"</span><span class="p">|</span><span class="s2">"fedora"</span><span class="p">)</span>
            yum <span class="nb">install</span> <span class="nt">--enablerepo</span><span class="o">=</span>elasticsearch <span class="nt">-y</span> filebeat
            <span class="p">;;</span>
        <span class="s2">"ubuntu"</span><span class="p">|</span><span class="s2">"debian"</span><span class="p">)</span>
            apt-get <span class="nb">install</span> <span class="nt">-y</span> filebeat
            <span class="p">;;</span>
    <span class="k">esac</span>
    
    <span class="c"># Filebeat ì„¤ì •</span>
    curl <span class="nt">-so</span> /etc/filebeat/filebeat.yml https://raw.githubusercontent.com/wazuh/wazuh/4.8/extensions/filebeat/7.x/filebeat.yml
    curl <span class="nt">-so</span> /etc/filebeat/wazuh-template.json https://raw.githubusercontent.com/wazuh/wazuh/4.8/extensions/elasticsearch/7.x/wazuh-template.json
    
    <span class="c"># Wazuh ëª¨ë“ˆ ë‹¤ìš´ë¡œë“œ</span>
    curl <span class="nt">-s</span> https://packages.wazuh.com/4.x/filebeat/wazuh-filebeat-0.4.tar.gz | <span class="nb">tar</span> <span class="nt">-xvz</span> <span class="nt">-C</span> /usr/share/filebeat/module
    
    <span class="c"># Elasticsearch í…œí”Œë¦¿ ë° íŒŒì´í”„ë¼ì¸ ì„¤ì •</span>
    filebeat setup <span class="nt">--template</span>
    
    systemctl daemon-reload
    systemctl <span class="nb">enable </span>filebeat
    systemctl start filebeat
    
    print_color <span class="s2">"Filebeat configured successfully"</span> <span class="s2">"</span><span class="nv">$GREEN</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># ë°©í™”ë²½ ì„¤ì •</span>
configure_firewall<span class="o">()</span> <span class="o">{</span>
    print_color <span class="s2">"Configuring firewall..."</span> <span class="s2">"</span><span class="nv">$YELLOW</span><span class="s2">"</span>
    
    <span class="c"># í•„ìš”í•œ í¬íŠ¸ë“¤</span>
    <span class="c"># 1514/udp: Wazuh agents</span>
    <span class="c"># 1515/tcp: Wazuh agents registration</span>
    <span class="c"># 55000/tcp: Wazuh API</span>
    <span class="c"># 5601/tcp: Kibana</span>
    <span class="c"># 9200/tcp: Elasticsearch</span>
    
    <span class="k">if </span><span class="nb">command</span> <span class="nt">-v</span> ufw <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then</span>
        <span class="c"># Ubuntu UFW</span>
        ufw allow 1514/udp
        ufw allow 1515/tcp
        ufw allow 55000/tcp
        ufw allow 5601/tcp
        ufw allow 9200/tcp
    <span class="k">elif </span><span class="nb">command</span> <span class="nt">-v</span> firewall-cmd <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then</span>
        <span class="c"># CentOS/RHEL firewalld</span>
        firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-port</span><span class="o">=</span>1514/udp
        firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-port</span><span class="o">=</span>1515/tcp
        firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-port</span><span class="o">=</span>55000/tcp
        firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-port</span><span class="o">=</span>5601/tcp
        firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-port</span><span class="o">=</span>9200/tcp
        firewall-cmd <span class="nt">--reload</span>
    <span class="k">fi
    
    </span>print_color <span class="s2">"Firewall configured successfully"</span> <span class="s2">"</span><span class="nv">$GREEN</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># ì„¤ì¹˜ ê²€ì¦</span>
verify_installation<span class="o">()</span> <span class="o">{</span>
    print_color <span class="s2">"Verifying installation..."</span> <span class="s2">"</span><span class="nv">$YELLOW</span><span class="s2">"</span>
    
    <span class="c"># ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸</span>
    <span class="nv">SERVICES</span><span class="o">=(</span><span class="s2">"wazuh-manager"</span> <span class="s2">"wazuh-api"</span> <span class="s2">"elasticsearch"</span> <span class="s2">"kibana"</span> <span class="s2">"filebeat"</span><span class="o">)</span>
    
    <span class="k">for </span>service <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">SERVICES</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
        if </span>systemctl is-active <span class="nt">--quiet</span> <span class="s2">"</span><span class="nv">$service</span><span class="s2">"</span><span class="p">;</span> <span class="k">then
            </span>print_color <span class="s2">"âœ“ </span><span class="nv">$service</span><span class="s2"> is running"</span> <span class="s2">"</span><span class="nv">$GREEN</span><span class="s2">"</span>
        <span class="k">else
            </span>print_color <span class="s2">"âœ— </span><span class="nv">$service</span><span class="s2"> is not running"</span> <span class="s2">"</span><span class="nv">$RED</span><span class="s2">"</span>
        <span class="k">fi
    done</span>
    
    <span class="c"># í¬íŠ¸ í™•ì¸</span>
    print_color <span class="s2">"</span><span class="se">\n</span><span class="s2">Port status:"</span> <span class="s2">"</span><span class="nv">$BLUE</span><span class="s2">"</span>
    ss <span class="nt">-tlnp</span> | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s1">':(1514|1515|5601|9200|55000)'</span>
    
    <span class="c"># Wazuh ì—ì´ì „íŠ¸ í‚¤ ìƒì„± ì˜ˆì œ</span>
    print_color <span class="s2">"</span><span class="se">\n</span><span class="s2">Generating example agent key..."</span> <span class="s2">"</span><span class="nv">$YELLOW</span><span class="s2">"</span>
    /var/ossec/bin/manage_agents <span class="nt">-a</span> <span class="nt">-n</span> example-agent <span class="nt">-i</span> 001
    
    print_color <span class="s2">"</span><span class="se">\n</span><span class="s2">=== Installation Summary ==="</span> <span class="s2">"</span><span class="nv">$BLUE</span><span class="s2">"</span>
    <span class="nb">echo</span> <span class="s2">"Wazuh Manager: http://</span><span class="si">$(</span><span class="nb">hostname</span> <span class="nt">-I</span> | <span class="nb">awk</span> <span class="s1">'{print $1}'</span><span class="si">)</span><span class="s2">:55000"</span>
    <span class="nb">echo</span> <span class="s2">"Kibana Dashboard: http://</span><span class="si">$(</span><span class="nb">hostname</span> <span class="nt">-I</span> | <span class="nb">awk</span> <span class="s1">'{print $1}'</span><span class="si">)</span><span class="s2">:5601"</span>
    <span class="nb">echo</span> <span class="s2">"Elasticsearch: http://</span><span class="si">$(</span><span class="nb">hostname</span> <span class="nt">-I</span> | <span class="nb">awk</span> <span class="s1">'{print $1}'</span><span class="si">)</span><span class="s2">:9200"</span>
    <span class="nb">echo</span> <span class="s2">""</span>
    <span class="nb">echo</span> <span class="s2">"Default credentials:"</span>
    <span class="nb">echo</span> <span class="s2">"- Wazuh API: admin / admin"</span>
    <span class="nb">echo</span> <span class="s2">"- Change default passwords immediately!"</span>
<span class="o">}</span>

<span class="c"># ë©”ì¸ ì„¤ì¹˜ í”„ë¡œì„¸ìŠ¤</span>
main<span class="o">()</span> <span class="o">{</span>
    check_prerequisites
    setup_repository
    install_wazuh_manager
    install_wazuh_api
    install_elastic_stack
    install_wazuh_kibana_plugin
    install_filebeat
    configure_firewall
    verify_installation
    
    print_color <span class="s2">"</span><span class="se">\n</span><span class="s2">ğŸ‰ Wazuh SIEM installation completed successfully!"</span> <span class="s2">"</span><span class="nv">$GREEN</span><span class="s2">"</span>
    print_color <span class="s2">"Access Kibana at: http://</span><span class="si">$(</span><span class="nb">hostname</span> <span class="nt">-I</span> | <span class="nb">awk</span> <span class="s1">'{print $1}'</span><span class="si">)</span><span class="s2">:5601"</span> <span class="s2">"</span><span class="nv">$BLUE</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰</span>
<span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"</span><span class="k">${</span><span class="nv">0</span><span class="k">}</span><span class="s2">"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
    </span>main <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<span class="k">fi</span>
</code></pre></div></div>

<h3 id="ï¸-wazuh-ê³ ê¸‰-ì„¤ì •-ë°-ê·œì¹™">ğŸ›¡ï¸ Wazuh ê³ ê¸‰ ì„¤ì • ë° ê·œì¹™</h3>

<h4 id="ì»¤ìŠ¤í…€-ë³´ì•ˆ-ë£°-ì‘ì„±">ì»¤ìŠ¤í…€ ë³´ì•ˆ ë£° ì‘ì„±</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /var/ossec/etc/rules/local_rules.xml</span>
<span class="c"># Wazuh ì»¤ìŠ¤í…€ ë³´ì•ˆ ë£°</span>

&lt;group <span class="nv">name</span><span class="o">=</span><span class="s2">"local,syslog,"</span><span class="o">&gt;</span>

  &lt;<span class="o">!</span><span class="nt">--</span> ì»¤ìŠ¤í…€ SSH ê³µê²© íƒì§€ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100001"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"10"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;5720&lt;/if_sid&gt;
    &lt;match&gt;^Failed|^error: PAM: Authentication failure&lt;/match&gt;
    &lt;description&gt;SSH authentication failure.&lt;/description&gt;
    &lt;group&gt;authentication_failed,pci_dss_10.2.4,pci_dss_10.2.5,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100002"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"12"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;100001&lt;/if_sid&gt;
    &lt;same_source_ip /&gt;
    &lt;description&gt;SSH brute force attack detected <span class="o">(</span>multiple authentication failures<span class="o">)</span>.&lt;/description&gt;
    &lt;mitre&gt;
      &lt;<span class="nb">id</span><span class="o">&gt;</span>T1110&lt;/id&gt;
    &lt;/mitre&gt;
    &lt;group&gt;authentication_failures,pci_dss_10.2.4,pci_dss_10.2.5,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;<span class="o">!</span><span class="nt">--</span> ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê³µê²© íƒì§€ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100010"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"6"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;31100&lt;/if_sid&gt;
    &lt;url&gt;admin|wp-admin|phpmyadmin|cpanel&lt;/url&gt;
    &lt;description&gt;Attempt to access sensitive web directories.&lt;/description&gt;
    &lt;group&gt;web,accesslog,attack,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100011"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"8"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;31100&lt;/if_sid&gt;
    &lt;url&gt;<span class="se">\.</span>php<span class="se">\?</span>|<span class="se">\.</span>asp<span class="se">\?</span>|<span class="se">\.</span>jsp<span class="se">\?</span>&lt;/url&gt;
    &lt;description&gt;Potential web application vulnerability scan.&lt;/description&gt;
    &lt;group&gt;web,accesslog,attack,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100012"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"10"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;31100&lt;/if_sid&gt;
    &lt;url&gt;union.<span class="k">*select</span>|concat<span class="se">\(</span>|exec<span class="se">\(</span>|system<span class="se">\(</span>&lt;/url&gt;
    &lt;description&gt;SQL injection attempt detected.&lt;/description&gt;
    &lt;mitre&gt;
      &lt;<span class="nb">id</span><span class="o">&gt;</span>T1190&lt;/id&gt;
    &lt;/mitre&gt;
    &lt;group&gt;web,accesslog,attack,sql_injection,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;<span class="o">!</span><span class="nt">--</span> íŒŒì¼ ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100020"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"7"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;550&lt;/if_sid&gt;
    &lt;field <span class="nv">name</span><span class="o">=</span><span class="s2">"file"</span><span class="o">&gt;</span>/etc/passwd|/etc/shadow|/etc/group&lt;/field&gt;
    &lt;description&gt;Critical system file modified.&lt;/description&gt;
    &lt;group&gt;syscheck,pci_dss_11.5,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100021"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"12"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;554&lt;/if_sid&gt;
    &lt;field <span class="nv">name</span><span class="o">=</span><span class="s2">"file"</span><span class="o">&gt;</span>/bin/|/sbin/|/usr/bin/&lt;/field&gt;
    &lt;description&gt;System binary file modified or deleted - possible rootkit.&lt;/description&gt;
    &lt;mitre&gt;
      &lt;<span class="nb">id</span><span class="o">&gt;</span>T1014&lt;/id&gt;
    &lt;/mitre&gt;
    &lt;group&gt;syscheck,rootkit,pci_dss_11.5,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;<span class="o">!</span><span class="nt">--</span> ë„¤íŠ¸ì›Œí¬ ê³µê²© íƒì§€ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100030"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"8"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;4386&lt;/if_sid&gt;
    &lt;regex&gt;DPT<span class="o">=(</span>22|23|21|25|53|80|110|143|443|993|995|3389<span class="o">)</span>&lt;/regex&gt;
    &lt;description&gt;Port scan detected on critical services.&lt;/description&gt;
    &lt;group&gt;recon,pci_dss_11.4,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100031"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"10"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;100030&lt;/if_sid&gt;
    &lt;same_source_ip /&gt;
    &lt;description&gt;Multiple port scan attempts from same source.&lt;/description&gt;
    &lt;mitre&gt;
      &lt;<span class="nb">id</span><span class="o">&gt;</span>T1046&lt;/id&gt;
    &lt;/mitre&gt;
    &lt;group&gt;recon,pci_dss_11.4,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;<span class="o">!</span><span class="nt">--</span> ì•…ì„±ì½”ë“œ ë° ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í”„ë¡œì„¸ìŠ¤ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100040"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"12"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;530&lt;/if_sid&gt;
    &lt;match&gt;nc <span class="nt">-l</span>|ncat <span class="nt">-l</span>|/dev/tcp|/dev/udp&lt;/match&gt;
    &lt;description&gt;Potential reverse shell or backdoor detected.&lt;/description&gt;
    &lt;mitre&gt;
      &lt;<span class="nb">id</span><span class="o">&gt;</span>T1059&lt;/id&gt;
    &lt;/mitre&gt;
    &lt;group&gt;attack,malware,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100041"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"10"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;530&lt;/if_sid&gt;
    &lt;match&gt;wget.<span class="k">*</span><span class="se">\.</span><span class="o">(</span>sh|py|pl<span class="o">)</span>|curl.<span class="k">*</span><span class="se">\.</span><span class="o">(</span>sh|py|pl<span class="o">)</span>&lt;/match&gt;
    &lt;description&gt;Suspicious script download detected.&lt;/description&gt;
    &lt;group&gt;attack,malware,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;<span class="o">!</span><span class="nt">--</span> ê¶Œí•œ ìƒìŠ¹ íƒì§€ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100050"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"8"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;5401&lt;/if_sid&gt;
    &lt;user&gt;root&lt;/user&gt;
    &lt;description&gt;Successful <span class="nb">sudo </span>to root.&lt;/description&gt;
    &lt;group&gt;privilege_escalation,pci_dss_10.2.2,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100051"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"12"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;5402&lt;/if_sid&gt;
    &lt;same_user /&gt;
    &lt;description&gt;Multiple failed <span class="nb">sudo </span>attempts by same user.&lt;/description&gt;
    &lt;mitre&gt;
      &lt;<span class="nb">id</span><span class="o">&gt;</span>T1548&lt;/id&gt;
    &lt;/mitre&gt;
    &lt;group&gt;privilege_escalation,pci_dss_10.2.2,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;<span class="o">!</span><span class="nt">--</span> ë°ì´í„° ìœ ì¶œ ê°ì§€ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100060"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"10"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;31100&lt;/if_sid&gt;
    &lt;status&gt;200&lt;/status&gt;
    &lt;size&gt;1048576&lt;/size&gt;
    &lt;description&gt;Large file download detected - potential data exfiltration.&lt;/description&gt;
    &lt;group&gt;web,data_exfiltration,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100061"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"8"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;530&lt;/if_sid&gt;
    &lt;match&gt;scp.<span class="k">*</span><span class="nt">-r</span>|rsync.<span class="k">*</span><span class="nt">-r</span>|tar.<span class="k">*</span><span class="nt">-c</span>&lt;/match&gt;
    &lt;description&gt;Bulk data transfer <span class="nb">command </span>detected.&lt;/description&gt;
    &lt;group&gt;data_exfiltration,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;<span class="o">!</span><span class="nt">--</span> ì»¨í…Œì´ë„ˆ ë³´ì•ˆ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100070"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"10"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;530&lt;/if_sid&gt;
    &lt;match&gt;docker.<span class="k">*</span><span class="nt">--privileged</span>|docker.<span class="k">*</span><span class="nt">--cap-add</span>&lt;/match&gt;
    &lt;description&gt;Privileged container execution detected.&lt;/description&gt;
    &lt;group&gt;docker,container_security,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100071"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"8"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;530&lt;/if_sid&gt;
    &lt;match&gt;kubectl.<span class="k">*</span>create|kubectl.<span class="k">*</span>apply&lt;/match&gt;
    &lt;description&gt;Kubernetes resource creation detected.&lt;/description&gt;
    &lt;group&gt;kubernetes,container_security,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;<span class="o">!</span><span class="nt">--</span> ë¡œê·¸ ë³€ì¡° íƒì§€ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100080"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"12"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;530&lt;/if_sid&gt;
    &lt;match&gt;rm.<span class="k">*</span>log|truncate.<span class="k">*</span>log|&gt;.<span class="k">*</span>log&lt;/match&gt;
    &lt;description&gt;Log file manipulation detected.&lt;/description&gt;
    &lt;mitre&gt;
      &lt;<span class="nb">id</span><span class="o">&gt;</span>T1070.002&lt;/id&gt;
    &lt;/mitre&gt;
    &lt;group&gt;log_tampering,attack,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;<span class="o">!</span><span class="nt">--</span> ì•”í˜¸í™”í ì±„êµ´ íƒì§€ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100090"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"10"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;530&lt;/if_sid&gt;
    &lt;match&gt;xmrig|cpuminer|minerd|ccminer&lt;/match&gt;
    &lt;description&gt;Cryptocurrency mining activity detected.&lt;/description&gt;
    &lt;group&gt;malware,cryptomining,&lt;/group&gt;
  &lt;/rule&gt;

  &lt;<span class="o">!</span><span class="nt">--</span> ì»´í”Œë¼ì´ì–¸ìŠ¤ ê´€ë ¨ ì´ë²¤íŠ¸ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;rule <span class="nb">id</span><span class="o">=</span><span class="s2">"100100"</span> <span class="nv">level</span><span class="o">=</span><span class="s2">"5"</span><span class="o">&gt;</span>
    &lt;if_sid&gt;5501&lt;/if_sid&gt;
    &lt;user&gt;audit&lt;/user&gt;
    &lt;description&gt;Audit log access detected.&lt;/description&gt;
    &lt;group&gt;audit,compliance,pci_dss_10.2.3,&lt;/group&gt;
  &lt;/rule&gt;

&lt;/group&gt;
</code></pre></div></div>

<h4 id="ê³ ê¸‰-ë””ì½”ë”-ì„¤ì •">ê³ ê¸‰ ë””ì½”ë” ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /var/ossec/etc/decoders/local_decoder.xml</span>
<span class="c"># Wazuh ì»¤ìŠ¤í…€ ë””ì½”ë”</span>

&lt;decoder <span class="nv">name</span><span class="o">=</span><span class="s2">"custom-ssh"</span><span class="o">&gt;</span>
  &lt;parent&gt;sshd&lt;/parent&gt;
  &lt;regex&gt;Failed password <span class="k">for</span> <span class="o">(</span><span class="se">\S</span>+<span class="o">)</span> from <span class="o">(</span><span class="se">\d</span>+.<span class="se">\d</span>+.<span class="se">\d</span>+.<span class="se">\d</span>+<span class="o">)</span> port <span class="o">(</span><span class="se">\d</span>+<span class="o">)</span>&lt;/regex&gt;
  &lt;order&gt;user,srcip,srcport&lt;/order&gt;
&lt;/decoder&gt;

&lt;decoder <span class="nv">name</span><span class="o">=</span><span class="s2">"custom-apache-error"</span><span class="o">&gt;</span>
  &lt;parent&gt;apache-errorlog&lt;/parent&gt;
  &lt;regex&gt;<span class="se">\[</span><span class="o">(</span><span class="se">\w</span>+ <span class="se">\w</span>+ <span class="se">\d</span>+ <span class="se">\d</span>+:<span class="se">\d</span>+:<span class="se">\d</span>+ <span class="se">\d</span>+<span class="o">)</span><span class="se">\]</span> <span class="se">\[</span><span class="o">(</span><span class="se">\w</span>+<span class="o">)</span><span class="se">\]</span> <span class="o">(</span><span class="se">\S</span>+<span class="o">)</span>: <span class="o">(</span>.+<span class="o">)</span>, referer: <span class="o">(</span><span class="se">\S</span>+<span class="o">)</span>&lt;/regex&gt;
  &lt;order&gt;timestamp,level,client,message,referer&lt;/order&gt;
&lt;/decoder&gt;

&lt;decoder <span class="nv">name</span><span class="o">=</span><span class="s2">"custom-mysql"</span><span class="o">&gt;</span>
  &lt;parent&gt;mysql_log&lt;/parent&gt;
  &lt;regex&gt;<span class="o">(</span><span class="se">\d</span>+<span class="o">)</span> Connect<span class="se">\s</span>+Access denied <span class="k">for </span>user <span class="s1">'(\S+)'</span>@<span class="s1">'(\S+)'</span>&lt;/regex&gt;
  &lt;order&gt;id,user,srcip&lt;/order&gt;
&lt;/decoder&gt;

&lt;decoder <span class="nv">name</span><span class="o">=</span><span class="s2">"custom-docker"</span><span class="o">&gt;</span>
  &lt;parent&gt;json&lt;/parent&gt;
  &lt;regex&gt;<span class="s2">"container_name"</span>:<span class="s2">"([^"</span><span class="o">]</span>+<span class="o">)</span><span class="s2">"&lt;/regex&gt;
  &lt;order&gt;container_name&lt;/order&gt;
&lt;/decoder&gt;

&lt;decoder name="</span>custom-kubernetes<span class="s2">"&gt;
  &lt;parent&gt;json&lt;/parent&gt;
  &lt;regex&gt;"</span>verb<span class="s2">":"</span><span class="o">(</span><span class="se">\S</span>+<span class="o">)</span><span class="s2">","</span>user<span class="s2">":{"</span>username<span class="s2">":"</span><span class="o">([</span>^<span class="s2">"]+)"</span><span class="o">}</span>&lt;/regex&gt;
  &lt;order&gt;verb,username&lt;/order&gt;
&lt;/decoder&gt;
</code></pre></div></div>

<h3 id="-wazuh-ìë™í™”-ë°-ëŒ€ì‘">ğŸ“Š Wazuh ìë™í™” ë° ëŒ€ì‘</h3>

<h4 id="ìë™-ëŒ€ì‘-ìŠ¤í¬ë¦½íŠ¸">ìë™ ëŒ€ì‘ ìŠ¤í¬ë¦½íŠ¸</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># /var/ossec/active-response/bin/custom-response.sh</span>
<span class="c"># Wazuh ìë™ ëŒ€ì‘ ìŠ¤í¬ë¦½íŠ¸</span>

<span class="c"># ì…ë ¥ íŒŒë¼ë¯¸í„° ì½ê¸°</span>
<span class="nv">LOCAL</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$0</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">'/'</span> <span class="nt">-f4</span><span class="sb">`</span>
<span class="nv">PWD</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
<span class="nb">read </span>INPUT_JSON

<span class="c"># JSON íŒŒì‹± í•¨ìˆ˜</span>
get_json_value<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$INPUT_JSON</span><span class="s2">"</span> | python3 <span class="nt">-c</span> <span class="s2">"
import sys, json
data = json.load(sys.stdin)
print(data.get('</span><span class="nv">$1</span><span class="s2">', ''))
"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">echo</span> <span class="s2">""</span>
<span class="o">}</span>

<span class="c"># ë¡œê·¸ í•¨ìˆ˜</span>
log_message<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span> <span class="s1">'+%Y-%m-%d %H:%M:%S'</span><span class="si">)</span><span class="s2"> - </span><span class="nv">$1</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /var/ossec/logs/active-responses.log
<span class="o">}</span>

<span class="c"># ì•¡ì…˜ ë° ë§¤ê°œë³€ìˆ˜ ì¶”ì¶œ</span>
<span class="nv">ACTION</span><span class="o">=</span><span class="si">$(</span>get_json_value <span class="s2">"command"</span><span class="si">)</span>
<span class="nv">SRCIP</span><span class="o">=</span><span class="si">$(</span>get_json_value <span class="s2">"parameters.alert.data.srcip"</span><span class="si">)</span>
<span class="nv">RULE_ID</span><span class="o">=</span><span class="si">$(</span>get_json_value <span class="s2">"parameters.alert.rule.id"</span><span class="si">)</span>
<span class="nv">USERNAME</span><span class="o">=</span><span class="si">$(</span>get_json_value <span class="s2">"parameters.alert.data.user"</span><span class="si">)</span>
<span class="nv">FILENAME</span><span class="o">=</span><span class="si">$(</span>get_json_value <span class="s2">"parameters.alert.syscheck.path"</span><span class="si">)</span>

log_message <span class="s2">"Active response triggered: Action=</span><span class="nv">$ACTION</span><span class="s2">, Rule=</span><span class="nv">$RULE_ID</span><span class="s2">, SrcIP=</span><span class="nv">$SRCIP</span><span class="s2">"</span>

<span class="k">case</span> <span class="nv">$ACTION</span> <span class="k">in</span>
    <span class="s2">"ban-ip"</span><span class="p">)</span>
        <span class="c"># IP ì°¨ë‹¨</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$SRCIP</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
            <span class="c"># iptables ì°¨ë‹¨</span>
            iptables <span class="nt">-I</span> INPUT <span class="nt">-s</span> <span class="s2">"</span><span class="nv">$SRCIP</span><span class="s2">"</span> <span class="nt">-j</span> DROP
            
            <span class="c"># Fail2Ban ì°¨ë‹¨ (Fail2Banì´ ì„¤ì¹˜ëœ ê²½ìš°)</span>
            <span class="k">if </span><span class="nb">command</span> <span class="nt">-v</span> fail2ban-client <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
                </span>fail2ban-client <span class="nb">set </span>sshd banip <span class="s2">"</span><span class="nv">$SRCIP</span><span class="s2">"</span>
            <span class="k">fi
            
            </span>log_message <span class="s2">"IP </span><span class="nv">$SRCIP</span><span class="s2"> banned successfully"</span>
            
            <span class="c"># ì•Œë¦¼ ë°œì†¡</span>
            /usr/local/bin/send-alert.sh <span class="s2">"IP Banned"</span> <span class="s2">"IP </span><span class="nv">$SRCIP</span><span class="s2"> has been banned due to rule </span><span class="nv">$RULE_ID</span><span class="s2">"</span>
        <span class="k">fi</span>
        <span class="p">;;</span>
        
    <span class="s2">"disable-user"</span><span class="p">)</span>
        <span class="c"># ì‚¬ìš©ì ê³„ì • ë¹„í™œì„±í™”</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$USERNAME</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span>usermod <span class="nt">-L</span> <span class="s2">"</span><span class="nv">$USERNAME</span><span class="s2">"</span>
            log_message <span class="s2">"User </span><span class="nv">$USERNAME</span><span class="s2"> disabled due to suspicious activity"</span>
            
            <span class="c"># í™œì„± ì„¸ì…˜ ì¢…ë£Œ</span>
            pkill <span class="nt">-u</span> <span class="s2">"</span><span class="nv">$USERNAME</span><span class="s2">"</span>
            
            <span class="c"># ì•Œë¦¼ ë°œì†¡</span>
            /usr/local/bin/send-alert.sh <span class="s2">"User Disabled"</span> <span class="s2">"User </span><span class="nv">$USERNAME</span><span class="s2"> has been disabled due to rule </span><span class="nv">$RULE_ID</span><span class="s2">"</span>
        <span class="k">fi</span>
        <span class="p">;;</span>
        
    <span class="s2">"quarantine-file"</span><span class="p">)</span>
        <span class="c"># íŒŒì¼ ê²©ë¦¬</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$FILENAME</span><span class="s2">"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$FILENAME</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nv">QUARANTINE_DIR</span><span class="o">=</span><span class="s2">"/var/ossec/quarantine/</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span><span class="s2">"</span>
            <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$QUARANTINE_DIR</span><span class="s2">"</span>
            
            <span class="c"># íŒŒì¼ ì´ë™</span>
            <span class="nb">mv</span> <span class="s2">"</span><span class="nv">$FILENAME</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$QUARANTINE_DIR</span><span class="s2">/"</span>
            log_message <span class="s2">"File </span><span class="nv">$FILENAME</span><span class="s2"> quarantined to </span><span class="nv">$QUARANTINE_DIR</span><span class="s2">"</span>
            
            <span class="c"># ì•Œë¦¼ ë°œì†¡</span>
            /usr/local/bin/send-alert.sh <span class="s2">"File Quarantined"</span> <span class="s2">"File </span><span class="nv">$FILENAME</span><span class="s2"> has been quarantined due to rule </span><span class="nv">$RULE_ID</span><span class="s2">"</span>
        <span class="k">fi</span>
        <span class="p">;;</span>
        
    <span class="s2">"restart-service"</span><span class="p">)</span>
        <span class="c"># ì„œë¹„ìŠ¤ ì¬ì‹œì‘</span>
        <span class="nv">SERVICE</span><span class="o">=</span><span class="si">$(</span>get_json_value <span class="s2">"parameters.service"</span><span class="si">)</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$SERVICE</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span>systemctl restart <span class="s2">"</span><span class="nv">$SERVICE</span><span class="s2">"</span>
            log_message <span class="s2">"Service </span><span class="nv">$SERVICE</span><span class="s2"> restarted due to rule </span><span class="nv">$RULE_ID</span><span class="s2">"</span>
            
            <span class="c"># ì•Œë¦¼ ë°œì†¡</span>
            /usr/local/bin/send-alert.sh <span class="s2">"Service Restarted"</span> <span class="s2">"Service </span><span class="nv">$SERVICE</span><span class="s2"> has been restarted due to rule </span><span class="nv">$RULE_ID</span><span class="s2">"</span>
        <span class="k">fi</span>
        <span class="p">;;</span>
        
    <span class="s2">"collect-evidence"</span><span class="p">)</span>
        <span class="c"># ì¦ê±° ìˆ˜ì§‘</span>
        <span class="nv">EVIDENCE_DIR</span><span class="o">=</span><span class="s2">"/var/ossec/evidence/</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d-%H%M%S<span class="si">)</span><span class="s2">-rule</span><span class="nv">$RULE_ID</span><span class="s2">"</span>
        <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$EVIDENCE_DIR</span><span class="s2">"</span>
        
        <span class="c"># ì‹œìŠ¤í…œ ì •ë³´ ìˆ˜ì§‘</span>
        ps aux <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$EVIDENCE_DIR</span><span class="s2">/processes.txt"</span>
        netstat <span class="nt">-tlnp</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$EVIDENCE_DIR</span><span class="s2">/network.txt"</span>
        ss <span class="nt">-tlnp</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$EVIDENCE_DIR</span><span class="s2">/sockets.txt"</span>
        last <span class="nt">-n</span> 50 <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$EVIDENCE_DIR</span><span class="s2">/logins.txt"</span>
        
        <span class="c"># ë¡œê·¸ íŒŒì¼ ë³µì‚¬</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$SRCIP</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">grep</span> <span class="s2">"</span><span class="nv">$SRCIP</span><span class="s2">"</span> /var/log/auth.log <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$EVIDENCE_DIR</span><span class="s2">/auth-logs.txt"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
            grep</span> <span class="s2">"</span><span class="nv">$SRCIP</span><span class="s2">"</span> /var/log/apache2/access.log <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$EVIDENCE_DIR</span><span class="s2">/web-logs.txt"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
        </span><span class="k">fi</span>
        
        <span class="c"># ë©”ëª¨ë¦¬ ë¤í”„ (ì„ íƒì‚¬í•­)</span>
        <span class="k">if </span><span class="nb">command</span> <span class="nt">-v</span> memdump <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
            </span>memdump <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$EVIDENCE_DIR</span><span class="s2">/memory.dump"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
        </span><span class="k">fi
        
        </span>log_message <span class="s2">"Evidence collected in </span><span class="nv">$EVIDENCE_DIR</span><span class="s2">"</span>
        <span class="p">;;</span>
        
    <span class="k">*</span><span class="p">)</span>
        log_message <span class="s2">"Unknown action: </span><span class="nv">$ACTION</span><span class="s2">"</span>
        <span class="p">;;</span>
<span class="k">esac</span>

<span class="c"># ì„±ê³µ ìƒíƒœ ë°˜í™˜</span>
<span class="nb">exit </span>0
</code></pre></div></div>

<h4 id="ì•Œë¦¼-ì‹œìŠ¤í…œ-êµ¬ì¶•">ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬ì¶•</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/send-alert.sh</span>
<span class="c"># ë‹¤ì¤‘ ì±„ë„ ì•Œë¦¼ ì‹œìŠ¤í…œ</span>

<span class="nv">SUBJECT</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
<span class="nv">MESSAGE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span>
<span class="nv">SEVERITY</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">3</span><span class="k">:-</span><span class="nv">medium</span><span class="k">}</span><span class="s2">"</span>

<span class="c"># ì„¤ì • íŒŒì¼ ë¡œë“œ</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> /etc/wazuh/alert-config.conf <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">source</span> /etc/wazuh/alert-config.conf
<span class="k">fi</span>

<span class="c"># ê¸°ë³¸ ì„¤ì •</span>
<span class="nv">EMAIL_TO</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">EMAIL_TO</span><span class="k">:-</span><span class="nv">admin</span><span class="p">@example.com</span><span class="k">}</span><span class="s2">"</span>
<span class="nv">SLACK_WEBHOOK</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">SLACK_WEBHOOK</span><span class="k">:-}</span><span class="s2">"</span>
<span class="nv">DISCORD_WEBHOOK</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">DISCORD_WEBHOOK</span><span class="k">:-}</span><span class="s2">"</span>
<span class="nv">SMS_API_KEY</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">SMS_API_KEY</span><span class="k">:-}</span><span class="s2">"</span>
<span class="nv">SMS_TO</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">SMS_TO</span><span class="k">:-}</span><span class="s2">"</span>

<span class="c"># ë¡œê·¸ í•¨ìˆ˜</span>
log_alert<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span> <span class="s1">'+%Y-%m-%d %H:%M:%S'</span><span class="si">)</span><span class="s2"> - [</span><span class="nv">$SEVERITY</span><span class="s2">] </span><span class="nv">$SUBJECT</span><span class="s2">: </span><span class="nv">$MESSAGE</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /var/log/wazuh-alerts.log
<span class="o">}</span>

<span class="c"># ì´ë©”ì¼ ë°œì†¡</span>
send_email<span class="o">()</span> <span class="o">{</span>
    <span class="k">if </span><span class="nb">command</span> <span class="nt">-v</span> mail <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$MESSAGE</span><span class="s2">"</span> | mail <span class="nt">-s</span> <span class="s2">"Wazuh Alert: </span><span class="nv">$SUBJECT</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$EMAIL_TO</span><span class="s2">"</span>
        <span class="nb">echo</span> <span class="s2">"Email sent to </span><span class="nv">$EMAIL_TO</span><span class="s2">"</span>
    <span class="k">fi</span>
<span class="o">}</span>

<span class="c"># Slack ì•Œë¦¼</span>
send_slack<span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$SLACK_WEBHOOK</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="c"># ì‹¬ê°ë„ì— ë”°ë¥¸ ìƒ‰ìƒ</span>
        <span class="k">case</span> <span class="nv">$SEVERITY</span> <span class="k">in</span>
            <span class="s2">"high"</span><span class="p">|</span><span class="s2">"critical"</span><span class="p">)</span>
                <span class="nv">COLOR</span><span class="o">=</span><span class="s2">"danger"</span>
                <span class="nv">EMOJI</span><span class="o">=</span><span class="s2">"ğŸš¨"</span>
                <span class="p">;;</span>
            <span class="s2">"medium"</span><span class="p">)</span>
                <span class="nv">COLOR</span><span class="o">=</span><span class="s2">"warning"</span>
                <span class="nv">EMOJI</span><span class="o">=</span><span class="s2">"âš ï¸"</span>
                <span class="p">;;</span>
            <span class="k">*</span><span class="p">)</span>
                <span class="nv">COLOR</span><span class="o">=</span><span class="s2">"good"</span>
                <span class="nv">EMOJI</span><span class="o">=</span><span class="s2">"â„¹ï¸"</span>
                <span class="p">;;</span>
        <span class="k">esac</span>
        
        <span class="nv">PAYLOAD</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
{
    "text": "</span><span class="nv">$EMOJI</span><span class="sh"> Wazuh Security Alert",
    "attachments": [
        {
            "color": "</span><span class="nv">$COLOR</span><span class="sh">",
            "fields": [
                {
                    "title": "Alert",
                    "value": "</span><span class="nv">$SUBJECT</span><span class="sh">",
                    "short": true
                },
                {
                    "title": "Severity",
                    "value": "</span><span class="nv">$SEVERITY</span><span class="sh">",
                    "short": true
                },
                {
                    "title": "Details",
                    "value": "</span><span class="nv">$MESSAGE</span><span class="sh">",
                    "short": false
                },
                {
                    "title": "Timestamp",
                    "value": "</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="sh">",
                    "short": true
                },
                {
                    "title": "Host",
                    "value": "</span><span class="si">$(</span><span class="nb">hostname</span><span class="si">)</span><span class="sh">",
                    "short": true
                }
            ]
        }
    ]
}
</span><span class="no">EOF
</span>        <span class="si">)</span>
        
        curl <span class="nt">-X</span> POST <span class="nt">-H</span> <span class="s1">'Content-type: application/json'</span> <span class="se">\</span>
             <span class="nt">--data</span> <span class="s2">"</span><span class="nv">$PAYLOAD</span><span class="s2">"</span> <span class="se">\</span>
             <span class="s2">"</span><span class="nv">$SLACK_WEBHOOK</span><span class="s2">"</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1
        
        <span class="nb">echo</span> <span class="s2">"Slack notification sent"</span>
    <span class="k">fi</span>
<span class="o">}</span>

<span class="c"># Discord ì•Œë¦¼</span>
send_discord<span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$DISCORD_WEBHOOK</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">PAYLOAD</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
{
    "username": "Wazuh Security Bot",
    "embeds": [
        {
            "title": "ğŸ›¡ï¸ Security Alert: </span><span class="nv">$SUBJECT</span><span class="sh">",
            "description": "</span><span class="nv">$MESSAGE</span><span class="sh">",
            "color": 15158332,
            "fields": [
                {
                    "name": "Severity",
                    "value": "</span><span class="nv">$SEVERITY</span><span class="sh">",
                    "inline": true
                },
                {
                    "name": "Host",
                    "value": "</span><span class="si">$(</span><span class="nb">hostname</span><span class="si">)</span><span class="sh">",
                    "inline": true
                },
                {
                    "name": "Timestamp",
                    "value": "</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="sh">",
                    "inline": false
                }
            ]
        }
    ]
}
</span><span class="no">EOF
</span>        <span class="si">)</span>
        
        curl <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
             <span class="nt">-X</span> POST <span class="se">\</span>
             <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$PAYLOAD</span><span class="s2">"</span> <span class="se">\</span>
             <span class="s2">"</span><span class="nv">$DISCORD_WEBHOOK</span><span class="s2">"</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1
        
        <span class="nb">echo</span> <span class="s2">"Discord notification sent"</span>
    <span class="k">fi</span>
<span class="o">}</span>

<span class="c"># SMS ë°œì†¡ (Twilio API ì˜ˆì œ)</span>
send_sms<span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$SMS_API_KEY</span><span class="s2">"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$SMS_TO</span><span class="s2">"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$SEVERITY</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"critical"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">SMS_MESSAGE</span><span class="o">=</span><span class="s2">"Wazuh CRITICAL Alert: </span><span class="nv">$SUBJECT</span><span class="s2"> on </span><span class="si">$(</span><span class="nb">hostname</span><span class="si">)</span><span class="s2">"</span>
        
        curl <span class="nt">-X</span> POST https://api.twilio.com/2010-04-01/Accounts/<span class="nv">$TWILIO_SID</span>/Messages.json <span class="se">\</span>
             <span class="nt">--data-urlencode</span> <span class="s2">"To=</span><span class="nv">$SMS_TO</span><span class="s2">"</span> <span class="se">\</span>
             <span class="nt">--data-urlencode</span> <span class="s2">"From=</span><span class="nv">$TWILIO_FROM</span><span class="s2">"</span> <span class="se">\</span>
             <span class="nt">--data-urlencode</span> <span class="s2">"Body=</span><span class="nv">$SMS_MESSAGE</span><span class="s2">"</span> <span class="se">\</span>
             <span class="nt">-u</span> <span class="s2">"</span><span class="nv">$TWILIO_SID</span><span class="s2">:</span><span class="nv">$SMS_API_KEY</span><span class="s2">"</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1
        
        <span class="nb">echo</span> <span class="s2">"SMS notification sent"</span>
    <span class="k">fi</span>
<span class="o">}</span>

<span class="c"># ë©”ì¸ ì‹¤í–‰</span>
main<span class="o">()</span> <span class="o">{</span>
    log_alert
    
    <span class="c"># ì‹¬ê°ë„ì— ë”°ë¥¸ ì•Œë¦¼ ì±„ë„ ì„ íƒ</span>
    <span class="k">case</span> <span class="nv">$SEVERITY</span> <span class="k">in</span>
        <span class="s2">"critical"</span><span class="p">)</span>
            send_email
            send_slack
            send_discord
            send_sms
            <span class="p">;;</span>
        <span class="s2">"high"</span><span class="p">)</span>
            send_email
            send_slack
            send_discord
            <span class="p">;;</span>
        <span class="s2">"medium"</span><span class="p">)</span>
            send_slack
            <span class="p">;;</span>
        <span class="s2">"low"</span><span class="p">)</span>
            log_alert  <span class="c"># ë¡œê·¸ë§Œ ê¸°ë¡</span>
            <span class="p">;;</span>
    <span class="k">esac</span>
<span class="o">}</span>

main
</code></pre></div></div>

<h2 id="docker-ì»¨í…Œì´ë„ˆ-ë³´ì•ˆ--docker-container-security">Docker ì»¨í…Œì´ë„ˆ ë³´ì•ˆ | Docker Container Security</h2>

<h3 id="-docker-ë³´ì•ˆ-ê°•í™”">ğŸ³ Docker ë³´ì•ˆ ê°•í™”</h3>

<h4 id="í¬ê´„ì ì¸-docker-ë³´ì•ˆ-ì„¤ì •">í¬ê´„ì ì¸ Docker ë³´ì•ˆ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/docker-security-hardening.sh</span>
<span class="c"># Docker ë³´ì•ˆ ê°•í™” ìŠ¤í¬ë¦½íŠ¸</span>

<span class="nb">set</span> <span class="nt">-e</span>

print_status<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span> <span class="s1">'+%Y-%m-%d %H:%M:%S'</span><span class="si">)</span><span class="s2"> - </span><span class="nv">$1</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># Docker ë°ëª¬ ë³´ì•ˆ ì„¤ì •</span>
configure_docker_daemon<span class="o">()</span> <span class="o">{</span>
    print_status <span class="s2">"Configuring Docker daemon security..."</span>
    
    <span class="c"># Docker ë°ëª¬ ì„¤ì • íŒŒì¼ ìƒì„±</span>
    <span class="nb">mkdir</span> <span class="nt">-p</span> /etc/docker
    
    <span class="nb">cat</span> <span class="o">&gt;</span> /etc/docker/daemon.json <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
{
    "icc": false,
    "userns-remap": "default",
    "live-restore": true,
    "userland-proxy": false,
    "no-new-privileges": true,
    "log-driver": "json-file",
    "log-opts": {
        "max-size": "10m",
        "max-file": "3"
    },
    "storage-driver": "overlay2",
    "storage-opts": [
        "overlay2.override_kernel_check=true"
    ],
    "default-ulimits": {
        "nofile": {
            "Hard": 64000,
            "Name": "nofile",
            "Soft": 64000
        }
    },
    "disable-legacy-registry": true,
    "experimental": false,
    "metrics-addr": "127.0.0.1:9323",
    "insecure-registries": []
}
</span><span class="no">EOF
    
</span>    <span class="c"># Docker ì„œë¹„ìŠ¤ ì¬ì‹œì‘</span>
    systemctl restart docker
    print_status <span class="s2">"Docker daemon configured successfully"</span>
<span class="o">}</span>

<span class="c"># Docker ì»¨í…Œì´ë„ˆ ê¸°ë³¸ ë³´ì•ˆ í”„ë¡œíŒŒì¼</span>
create_security_profiles<span class="o">()</span> <span class="o">{</span>
    print_status <span class="s2">"Creating security profiles..."</span>
    
    <span class="c"># AppArmor í”„ë¡œíŒŒì¼ ìƒì„±</span>
    <span class="k">if </span><span class="nb">command</span> <span class="nt">-v</span> aa-status <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
        </span><span class="nb">cat</span> <span class="o">&gt;</span> /etc/apparmor.d/docker-default-secure <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
#include &lt;tunables/global&gt;

profile docker-default-secure flags=(attach_disconnected,mediate_deleted) {
  #include &lt;abstractions/base&gt;
  
  # ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ ì œí•œ
  network inet tcp,
  network inet udp,
  network inet6 tcp,
  network inet6 udp,
  network netlink raw,
  
  # íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼ ì œí•œ
  deny /etc/passwd r,
  deny /etc/shadow r,
  deny /etc/group r,
  deny /etc/gshadow r,
  deny /proc/sys/** w,
  deny /sys/** w,
  
  # íŠ¹ê¶Œ ìƒìŠ¹ ë°©ì§€
  deny capability sys_admin,
  deny capability sys_module,
  deny capability sys_rawio,
  deny capability sys_pacct,
  deny capability sys_nice,
  deny capability sys_resource,
  deny capability sys_time,
  deny capability sys_tty_config,
  deny capability mknod,
  deny capability audit_write,
  deny capability audit_control,
  deny capability mac_override,
  deny capability mac_admin,
  deny capability net_admin,
  deny capability syslog,
  deny capability wake_alarm,
  deny capability block_suspend,
  
  # í—ˆìš©ëœ capabilityë“¤
  capability chown,
  capability dac_override,
  capability fowner,
  capability fsetid,
  capability kill,
  capability setgid,
  capability setuid,
  capability setpcap,
  capability linux_immutable,
  capability net_bind_service,
  capability net_broadcast,
  capability net_raw,
  capability ipc_lock,
  capability ipc_owner,
  capability sys_chroot,
  capability sys_ptrace,
  capability lease,
  capability audit_read,
}
</span><span class="no">EOF
        
</span>        apparmor_parser <span class="nt">-r</span> /etc/apparmor.d/docker-default-secure
    <span class="k">fi</span>
    
    <span class="c"># Seccomp í”„ë¡œíŒŒì¼ ìƒì„±</span>
    <span class="nb">cat</span> <span class="o">&gt;</span> /etc/docker/seccomp-profile.json <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
{
    "defaultAction": "SCMP_ACT_ERRNO",
    "archMap": [
        {
            "architecture": "SCMP_ARCH_X86_64",
            "subArchitectures": [
                "SCMP_ARCH_X86",
                "SCMP_ARCH_X32"
            ]
        }
    ],
    "syscalls": [
        {
            "names": [
                "accept",
                "accept4", 
                "access",
                "adjtimex",
                "alarm",
                "bind",
                "brk",
                "chdir",
                "chmod",
                "chown",
                "chroot",
                "clock_getres",
                "clock_gettime",
                "clone",
                "close",
                "connect",
                "dup",
                "dup2",
                "dup3",
                "epoll_create",
                "epoll_create1",
                "epoll_ctl",
                "epoll_wait",
                "eventfd",
                "eventfd2",
                "execve",
                "exit",
                "exit_group",
                "fcntl",
                "fstat",
                "futex",
                "getcwd",
                "getdents",
                "getdents64",
                "getegid",
                "geteuid",
                "getgid",
                "getgroups",
                "getpeername",
                "getpgrp",
                "getpid",
                "getppid",
                "getrlimit",
                "getsid",
                "getsockname",
                "getsockopt",
                "gettid",
                "gettimeofday",
                "getuid",
                "listen",
                "lseek",
                "lstat",
                "madvise",
                "mmap",
                "mprotect",
                "munmap",
                "nanosleep",
                "open",
                "openat",
                "pause",
                "pipe",
                "pipe2",
                "poll",
                "ppoll",
                "prctl",
                "read",
                "recv",
                "recvfrom",
                "recvmsg",
                "rt_sigaction",
                "rt_sigprocmask",
                "rt_sigreturn",
                "sched_getaffinity",
                "sched_yield",
                "select",
                "send",
                "sendmsg",
                "sendto",
                "setgid",
                "setgroups",
                "setrlimit",
                "setsid",
                "setsockopt",
                "setuid",
                "shutdown",
                "sigaltstack",
                "socket",
                "socketpair",
                "stat",
                "statfs",
                "sysinfo",
                "time",
                "uname",
                "unlink",
                "unlinkat",
                "wait4",
                "waitpid",
                "write"
            ],
            "action": "SCMP_ACT_ALLOW"
        }
    ]
}
</span><span class="no">EOF
    
</span>    print_status <span class="s2">"Security profiles created successfully"</span>
<span class="o">}</span>

<span class="c"># Docker ì´ë¯¸ì§€ ë³´ì•ˆ ìŠ¤ìºë„ˆ ì„¤ì¹˜</span>
install_image_scanner<span class="o">()</span> <span class="o">{</span>
    print_status <span class="s2">"Installing Docker image security scanner..."</span>
    
    <span class="c"># Trivy ì„¤ì¹˜</span>
    <span class="k">if</span> <span class="o">!</span> <span class="nb">command</span> <span class="nt">-v</span> trivy <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
        case</span> <span class="si">$(</span><span class="nb">uname</span> <span class="nt">-m</span><span class="si">)</span> <span class="k">in
            </span>x86_64<span class="p">)</span>
                <span class="nv">ARCH</span><span class="o">=</span><span class="s2">"64bit"</span>
                <span class="p">;;</span>
            aarch64<span class="p">)</span>
                <span class="nv">ARCH</span><span class="o">=</span><span class="s2">"ARM64"</span>
                <span class="p">;;</span>
            <span class="k">*</span><span class="p">)</span>
                print_status <span class="s2">"Unsupported architecture for Trivy"</span>
                <span class="k">return </span>1
                <span class="p">;;</span>
        <span class="k">esac</span>
        
        <span class="nv">VERSION</span><span class="o">=</span><span class="si">$(</span>curl <span class="nt">-s</span> <span class="s2">"https://api.github.com/repos/aquasecurity/trivy/releases/latest"</span> | <span class="nb">grep</span> <span class="s1">'"tag_name":'</span> | <span class="nb">sed</span> <span class="nt">-E</span> <span class="s1">'s/.*"([^"]+)".*/\1/'</span><span class="si">)</span>
        wget <span class="nt">-q</span> <span class="s2">"https://github.com/aquasecurity/trivy/releases/download/</span><span class="k">${</span><span class="nv">VERSION</span><span class="k">}</span><span class="s2">/trivy_</span><span class="k">${</span><span class="nv">VERSION</span><span class="p">#v</span><span class="k">}</span><span class="s2">_Linux-</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">.tar.gz"</span>
        <span class="nb">tar</span> <span class="nt">-xzf</span> <span class="s2">"trivy_</span><span class="k">${</span><span class="nv">VERSION</span><span class="p">#v</span><span class="k">}</span><span class="s2">_Linux-</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">.tar.gz"</span>
        <span class="nb">mv </span>trivy /usr/local/bin/
        <span class="nb">rm</span> <span class="nt">-f</span> <span class="s2">"trivy_</span><span class="k">${</span><span class="nv">VERSION</span><span class="p">#v</span><span class="k">}</span><span class="s2">_Linux-</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">.tar.gz"</span>
    <span class="k">fi
    
    </span>print_status <span class="s2">"Trivy installed successfully"</span>
<span class="o">}</span>

<span class="c"># Docker ì»´í¬ì¦ˆ ë³´ì•ˆ í…œí”Œë¦¿</span>
create_secure_compose_template<span class="o">()</span> <span class="o">{</span>
    print_status <span class="s2">"Creating secure Docker Compose template..."</span>
    
    <span class="nb">cat</span> <span class="o">&gt;</span> /usr/local/share/docker-compose-secure-template.yml <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
version: '3.8'

# ë³´ì•ˆ ê°•í™”ëœ Docker Compose í…œí”Œë¦¿
services:
  app:
    image: your-app:latest
    
    # ë³´ì•ˆ ì„¤ì •
    read_only: true                    # ë£¨íŠ¸ íŒŒì¼ì‹œìŠ¤í…œ ì½ê¸° ì „ìš©
    cap_drop:                         # ëª¨ë“  capabilities ì œê±°
      - ALL
    cap_add:                          # í•„ìš”í•œ capabilitiesë§Œ ì¶”ê°€
      - NET_BIND_SERVICE
    
    # ë¦¬ì†ŒìŠ¤ ì œí•œ
    mem_limit: 512m
    memswap_limit: 512m
    cpu_count: 1
    pids_limit: 100
    
    # ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ
    networks:
      - app-network
    ports:
      - "8080:8080"
    
    # í™˜ê²½ ë³€ìˆ˜ (secrets ì‚¬ìš© ê¶Œì¥)
    environment:
      - NODE_ENV=production
    
    # ë³¼ë¥¨ ë§ˆìš´íŠ¸ (ìµœì†Œí•œìœ¼ë¡œ)
    volumes:
      - app-data:/app/data
      - /tmp:/tmp:rw,noexec,nosuid,nodev
    
    # ë³´ì•ˆ ì˜µì…˜
    security_opt:
      - no-new-privileges:true
      - apparmor:docker-default-secure
      - seccomp:/etc/docker/seccomp-profile.json
    
    # ì¬ì‹œì‘ ì •ì±…
    restart: unless-stopped
    
    # í—¬ìŠ¤ì²´í¬
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    
    # ë¡œê·¸ ì„¤ì •
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤ ì˜ˆì œ
  database:
    image: postgres:13-alpine
    
    # ë³´ì•ˆ ì„¤ì •
    read_only: true
    cap_drop:
      - ALL
    cap_add:
      - SETUID
      - SETGID
      - DAC_OVERRIDE
    
    # ë¦¬ì†ŒìŠ¤ ì œí•œ
    mem_limit: 1g
    memswap_limit: 1g
    
    # í™˜ê²½ ë³€ìˆ˜
    environment:
      POSTGRES_DB_FILE: /run/secrets/postgres_db
      POSTGRES_USER_FILE: /run/secrets/postgres_user
      POSTGRES_PASSWORD_FILE: /run/secrets/postgres_password
    
    # Secrets ì‚¬ìš©
    secrets:
      - postgres_db
      - postgres_user
      - postgres_password
    
    # ë³¼ë¥¨ ì„¤ì •
    volumes:
      - postgres-data:/var/lib/postgresql/data
      - /tmp:/tmp:rw,noexec,nosuid,nodev
    
    # ë„¤íŠ¸ì›Œí¬
    networks:
      - db-network
    
    # ë³´ì•ˆ ì˜µì…˜
    security_opt:
      - no-new-privileges:true
    
    # í—¬ìŠ¤ì²´í¬
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 30s
      timeout: 10s
      retries: 5

# ë„¤íŠ¸ì›Œí¬ ì •ì˜
networks:
  app-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16
  db-network:
    driver: bridge
    internal: true                    # ì™¸ë¶€ ì ‘ê·¼ ì°¨ë‹¨

# ë³¼ë¥¨ ì •ì˜
volumes:
  app-data:
    driver: local
  postgres-data:
    driver: local

# Secrets ì •ì˜
secrets:
  postgres_db:
    file: ./secrets/postgres_db.txt
  postgres_user:
    file: ./secrets/postgres_user.txt
  postgres_password:
    file: ./secrets/postgres_password.txt
</span><span class="no">EOF
    
</span>    print_status <span class="s2">"Secure Docker Compose template created"</span>
<span class="o">}</span>

<span class="c"># Docker ë³´ì•ˆ ìŠ¤ìº” ìŠ¤í¬ë¦½íŠ¸</span>
create_security_scanner<span class="o">()</span> <span class="o">{</span>
    print_status <span class="s2">"Creating Docker security scanner..."</span>
    
    <span class="nb">cat</span> <span class="o">&gt;</span> /usr/local/bin/docker-security-scan.sh <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
#!/bin/bash
# Docker ë³´ì•ˆ ìŠ¤ìº” ìŠ¤í¬ë¦½íŠ¸

IMAGE=</span><span class="nv">$1</span><span class="sh">
REPORT_DIR="/var/log/docker-security-scans"
TIMESTAMP=</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d-%H%M%S<span class="si">)</span><span class="sh">

if [ -z "</span><span class="nv">$IMAGE</span><span class="sh">" ]; then
    echo "Usage: </span><span class="nv">$0</span><span class="sh"> &lt;image-name&gt;"
    exit 1
fi

mkdir -p "</span><span class="nv">$REPORT_DIR</span><span class="sh">"

echo "Starting security scan for image: </span><span class="nv">$IMAGE</span><span class="sh">"

# Trivy ì·¨ì•½ì  ìŠ¤ìº”
echo "Running Trivy vulnerability scan..."
trivy image --format json --output "</span><span class="nv">$REPORT_DIR</span><span class="sh">/trivy-</span><span class="nv">$TIMESTAMP</span><span class="sh">.json" "</span><span class="nv">$IMAGE</span><span class="sh">"
trivy image --format table "</span><span class="nv">$IMAGE</span><span class="sh">" | tee "</span><span class="nv">$REPORT_DIR</span><span class="sh">/trivy-</span><span class="nv">$TIMESTAMP</span><span class="sh">.txt"

# Docker Bench ë³´ì•ˆ ìŠ¤ìº” (ì„¤ì¹˜ëœ ê²½ìš°)
if command -v docker-bench-security &gt;/dev/null 2&gt;&amp;1; then
    echo "Running Docker Bench security check..."
    docker-bench-security &gt; "</span><span class="nv">$REPORT_DIR</span><span class="sh">/docker-bench-</span><span class="nv">$TIMESTAMP</span><span class="sh">.txt"
fi

# ì´ë¯¸ì§€ íˆìŠ¤í† ë¦¬ ë¶„ì„
echo "Analyzing image history..."
docker history --no-trunc "</span><span class="nv">$IMAGE</span><span class="sh">" &gt; "</span><span class="nv">$REPORT_DIR</span><span class="sh">/history-</span><span class="nv">$TIMESTAMP</span><span class="sh">.txt"

# ì´ë¯¸ì§€ êµ¬ì„± í™•ì¸
echo "Checking image configuration..."
docker inspect "</span><span class="nv">$IMAGE</span><span class="sh">" &gt; "</span><span class="nv">$REPORT_DIR</span><span class="sh">/inspect-</span><span class="nv">$TIMESTAMP</span><span class="sh">.json"

# ë³´ì•ˆ ê¶Œê³ ì‚¬í•­ ì²´í¬
echo "Checking security best practices..."
{
    echo "=== Security Check Results ==="
    echo "Image: </span><span class="nv">$IMAGE</span><span class="sh">"
    echo "Scan Date: </span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="sh">"
    echo ""
    
    # ë£¨íŠ¸ ì‚¬ìš©ì ì²´í¬
    if docker inspect "</span><span class="nv">$IMAGE</span><span class="sh">" | grep -q '"User": ""'; then
        echo "âŒ FAIL: Image runs as root user"
    else
        echo "âœ… PASS: Image does not run as root"
    fi
    
    # ë¶ˆí•„ìš”í•œ íŒ¨í‚¤ì§€ ì²´í¬
    echo ""
    echo "=== Package Analysis ==="
    docker run --rm "</span><span class="nv">$IMAGE</span><span class="sh">" sh -c 'which wget curl nc netcat' 2&gt;/dev/null | while read tool; do
        if [ -n "</span><span class="nv">$tool</span><span class="sh">" ]; then
            echo "âš ï¸  WARNING: Found potentially dangerous tool: </span><span class="nv">$tool</span><span class="sh">"
        fi
    done
    
} &gt; "</span><span class="nv">$REPORT_DIR</span><span class="sh">/security-check-</span><span class="nv">$TIMESTAMP</span><span class="sh">.txt"

echo "Security scan completed. Reports saved in: </span><span class="nv">$REPORT_DIR</span><span class="sh">"
</span><span class="no">EOF
    
</span>    <span class="nb">chmod</span> +x /usr/local/bin/docker-security-scan.sh
    print_status <span class="s2">"Docker security scanner created"</span>
<span class="o">}</span>

<span class="c"># ë©”ì¸ ì‹¤í–‰</span>
main<span class="o">()</span> <span class="o">{</span>
    print_status <span class="s2">"Starting Docker security hardening..."</span>
    
    configure_docker_daemon
    create_security_profiles
    install_image_scanner
    create_secure_compose_template
    create_security_scanner
    
    print_status <span class="s2">"Docker security hardening completed successfully!"</span>
    
    <span class="nb">echo</span> <span class="s2">""</span>
    <span class="nb">echo</span> <span class="s2">"Next steps:"</span>
    <span class="nb">echo</span> <span class="s2">"1. Review Docker daemon configuration in /etc/docker/daemon.json"</span>
    <span class="nb">echo</span> <span class="s2">"2. Use secure Docker Compose template: /usr/local/share/docker-compose-secure-template.yml"</span>
    <span class="nb">echo</span> <span class="s2">"3. Scan images with: /usr/local/bin/docker-security-scan.sh &lt;image-name&gt;"</span>
    <span class="nb">echo</span> <span class="s2">"4. Apply security profiles to containers"</span>
<span class="o">}</span>

main <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
</code></pre></div></div>

<h2 id="ë‹¤ìŒ-í¸-ì˜ˆê³ ">ë‹¤ìŒ í¸ ì˜ˆê³ </h2>

<p>ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” <strong>Kubernetes ë³´ì•ˆê³¼ ì»´í”Œë¼ì´ì–¸ìŠ¤</strong>ë¥¼ ìƒì„¸íˆ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤:</p>
<ul>
  <li>Kubernetes í´ëŸ¬ìŠ¤í„° ë³´ì•ˆ ê°•í™”</li>
  <li>Pod Security Standards ë° ì •ì±…</li>
  <li>Network Policyì™€ Service Mesh ë³´ì•ˆ</li>
  <li>ì»´í”Œë¼ì´ì–¸ìŠ¤ ìë™í™” ë° ê°ì‚¬</li>
</ul>

<p>Wazuh SIEMê³¼ Docker ë³´ì•ˆìœ¼ë¡œ ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ë³´ì•ˆ ì¸í”„ë¼ë¥¼ ì™„ì„±í•˜ì…¨ë‚˜ìš”? ğŸ”ğŸ³ğŸ›¡ï¸</p>]]></content><author><name>DevOps Engineer</name></author><category term="Security" /><category term="Linux" /><category term="wazuh" /><category term="siem" /><category term="container-security" /><category term="docker" /><category term="kubernetes" /><category term="compliance" /><category term="threat-detection" /><category term="log-analysis" /><summary type="html"><![CDATA[ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆì˜ ìµœì¢… ì™„ì„± ë‹¨ê³„ì¸ Wazuh SIEM êµ¬ì¶•ê³¼ ì»¨í…Œì´ë„ˆ ë³´ì•ˆì„ ì™„ì „íˆ ë§ˆìŠ¤í„°í•´ë³´ê² ìŠµë‹ˆë‹¤. ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ë¶€í„° ìµœì‹  ì»¨í…Œì´ë„ˆ í™˜ê²½ ë³´ì•ˆê¹Œì§€, ì°¨ì„¸ëŒ€ ë³´ì•ˆ ì¸í”„ë¼ë¥¼ êµ¬ì¶•í•˜ëŠ” ëª¨ë“  ê²ƒì„ ë‹¤ë£¹ë‹ˆë‹¤. Wazuh SIEM ì™„ì „ êµ¬ì¶• | Complete Wazuh SIEM Implementation ğŸ” Wazuh ì•„í‚¤í…ì²˜ ë° ì„¤ì¹˜ Wazuh ì™„ì „ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # /usr/local/bin/wazuh-installer.sh # Wazuh SIEM ì™„ì „ ìë™ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ set -e # ìƒ‰ìƒ ì •ì˜ RED='\033[0;31m' GREEN='\033[0;32m' YELLOW='\033[1;33m' BLUE='\033[0;34m' NC='\033[0m' print_color() { echo -e "${2}${1}${NC}" } # ì‹œìŠ¤í…œ ì •ë³´ í™•ì¸ OS_ID=$(grep ^ID= /etc/os-release | cut -d= -f2 | tr -d '"') OS_VERSION=$(grep ^VERSION_ID= /etc/os-release | cut -d= -f2 | tr -d '"') print_color "=== Wazuh SIEM Installation Started ===" "$BLUE" print_color "OS: $OS_ID $OS_VERSION" "$BLUE" # ì „ì œ ì¡°ê±´ í™•ì¸ check_prerequisites() { print_color "Checking prerequisites..." "$YELLOW" # ìµœì†Œ ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ í™•ì¸ RAM_GB=$(free -g | awk '/^Mem:/{print $2}') if [ "$RAM_GB" -lt 2 ]; then print_color "WARNING: Minimum 2GB RAM recommended (Current: ${RAM_GB}GB)" "$RED" fi # ë””ìŠ¤í¬ ê³µê°„ í™•ì¸ DISK_GB=$(df / | awk 'NR==2{print int($4/1048576)}') if [ "$DISK_GB" -lt 10 ]; then print_color "WARNING: Minimum 10GB disk space recommended (Available: ${DISK_GB}GB)" "$RED" fi # ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸ if ! ping -c 1 packages.wazuh.com &gt;/dev/null 2&gt;&amp;1; then print_color "ERROR: Cannot reach Wazuh repository" "$RED" exit 1 fi print_color "Prerequisites check completed" "$GREEN" } # Wazuh ì €ì¥ì†Œ ì¶”ê°€ setup_repository() { print_color "Setting up Wazuh repository..." "$YELLOW" case $OS_ID in "centos"|"rhel"|"fedora") # CentOS/RHEL/Fedora rpm --import https://packages.wazuh.com/key/GPG-KEY-WAZUH cat &gt; /etc/yum.repos.d/wazuh.repo &lt;&lt; 'EOF' [wazuh] gpgcheck=1 gpgkey=https://packages.wazuh.com/key/GPG-KEY-WAZUH enabled=1 name=EL-$releasever - Wazuh baseurl=https://packages.wazuh.com/4.x/yum/ protect=1 EOF ;; "ubuntu"|"debian") # Ubuntu/Debian curl -s https://packages.wazuh.com/key/GPG-KEY-WAZUH | gpg --no-default-keyring --keyring gnupg-ring:/usr/share/keyrings/wazuh.gpg --import &amp;&amp; chmod 644 /usr/share/keyrings/wazuh.gpg echo "deb [signed-by=/usr/share/keyrings/wazuh.gpg] https://packages.wazuh.com/4.x/apt/ stable main" | tee -a /etc/apt/sources.list.d/wazuh.list apt-get update ;; *) print_color "Unsupported OS: $OS_ID" "$RED" exit 1 ;; esac print_color "Repository setup completed" "$GREEN" } # Wazuh Manager ì„¤ì¹˜ install_wazuh_manager() { print_color "Installing Wazuh Manager..." "$YELLOW" case $OS_ID in "centos"|"rhel"|"fedora") yum install -y wazuh-manager ;; "ubuntu"|"debian") apt-get install -y wazuh-manager ;; esac # ì„œë¹„ìŠ¤ í™œì„±í™” systemctl daemon-reload systemctl enable wazuh-manager systemctl start wazuh-manager print_color "Wazuh Manager installed successfully" "$GREEN" } # Wazuh API ì„¤ì¹˜ ë° ì„¤ì • install_wazuh_api() { print_color "Installing and configuring Wazuh API..." "$YELLOW" case $OS_ID in "centos"|"rhel"|"fedora") yum install -y nodejs npm ;; "ubuntu"|"debian") apt-get install -y nodejs npm ;; esac # Wazuh API ì„¤ì¹˜ case $OS_ID in "centos"|"rhel"|"fedora") yum install -y wazuh-api ;; "ubuntu"|"debian") apt-get install -y wazuh-api ;; esac # API ì„¤ì • cat &gt; /var/ossec/api/configuration/config.js &lt;&lt; 'EOF' var config = {}; config.port = "55000"; config.host = "0.0.0.0"; config.https = "no"; config.basic_auth = "yes"; config.BehindProxyServer = "no"; config.cors = "yes"; module.exports = config; EOF # API ì‚¬ìš©ì ìƒì„± cd /var/ossec/api/scripts ./configure_api.sh systemctl enable wazuh-api systemctl start wazuh-api print_color "Wazuh API configured successfully" "$GREEN" } # Elastic Stack ì„¤ì¹˜ install_elastic_stack() { print_color "Installing Elastic Stack..." "$YELLOW" # Elasticsearch ì €ì¥ì†Œ ì¶”ê°€ case $OS_ID in "centos"|"rhel"|"fedora") rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch cat &gt; /etc/yum.repos.d/elasticsearch.repo &lt;&lt; 'EOF' [elasticsearch] name=Elasticsearch repository for 7.x packages baseurl=https://artifacts.elastic.co/packages/7.x/yum gpgcheck=1 gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch enabled=0 autorefresh=1 type=rpm-md EOF ;; "ubuntu"|"debian") wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | apt-key add - echo "deb https://artifacts.elastic.co/packages/7.x/apt stable main" | tee /etc/apt/sources.list.d/elastic-7.x.list apt-get update ;; esac # Java ì„¤ì¹˜ (Elasticsearch ìš”êµ¬ì‚¬í•­) case $OS_ID in "centos"|"rhel"|"fedora") yum install -y java-11-openjdk ;; "ubuntu"|"debian") apt-get install -y openjdk-11-jdk ;; esac # Elasticsearch ì„¤ì¹˜ case $OS_ID in "centos"|"rhel"|"fedora") yum install --enablerepo=elasticsearch -y elasticsearch ;; "ubuntu"|"debian") apt-get install -y elasticsearch ;; esac # Elasticsearch ì„¤ì • cat &gt; /etc/elasticsearch/elasticsearch.yml &lt;&lt; 'EOF' cluster.name: wazuh-cluster node.name: wazuh-node path.data: /var/lib/elasticsearch path.logs: /var/log/elasticsearch network.host: localhost http.port: 9200 cluster.initial_master_nodes: ["wazuh-node"] EOF # JVM í™ í¬ê¸° ì„¤ì • (ì‹œìŠ¤í…œ ë©”ëª¨ë¦¬ì˜ 50%) HEAP_SIZE=$((RAM_GB / 2)) if [ $HEAP_SIZE -lt 1 ]; then HEAP_SIZE=1 fi cat &gt; /etc/elasticsearch/jvm.options.d/wazuh.options &lt;&lt; EOF -Xms${HEAP_SIZE}g -Xmx${HEAP_SIZE}g EOF systemctl daemon-reload systemctl enable elasticsearch systemctl start elasticsearch # Elasticsearch ì‹œì‘ ëŒ€ê¸° sleep 30 # Kibana ì„¤ì¹˜ case $OS_ID in "centos"|"rhel"|"fedora") yum install --enablerepo=elasticsearch -y kibana ;; "ubuntu"|"debian") apt-get install -y kibana ;; esac # Kibana ì„¤ì • cat &gt; /etc/kibana/kibana.yml &lt;&lt; 'EOF' server.port: 5601 server.host: "0.0.0.0" elasticsearch.hosts: ["http://localhost:9200"] logging.dest: /var/log/kibana/kibana.log EOF systemctl enable kibana systemctl start kibana print_color "Elastic Stack installed successfully" "$GREEN" } # Wazuh Kibana í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ install_wazuh_kibana_plugin() { print_color "Installing Wazuh Kibana plugin..." "$YELLOW" # Kibana ì •ì§€ systemctl stop kibana # í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ sudo -u kibana /usr/share/kibana/bin/kibana-plugin install https://packages.wazuh.com/4.x/ui/kibana/wazuh_kibana-4.8.0_7.17.0-1.zip # Kibana ì‹œì‘ systemctl start kibana print_color "Wazuh Kibana plugin installed successfully" "$GREEN" } # Filebeat ì„¤ì¹˜ ë° ì„¤ì • install_filebeat() { print_color "Installing and configuring Filebeat..." "$YELLOW" case $OS_ID in "centos"|"rhel"|"fedora") yum install --enablerepo=elasticsearch -y filebeat ;; "ubuntu"|"debian") apt-get install -y filebeat ;; esac # Filebeat ì„¤ì • curl -so /etc/filebeat/filebeat.yml https://raw.githubusercontent.com/wazuh/wazuh/4.8/extensions/filebeat/7.x/filebeat.yml curl -so /etc/filebeat/wazuh-template.json https://raw.githubusercontent.com/wazuh/wazuh/4.8/extensions/elasticsearch/7.x/wazuh-template.json # Wazuh ëª¨ë“ˆ ë‹¤ìš´ë¡œë“œ curl -s https://packages.wazuh.com/4.x/filebeat/wazuh-filebeat-0.4.tar.gz | tar -xvz -C /usr/share/filebeat/module # Elasticsearch í…œí”Œë¦¿ ë° íŒŒì´í”„ë¼ì¸ ì„¤ì • filebeat setup --template systemctl daemon-reload systemctl enable filebeat systemctl start filebeat print_color "Filebeat configured successfully" "$GREEN" } # ë°©í™”ë²½ ì„¤ì • configure_firewall() { print_color "Configuring firewall..." "$YELLOW" # í•„ìš”í•œ í¬íŠ¸ë“¤ # 1514/udp: Wazuh agents # 1515/tcp: Wazuh agents registration # 55000/tcp: Wazuh API # 5601/tcp: Kibana # 9200/tcp: Elasticsearch if command -v ufw &gt;/dev/null 2&gt;&amp;1; then # Ubuntu UFW ufw allow 1514/udp ufw allow 1515/tcp ufw allow 55000/tcp ufw allow 5601/tcp ufw allow 9200/tcp elif command -v firewall-cmd &gt;/dev/null 2&gt;&amp;1; then # CentOS/RHEL firewalld firewall-cmd --permanent --add-port=1514/udp firewall-cmd --permanent --add-port=1515/tcp firewall-cmd --permanent --add-port=55000/tcp firewall-cmd --permanent --add-port=5601/tcp firewall-cmd --permanent --add-port=9200/tcp firewall-cmd --reload fi print_color "Firewall configured successfully" "$GREEN" } # ì„¤ì¹˜ ê²€ì¦ verify_installation() { print_color "Verifying installation..." "$YELLOW" # ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸ SERVICES=("wazuh-manager" "wazuh-api" "elasticsearch" "kibana" "filebeat") for service in "${SERVICES[@]}"; do if systemctl is-active --quiet "$service"; then print_color "âœ“ $service is running" "$GREEN" else print_color "âœ— $service is not running" "$RED" fi done # í¬íŠ¸ í™•ì¸ print_color "\nPort status:" "$BLUE" ss -tlnp | grep -E ':(1514|1515|5601|9200|55000)' # Wazuh ì—ì´ì „íŠ¸ í‚¤ ìƒì„± ì˜ˆì œ print_color "\nGenerating example agent key..." "$YELLOW" /var/ossec/bin/manage_agents -a -n example-agent -i 001 print_color "\n=== Installation Summary ===" "$BLUE" echo "Wazuh Manager: http://$(hostname -I | awk '{print $1}'):55000" echo "Kibana Dashboard: http://$(hostname -I | awk '{print $1}'):5601" echo "Elasticsearch: http://$(hostname -I | awk '{print $1}'):9200" echo "" echo "Default credentials:" echo "- Wazuh API: admin / admin" echo "- Change default passwords immediately!" } # ë©”ì¸ ì„¤ì¹˜ í”„ë¡œì„¸ìŠ¤ main() { check_prerequisites setup_repository install_wazuh_manager install_wazuh_api install_elastic_stack install_wazuh_kibana_plugin install_filebeat configure_firewall verify_installation print_color "\nğŸ‰ Wazuh SIEM installation completed successfully!" "$GREEN" print_color "Access Kibana at: http://$(hostname -I | awk '{print $1}'):5601" "$BLUE" } # ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then main "$@" fi ğŸ›¡ï¸ Wazuh ê³ ê¸‰ ì„¤ì • ë° ê·œì¹™ ì»¤ìŠ¤í…€ ë³´ì•ˆ ë£° ì‘ì„± # /var/ossec/etc/rules/local_rules.xml # Wazuh ì»¤ìŠ¤í…€ ë³´ì•ˆ ë£° &lt;group name="local,syslog,"&gt; &lt;!-- ì»¤ìŠ¤í…€ SSH ê³µê²© íƒì§€ --&gt; &lt;rule id="100001" level="10"&gt; &lt;if_sid&gt;5720&lt;/if_sid&gt; &lt;match&gt;^Failed|^error: PAM: Authentication failure&lt;/match&gt; &lt;description&gt;SSH authentication failure.&lt;/description&gt; &lt;group&gt;authentication_failed,pci_dss_10.2.4,pci_dss_10.2.5,&lt;/group&gt; &lt;/rule&gt; &lt;rule id="100002" level="12"&gt; &lt;if_sid&gt;100001&lt;/if_sid&gt; &lt;same_source_ip /&gt; &lt;description&gt;SSH brute force attack detected (multiple authentication failures).&lt;/description&gt; &lt;mitre&gt; &lt;id&gt;T1110&lt;/id&gt; &lt;/mitre&gt; &lt;group&gt;authentication_failures,pci_dss_10.2.4,pci_dss_10.2.5,&lt;/group&gt; &lt;/rule&gt; &lt;!-- ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê³µê²© íƒì§€ --&gt; &lt;rule id="100010" level="6"&gt; &lt;if_sid&gt;31100&lt;/if_sid&gt; &lt;url&gt;admin|wp-admin|phpmyadmin|cpanel&lt;/url&gt; &lt;description&gt;Attempt to access sensitive web directories.&lt;/description&gt; &lt;group&gt;web,accesslog,attack,&lt;/group&gt; &lt;/rule&gt; &lt;rule id="100011" level="8"&gt; &lt;if_sid&gt;31100&lt;/if_sid&gt; &lt;url&gt;\.php\?|\.asp\?|\.jsp\?&lt;/url&gt; &lt;description&gt;Potential web application vulnerability scan.&lt;/description&gt; &lt;group&gt;web,accesslog,attack,&lt;/group&gt; &lt;/rule&gt; &lt;rule id="100012" level="10"&gt; &lt;if_sid&gt;31100&lt;/if_sid&gt; &lt;url&gt;union.*select|concat\(|exec\(|system\(&lt;/url&gt; &lt;description&gt;SQL injection attempt detected.&lt;/description&gt; &lt;mitre&gt; &lt;id&gt;T1190&lt;/id&gt; &lt;/mitre&gt; &lt;group&gt;web,accesslog,attack,sql_injection,&lt;/group&gt; &lt;/rule&gt; &lt;!-- íŒŒì¼ ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§ --&gt; &lt;rule id="100020" level="7"&gt; &lt;if_sid&gt;550&lt;/if_sid&gt; &lt;field name="file"&gt;/etc/passwd|/etc/shadow|/etc/group&lt;/field&gt; &lt;description&gt;Critical system file modified.&lt;/description&gt; &lt;group&gt;syscheck,pci_dss_11.5,&lt;/group&gt; &lt;/rule&gt; &lt;rule id="100021" level="12"&gt; &lt;if_sid&gt;554&lt;/if_sid&gt; &lt;field name="file"&gt;/bin/|/sbin/|/usr/bin/&lt;/field&gt; &lt;description&gt;System binary file modified or deleted - possible rootkit.&lt;/description&gt; &lt;mitre&gt; &lt;id&gt;T1014&lt;/id&gt; &lt;/mitre&gt; &lt;group&gt;syscheck,rootkit,pci_dss_11.5,&lt;/group&gt; &lt;/rule&gt; &lt;!-- ë„¤íŠ¸ì›Œí¬ ê³µê²© íƒì§€ --&gt; &lt;rule id="100030" level="8"&gt; &lt;if_sid&gt;4386&lt;/if_sid&gt; &lt;regex&gt;DPT=(22|23|21|25|53|80|110|143|443|993|995|3389)&lt;/regex&gt; &lt;description&gt;Port scan detected on critical services.&lt;/description&gt; &lt;group&gt;recon,pci_dss_11.4,&lt;/group&gt; &lt;/rule&gt; &lt;rule id="100031" level="10"&gt; &lt;if_sid&gt;100030&lt;/if_sid&gt; &lt;same_source_ip /&gt; &lt;description&gt;Multiple port scan attempts from same source.&lt;/description&gt; &lt;mitre&gt; &lt;id&gt;T1046&lt;/id&gt; &lt;/mitre&gt; &lt;group&gt;recon,pci_dss_11.4,&lt;/group&gt; &lt;/rule&gt; &lt;!-- ì•…ì„±ì½”ë“œ ë° ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í”„ë¡œì„¸ìŠ¤ --&gt; &lt;rule id="100040" level="12"&gt; &lt;if_sid&gt;530&lt;/if_sid&gt; &lt;match&gt;nc -l|ncat -l|/dev/tcp|/dev/udp&lt;/match&gt; &lt;description&gt;Potential reverse shell or backdoor detected.&lt;/description&gt; &lt;mitre&gt; &lt;id&gt;T1059&lt;/id&gt; &lt;/mitre&gt; &lt;group&gt;attack,malware,&lt;/group&gt; &lt;/rule&gt; &lt;rule id="100041" level="10"&gt; &lt;if_sid&gt;530&lt;/if_sid&gt; &lt;match&gt;wget.*\.(sh|py|pl)|curl.*\.(sh|py|pl)&lt;/match&gt; &lt;description&gt;Suspicious script download detected.&lt;/description&gt; &lt;group&gt;attack,malware,&lt;/group&gt; &lt;/rule&gt; &lt;!-- ê¶Œí•œ ìƒìŠ¹ íƒì§€ --&gt; &lt;rule id="100050" level="8"&gt; &lt;if_sid&gt;5401&lt;/if_sid&gt; &lt;user&gt;root&lt;/user&gt; &lt;description&gt;Successful sudo to root.&lt;/description&gt; &lt;group&gt;privilege_escalation,pci_dss_10.2.2,&lt;/group&gt; &lt;/rule&gt; &lt;rule id="100051" level="12"&gt; &lt;if_sid&gt;5402&lt;/if_sid&gt; &lt;same_user /&gt; &lt;description&gt;Multiple failed sudo attempts by same user.&lt;/description&gt; &lt;mitre&gt; &lt;id&gt;T1548&lt;/id&gt; &lt;/mitre&gt; &lt;group&gt;privilege_escalation,pci_dss_10.2.2,&lt;/group&gt; &lt;/rule&gt; &lt;!-- ë°ì´í„° ìœ ì¶œ ê°ì§€ --&gt; &lt;rule id="100060" level="10"&gt; &lt;if_sid&gt;31100&lt;/if_sid&gt; &lt;status&gt;200&lt;/status&gt; &lt;size&gt;1048576&lt;/size&gt; &lt;description&gt;Large file download detected - potential data exfiltration.&lt;/description&gt; &lt;group&gt;web,data_exfiltration,&lt;/group&gt; &lt;/rule&gt; &lt;rule id="100061" level="8"&gt; &lt;if_sid&gt;530&lt;/if_sid&gt; &lt;match&gt;scp.*-r|rsync.*-r|tar.*-c&lt;/match&gt; &lt;description&gt;Bulk data transfer command detected.&lt;/description&gt; &lt;group&gt;data_exfiltration,&lt;/group&gt; &lt;/rule&gt; &lt;!-- ì»¨í…Œì´ë„ˆ ë³´ì•ˆ --&gt; &lt;rule id="100070" level="10"&gt; &lt;if_sid&gt;530&lt;/if_sid&gt; &lt;match&gt;docker.*--privileged|docker.*--cap-add&lt;/match&gt; &lt;description&gt;Privileged container execution detected.&lt;/description&gt; &lt;group&gt;docker,container_security,&lt;/group&gt; &lt;/rule&gt; &lt;rule id="100071" level="8"&gt; &lt;if_sid&gt;530&lt;/if_sid&gt; &lt;match&gt;kubectl.*create|kubectl.*apply&lt;/match&gt; &lt;description&gt;Kubernetes resource creation detected.&lt;/description&gt; &lt;group&gt;kubernetes,container_security,&lt;/group&gt; &lt;/rule&gt; &lt;!-- ë¡œê·¸ ë³€ì¡° íƒì§€ --&gt; &lt;rule id="100080" level="12"&gt; &lt;if_sid&gt;530&lt;/if_sid&gt; &lt;match&gt;rm.*log|truncate.*log|&gt;.*log&lt;/match&gt; &lt;description&gt;Log file manipulation detected.&lt;/description&gt; &lt;mitre&gt; &lt;id&gt;T1070.002&lt;/id&gt; &lt;/mitre&gt; &lt;group&gt;log_tampering,attack,&lt;/group&gt; &lt;/rule&gt; &lt;!-- ì•”í˜¸í™”í ì±„êµ´ íƒì§€ --&gt; &lt;rule id="100090" level="10"&gt; &lt;if_sid&gt;530&lt;/if_sid&gt; &lt;match&gt;xmrig|cpuminer|minerd|ccminer&lt;/match&gt; &lt;description&gt;Cryptocurrency mining activity detected.&lt;/description&gt; &lt;group&gt;malware,cryptomining,&lt;/group&gt; &lt;/rule&gt; &lt;!-- ì»´í”Œë¼ì´ì–¸ìŠ¤ ê´€ë ¨ ì´ë²¤íŠ¸ --&gt; &lt;rule id="100100" level="5"&gt; &lt;if_sid&gt;5501&lt;/if_sid&gt; &lt;user&gt;audit&lt;/user&gt; &lt;description&gt;Audit log access detected.&lt;/description&gt; &lt;group&gt;audit,compliance,pci_dss_10.2.3,&lt;/group&gt; &lt;/rule&gt; &lt;/group&gt; ê³ ê¸‰ ë””ì½”ë” ì„¤ì • # /var/ossec/etc/decoders/local_decoder.xml # Wazuh ì»¤ìŠ¤í…€ ë””ì½”ë” &lt;decoder name="custom-ssh"&gt; &lt;parent&gt;sshd&lt;/parent&gt; &lt;regex&gt;Failed password for (\S+) from (\d+.\d+.\d+.\d+) port (\d+)&lt;/regex&gt; &lt;order&gt;user,srcip,srcport&lt;/order&gt; &lt;/decoder&gt; &lt;decoder name="custom-apache-error"&gt; &lt;parent&gt;apache-errorlog&lt;/parent&gt; &lt;regex&gt;\[(\w+ \w+ \d+ \d+:\d+:\d+ \d+)\] \[(\w+)\] (\S+): (.+), referer: (\S+)&lt;/regex&gt; &lt;order&gt;timestamp,level,client,message,referer&lt;/order&gt; &lt;/decoder&gt; &lt;decoder name="custom-mysql"&gt; &lt;parent&gt;mysql_log&lt;/parent&gt; &lt;regex&gt;(\d+) Connect\s+Access denied for user '(\S+)'@'(\S+)'&lt;/regex&gt; &lt;order&gt;id,user,srcip&lt;/order&gt; &lt;/decoder&gt; &lt;decoder name="custom-docker"&gt; &lt;parent&gt;json&lt;/parent&gt; &lt;regex&gt;"container_name":"([^"]+)"&lt;/regex&gt; &lt;order&gt;container_name&lt;/order&gt; &lt;/decoder&gt; &lt;decoder name="custom-kubernetes"&gt; &lt;parent&gt;json&lt;/parent&gt; &lt;regex&gt;"verb":"(\S+)","user":{"username":"([^"]+)"}&lt;/regex&gt; &lt;order&gt;verb,username&lt;/order&gt; &lt;/decoder&gt; ğŸ“Š Wazuh ìë™í™” ë° ëŒ€ì‘ ìë™ ëŒ€ì‘ ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # /var/ossec/active-response/bin/custom-response.sh # Wazuh ìë™ ëŒ€ì‘ ìŠ¤í¬ë¦½íŠ¸ # ì…ë ¥ íŒŒë¼ë¯¸í„° ì½ê¸° LOCAL=`echo $0 | cut -d '/' -f4` PWD=`pwd` read INPUT_JSON # JSON íŒŒì‹± í•¨ìˆ˜ get_json_value() { echo "$INPUT_JSON" | python3 -c " import sys, json data = json.load(sys.stdin) print(data.get('$1', '')) " 2&gt;/dev/null || echo "" } # ë¡œê·¸ í•¨ìˆ˜ log_message() { echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" &gt;&gt; /var/ossec/logs/active-responses.log } # ì•¡ì…˜ ë° ë§¤ê°œë³€ìˆ˜ ì¶”ì¶œ ACTION=$(get_json_value "command") SRCIP=$(get_json_value "parameters.alert.data.srcip") RULE_ID=$(get_json_value "parameters.alert.rule.id") USERNAME=$(get_json_value "parameters.alert.data.user") FILENAME=$(get_json_value "parameters.alert.syscheck.path") log_message "Active response triggered: Action=$ACTION, Rule=$RULE_ID, SrcIP=$SRCIP" case $ACTION in "ban-ip") # IP ì°¨ë‹¨ if [ -n "$SRCIP" ]; then # iptables ì°¨ë‹¨ iptables -I INPUT -s "$SRCIP" -j DROP # Fail2Ban ì°¨ë‹¨ (Fail2Banì´ ì„¤ì¹˜ëœ ê²½ìš°) if command -v fail2ban-client &gt;/dev/null 2&gt;&amp;1; then fail2ban-client set sshd banip "$SRCIP" fi log_message "IP $SRCIP banned successfully" # ì•Œë¦¼ ë°œì†¡ /usr/local/bin/send-alert.sh "IP Banned" "IP $SRCIP has been banned due to rule $RULE_ID" fi ;; "disable-user") # ì‚¬ìš©ì ê³„ì • ë¹„í™œì„±í™” if [ -n "$USERNAME" ]; then usermod -L "$USERNAME" log_message "User $USERNAME disabled due to suspicious activity" # í™œì„± ì„¸ì…˜ ì¢…ë£Œ pkill -u "$USERNAME" # ì•Œë¦¼ ë°œì†¡ /usr/local/bin/send-alert.sh "User Disabled" "User $USERNAME has been disabled due to rule $RULE_ID" fi ;; "quarantine-file") # íŒŒì¼ ê²©ë¦¬ if [ -n "$FILENAME" ] &amp;&amp; [ -f "$FILENAME" ]; then QUARANTINE_DIR="/var/ossec/quarantine/$(date +%Y%m%d)" mkdir -p "$QUARANTINE_DIR" # íŒŒì¼ ì´ë™ mv "$FILENAME" "$QUARANTINE_DIR/" log_message "File $FILENAME quarantined to $QUARANTINE_DIR" # ì•Œë¦¼ ë°œì†¡ /usr/local/bin/send-alert.sh "File Quarantined" "File $FILENAME has been quarantined due to rule $RULE_ID" fi ;; "restart-service") # ì„œë¹„ìŠ¤ ì¬ì‹œì‘ SERVICE=$(get_json_value "parameters.service") if [ -n "$SERVICE" ]; then systemctl restart "$SERVICE" log_message "Service $SERVICE restarted due to rule $RULE_ID" # ì•Œë¦¼ ë°œì†¡ /usr/local/bin/send-alert.sh "Service Restarted" "Service $SERVICE has been restarted due to rule $RULE_ID" fi ;; "collect-evidence") # ì¦ê±° ìˆ˜ì§‘ EVIDENCE_DIR="/var/ossec/evidence/$(date +%Y%m%d-%H%M%S)-rule$RULE_ID" mkdir -p "$EVIDENCE_DIR" # ì‹œìŠ¤í…œ ì •ë³´ ìˆ˜ì§‘ ps aux &gt; "$EVIDENCE_DIR/processes.txt" netstat -tlnp &gt; "$EVIDENCE_DIR/network.txt" ss -tlnp &gt; "$EVIDENCE_DIR/sockets.txt" last -n 50 &gt; "$EVIDENCE_DIR/logins.txt" # ë¡œê·¸ íŒŒì¼ ë³µì‚¬ if [ -n "$SRCIP" ]; then grep "$SRCIP" /var/log/auth.log &gt; "$EVIDENCE_DIR/auth-logs.txt" 2&gt;/dev/null || true grep "$SRCIP" /var/log/apache2/access.log &gt; "$EVIDENCE_DIR/web-logs.txt" 2&gt;/dev/null || true fi # ë©”ëª¨ë¦¬ ë¤í”„ (ì„ íƒì‚¬í•­) if command -v memdump &gt;/dev/null 2&gt;&amp;1; then memdump &gt; "$EVIDENCE_DIR/memory.dump" 2&gt;/dev/null || true fi log_message "Evidence collected in $EVIDENCE_DIR" ;; *) log_message "Unknown action: $ACTION" ;; esac # ì„±ê³µ ìƒíƒœ ë°˜í™˜ exit 0 ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬ì¶• #!/bin/bash # /usr/local/bin/send-alert.sh # ë‹¤ì¤‘ ì±„ë„ ì•Œë¦¼ ì‹œìŠ¤í…œ SUBJECT="$1" MESSAGE="$2" SEVERITY="${3:-medium}" # ì„¤ì • íŒŒì¼ ë¡œë“œ if [ -f /etc/wazuh/alert-config.conf ]; then source /etc/wazuh/alert-config.conf fi # ê¸°ë³¸ ì„¤ì • EMAIL_TO="${EMAIL_TO:-admin@example.com}" SLACK_WEBHOOK="${SLACK_WEBHOOK:-}" DISCORD_WEBHOOK="${DISCORD_WEBHOOK:-}" SMS_API_KEY="${SMS_API_KEY:-}" SMS_TO="${SMS_TO:-}" # ë¡œê·¸ í•¨ìˆ˜ log_alert() { echo "$(date '+%Y-%m-%d %H:%M:%S') - [$SEVERITY] $SUBJECT: $MESSAGE" &gt;&gt; /var/log/wazuh-alerts.log } # ì´ë©”ì¼ ë°œì†¡ send_email() { if command -v mail &gt;/dev/null 2&gt;&amp;1; then echo "$MESSAGE" | mail -s "Wazuh Alert: $SUBJECT" "$EMAIL_TO" echo "Email sent to $EMAIL_TO" fi } # Slack ì•Œë¦¼ send_slack() { if [ -n "$SLACK_WEBHOOK" ]; then # ì‹¬ê°ë„ì— ë”°ë¥¸ ìƒ‰ìƒ case $SEVERITY in "high"|"critical") COLOR="danger" EMOJI="ğŸš¨" ;; "medium") COLOR="warning" EMOJI="âš ï¸" ;; *) COLOR="good" EMOJI="â„¹ï¸" ;; esac PAYLOAD=$(cat &lt;&lt;EOF { "text": "$EMOJI Wazuh Security Alert", "attachments": [ { "color": "$COLOR", "fields": [ { "title": "Alert", "value": "$SUBJECT", "short": true }, { "title": "Severity", "value": "$SEVERITY", "short": true }, { "title": "Details", "value": "$MESSAGE", "short": false }, { "title": "Timestamp", "value": "$(date)", "short": true }, { "title": "Host", "value": "$(hostname)", "short": true } ] } ] } EOF ) curl -X POST -H 'Content-type: application/json' \ --data "$PAYLOAD" \ "$SLACK_WEBHOOK" &gt;/dev/null 2&gt;&amp;1 echo "Slack notification sent" fi } # Discord ì•Œë¦¼ send_discord() { if [ -n "$DISCORD_WEBHOOK" ]; then PAYLOAD=$(cat &lt;&lt;EOF { "username": "Wazuh Security Bot", "embeds": [ { "title": "ğŸ›¡ï¸ Security Alert: $SUBJECT", "description": "$MESSAGE", "color": 15158332, "fields": [ { "name": "Severity", "value": "$SEVERITY", "inline": true }, { "name": "Host", "value": "$(hostname)", "inline": true }, { "name": "Timestamp", "value": "$(date)", "inline": false } ] } ] } EOF ) curl -H "Content-Type: application/json" \ -X POST \ -d "$PAYLOAD" \ "$DISCORD_WEBHOOK" &gt;/dev/null 2&gt;&amp;1 echo "Discord notification sent" fi } # SMS ë°œì†¡ (Twilio API ì˜ˆì œ) send_sms() { if [ -n "$SMS_API_KEY" ] &amp;&amp; [ -n "$SMS_TO" ] &amp;&amp; [ "$SEVERITY" = "critical" ]; then SMS_MESSAGE="Wazuh CRITICAL Alert: $SUBJECT on $(hostname)" curl -X POST https://api.twilio.com/2010-04-01/Accounts/$TWILIO_SID/Messages.json \ --data-urlencode "To=$SMS_TO" \ --data-urlencode "From=$TWILIO_FROM" \ --data-urlencode "Body=$SMS_MESSAGE" \ -u "$TWILIO_SID:$SMS_API_KEY" &gt;/dev/null 2&gt;&amp;1 echo "SMS notification sent" fi } # ë©”ì¸ ì‹¤í–‰ main() { log_alert # ì‹¬ê°ë„ì— ë”°ë¥¸ ì•Œë¦¼ ì±„ë„ ì„ íƒ case $SEVERITY in "critical") send_email send_slack send_discord send_sms ;; "high") send_email send_slack send_discord ;; "medium") send_slack ;; "low") log_alert # ë¡œê·¸ë§Œ ê¸°ë¡ ;; esac } main Docker ì»¨í…Œì´ë„ˆ ë³´ì•ˆ | Docker Container Security ğŸ³ Docker ë³´ì•ˆ ê°•í™” í¬ê´„ì ì¸ Docker ë³´ì•ˆ ì„¤ì • #!/bin/bash # /usr/local/bin/docker-security-hardening.sh # Docker ë³´ì•ˆ ê°•í™” ìŠ¤í¬ë¦½íŠ¸ set -e print_status() { echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" } # Docker ë°ëª¬ ë³´ì•ˆ ì„¤ì • configure_docker_daemon() { print_status "Configuring Docker daemon security..." # Docker ë°ëª¬ ì„¤ì • íŒŒì¼ ìƒì„± mkdir -p /etc/docker cat &gt; /etc/docker/daemon.json &lt;&lt; 'EOF' { "icc": false, "userns-remap": "default", "live-restore": true, "userland-proxy": false, "no-new-privileges": true, "log-driver": "json-file", "log-opts": { "max-size": "10m", "max-file": "3" }, "storage-driver": "overlay2", "storage-opts": [ "overlay2.override_kernel_check=true" ], "default-ulimits": { "nofile": { "Hard": 64000, "Name": "nofile", "Soft": 64000 } }, "disable-legacy-registry": true, "experimental": false, "metrics-addr": "127.0.0.1:9323", "insecure-registries": [] } EOF # Docker ì„œë¹„ìŠ¤ ì¬ì‹œì‘ systemctl restart docker print_status "Docker daemon configured successfully" } # Docker ì»¨í…Œì´ë„ˆ ê¸°ë³¸ ë³´ì•ˆ í”„ë¡œíŒŒì¼ create_security_profiles() { print_status "Creating security profiles..." # AppArmor í”„ë¡œíŒŒì¼ ìƒì„± if command -v aa-status &gt;/dev/null 2&gt;&amp;1; then cat &gt; /etc/apparmor.d/docker-default-secure &lt;&lt; 'EOF' #include &lt;tunables/global&gt; profile docker-default-secure flags=(attach_disconnected,mediate_deleted) { #include &lt;abstractions/base&gt; # ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ ì œí•œ network inet tcp, network inet udp, network inet6 tcp, network inet6 udp, network netlink raw, # íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼ ì œí•œ deny /etc/passwd r, deny /etc/shadow r, deny /etc/group r, deny /etc/gshadow r, deny /proc/sys/** w, deny /sys/** w, # íŠ¹ê¶Œ ìƒìŠ¹ ë°©ì§€ deny capability sys_admin, deny capability sys_module, deny capability sys_rawio, deny capability sys_pacct, deny capability sys_nice, deny capability sys_resource, deny capability sys_time, deny capability sys_tty_config, deny capability mknod, deny capability audit_write, deny capability audit_control, deny capability mac_override, deny capability mac_admin, deny capability net_admin, deny capability syslog, deny capability wake_alarm, deny capability block_suspend, # í—ˆìš©ëœ capabilityë“¤ capability chown, capability dac_override, capability fowner, capability fsetid, capability kill, capability setgid, capability setuid, capability setpcap, capability linux_immutable, capability net_bind_service, capability net_broadcast, capability net_raw, capability ipc_lock, capability ipc_owner, capability sys_chroot, capability sys_ptrace, capability lease, capability audit_read, } EOF apparmor_parser -r /etc/apparmor.d/docker-default-secure fi # Seccomp í”„ë¡œíŒŒì¼ ìƒì„± cat &gt; /etc/docker/seccomp-profile.json &lt;&lt; 'EOF' { "defaultAction": "SCMP_ACT_ERRNO", "archMap": [ { "architecture": "SCMP_ARCH_X86_64", "subArchitectures": [ "SCMP_ARCH_X86", "SCMP_ARCH_X32" ] } ], "syscalls": [ { "names": [ "accept", "accept4", "access", "adjtimex", "alarm", "bind", "brk", "chdir", "chmod", "chown", "chroot", "clock_getres", "clock_gettime", "clone", "close", "connect", "dup", "dup2", "dup3", "epoll_create", "epoll_create1", "epoll_ctl", "epoll_wait", "eventfd", "eventfd2", "execve", "exit", "exit_group", "fcntl", "fstat", "futex", "getcwd", "getdents", "getdents64", "getegid", "geteuid", "getgid", "getgroups", "getpeername", "getpgrp", "getpid", "getppid", "getrlimit", "getsid", "getsockname", "getsockopt", "gettid", "gettimeofday", "getuid", "listen", "lseek", "lstat", "madvise", "mmap", "mprotect", "munmap", "nanosleep", "open", "openat", "pause", "pipe", "pipe2", "poll", "ppoll", "prctl", "read", "recv", "recvfrom", "recvmsg", "rt_sigaction", "rt_sigprocmask", "rt_sigreturn", "sched_getaffinity", "sched_yield", "select", "send", "sendmsg", "sendto", "setgid", "setgroups", "setrlimit", "setsid", "setsockopt", "setuid", "shutdown", "sigaltstack", "socket", "socketpair", "stat", "statfs", "sysinfo", "time", "uname", "unlink", "unlinkat", "wait4", "waitpid", "write" ], "action": "SCMP_ACT_ALLOW" } ] } EOF print_status "Security profiles created successfully" } # Docker ì´ë¯¸ì§€ ë³´ì•ˆ ìŠ¤ìºë„ˆ ì„¤ì¹˜ install_image_scanner() { print_status "Installing Docker image security scanner..." # Trivy ì„¤ì¹˜ if ! command -v trivy &gt;/dev/null 2&gt;&amp;1; then case $(uname -m) in x86_64) ARCH="64bit" ;; aarch64) ARCH="ARM64" ;; *) print_status "Unsupported architecture for Trivy" return 1 ;; esac VERSION=$(curl -s "https://api.github.com/repos/aquasecurity/trivy/releases/latest" | grep '"tag_name":' | sed -E 's/.*"([^"]+)".*/\1/') wget -q "https://github.com/aquasecurity/trivy/releases/download/${VERSION}/trivy_${VERSION#v}_Linux-${ARCH}.tar.gz" tar -xzf "trivy_${VERSION#v}_Linux-${ARCH}.tar.gz" mv trivy /usr/local/bin/ rm -f "trivy_${VERSION#v}_Linux-${ARCH}.tar.gz" fi print_status "Trivy installed successfully" } # Docker ì»´í¬ì¦ˆ ë³´ì•ˆ í…œí”Œë¦¿ create_secure_compose_template() { print_status "Creating secure Docker Compose template..." cat &gt; /usr/local/share/docker-compose-secure-template.yml &lt;&lt; 'EOF' version: '3.8' # ë³´ì•ˆ ê°•í™”ëœ Docker Compose í…œí”Œë¦¿ services: app: image: your-app:latest # ë³´ì•ˆ ì„¤ì • read_only: true # ë£¨íŠ¸ íŒŒì¼ì‹œìŠ¤í…œ ì½ê¸° ì „ìš© cap_drop: # ëª¨ë“  capabilities ì œê±° - ALL cap_add: # í•„ìš”í•œ capabilitiesë§Œ ì¶”ê°€ - NET_BIND_SERVICE # ë¦¬ì†ŒìŠ¤ ì œí•œ mem_limit: 512m memswap_limit: 512m cpu_count: 1 pids_limit: 100 # ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ networks: - app-network ports: - "8080:8080" # í™˜ê²½ ë³€ìˆ˜ (secrets ì‚¬ìš© ê¶Œì¥) environment: - NODE_ENV=production # ë³¼ë¥¨ ë§ˆìš´íŠ¸ (ìµœì†Œí•œìœ¼ë¡œ) volumes: - app-data:/app/data - /tmp:/tmp:rw,noexec,nosuid,nodev # ë³´ì•ˆ ì˜µì…˜ security_opt: - no-new-privileges:true - apparmor:docker-default-secure - seccomp:/etc/docker/seccomp-profile.json # ì¬ì‹œì‘ ì •ì±… restart: unless-stopped # í—¬ìŠ¤ì²´í¬ healthcheck: test: ["CMD", "curl", "-f", "http://localhost:8080/health"] interval: 30s timeout: 10s retries: 3 start_period: 60s # ë¡œê·¸ ì„¤ì • logging: driver: "json-file" options: max-size: "10m" max-file: "3" # ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤ ì˜ˆì œ database: image: postgres:13-alpine # ë³´ì•ˆ ì„¤ì • read_only: true cap_drop: - ALL cap_add: - SETUID - SETGID - DAC_OVERRIDE # ë¦¬ì†ŒìŠ¤ ì œí•œ mem_limit: 1g memswap_limit: 1g # í™˜ê²½ ë³€ìˆ˜ environment: POSTGRES_DB_FILE: /run/secrets/postgres_db POSTGRES_USER_FILE: /run/secrets/postgres_user POSTGRES_PASSWORD_FILE: /run/secrets/postgres_password # Secrets ì‚¬ìš© secrets: - postgres_db - postgres_user - postgres_password # ë³¼ë¥¨ ì„¤ì • volumes: - postgres-data:/var/lib/postgresql/data - /tmp:/tmp:rw,noexec,nosuid,nodev # ë„¤íŠ¸ì›Œí¬ networks: - db-network # ë³´ì•ˆ ì˜µì…˜ security_opt: - no-new-privileges:true # í—¬ìŠ¤ì²´í¬ healthcheck: test: ["CMD-SHELL", "pg_isready -U postgres"] interval: 30s timeout: 10s retries: 5 # ë„¤íŠ¸ì›Œí¬ ì •ì˜ networks: app-network: driver: bridge ipam: config: - subnet: 172.20.0.0/16 db-network: driver: bridge internal: true # ì™¸ë¶€ ì ‘ê·¼ ì°¨ë‹¨ # ë³¼ë¥¨ ì •ì˜ volumes: app-data: driver: local postgres-data: driver: local # Secrets ì •ì˜ secrets: postgres_db: file: ./secrets/postgres_db.txt postgres_user: file: ./secrets/postgres_user.txt postgres_password: file: ./secrets/postgres_password.txt EOF print_status "Secure Docker Compose template created" } # Docker ë³´ì•ˆ ìŠ¤ìº” ìŠ¤í¬ë¦½íŠ¸ create_security_scanner() { print_status "Creating Docker security scanner..." cat &gt; /usr/local/bin/docker-security-scan.sh &lt;&lt; 'EOF' #!/bin/bash # Docker ë³´ì•ˆ ìŠ¤ìº” ìŠ¤í¬ë¦½íŠ¸ IMAGE=$1 REPORT_DIR="/var/log/docker-security-scans" TIMESTAMP=$(date +%Y%m%d-%H%M%S) if [ -z "$IMAGE" ]; then echo "Usage: $0 &lt;image-name&gt;" exit 1 fi mkdir -p "$REPORT_DIR" echo "Starting security scan for image: $IMAGE" # Trivy ì·¨ì•½ì  ìŠ¤ìº” echo "Running Trivy vulnerability scan..." trivy image --format json --output "$REPORT_DIR/trivy-$TIMESTAMP.json" "$IMAGE" trivy image --format table "$IMAGE" | tee "$REPORT_DIR/trivy-$TIMESTAMP.txt" # Docker Bench ë³´ì•ˆ ìŠ¤ìº” (ì„¤ì¹˜ëœ ê²½ìš°) if command -v docker-bench-security &gt;/dev/null 2&gt;&amp;1; then echo "Running Docker Bench security check..." docker-bench-security &gt; "$REPORT_DIR/docker-bench-$TIMESTAMP.txt" fi # ì´ë¯¸ì§€ íˆìŠ¤í† ë¦¬ ë¶„ì„ echo "Analyzing image history..." docker history --no-trunc "$IMAGE" &gt; "$REPORT_DIR/history-$TIMESTAMP.txt" # ì´ë¯¸ì§€ êµ¬ì„± í™•ì¸ echo "Checking image configuration..." docker inspect "$IMAGE" &gt; "$REPORT_DIR/inspect-$TIMESTAMP.json" # ë³´ì•ˆ ê¶Œê³ ì‚¬í•­ ì²´í¬ echo "Checking security best practices..." { echo "=== Security Check Results ===" echo "Image: $IMAGE" echo "Scan Date: $(date)" echo "" # ë£¨íŠ¸ ì‚¬ìš©ì ì²´í¬ if docker inspect "$IMAGE" | grep -q '"User": ""'; then echo "âŒ FAIL: Image runs as root user" else echo "âœ… PASS: Image does not run as root" fi # ë¶ˆí•„ìš”í•œ íŒ¨í‚¤ì§€ ì²´í¬ echo "" echo "=== Package Analysis ===" docker run --rm "$IMAGE" sh -c 'which wget curl nc netcat' 2&gt;/dev/null | while read tool; do if [ -n "$tool" ]; then echo "âš ï¸ WARNING: Found potentially dangerous tool: $tool" fi done } &gt; "$REPORT_DIR/security-check-$TIMESTAMP.txt" echo "Security scan completed. Reports saved in: $REPORT_DIR" EOF chmod +x /usr/local/bin/docker-security-scan.sh print_status "Docker security scanner created" } # ë©”ì¸ ì‹¤í–‰ main() { print_status "Starting Docker security hardening..." configure_docker_daemon create_security_profiles install_image_scanner create_secure_compose_template create_security_scanner print_status "Docker security hardening completed successfully!" echo "" echo "Next steps:" echo "1. Review Docker daemon configuration in /etc/docker/daemon.json" echo "2. Use secure Docker Compose template: /usr/local/share/docker-compose-secure-template.yml" echo "3. Scan images with: /usr/local/bin/docker-security-scan.sh &lt;image-name&gt;" echo "4. Apply security profiles to containers" } main "$@" ë‹¤ìŒ í¸ ì˜ˆê³  ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” Kubernetes ë³´ì•ˆê³¼ ì»´í”Œë¼ì´ì–¸ìŠ¤ë¥¼ ìƒì„¸íˆ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤: Kubernetes í´ëŸ¬ìŠ¤í„° ë³´ì•ˆ ê°•í™” Pod Security Standards ë° ì •ì±… Network Policyì™€ Service Mesh ë³´ì•ˆ ì»´í”Œë¼ì´ì–¸ìŠ¤ ìë™í™” ë° ê°ì‚¬ Wazuh SIEMê³¼ Docker ë³´ì•ˆìœ¼ë¡œ ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ë³´ì•ˆ ì¸í”„ë¼ë¥¼ ì™„ì„±í•˜ì…¨ë‚˜ìš”? ğŸ”ğŸ³ğŸ›¡ï¸]]></summary></entry><entry><title type="html">ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ 4í¸ - ì¹¨ì… íƒì§€ì™€ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ | Linux Security Guide Part 4 - Intrusion Detection &amp;amp; Real-time Monitoring</title><link href="https://leeyonghe.github.io/infra-blog/blog/2025/04/12/linux-security-guide-part4.html" rel="alternate" type="text/html" title="ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ 4í¸ - ì¹¨ì… íƒì§€ì™€ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ | Linux Security Guide Part 4 - Intrusion Detection &amp;amp; Real-time Monitoring" /><published>2025-04-12T00:00:00+00:00</published><updated>2025-04-12T00:00:00+00:00</updated><id>https://leeyonghe.github.io/infra-blog/blog/2025/04/12/linux-security-guide-part4</id><content type="html" xml:base="https://leeyonghe.github.io/infra-blog/blog/2025/04/12/linux-security-guide-part4.html"><![CDATA[<p>ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œì˜ ì™„ë²½í•œ ë³´ì•ˆì„ ìœ„í•œ ë§ˆì§€ë§‰ í¼ì¦ ì¡°ê°ì¸ ì¹¨ì… íƒì§€ì™€ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ì„ ì™„ì „íˆ ë§ˆìŠ¤í„°í•´ë³´ê² ìŠµë‹ˆë‹¤. AIDEë¶€í„° Wazuh SIEMê¹Œì§€, ëª¨ë“  ìœ„í˜‘ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ íƒì§€í•˜ê³  ëŒ€ì‘í•˜ëŠ” ìµœê³ ê¸‰ ë³´ì•ˆ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•©ë‹ˆë‹¤.</p>

<h2 id="aide-íŒŒì¼-ë¬´ê²°ì„±-ëª¨ë‹ˆí„°ë§--aide-file-integrity-monitoring">AIDE íŒŒì¼ ë¬´ê²°ì„± ëª¨ë‹ˆí„°ë§ | AIDE File Integrity Monitoring</h2>

<h3 id="-aide-ì™„ì „-ì„¤ì •-ë°-ìš´ì˜">ğŸ” AIDE ì™„ì „ ì„¤ì • ë° ìš´ì˜</h3>

<h4 id="aide-ì„¤ì¹˜-ë°-ê¸°ë³¸-ì„¤ì •">AIDE ì„¤ì¹˜ ë° ê¸°ë³¸ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># AIDE ì„¤ì¹˜</span>
<span class="c"># CentOS/RHEL</span>
yum <span class="nb">install </span>aide
<span class="c"># Ubuntu/Debian  </span>
apt-get <span class="nb">install </span>aide aide-common

<span class="c"># ì´ˆê¸° ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±</span>
aide <span class="nt">--init</span>
<span class="nb">mv</span> /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz

<span class="c"># ê¸°ë³¸ ë¬´ê²°ì„± ê²€ì‚¬ ì‹¤í–‰</span>
aide <span class="nt">--check</span>

<span class="c"># ì„¤ì • íŒŒì¼ ìœ„ì¹˜</span>
<span class="c"># CentOS/RHEL: /etc/aide.conf</span>
<span class="c"># Ubuntu/Debian: /etc/aide/aide.conf</span>
</code></pre></div></div>

<h4 id="ê³ ê¸‰-aide-ì„¤ì •-íŒŒì¼-ì‘ì„±">ê³ ê¸‰ AIDE ì„¤ì • íŒŒì¼ ì‘ì„±</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/aide/aide.conf (Ubuntu) ë˜ëŠ” /etc/aide.conf (CentOS)</span>
<span class="c"># ì¢…í•©ì ì¸ AIDE ì„¤ì •</span>

<span class="c"># ë°ì´í„°ë² ì´ìŠ¤ ê²½ë¡œ</span>
<span class="nv">database</span><span class="o">=</span>file:/var/lib/aide/aide.db.gz
<span class="nv">database_out</span><span class="o">=</span>file:/var/lib/aide/aide.db.new.gz

<span class="c"># ë¡œê·¸ ì„¤ì •</span>
<span class="nv">verbose</span><span class="o">=</span>5
<span class="nv">report_url</span><span class="o">=</span>file:/var/log/aide/aide.log
<span class="nv">report_url</span><span class="o">=</span>stdout

<span class="c"># ê²€ì‚¬ ê·œì¹™ ì •ì˜</span>
<span class="c"># R = p+i+n+u+g+s+m+c+md5</span>
<span class="c"># L = p+i+n+u+g</span>
<span class="c"># E = ë¹ˆ ê·¸ë£¹ (ì¡´ì¬ë§Œ í™•ì¸)</span>
<span class="c"># &gt; = ë¡œê·¸ íŒŒì¼ (í¬ê¸° ì¦ê°€ë§Œ í—ˆìš©)</span>
<span class="c"># X = ì œì™¸</span>

<span class="c"># ê¸°ë³¸ ê·œì¹™ë“¤</span>
Binlib <span class="o">=</span> p+i+n+u+g+s+b+m+c+md5+sha1+sha256+sha512
ConfFiles <span class="o">=</span> p+i+n+u+g+s+m+c+md5+sha1+sha256
LogFiles <span class="o">=</span> p+u+g+i+n+S
DatabaseFiles <span class="o">=</span> p+i+n+u+g+s+m+c+md5+sha1+sha256
StaticFiles <span class="o">=</span> p+i+n+u+g+s+m+c+md5+sha1+sha256+acl+selinux+xattrs
DeviceFiles <span class="o">=</span> p+i+n+u+g+s+b+c+md5+sha1

<span class="c"># ê³ ê¸‰ ê·œì¹™ë“¤</span>
CriticalFiles <span class="o">=</span> p+i+n+u+g+s+m+c+md5+sha1+sha256+sha512+acl+selinux+xattrs
WebFiles <span class="o">=</span> p+i+n+u+g+s+m+c+md5+sha1+sha256
TempFiles <span class="o">=</span> n+u+g+i
UserFiles <span class="o">=</span> p+i+n+u+g+s+m+c+md5+sha1

<span class="c"># ì‹œìŠ¤í…œ ì¤‘ìš” ë””ë ‰í† ë¦¬</span>
/boot                   CriticalFiles
/bin                    Binlib
/sbin                   Binlib
/usr/bin                Binlib
/usr/sbin               Binlib
/usr/local/bin          Binlib
/usr/local/sbin         Binlib
/lib                    Binlib
/lib64                  Binlib
/usr/lib                Binlib
/usr/lib64              Binlib

<span class="c"># ì„¤ì • íŒŒì¼ë“¤</span>
/etc                    ConfFiles
<span class="o">!</span>/etc/mtab
<span class="o">!</span>/etc/.<span class="k">*</span>~
<span class="o">!</span>/etc/<span class="se">\.</span>.<span class="k">*</span>
<span class="o">!</span>/etc/passwd-
<span class="o">!</span>/etc/shadow-
<span class="o">!</span>/etc/group-
<span class="o">!</span>/etc/gshadow-
<span class="o">!</span>/etc/security/opasswd
<span class="o">!</span>/etc/mail/statistics
<span class="o">!</span>/etc/prelink<span class="se">\.</span>cache
<span class="o">!</span>/etc/crontab
<span class="o">!</span>/etc/cron<span class="se">\.</span>d
<span class="o">!</span>/etc/cron<span class="se">\.</span>daily
<span class="o">!</span>/etc/cron<span class="se">\.</span>hourly
<span class="o">!</span>/etc/cron<span class="se">\.</span>monthly
<span class="o">!</span>/etc/cron<span class="se">\.</span>weekly

<span class="c"># ì‹œìŠ¤í…œ íŠ¹ìˆ˜ íŒŒì¼ë“¤</span>
/etc/passwd             CriticalFiles
/etc/shadow             CriticalFiles
/etc/group              CriticalFiles
/etc/gshadow            CriticalFiles
/etc/sudoers            CriticalFiles
/etc/ssh/sshd_config    CriticalFiles
/etc/hosts              CriticalFiles
/etc/hosts.allow        CriticalFiles
/etc/hosts.deny         CriticalFiles

<span class="c"># ì›¹ ì„œë²„ íŒŒì¼ë“¤ (í•´ë‹¹í•˜ëŠ” ê²½ìš°)</span>
/var/www                WebFiles
<span class="o">!</span>/var/www/html/.<span class="k">*</span><span class="se">\.</span>log<span class="err">$</span>
<span class="o">!</span>/var/www/.<span class="k">*</span>cache.<span class="k">*</span>

<span class="c"># ë¡œê·¸ ë””ë ‰í† ë¦¬ (ì¦ê°€ë§Œ í—ˆìš©)</span>
/var/log                LogFiles
<span class="o">!</span>/var/log/.<span class="k">*</span><span class="se">\.</span><span class="o">[</span>0-9]+<span class="se">\.</span>gz
<span class="o">!</span>/var/log/.<span class="k">*</span><span class="se">\.</span>old
<span class="o">!</span>/var/log/.<span class="k">*</span><span class="se">\.</span>log<span class="se">\.</span><span class="o">[</span>0-9]+
<span class="o">!</span>/var/log/lastlog
<span class="o">!</span>/var/log/wtmp
<span class="o">!</span>/var/log/btmp
<span class="o">!</span>/var/log/utmp

<span class="c"># ì‚¬ìš©ì í™ˆ ë””ë ‰í† ë¦¬ (ì¤‘ìš” íŒŒì¼ë§Œ)</span>
/home                   UserFiles
<span class="o">!</span>/home/[^/]+/<span class="se">\.</span>bash_history
<span class="o">!</span>/home/[^/]+/<span class="se">\.</span>viminfo
<span class="o">!</span>/home/[^/]+/<span class="se">\.</span>cache
<span class="o">!</span>/home/[^/]+/<span class="se">\.</span><span class="nb">local</span>
<span class="o">!</span>/home/[^/]+/<span class="se">\.</span>mozilla
<span class="o">!</span>/home/[^/]+/<span class="se">\.</span>gnome
<span class="o">!</span>/home/[^/]+/<span class="se">\.</span>config

<span class="c"># íŠ¹ë³„ ê´€ì‹¬ íŒŒì¼ë“¤</span>
/root                   CriticalFiles
<span class="o">!</span>/root/<span class="se">\.</span>bash_history
<span class="o">!</span>/root/<span class="se">\.</span>viminfo

<span class="c"># ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ë“¤</span>
/var/lib/mysql          DatabaseFiles
/var/lib/postgresql     DatabaseFiles

<span class="c"># ì„ì‹œ ë””ë ‰í† ë¦¬ (ì¡´ì¬ë§Œ í™•ì¸)</span>
/tmp                    TempFiles
/var/tmp                TempFiles

<span class="c"># ì œì™¸í•  ë””ë ‰í† ë¦¬ë“¤</span>
<span class="o">!</span>/proc
<span class="o">!</span>/sys
<span class="o">!</span>/dev
<span class="o">!</span>/run
<span class="o">!</span>/var/run
<span class="o">!</span>/var/lock
<span class="o">!</span>/var/cache
<span class="o">!</span>/var/spool
<span class="o">!</span>/media
<span class="o">!</span>/mnt
<span class="o">!</span>/tmp/.<span class="k">*</span>
<span class="o">!</span>/var/tmp/.<span class="k">*</span>
<span class="o">!</span>/lost<span class="se">\+</span>found

<span class="c"># ê³ ê¸‰ ì œì™¸ ê·œì¹™ë“¤</span>
<span class="o">!</span>/<span class="se">\.</span>journal
<span class="o">!</span>/<span class="se">\.</span>updated
<span class="o">!</span>/var/lib/dhcp/dhcpd<span class="se">\.</span>leases.<span class="k">*</span>
<span class="o">!</span>/var/lib/logrotate<span class="se">\.</span>status
<span class="o">!</span>/var/lib/random-seed
<span class="o">!</span>/var/lib/systemd
<span class="o">!</span>/var/lib/dbus
</code></pre></div></div>

<h4 id="aide-ìë™í™”-ë°-ëª¨ë‹ˆí„°ë§-ìŠ¤í¬ë¦½íŠ¸">AIDE ìë™í™” ë° ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/aide-monitor.sh</span>
<span class="c"># AIDE ìë™ ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼ ì‹œìŠ¤í…œ</span>

<span class="nv">AIDE_CONFIG</span><span class="o">=</span><span class="s2">"/etc/aide/aide.conf"</span>
<span class="nv">AIDE_DB</span><span class="o">=</span><span class="s2">"/var/lib/aide/aide.db.gz"</span>
<span class="nv">AIDE_NEW_DB</span><span class="o">=</span><span class="s2">"/var/lib/aide/aide.db.new.gz"</span>
<span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">"/var/log/aide/aide-monitor.log"</span>
<span class="nv">ALERT_LOG</span><span class="o">=</span><span class="s2">"/var/log/aide/aide-alerts.log"</span>
<span class="nv">EMAIL_TO</span><span class="o">=</span><span class="s2">"admin@example.com"</span>
<span class="nv">LOCKFILE</span><span class="o">=</span><span class="s2">"/var/run/aide-monitor.lock"</span>

<span class="c"># í•¨ìˆ˜ ì •ì˜</span>
log_message<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span> <span class="s1">'+%Y-%m-%d %H:%M:%S'</span><span class="si">)</span><span class="s2"> - </span><span class="nv">$1</span><span class="s2">"</span> | <span class="nb">tee</span> <span class="nt">-a</span> <span class="s2">"</span><span class="nv">$LOG_FILE</span><span class="s2">"</span>
<span class="o">}</span>

send_alert<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local </span><span class="nv">subject</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
    <span class="nb">local </span><span class="nv">message</span><span class="o">=</span><span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span>
    
    <span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span> <span class="s1">'+%Y-%m-%d %H:%M:%S'</span><span class="si">)</span><span class="s2"> - ALERT: </span><span class="nv">$subject</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="s2">"</span><span class="nv">$ALERT_LOG</span><span class="s2">"</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$message</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="s2">"</span><span class="nv">$ALERT_LOG</span><span class="s2">"</span>
    
    <span class="c"># ì´ë©”ì¼ ë°œì†¡ (sendmail ë˜ëŠ” mail ëª…ë ¹ ì‚¬ìš©)</span>
    <span class="k">if </span><span class="nb">command</span> <span class="nt">-v</span> mail <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$message</span><span class="s2">"</span> | mail <span class="nt">-s</span> <span class="s2">"AIDE Alert: </span><span class="nv">$subject</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$EMAIL_TO</span><span class="s2">"</span>
    <span class="k">fi</span>
    
    <span class="c"># Slack ì›¹í›… (ì„¤ì •ëœ ê²½ìš°)</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$SLACK_WEBHOOK</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>curl <span class="nt">-X</span> POST <span class="nt">-H</span> <span class="s1">'Content-type: application/json'</span> <span class="se">\</span>
             <span class="nt">--data</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">text</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">ğŸš¨ AIDE Alert: </span><span class="nv">$subject</span><span class="se">\n</span><span class="nv">$message</span><span class="se">\"</span><span class="s2">}"</span> <span class="se">\</span>
             <span class="s2">"</span><span class="nv">$SLACK_WEBHOOK</span><span class="s2">"</span>
    <span class="k">fi</span>
    
    <span class="c"># syslogì—ë„ ê¸°ë¡</span>
    logger <span class="nt">-p</span> local0.alert <span class="s2">"AIDE Alert: </span><span class="nv">$subject</span><span class="s2">"</span>
<span class="o">}</span>

check_prerequisites<span class="o">()</span> <span class="o">{</span>
    <span class="c"># AIDE ì„¤ì¹˜ í™•ì¸</span>
    <span class="k">if</span> <span class="o">!</span> <span class="nb">command</span> <span class="nt">-v</span> aide <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
        </span>log_message <span class="s2">"ERROR: AIDE is not installed"</span>
        <span class="nb">exit </span>1
    <span class="k">fi</span>
    
    <span class="c"># ë°ì´í„°ë² ì´ìŠ¤ ì¡´ì¬ í™•ì¸</span>
    <span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$AIDE_DB</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>log_message <span class="s2">"ERROR: AIDE database not found at </span><span class="nv">$AIDE_DB</span><span class="s2">"</span>
        log_message <span class="s2">"Run: aide --init &amp;&amp; mv </span><span class="nv">$AIDE_NEW_DB</span><span class="s2"> </span><span class="nv">$AIDE_DB</span><span class="s2">"</span>
        <span class="nb">exit </span>1
    <span class="k">fi</span>
    
    <span class="c"># ë¡œê·¸ ë””ë ‰í† ë¦¬ ìƒì„±</span>
    <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$LOG_FILE</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
    <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$ALERT_LOG</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># ë½ íŒŒì¼ í™•ì¸ (ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€)</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$LOCKFILE</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nv">PID</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat</span> <span class="s2">"</span><span class="nv">$LOCKFILE</span><span class="s2">"</span><span class="si">)</span>
    <span class="k">if </span>ps <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$PID</span><span class="s2">"</span> <span class="o">&gt;</span> /dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
        </span>log_message <span class="s2">"Another instance is running (PID: </span><span class="nv">$PID</span><span class="s2">)"</span>
        <span class="nb">exit </span>1
    <span class="k">else
        </span><span class="nb">rm</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$LOCKFILE</span><span class="s2">"</span>
    <span class="k">fi
fi</span>

<span class="c"># ë½ íŒŒì¼ ìƒì„±</span>
<span class="nb">echo</span> <span class="nv">$$</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$LOCKFILE</span><span class="s2">"</span>
<span class="nb">trap</span> <span class="s2">"rm -f </span><span class="nv">$LOCKFILE</span><span class="s2">"</span> EXIT

<span class="c"># ì•¡ì…˜ íŒŒë¼ë¯¸í„°</span>
<span class="nv">ACTION</span><span class="o">=</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">check</span><span class="k">}</span>

<span class="k">case</span> <span class="nv">$ACTION</span> <span class="k">in</span>
    <span class="s2">"init"</span><span class="p">)</span>
        log_message <span class="s2">"Initializing AIDE database..."</span>
        check_prerequisites
        
        aide <span class="nt">--init</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">mv</span> <span class="s2">"</span><span class="nv">$AIDE_NEW_DB</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$AIDE_DB</span><span class="s2">"</span>
            log_message <span class="s2">"AIDE database initialized successfully"</span>
        <span class="k">else
            </span>log_message <span class="s2">"ERROR: AIDE database initialization failed"</span>
            <span class="nb">exit </span>1
        <span class="k">fi</span>
        <span class="p">;;</span>
        
    <span class="s2">"check"</span><span class="p">)</span>
        log_message <span class="s2">"Starting AIDE integrity check..."</span>
        check_prerequisites
        
        <span class="c"># ì„ì‹œ íŒŒì¼ì— ê²°ê³¼ ì €ì¥</span>
        <span class="nv">TEMP_RESULT</span><span class="o">=</span><span class="s2">"/tmp/aide-result-</span><span class="nv">$$</span><span class="s2">"</span>
        
        <span class="c"># AIDE ì‹¤í–‰</span>
        aide <span class="nt">--check</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$TEMP_RESULT</span><span class="s2">"</span> 2&gt;&amp;1
        <span class="nv">AIDE_EXIT_CODE</span><span class="o">=</span><span class="nv">$?</span>
        
        <span class="k">case</span> <span class="nv">$AIDE_EXIT_CODE</span> <span class="k">in
            </span>0<span class="p">)</span>
                log_message <span class="s2">"AIDE check completed - No changes detected"</span>
                <span class="p">;;</span>
            1<span class="p">)</span>
                log_message <span class="s2">"WARNING: AIDE detected file changes"</span>
                
                <span class="c"># ë³€ê²½ ì‚¬í•­ ë¶„ì„</span>
                <span class="nv">CHANGES</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"(added|removed|changed)"</span> <span class="s2">"</span><span class="nv">$TEMP_RESULT</span><span class="s2">"</span> | <span class="nb">wc</span> <span class="nt">-l</span><span class="si">)</span>
                
                <span class="c"># ìƒì„¸ ë³€ê²½ ë‚´ì—­</span>
                <span class="nv">CHANGE_DETAILS</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-A</span> 5 <span class="nt">-B</span> 5 <span class="nt">-E</span> <span class="s2">"(added|removed|changed)"</span> <span class="s2">"</span><span class="nv">$TEMP_RESULT</span><span class="s2">"</span><span class="si">)</span>
                
                <span class="c"># ì•Œë¦¼ ë°œì†¡</span>
                <span class="nv">ALERT_MESSAGE</span><span class="o">=</span><span class="s2">"AIDE detected </span><span class="nv">$CHANGES</span><span class="s2"> file system changes:

</span><span class="nv">$CHANGE_DETAILS</span><span class="s2">

Full report saved to: </span><span class="nv">$LOG_FILE</span><span class="s2">
Time: </span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">
Hostname: </span><span class="si">$(</span><span class="nb">hostname</span><span class="si">)</span><span class="s2">"</span>
                
                send_alert <span class="s2">"File System Changes Detected"</span> <span class="s2">"</span><span class="nv">$ALERT_MESSAGE</span><span class="s2">"</span>
                
                <span class="c"># ì „ì²´ ê²°ê³¼ë¥¼ ë¡œê·¸ì— ì €ì¥</span>
                <span class="nb">cat</span> <span class="s2">"</span><span class="nv">$TEMP_RESULT</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="s2">"</span><span class="nv">$LOG_FILE</span><span class="s2">"</span>
                <span class="p">;;</span>
            2|3|4|5|6|7|14|15|16|17<span class="p">)</span>
                log_message <span class="s2">"ERROR: AIDE check failed with exit code </span><span class="nv">$AIDE_EXIT_CODE</span><span class="s2">"</span>
                send_alert <span class="s2">"AIDE Check Failed"</span> <span class="s2">"AIDE integrity check failed with exit code: </span><span class="nv">$AIDE_EXIT_CODE</span><span class="s2">"</span>
                <span class="p">;;</span>
        <span class="k">esac</span>
        
        <span class="nb">rm</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$TEMP_RESULT</span><span class="s2">"</span>
        <span class="p">;;</span>
        
    <span class="s2">"update"</span><span class="p">)</span>
        log_message <span class="s2">"Updating AIDE database..."</span>
        check_prerequisites
        
        <span class="c"># ë°±ì—… ìƒì„±</span>
        <span class="nv">BACKUP_DB</span><span class="o">=</span><span class="s2">"/var/lib/aide/aide.db.backup.</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d-%H%M%S<span class="si">)</span><span class="s2">.gz"</span>
        <span class="nb">cp</span> <span class="s2">"</span><span class="nv">$AIDE_DB</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$BACKUP_DB</span><span class="s2">"</span>
        log_message <span class="s2">"Database backed up to </span><span class="nv">$BACKUP_DB</span><span class="s2">"</span>
        
        <span class="c"># ìƒˆ ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±</span>
        aide <span class="nt">--init</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">mv</span> <span class="s2">"</span><span class="nv">$AIDE_NEW_DB</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$AIDE_DB</span><span class="s2">"</span>
            log_message <span class="s2">"AIDE database updated successfully"</span>
        <span class="k">else
            </span>log_message <span class="s2">"ERROR: AIDE database update failed"</span>
            <span class="nb">exit </span>1
        <span class="k">fi</span>
        <span class="p">;;</span>
        
    <span class="s2">"config-test"</span><span class="p">)</span>
        log_message <span class="s2">"Testing AIDE configuration..."</span>
        aide <span class="nt">--config-check</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span>log_message <span class="s2">"AIDE configuration is valid"</span>
        <span class="k">else
            </span>log_message <span class="s2">"ERROR: AIDE configuration has errors"</span>
            <span class="nb">exit </span>1
        <span class="k">fi</span>
        <span class="p">;;</span>
        
    <span class="s2">"stats"</span><span class="p">)</span>
        log_message <span class="s2">"AIDE Statistics:"</span>
        <span class="nb">echo</span> <span class="s2">"Database size: </span><span class="si">$(</span><span class="nb">du</span> <span class="nt">-h</span> <span class="nv">$AIDE_DB</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">echo</span> <span class="s1">'N/A'</span><span class="si">)</span><span class="s2">"</span>
        <span class="nb">echo</span> <span class="s2">"Database date: </span><span class="si">$(</span><span class="nb">stat</span> <span class="nt">-c</span> %y <span class="nv">$AIDE_DB</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">echo</span> <span class="s1">'N/A'</span><span class="si">)</span><span class="s2">"</span>
        <span class="nb">echo</span> <span class="s2">"Config file: </span><span class="nv">$AIDE_CONFIG</span><span class="s2">"</span>
        <span class="nb">echo</span> <span class="s2">"Log file: </span><span class="nv">$LOG_FILE</span><span class="s2">"</span>
        
        <span class="c"># ìµœê·¼ ì²´í¬ ì´ë ¥</span>
        <span class="nb">echo</span> <span class="s2">"Recent checks:"</span>
        <span class="nb">tail</span> <span class="nt">-n</span> 10 <span class="s2">"</span><span class="nv">$LOG_FILE</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"No recent checks found"</span>
        <span class="p">;;</span>
        
    <span class="s2">"report"</span><span class="p">)</span>
        <span class="nv">DAYS</span><span class="o">=</span><span class="k">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">7</span><span class="k">}</span>
        log_message <span class="s2">"Generating AIDE report for last </span><span class="nv">$DAYS</span><span class="s2"> days..."</span>
        
        <span class="nb">echo</span> <span class="s2">"=== AIDE Activity Report (Last </span><span class="nv">$DAYS</span><span class="s2"> days) ==="</span>
        <span class="nb">echo</span> <span class="s2">"Generated: </span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">"</span>
        <span class="nb">echo</span> <span class="s2">""</span>
        
        <span class="c"># ìµœê·¼ ì²´í¬ ê²°ê³¼</span>
        <span class="nb">echo</span> <span class="s2">"Recent integrity checks:"</span>
        <span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"AIDE check completed|AIDE detected|ERROR:"</span> <span class="s2">"</span><span class="nv">$LOG_FILE</span><span class="s2">"</span> 2&gt;/dev/null | <span class="se">\</span>
        <span class="nb">awk</span> <span class="nt">-v</span> <span class="nv">days</span><span class="o">=</span><span class="s2">"</span><span class="nv">$DAYS</span><span class="s2">"</span> <span class="s1">'
        BEGIN {
            cutoff = systime() - (days * 24 * 60 * 60)
        }
        {
            # ë‚ ì§œ íŒŒì‹± (ê°„ë‹¨í•œ ë°©ë²•)
            print $0
        }'</span> | <span class="nb">tail</span> <span class="nt">-n</span> 20
        
        <span class="nb">echo</span> <span class="s2">""</span>
        <span class="nb">echo</span> <span class="s2">"Alert summary:"</span>
        <span class="nb">grep</span> <span class="s2">"ALERT:"</span> <span class="s2">"</span><span class="nv">$ALERT_LOG</span><span class="s2">"</span> 2&gt;/dev/null | <span class="nb">tail</span> <span class="nt">-n</span> 10 <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"No alerts in period"</span>
        <span class="p">;;</span>
        
    <span class="k">*</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> {init|check|update|config-test|stats|report} [days]"</span>
        <span class="nb">echo</span> <span class="s2">""</span>
        <span class="nb">echo</span> <span class="s2">"Actions:"</span>
        <span class="nb">echo</span> <span class="s2">"  init        - Initialize AIDE database"</span>
        <span class="nb">echo</span> <span class="s2">"  check       - Perform integrity check"</span>
        <span class="nb">echo</span> <span class="s2">"  update      - Update AIDE database"</span>
        <span class="nb">echo</span> <span class="s2">"  config-test - Test configuration"</span>
        <span class="nb">echo</span> <span class="s2">"  stats       - Show statistics"</span>
        <span class="nb">echo</span> <span class="s2">"  report      - Generate activity report"</span>
        <span class="nb">echo</span> <span class="s2">""</span>
        <span class="nb">echo</span> <span class="s2">"Examples:"</span>
        <span class="nb">echo</span> <span class="s2">"  </span><span class="nv">$0</span><span class="s2"> check              # Perform integrity check"</span>
        <span class="nb">echo</span> <span class="s2">"  </span><span class="nv">$0</span><span class="s2"> report 30          # Generate 30-day report"</span>
        <span class="nb">exit </span>1
        <span class="p">;;</span>
<span class="k">esac</span>

log_message <span class="s2">"AIDE monitor completed successfully"</span>
</code></pre></div></div>

<h4 id="aide-ìë™í™”-í¬ë¡ ì¡-ì„¤ì •">AIDE ìë™í™” í¬ë¡ ì¡ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/cron.d/aide-monitoring</span>
<span class="c"># AIDE ìë™ ëª¨ë‹ˆí„°ë§ í¬ë¡  ì„¤ì •</span>

<span class="c"># ë§¤ì¼ 02:00ì— ë¬´ê²°ì„± ê²€ì‚¬ ì‹¤í–‰</span>
0 2 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> root /usr/local/bin/aide-monitor.sh check

<span class="c"># ë§¤ì£¼ ì¼ìš”ì¼ 03:00ì— ì£¼ê°„ ë¦¬í¬íŠ¸ ìƒì„±</span>
0 3 <span class="k">*</span> <span class="k">*</span> 0 root /usr/local/bin/aide-monitor.sh report 7

<span class="c"># ë§¤ì›” 1ì¼ 04:00ì— ì›”ê°„ ë¦¬í¬íŠ¸ ìƒì„±</span>
0 4 1 <span class="k">*</span> <span class="k">*</span> root /usr/local/bin/aide-monitor.sh report 30

<span class="c"># logrotate ì„¤ì •</span>
<span class="c"># /etc/logrotate.d/aide</span>
/var/log/aide/<span class="k">*</span>.log <span class="o">{</span>
    daily
    missingok
    rotate 365
    compress
    delaycompress
    notifempty
    create 644 root root
    postrotate
        <span class="c"># AIDE ë¡œê·¸ ìˆœí™˜ í›„ ì²˜ë¦¬ (í•„ìš”ì‹œ)</span>
    endscript
<span class="o">}</span>
</code></pre></div></div>

<h2 id="fail2ban-ê³ ê¸‰-ì„¤ì •--advanced-fail2ban-configuration">Fail2Ban ê³ ê¸‰ ì„¤ì • | Advanced Fail2Ban Configuration</h2>

<h3 id="-í¬ê´„ì ì¸-ì¹¨ì…-ì°¨ë‹¨-ì‹œìŠ¤í…œ">ğŸš« í¬ê´„ì ì¸ ì¹¨ì… ì°¨ë‹¨ ì‹œìŠ¤í…œ</h3>

<h4 id="fail2ban-ê³ ê¸‰-ë©”ì¸-ì„¤ì •">Fail2Ban ê³ ê¸‰ ë©”ì¸ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/fail2ban/jail.local</span>
<span class="c"># ì¢…í•©ì ì¸ Fail2Ban ì„¤ì •</span>

<span class="o">[</span>DEFAULT]
<span class="c"># ê¸°ë³¸ ì„¤ì •</span>
ignorelist <span class="o">=</span> 127.0.0.1/8 ::1 192.168.1.0/24 10.0.0.0/8
bantime <span class="o">=</span> 3600
findtime <span class="o">=</span> 600
maxretry <span class="o">=</span> 3
backend <span class="o">=</span> auto

<span class="c"># ë°±ì—”ë“œ ìš°ì„ ìˆœìœ„: systemd &gt; pyinotify &gt; gamin &gt; polling</span>
backend <span class="o">=</span> systemd

<span class="c"># ì•¡ì…˜ ì„¤ì •</span>
banaction <span class="o">=</span> iptables-multiport
banaction_allports <span class="o">=</span> iptables-allports
action_ <span class="o">=</span> %<span class="o">(</span>banaction<span class="o">)</span>s[name<span class="o">=</span>%<span class="o">(</span>__name__<span class="o">)</span>s, <span class="nv">bantime</span><span class="o">=</span><span class="s2">"%(bantime)s"</span>, <span class="nv">port</span><span class="o">=</span><span class="s2">"%(port)s"</span>, <span class="nv">protocol</span><span class="o">=</span><span class="s2">"%(protocol)s"</span>, <span class="nv">chain</span><span class="o">=</span><span class="s2">"%(chain)s"</span><span class="o">]</span>

<span class="c"># ì´ë©”ì¼ ì•¡ì…˜</span>
action_mw <span class="o">=</span> %<span class="o">(</span>banaction<span class="o">)</span>s[name<span class="o">=</span>%<span class="o">(</span>__name__<span class="o">)</span>s, <span class="nv">bantime</span><span class="o">=</span><span class="s2">"%(bantime)s"</span>, <span class="nv">port</span><span class="o">=</span><span class="s2">"%(port)s"</span>, <span class="nv">protocol</span><span class="o">=</span><span class="s2">"%(protocol)s"</span>, <span class="nv">chain</span><span class="o">=</span><span class="s2">"%(chain)s"</span><span class="o">]</span>
           %<span class="o">(</span>mta<span class="o">)</span>s-whois[name<span class="o">=</span>%<span class="o">(</span>__name__<span class="o">)</span>s, <span class="nv">sender</span><span class="o">=</span><span class="s2">"%(sender)s"</span>, <span class="nv">dest</span><span class="o">=</span><span class="s2">"%(destemail)s"</span>, <span class="nv">protocol</span><span class="o">=</span><span class="s2">"%(protocol)s"</span>, <span class="nv">chain</span><span class="o">=</span><span class="s2">"%(chain)s"</span><span class="o">]</span>

<span class="c"># ì´ë©”ì¼ + ë¡œê·¸ ì•¡ì…˜  </span>
action_mwl <span class="o">=</span> %<span class="o">(</span>banaction<span class="o">)</span>s[name<span class="o">=</span>%<span class="o">(</span>__name__<span class="o">)</span>s, <span class="nv">bantime</span><span class="o">=</span><span class="s2">"%(bantime)s"</span>, <span class="nv">port</span><span class="o">=</span><span class="s2">"%(port)s"</span>, <span class="nv">protocol</span><span class="o">=</span><span class="s2">"%(protocol)s"</span>, <span class="nv">chain</span><span class="o">=</span><span class="s2">"%(chain)s"</span><span class="o">]</span>
            %<span class="o">(</span>mta<span class="o">)</span>s-whois-lines[name<span class="o">=</span>%<span class="o">(</span>__name__<span class="o">)</span>s, <span class="nv">sender</span><span class="o">=</span><span class="s2">"%(sender)s"</span>, <span class="nv">dest</span><span class="o">=</span><span class="s2">"%(destemail)s"</span>, <span class="nv">logpath</span><span class="o">=</span><span class="s2">"%(logpath)s"</span>, <span class="nv">chain</span><span class="o">=</span><span class="s2">"%(chain)s"</span><span class="o">]</span>

<span class="c"># ê¸°ë³¸ ì•¡ì…˜</span>
action <span class="o">=</span> %<span class="o">(</span>action_mwl<span class="o">)</span>s

<span class="c"># ì´ë©”ì¼ ì„¤ì •</span>
destemail <span class="o">=</span> admin@example.com
sender <span class="o">=</span> fail2ban@example.com
mta <span class="o">=</span> sendmail

<span class="c"># ë¡œê·¸ ë ˆë²¨</span>
loglevel <span class="o">=</span> INFO
logtarget <span class="o">=</span> /var/log/fail2ban.log

<span class="c"># ì†Œì¼“ ì„¤ì •</span>
socket <span class="o">=</span> /var/run/fail2ban/fail2ban.sock
pidfile <span class="o">=</span> /var/run/fail2ban/fail2ban.pid

<span class="c"># ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •</span>
dbfile <span class="o">=</span> /var/lib/fail2ban/fail2ban.sqlite3
dbpurgeage <span class="o">=</span> 86400

<span class="c">#</span>
<span class="c"># SSH ë³´ì•ˆ ê°•í™”</span>
<span class="c">#</span>
<span class="o">[</span>sshd]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> ssh,2222
filter <span class="o">=</span> sshd
logpath <span class="o">=</span> /var/log/auth.log
maxretry <span class="o">=</span> 3
bantime <span class="o">=</span> 3600
findtime <span class="o">=</span> 600

<span class="o">[</span>sshd-ddos]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> ssh,2222
filter <span class="o">=</span> sshd-ddos
logpath <span class="o">=</span> /var/log/auth.log
maxretry <span class="o">=</span> 6
bantime <span class="o">=</span> 1800
findtime <span class="o">=</span> 120

<span class="c">#</span>
<span class="c"># ì›¹ ì„œë²„ ë³´ì•ˆ</span>
<span class="c">#</span>
<span class="o">[</span>apache-auth]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> http,https
filter <span class="o">=</span> apache-auth
logpath <span class="o">=</span> /var/log/apache2/error.log
maxretry <span class="o">=</span> 3
bantime <span class="o">=</span> 3600

<span class="o">[</span>apache-badbots]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> http,https
filter <span class="o">=</span> apache-badbots
logpath <span class="o">=</span> /var/log/apache2/access.log
maxretry <span class="o">=</span> 2
bantime <span class="o">=</span> 7200

<span class="o">[</span>apache-noscript]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> http,https
filter <span class="o">=</span> apache-noscript
logpath <span class="o">=</span> /var/log/apache2/access.log
maxretry <span class="o">=</span> 6
bantime <span class="o">=</span> 1800

<span class="o">[</span>apache-overflows]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> http,https
filter <span class="o">=</span> apache-overflows
logpath <span class="o">=</span> /var/log/apache2/error.log
maxretry <span class="o">=</span> 2
bantime <span class="o">=</span> 7200

<span class="o">[</span>apache-nohome]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> http,https
filter <span class="o">=</span> apache-nohome
logpath <span class="o">=</span> /var/log/apache2/access.log
maxretry <span class="o">=</span> 2
bantime <span class="o">=</span> 3600

<span class="o">[</span>apache-botsearch]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> http,https
filter <span class="o">=</span> apache-botsearch
logpath <span class="o">=</span> /var/log/apache2/access.log
maxretry <span class="o">=</span> 2
bantime <span class="o">=</span> 7200

<span class="c">#</span>
<span class="c"># Nginx ë³´ì•ˆ</span>
<span class="c">#</span>
<span class="o">[</span>nginx-http-auth]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> http,https
filter <span class="o">=</span> nginx-http-auth
logpath <span class="o">=</span> /var/log/nginx/error.log
maxretry <span class="o">=</span> 3
bantime <span class="o">=</span> 3600

<span class="o">[</span>nginx-limit-req]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> http,https
filter <span class="o">=</span> nginx-limit-req
logpath <span class="o">=</span> /var/log/nginx/error.log
maxretry <span class="o">=</span> 10
bantime <span class="o">=</span> 600
findtime <span class="o">=</span> 60

<span class="o">[</span>nginx-botsearch]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> http,https
filter <span class="o">=</span> nginx-botsearch
logpath <span class="o">=</span> /var/log/nginx/access.log
maxretry <span class="o">=</span> 2
bantime <span class="o">=</span> 7200

<span class="c">#</span>
<span class="c"># ë©”ì¼ ì„œë²„ ë³´ì•ˆ</span>
<span class="c">#</span>
<span class="o">[</span>postfix]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> smtp,465,submission
filter <span class="o">=</span> postfix
logpath <span class="o">=</span> /var/log/mail.log
maxretry <span class="o">=</span> 3
bantime <span class="o">=</span> 3600

<span class="o">[</span>dovecot]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> pop3,pop3s,imap,imaps,submission,465,sieve
filter <span class="o">=</span> dovecot
logpath <span class="o">=</span> /var/log/mail.log
maxretry <span class="o">=</span> 3
bantime <span class="o">=</span> 3600

<span class="c">#</span>
<span class="c"># FTP ë³´ì•ˆ</span>
<span class="c">#</span>
<span class="o">[</span>vsftpd]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> ftp,ftp-data,ftps,ftps-data
filter <span class="o">=</span> vsftpd
logpath <span class="o">=</span> /var/log/vsftpd.log
maxretry <span class="o">=</span> 3
bantime <span class="o">=</span> 3600

<span class="c">#</span>
<span class="c"># ë°ì´í„°ë² ì´ìŠ¤ ë³´ì•ˆ</span>
<span class="c">#</span>
<span class="o">[</span>mysqld-auth]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> 3306
filter <span class="o">=</span> mysqld-auth
logpath <span class="o">=</span> /var/log/mysql/error.log
maxretry <span class="o">=</span> 3
bantime <span class="o">=</span> 3600

<span class="c">#</span>
<span class="c"># ì»¤ìŠ¤í…€ ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆ</span>
<span class="c">#</span>
<span class="o">[</span>custom-app]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> 8080,8443
filter <span class="o">=</span> custom-app
logpath <span class="o">=</span> /var/log/custom-app/security.log
maxretry <span class="o">=</span> 5
bantime <span class="o">=</span> 7200
findtime <span class="o">=</span> 300

<span class="c">#</span>
<span class="c"># ì‹œìŠ¤í…œ ë¡œê·¸ ëª¨ë‹ˆí„°ë§</span>
<span class="c">#</span>
<span class="o">[</span>pam-generic]
enabled <span class="o">=</span> <span class="nb">true
</span>filter <span class="o">=</span> pam-generic
logpath <span class="o">=</span> /var/log/auth.log
maxretry <span class="o">=</span> 6
bantime <span class="o">=</span> 1800

<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span>
enabled <span class="o">=</span> <span class="nb">true
</span>filter <span class="o">=</span> <span class="nb">sudo
</span>logpath <span class="o">=</span> /var/log/auth.log
maxretry <span class="o">=</span> 3
bantime <span class="o">=</span> 3600
</code></pre></div></div>

<h4 id="ê³ ê¸‰-ì»¤ìŠ¤í…€-í•„í„°-ì‘ì„±">ê³ ê¸‰ ì»¤ìŠ¤í…€ í•„í„° ì‘ì„±</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/fail2ban/filter.d/custom-app.conf</span>
<span class="c"># ì»¤ìŠ¤í…€ ì• í”Œë¦¬ì¼€ì´ì…˜ìš© í•„í„°</span>

<span class="o">[</span>Definition]
<span class="c"># ì‹¤íŒ¨í•œ ë¡œê·¸ì¸ ì‹œë„</span>
failregex <span class="o">=</span> ^&lt;HOST&gt; .<span class="k">*</span> <span class="s2">"POST /api/login HTTP.*"</span> 401 .<span class="k">*</span><span class="err">$</span>
            ^&lt;HOST&gt; .<span class="k">*</span> <span class="s2">"POST /admin/login HTTP.*"</span> 403 .<span class="k">*</span><span class="err">$</span>
            ^&lt;HOST&gt; .<span class="k">*</span> <span class="s2">"Failed login attempt for user .* from &lt;HOST&gt;"</span><span class="err">$</span>
            ^&lt;HOST&gt; .<span class="k">*</span> <span class="s2">"Invalid API key from &lt;HOST&gt;"</span><span class="err">$</span>
            ^&lt;HOST&gt; .<span class="k">*</span> <span class="s2">"Suspicious activity detected from &lt;HOST&gt;"</span><span class="err">$</span>
            ^&lt;HOST&gt; .<span class="k">*</span> <span class="s2">"Rate limit exceeded for &lt;HOST&gt;"</span><span class="err">$</span>
            ^&lt;HOST&gt; .<span class="k">*</span> <span class="s2">"Brute force attempt detected from &lt;HOST&gt;"</span><span class="err">$</span>

<span class="c"># ë¬´ì‹œí•  íŒ¨í„´</span>
ignoreregex <span class="o">=</span> ^&lt;HOST&gt; .<span class="k">*</span> <span class="s2">"GET /health HTTP.*"</span> 200 .<span class="k">*</span><span class="err">$</span>
              ^&lt;HOST&gt; .<span class="k">*</span> <span class="s2">"GET /status HTTP.*"</span> 200 .<span class="k">*</span><span class="err">$</span>

<span class="c"># /etc/fail2ban/filter.d/nginx-botsearch.conf</span>
<span class="c"># Nginx ë´‡ ê²€ìƒ‰ íŒ¨í„´ í•„í„°</span>

<span class="o">[</span>Definition]
failregex <span class="o">=</span> ^&lt;HOST&gt; -.<span class="k">*</span>GET.<span class="k">*</span><span class="o">(</span><span class="se">\.</span>php|<span class="se">\.</span>asp|<span class="se">\.</span>exe|<span class="se">\.</span>pl|<span class="se">\.</span>cgi|<span class="se">\.</span>scgi<span class="o">)</span>
            ^&lt;HOST&gt; -.<span class="k">*</span>GET.<span class="k">*</span>admin
            ^&lt;HOST&gt; -.<span class="k">*</span>GET.<span class="k">*</span>phpMyAdmin
            ^&lt;HOST&gt; -.<span class="k">*</span>GET.<span class="k">*</span>wp-admin
            ^&lt;HOST&gt; -.<span class="k">*</span>GET.<span class="k">*</span>wp-login
            ^&lt;HOST&gt; -.<span class="k">*</span>GET.<span class="k">*</span>/etc/passwd
            ^&lt;HOST&gt; -.<span class="k">*</span>GET.<span class="k">*</span><span class="se">\.\.</span>/
            ^&lt;HOST&gt; -.<span class="k">*</span>GET.<span class="k">*</span><span class="o">(</span>proc/self/environ|etc/shadow|etc/passwd<span class="o">)</span>
            ^&lt;HOST&gt; -.<span class="k">*</span>GET.<span class="k">*</span><span class="o">(</span>cmd<span class="se">\.</span>exe|command<span class="se">\.</span>com<span class="o">)</span>
            ^&lt;HOST&gt; -.<span class="k">*</span>GET.<span class="k">*</span>sql.<span class="k">*</span>dump

ignoreregex <span class="o">=</span>

<span class="c"># /etc/fail2ban/filter.d/wordpress-security.conf</span>
<span class="c"># WordPress ë³´ì•ˆ ì „ìš© í•„í„°</span>

<span class="o">[</span>Definition]
failregex <span class="o">=</span> ^&lt;HOST&gt; .<span class="k">*</span>POST.<span class="k">*</span>/wp-login<span class="se">\.</span>php.<span class="k">*</span> 200
            ^&lt;HOST&gt; .<span class="k">*</span>POST.<span class="k">*</span>/wp-admin/admin-ajax<span class="se">\.</span>php.<span class="k">*</span> 400
            ^&lt;HOST&gt; .<span class="k">*</span>GET.<span class="k">*</span>/wp-admin.<span class="k">*</span>
            ^&lt;HOST&gt; .<span class="k">*</span>GET.<span class="k">*</span>/wp-content/.<span class="k">*</span><span class="se">\.</span>php
            ^&lt;HOST&gt; .<span class="k">*</span>GET.<span class="k">*</span><span class="se">\?</span><span class="nv">author</span><span class="o">=</span><span class="se">\d</span>+
            ^&lt;HOST&gt; .<span class="k">*</span>GET.<span class="k">*</span>/xmlrpc<span class="se">\.</span>php

ignoreregex <span class="o">=</span> ^&lt;HOST&gt; .<span class="k">*</span>POST.<span class="k">*</span>/wp-login<span class="se">\.</span>php.<span class="k">*</span> <span class="s2">"WordPress/.*"</span>

<span class="c"># /etc/fail2ban/filter.d/ddos.conf</span>
<span class="c"># DDoS ê³µê²© ê°ì§€ í•„í„°</span>

<span class="o">[</span>Definition]
failregex <span class="o">=</span> ^&lt;HOST&gt; -.<span class="k">*</span>GET.<span class="k">*</span>
ignoreregex <span class="o">=</span>

<span class="c"># /etc/fail2ban/filter.d/port-scan.conf</span>
<span class="c"># í¬íŠ¸ ìŠ¤ìº” ê°ì§€ í•„í„°</span>

<span class="o">[</span>Definition]
failregex <span class="o">=</span> ^.<span class="k">*</span>kernel:.<span class="k">*</span><span class="nv">IN</span><span class="o">=</span>.<span class="k">*</span><span class="nv">SRC</span><span class="o">=</span>&lt;HOST&gt;.<span class="k">*</span><span class="nv">DPT</span><span class="o">=(</span>1|7|9|11|15|70|79|80|109|110|143|443|993|995<span class="o">)</span>.<span class="k">*</span>
            ^.<span class="k">*</span>kernel:.<span class="k">*</span><span class="nv">SRC</span><span class="o">=</span>&lt;HOST&gt;.<span class="k">*</span><span class="nv">DPT</span><span class="o">=(</span>23|53|111|137|139|445|513|514|515|993|995|1433|1521|3389<span class="o">)</span>.<span class="k">*</span>

ignoreregex <span class="o">=</span>
</code></pre></div></div>

<h4 id="fail2ban-ê³ ê¸‰-ê´€ë¦¬-ìŠ¤í¬ë¦½íŠ¸">Fail2Ban ê³ ê¸‰ ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/fail2ban-manager.sh</span>
<span class="c"># Fail2Ban ê³ ê¸‰ ê´€ë¦¬ ë„êµ¬</span>

<span class="nv">ACTION</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">JAIL</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">IP</span><span class="o">=</span><span class="nv">$3</span>

<span class="c"># ìƒ‰ìƒ ì •ì˜</span>
<span class="nv">RED</span><span class="o">=</span><span class="s1">'\033[0;31m'</span>
<span class="nv">GREEN</span><span class="o">=</span><span class="s1">'\033[0;32m'</span>
<span class="nv">YELLOW</span><span class="o">=</span><span class="s1">'\033[1;33m'</span>
<span class="nv">BLUE</span><span class="o">=</span><span class="s1">'\033[0;34m'</span>
<span class="nv">NC</span><span class="o">=</span><span class="s1">'\033[0m'</span> <span class="c"># No Color</span>

print_color<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="k">${</span><span class="nv">2</span><span class="k">}${</span><span class="nv">1</span><span class="k">}${</span><span class="nv">NC</span><span class="k">}</span><span class="s2">"</span>
<span class="o">}</span>

check_fail2ban<span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">!</span> systemctl is-active <span class="nt">--quiet</span> fail2ban<span class="p">;</span> <span class="k">then
        </span>print_color <span class="s2">"ERROR: Fail2Ban is not running"</span> <span class="s2">"</span><span class="nv">$RED</span><span class="s2">"</span>
        <span class="nb">exit </span>1
    <span class="k">fi</span>
<span class="o">}</span>

<span class="k">case</span> <span class="nv">$ACTION</span> <span class="k">in</span>
    <span class="s2">"status"</span><span class="p">)</span>
        check_fail2ban
        <span class="nb">echo</span> <span class="s2">"=== Fail2Ban Status ==="</span>
        fail2ban-client status
        
        <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$JAIL</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">""</span>
            <span class="nb">echo</span> <span class="s2">"=== Jail: </span><span class="nv">$JAIL</span><span class="s2"> ==="</span>
            fail2ban-client status <span class="s2">"</span><span class="nv">$JAIL</span><span class="s2">"</span>
        <span class="k">fi</span>
        <span class="p">;;</span>
        
    <span class="s2">"ban"</span><span class="p">)</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$JAIL</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$IP</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> ban &lt;jail&gt; &lt;ip&gt;"</span>
            <span class="nb">exit </span>1
        <span class="k">fi
        
        </span>check_fail2ban
        print_color <span class="s2">"Banning IP </span><span class="nv">$IP</span><span class="s2"> in jail </span><span class="nv">$JAIL</span><span class="s2">..."</span> <span class="s2">"</span><span class="nv">$YELLOW</span><span class="s2">"</span>
        fail2ban-client <span class="nb">set</span> <span class="s2">"</span><span class="nv">$JAIL</span><span class="s2">"</span> banip <span class="s2">"</span><span class="nv">$IP</span><span class="s2">"</span>
        print_color <span class="s2">"IP </span><span class="nv">$IP</span><span class="s2"> banned successfully"</span> <span class="s2">"</span><span class="nv">$GREEN</span><span class="s2">"</span>
        <span class="p">;;</span>
        
    <span class="s2">"unban"</span><span class="p">)</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$IP</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> unban &lt;jail|all&gt; &lt;ip&gt;"</span>
            <span class="nb">exit </span>1
        <span class="k">fi
        
        </span>check_fail2ban
        <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$JAIL</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"all"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span>print_color <span class="s2">"Unbanning IP </span><span class="nv">$IP</span><span class="s2"> from all jails..."</span> <span class="s2">"</span><span class="nv">$YELLOW</span><span class="s2">"</span>
            <span class="k">for </span>jail <span class="k">in</span> <span class="si">$(</span>fail2ban-client status | <span class="nb">grep</span> <span class="s2">"Jail list:"</span> | <span class="nb">cut</span> <span class="nt">-d</span>: <span class="nt">-f2</span> | <span class="nb">tr</span> <span class="s1">','</span> <span class="s1">' '</span><span class="si">)</span><span class="p">;</span> <span class="k">do
                </span><span class="nv">jail</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$jail</span> | xargs<span class="si">)</span>  <span class="c"># trim whitespace</span>
                fail2ban-client <span class="nb">set</span> <span class="s2">"</span><span class="nv">$jail</span><span class="s2">"</span> unbanip <span class="s2">"</span><span class="nv">$IP</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
            </span><span class="k">done
        else
            </span>print_color <span class="s2">"Unbanning IP </span><span class="nv">$IP</span><span class="s2"> from jail </span><span class="nv">$JAIL</span><span class="s2">..."</span> <span class="s2">"</span><span class="nv">$YELLOW</span><span class="s2">"</span>
            fail2ban-client <span class="nb">set</span> <span class="s2">"</span><span class="nv">$JAIL</span><span class="s2">"</span> unbanip <span class="s2">"</span><span class="nv">$IP</span><span class="s2">"</span>
        <span class="k">fi
        </span>print_color <span class="s2">"IP </span><span class="nv">$IP</span><span class="s2"> unbanned successfully"</span> <span class="s2">"</span><span class="nv">$GREEN</span><span class="s2">"</span>
        <span class="p">;;</span>
        
    <span class="s2">"list-banned"</span><span class="p">)</span>
        check_fail2ban
        <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$JAIL</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"=== Banned IPs in jail: </span><span class="nv">$JAIL</span><span class="s2"> ==="</span>
            fail2ban-client get <span class="s2">"</span><span class="nv">$JAIL</span><span class="s2">"</span> banip
        <span class="k">else
            </span><span class="nb">echo</span> <span class="s2">"=== All Banned IPs ==="</span>
            <span class="k">for </span>jail <span class="k">in</span> <span class="si">$(</span>fail2ban-client status | <span class="nb">grep</span> <span class="s2">"Jail list:"</span> | <span class="nb">cut</span> <span class="nt">-d</span>: <span class="nt">-f2</span> | <span class="nb">tr</span> <span class="s1">','</span> <span class="s1">' '</span><span class="si">)</span><span class="p">;</span> <span class="k">do
                </span><span class="nv">jail</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$jail</span> | xargs<span class="si">)</span>
                <span class="nv">banned</span><span class="o">=</span><span class="si">$(</span>fail2ban-client get <span class="s2">"</span><span class="nv">$jail</span><span class="s2">"</span> banip 2&gt;/dev/null<span class="si">)</span>
                <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$banned</span><span class="s2">"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$banned</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"[]"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
                    </span><span class="nb">echo</span> <span class="s2">"Jail: </span><span class="nv">$jail</span><span class="s2">"</span>
                    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$banned</span><span class="s2">"</span>
                    <span class="nb">echo</span> <span class="s2">""</span>
                <span class="k">fi
            done
        fi</span>
        <span class="p">;;</span>
        
    <span class="s2">"stats"</span><span class="p">)</span>
        check_fail2ban
        <span class="nb">echo</span> <span class="s2">"=== Fail2Ban Statistics ==="</span>
        <span class="nb">echo</span> <span class="s2">""</span>
        
        <span class="c"># ì „ì²´ í†µê³„</span>
        <span class="nb">echo</span> <span class="s2">"Active jails:"</span>
        fail2ban-client status | <span class="nb">grep</span> <span class="s2">"Jail list:"</span> | <span class="nb">cut</span> <span class="nt">-d</span>: <span class="nt">-f2</span>
        
        <span class="nb">echo</span> <span class="s2">""</span>
        <span class="nb">echo</span> <span class="s2">"Jail statistics:"</span>
        <span class="k">for </span>jail <span class="k">in</span> <span class="si">$(</span>fail2ban-client status | <span class="nb">grep</span> <span class="s2">"Jail list:"</span> | <span class="nb">cut</span> <span class="nt">-d</span>: <span class="nt">-f2</span> | <span class="nb">tr</span> <span class="s1">','</span> <span class="s1">' '</span><span class="si">)</span><span class="p">;</span> <span class="k">do
            </span><span class="nv">jail</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$jail</span> | xargs<span class="si">)</span>
            <span class="nv">status</span><span class="o">=</span><span class="si">$(</span>fail2ban-client status <span class="s2">"</span><span class="nv">$jail</span><span class="s2">"</span> 2&gt;/dev/null<span class="si">)</span>
            <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
                </span><span class="nv">currently_failed</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$status</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="s2">"Currently failed:"</span> | <span class="nb">awk</span> <span class="s1">'{print $NF}'</span><span class="si">)</span>
                <span class="nv">total_failed</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$status</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="s2">"Total failed:"</span> | <span class="nb">awk</span> <span class="s1">'{print $NF}'</span><span class="si">)</span>
                <span class="nv">currently_banned</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$status</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="s2">"Currently banned:"</span> | <span class="nb">awk</span> <span class="s1">'{print $NF}'</span><span class="si">)</span>
                <span class="nv">total_banned</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$status</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="s2">"Total banned:"</span> | <span class="nb">awk</span> <span class="s1">'{print $NF}'</span><span class="si">)</span>
                
                <span class="nb">echo</span> <span class="s2">"  </span><span class="nv">$jail</span><span class="s2">: Failed=</span><span class="nv">$currently_failed</span><span class="s2">/</span><span class="nv">$total_failed</span><span class="s2">, Banned=</span><span class="nv">$currently_banned</span><span class="s2">/</span><span class="nv">$total_banned</span><span class="s2">"</span>
            <span class="k">fi
        done
        
        </span><span class="nb">echo</span> <span class="s2">""</span>
        <span class="nb">echo</span> <span class="s2">"Top banned IPs:"</span>
        <span class="nb">grep</span> <span class="s2">"Ban "</span> /var/log/fail2ban.log 2&gt;/dev/null | <span class="se">\</span>
        <span class="nb">awk</span> <span class="s1">'{print $(NF-1)}'</span> | <span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="nb">sort</span> <span class="nt">-nr</span> | <span class="nb">head</span> <span class="nt">-10</span>
        <span class="p">;;</span>
        
    <span class="s2">"top-attackers"</span><span class="p">)</span>
        <span class="nv">DAYS</span><span class="o">=</span><span class="k">${</span><span class="nv">JAIL</span><span class="k">:-</span><span class="nv">7</span><span class="k">}</span>
        <span class="nb">echo</span> <span class="s2">"=== Top Attackers (Last </span><span class="nv">$DAYS</span><span class="s2"> days) ==="</span>
        
        <span class="c"># ì§€ì •ëœ ë‚ ì§œë¶€í„°ì˜ ë¡œê·¸ ë¶„ì„</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nv">$DAYS</span> <span class="nt">-gt</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nv">DATE_FILTER</span><span class="o">=</span><span class="s2">"-since </span><span class="se">\"</span><span class="nv">$DAYS</span><span class="s2"> days ago</span><span class="se">\"</span><span class="s2">"</span>
        <span class="k">else
            </span><span class="nv">DATE_FILTER</span><span class="o">=</span><span class="s2">""</span>
        <span class="k">fi</span>
        
        <span class="c"># ë¡œê·¸ì—ì„œ ê³µê²© IP ì¶”ì¶œ ë° ë¶„ì„</span>
        <span class="nb">eval </span>journalctl <span class="nt">-u</span> fail2ban <span class="nv">$DATE_FILTER</span> 2&gt;/dev/null | <span class="se">\</span>
        <span class="nb">grep</span> <span class="s2">"Ban "</span> | <span class="se">\</span>
        <span class="nb">awk</span> <span class="s1">'{print $(NF-1)}'</span> | <span class="se">\</span>
        <span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="nb">sort</span> <span class="nt">-nr</span> | <span class="nb">head</span> <span class="nt">-20</span> | <span class="se">\</span>
        <span class="k">while </span><span class="nb">read </span>count ip<span class="p">;</span> <span class="k">do</span>
            <span class="c"># IP ì§€ì—­ ì •ë³´ ì¡°íšŒ (geoip ì‚¬ìš©, ì„¤ì¹˜ëœ ê²½ìš°)</span>
            <span class="k">if </span><span class="nb">command</span> <span class="nt">-v</span> geoiplookup <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
                </span><span class="nv">country</span><span class="o">=</span><span class="si">$(</span>geoiplookup <span class="s2">"</span><span class="nv">$ip</span><span class="s2">"</span> 2&gt;/dev/null | <span class="nb">cut</span> <span class="nt">-d</span>: <span class="nt">-f2</span> | xargs<span class="si">)</span>
            <span class="k">else
                </span><span class="nv">country</span><span class="o">=</span><span class="s2">"Unknown"</span>
            <span class="k">fi
            </span><span class="nb">printf</span> <span class="s2">"%-6s %-15s %s</span><span class="se">\n</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$count</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$ip</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$country</span><span class="s2">"</span>
        <span class="k">done</span>
        <span class="p">;;</span>
        
    <span class="s2">"analyze"</span><span class="p">)</span>
        <span class="nv">HOURS</span><span class="o">=</span><span class="k">${</span><span class="nv">JAIL</span><span class="k">:-</span><span class="nv">24</span><span class="k">}</span>
        <span class="nb">echo</span> <span class="s2">"=== Fail2Ban Analysis (Last </span><span class="nv">$HOURS</span><span class="s2"> hours) ==="</span>
        
        <span class="c"># ìµœê·¼ í™œë™ ë¶„ì„</span>
        <span class="nb">eval </span>journalctl <span class="nt">-u</span> fail2ban <span class="nt">--since</span> <span class="s2">"</span><span class="nv">$HOURS</span><span class="s2"> hours ago"</span> 2&gt;/dev/null | <span class="se">\</span>
        <span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"(Ban|Unban)"</span> | <span class="se">\</span>
        <span class="nb">awk</span> <span class="s1">'{
            if ($0 ~ /Ban /) bans++
            if ($0 ~ /Unban/) unbans++
        }
        END {
            print "Total bans: " (bans ? bans : 0)
            print "Total unbans: " (unbans ? unbans : 0)
            print "Net banned: " ((bans ? bans : 0) - (unbans ? unbans : 0))
        }'</span>
        
        <span class="nb">echo</span> <span class="s2">""</span>
        <span class="nb">echo</span> <span class="s2">"Activity by jail:"</span>
        <span class="nb">eval </span>journalctl <span class="nt">-u</span> fail2ban <span class="nt">--since</span> <span class="s2">"</span><span class="nv">$HOURS</span><span class="s2"> hours ago"</span> 2&gt;/dev/null | <span class="se">\</span>
        <span class="nb">grep</span> <span class="s2">"Ban "</span> | <span class="se">\</span>
        <span class="nb">awk</span> <span class="s1">'{
            # jail ì´ë¦„ ì¶”ì¶œ (ë¡œê·¸ í˜•ì‹ì— ë”°ë¼ ì¡°ì • í•„ìš”)
            match($0, /\[([^\]]+)\]/, arr)
            if (arr[1]) jails[arr[1]]++
        }
        END {
            for (jail in jails) {
                print "  " jail ": " jails[jail]
            }
        }'</span>
        <span class="p">;;</span>
        
    <span class="s2">"reload"</span><span class="p">)</span>
        print_color <span class="s2">"Reloading Fail2Ban configuration..."</span> <span class="s2">"</span><span class="nv">$YELLOW</span><span class="s2">"</span>
        systemctl reload fail2ban
        print_color <span class="s2">"Fail2Ban reloaded successfully"</span> <span class="s2">"</span><span class="nv">$GREEN</span><span class="s2">"</span>
        <span class="p">;;</span>
        
    <span class="s2">"test-filter"</span><span class="p">)</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$JAIL</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> test-filter &lt;filter-name&gt; [log-file]"</span>
            <span class="nb">exit </span>1
        <span class="k">fi
        
        </span><span class="nv">FILTER</span><span class="o">=</span><span class="nv">$JAIL</span>
        <span class="nv">LOGFILE</span><span class="o">=</span><span class="k">${</span><span class="nv">IP</span><span class="k">:-</span><span class="p">/var/log/auth.log</span><span class="k">}</span>
        
        <span class="nb">echo</span> <span class="s2">"=== Testing filter: </span><span class="nv">$FILTER</span><span class="s2"> ==="</span>
        <span class="nb">echo</span> <span class="s2">"Log file: </span><span class="nv">$LOGFILE</span><span class="s2">"</span>
        <span class="nb">echo</span> <span class="s2">""</span>
        
        fail2ban-regex <span class="s2">"</span><span class="nv">$LOGFILE</span><span class="s2">"</span> <span class="s2">"/etc/fail2ban/filter.d/</span><span class="k">${</span><span class="nv">FILTER</span><span class="k">}</span><span class="s2">.conf"</span>
        <span class="p">;;</span>
        
    <span class="s2">"whitelist"</span><span class="p">)</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$JAIL</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$IP</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> whitelist &lt;add|remove|list&gt; &lt;ip|network&gt;"</span>
            <span class="nb">exit </span>1
        <span class="k">fi
        
        </span><span class="nv">WHITELIST_ACTION</span><span class="o">=</span><span class="nv">$JAIL</span>
        <span class="nv">TARGET_IP</span><span class="o">=</span><span class="nv">$IP</span>
        
        <span class="k">case</span> <span class="nv">$WHITELIST_ACTION</span> <span class="k">in</span>
            <span class="s2">"add"</span><span class="p">)</span>
                print_color <span class="s2">"Adding </span><span class="nv">$TARGET_IP</span><span class="s2"> to whitelist..."</span> <span class="s2">"</span><span class="nv">$YELLOW</span><span class="s2">"</span>
                <span class="c"># jail.localì˜ ignoreipì— ì¶”ê°€</span>
                <span class="k">if </span><span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"ignoreip.*</span><span class="nv">$TARGET_IP</span><span class="s2">"</span> /etc/fail2ban/jail.local<span class="p">;</span> <span class="k">then
                    </span>print_color <span class="s2">"IP </span><span class="nv">$TARGET_IP</span><span class="s2"> is already whitelisted"</span> <span class="s2">"</span><span class="nv">$BLUE</span><span class="s2">"</span>
                <span class="k">else
                    </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"/^ignoreip = / s/</span><span class="nv">$/</span><span class="s2"> </span><span class="nv">$TARGET_IP</span><span class="s2">/"</span> /etc/fail2ban/jail.local
                    systemctl reload fail2ban
                    print_color <span class="s2">"IP </span><span class="nv">$TARGET_IP</span><span class="s2"> added to whitelist"</span> <span class="s2">"</span><span class="nv">$GREEN</span><span class="s2">"</span>
                <span class="k">fi</span>
                <span class="p">;;</span>
            <span class="s2">"remove"</span><span class="p">)</span>
                print_color <span class="s2">"Removing </span><span class="nv">$TARGET_IP</span><span class="s2"> from whitelist..."</span> <span class="s2">"</span><span class="nv">$YELLOW</span><span class="s2">"</span>
                <span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s/ </span><span class="nv">$TARGET_IP</span><span class="s2">//g"</span> /etc/fail2ban/jail.local
                systemctl reload fail2ban
                print_color <span class="s2">"IP </span><span class="nv">$TARGET_IP</span><span class="s2"> removed from whitelist"</span> <span class="s2">"</span><span class="nv">$GREEN</span><span class="s2">"</span>
                <span class="p">;;</span>
            <span class="s2">"list"</span><span class="p">)</span>
                <span class="nb">echo</span> <span class="s2">"=== Current Whitelist ==="</span>
                <span class="nb">grep</span> <span class="s2">"^ignoreip"</span> /etc/fail2ban/jail.local
                <span class="p">;;</span>
        <span class="k">esac</span>
        <span class="p">;;</span>
        
    <span class="s2">"backup"</span><span class="p">)</span>
        <span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">"/etc/fail2ban/backup/</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d-%H%M%S<span class="si">)</span><span class="s2">"</span>
        <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$BACKUP_DIR</span><span class="s2">"</span>
        
        <span class="nb">cp</span> <span class="nt">-r</span> /etc/fail2ban/jail.local <span class="s2">"</span><span class="nv">$BACKUP_DIR</span><span class="s2">/"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
        cp</span> <span class="nt">-r</span> /etc/fail2ban/filter.d/<span class="k">*</span> <span class="s2">"</span><span class="nv">$BACKUP_DIR</span><span class="s2">/"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
        cp</span> <span class="nt">-r</span> /etc/fail2ban/action.d/<span class="k">*</span> <span class="s2">"</span><span class="nv">$BACKUP_DIR</span><span class="s2">/"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true
        
        </span>print_color <span class="s2">"Fail2Ban configuration backed up to: </span><span class="nv">$BACKUP_DIR</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$GREEN</span><span class="s2">"</span>
        <span class="p">;;</span>
        
    <span class="k">*</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> {status|ban|unban|list-banned|stats|top-attackers|analyze|reload|test-filter|whitelist|backup} [options]"</span>
        <span class="nb">echo</span> <span class="s2">""</span>
        <span class="nb">echo</span> <span class="s2">"Commands:"</span>
        <span class="nb">echo</span> <span class="s2">"  status [jail]                    - Show Fail2Ban status"</span>
        <span class="nb">echo</span> <span class="s2">"  ban &lt;jail&gt; &lt;ip&gt;                 - Ban IP in specific jail"</span>
        <span class="nb">echo</span> <span class="s2">"  unban &lt;jail|all&gt; &lt;ip&gt;           - Unban IP from jail or all jails"</span>
        <span class="nb">echo</span> <span class="s2">"  list-banned [jail]              - List banned IPs"</span>
        <span class="nb">echo</span> <span class="s2">"  stats                           - Show comprehensive statistics"</span>
        <span class="nb">echo</span> <span class="s2">"  top-attackers [days]            - Show top attacking IPs"</span>
        <span class="nb">echo</span> <span class="s2">"  analyze [hours]                 - Analyze recent activity"</span>
        <span class="nb">echo</span> <span class="s2">"  reload                          - Reload configuration"</span>
        <span class="nb">echo</span> <span class="s2">"  test-filter &lt;filter&gt; [logfile]  - Test filter regex"</span>
        <span class="nb">echo</span> <span class="s2">"  whitelist &lt;add|remove|list&gt; &lt;ip&gt; - Manage whitelist"</span>
        <span class="nb">echo</span> <span class="s2">"  backup                          - Backup configuration"</span>
        <span class="nb">echo</span> <span class="s2">""</span>
        <span class="nb">echo</span> <span class="s2">"Examples:"</span>
        <span class="nb">echo</span> <span class="s2">"  </span><span class="nv">$0</span><span class="s2"> status sshd"</span>
        <span class="nb">echo</span> <span class="s2">"  </span><span class="nv">$0</span><span class="s2"> ban sshd 192.168.1.100"</span>
        <span class="nb">echo</span> <span class="s2">"  </span><span class="nv">$0</span><span class="s2"> unban all 192.168.1.100"</span>
        <span class="nb">echo</span> <span class="s2">"  </span><span class="nv">$0</span><span class="s2"> top-attackers 30"</span>
        <span class="nb">echo</span> <span class="s2">"  </span><span class="nv">$0</span><span class="s2"> test-filter sshd"</span>
        <span class="nb">exit </span>1
        <span class="p">;;</span>
<span class="k">esac</span>
</code></pre></div></div>

<h2 id="ë‹¤ìŒ-í¸-ì˜ˆê³ ">ë‹¤ìŒ í¸ ì˜ˆê³ </h2>

<p>ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” <strong>Wazuh SIEMê³¼ ì»¨í…Œì´ë„ˆ ë³´ì•ˆ</strong>ì„ ìƒì„¸íˆ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤:</p>
<ul>
  <li>Wazuh ì™„ì „ êµ¬ì¶• ë° ì„¤ì •</li>
  <li>ì‹¤ì‹œê°„ ìœ„í˜‘ íƒì§€ ë£° ì‘ì„±</li>
  <li>Docker/Kubernetes ë³´ì•ˆ ê°•í™”</li>
  <li>ì»´í”Œë¼ì´ì–¸ìŠ¤ ë° ê°ì‚¬ ë¡œê·¸ ê´€ë¦¬</li>
</ul>

<p>AIDEì™€ Fail2Banìœ¼ë¡œ ê°•ë ¥í•œ ì¹¨ì… íƒì§€ ì‹œìŠ¤í…œì„ ì™„ì„±í•˜ì…¨ë‚˜ìš”? ğŸ”ğŸ›¡ï¸</p>]]></content><author><name>DevOps Engineer</name></author><category term="Security" /><category term="Linux" /><category term="intrusion-detection" /><category term="aide" /><category term="fail2ban" /><category term="wazuh" /><category term="siem" /><category term="monitoring" /><category term="threat-detection" /><category term="log-analysis" /><summary type="html"><![CDATA[ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œì˜ ì™„ë²½í•œ ë³´ì•ˆì„ ìœ„í•œ ë§ˆì§€ë§‰ í¼ì¦ ì¡°ê°ì¸ ì¹¨ì… íƒì§€ì™€ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ì„ ì™„ì „íˆ ë§ˆìŠ¤í„°í•´ë³´ê² ìŠµë‹ˆë‹¤. AIDEë¶€í„° Wazuh SIEMê¹Œì§€, ëª¨ë“  ìœ„í˜‘ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ íƒì§€í•˜ê³  ëŒ€ì‘í•˜ëŠ” ìµœê³ ê¸‰ ë³´ì•ˆ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•©ë‹ˆë‹¤. AIDE íŒŒì¼ ë¬´ê²°ì„± ëª¨ë‹ˆí„°ë§ | AIDE File Integrity Monitoring ğŸ” AIDE ì™„ì „ ì„¤ì • ë° ìš´ì˜ AIDE ì„¤ì¹˜ ë° ê¸°ë³¸ ì„¤ì • # AIDE ì„¤ì¹˜ # CentOS/RHEL yum install aide # Ubuntu/Debian apt-get install aide aide-common # ì´ˆê¸° ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± aide --init mv /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz # ê¸°ë³¸ ë¬´ê²°ì„± ê²€ì‚¬ ì‹¤í–‰ aide --check # ì„¤ì • íŒŒì¼ ìœ„ì¹˜ # CentOS/RHEL: /etc/aide.conf # Ubuntu/Debian: /etc/aide/aide.conf ê³ ê¸‰ AIDE ì„¤ì • íŒŒì¼ ì‘ì„± # /etc/aide/aide.conf (Ubuntu) ë˜ëŠ” /etc/aide.conf (CentOS) # ì¢…í•©ì ì¸ AIDE ì„¤ì • # ë°ì´í„°ë² ì´ìŠ¤ ê²½ë¡œ database=file:/var/lib/aide/aide.db.gz database_out=file:/var/lib/aide/aide.db.new.gz # ë¡œê·¸ ì„¤ì • verbose=5 report_url=file:/var/log/aide/aide.log report_url=stdout # ê²€ì‚¬ ê·œì¹™ ì •ì˜ # R = p+i+n+u+g+s+m+c+md5 # L = p+i+n+u+g # E = ë¹ˆ ê·¸ë£¹ (ì¡´ì¬ë§Œ í™•ì¸) # &gt; = ë¡œê·¸ íŒŒì¼ (í¬ê¸° ì¦ê°€ë§Œ í—ˆìš©) # X = ì œì™¸ # ê¸°ë³¸ ê·œì¹™ë“¤ Binlib = p+i+n+u+g+s+b+m+c+md5+sha1+sha256+sha512 ConfFiles = p+i+n+u+g+s+m+c+md5+sha1+sha256 LogFiles = p+u+g+i+n+S DatabaseFiles = p+i+n+u+g+s+m+c+md5+sha1+sha256 StaticFiles = p+i+n+u+g+s+m+c+md5+sha1+sha256+acl+selinux+xattrs DeviceFiles = p+i+n+u+g+s+b+c+md5+sha1 # ê³ ê¸‰ ê·œì¹™ë“¤ CriticalFiles = p+i+n+u+g+s+m+c+md5+sha1+sha256+sha512+acl+selinux+xattrs WebFiles = p+i+n+u+g+s+m+c+md5+sha1+sha256 TempFiles = n+u+g+i UserFiles = p+i+n+u+g+s+m+c+md5+sha1 # ì‹œìŠ¤í…œ ì¤‘ìš” ë””ë ‰í† ë¦¬ /boot CriticalFiles /bin Binlib /sbin Binlib /usr/bin Binlib /usr/sbin Binlib /usr/local/bin Binlib /usr/local/sbin Binlib /lib Binlib /lib64 Binlib /usr/lib Binlib /usr/lib64 Binlib # ì„¤ì • íŒŒì¼ë“¤ /etc ConfFiles !/etc/mtab !/etc/.*~ !/etc/\..* !/etc/passwd- !/etc/shadow- !/etc/group- !/etc/gshadow- !/etc/security/opasswd !/etc/mail/statistics !/etc/prelink\.cache !/etc/crontab !/etc/cron\.d !/etc/cron\.daily !/etc/cron\.hourly !/etc/cron\.monthly !/etc/cron\.weekly # ì‹œìŠ¤í…œ íŠ¹ìˆ˜ íŒŒì¼ë“¤ /etc/passwd CriticalFiles /etc/shadow CriticalFiles /etc/group CriticalFiles /etc/gshadow CriticalFiles /etc/sudoers CriticalFiles /etc/ssh/sshd_config CriticalFiles /etc/hosts CriticalFiles /etc/hosts.allow CriticalFiles /etc/hosts.deny CriticalFiles # ì›¹ ì„œë²„ íŒŒì¼ë“¤ (í•´ë‹¹í•˜ëŠ” ê²½ìš°) /var/www WebFiles !/var/www/html/.*\.log$ !/var/www/.*cache.* # ë¡œê·¸ ë””ë ‰í† ë¦¬ (ì¦ê°€ë§Œ í—ˆìš©) /var/log LogFiles !/var/log/.*\.[0-9]+\.gz !/var/log/.*\.old !/var/log/.*\.log\.[0-9]+ !/var/log/lastlog !/var/log/wtmp !/var/log/btmp !/var/log/utmp # ì‚¬ìš©ì í™ˆ ë””ë ‰í† ë¦¬ (ì¤‘ìš” íŒŒì¼ë§Œ) /home UserFiles !/home/[^/]+/\.bash_history !/home/[^/]+/\.viminfo !/home/[^/]+/\.cache !/home/[^/]+/\.local !/home/[^/]+/\.mozilla !/home/[^/]+/\.gnome !/home/[^/]+/\.config # íŠ¹ë³„ ê´€ì‹¬ íŒŒì¼ë“¤ /root CriticalFiles !/root/\.bash_history !/root/\.viminfo # ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ë“¤ /var/lib/mysql DatabaseFiles /var/lib/postgresql DatabaseFiles # ì„ì‹œ ë””ë ‰í† ë¦¬ (ì¡´ì¬ë§Œ í™•ì¸) /tmp TempFiles /var/tmp TempFiles # ì œì™¸í•  ë””ë ‰í† ë¦¬ë“¤ !/proc !/sys !/dev !/run !/var/run !/var/lock !/var/cache !/var/spool !/media !/mnt !/tmp/.* !/var/tmp/.* !/lost\+found # ê³ ê¸‰ ì œì™¸ ê·œì¹™ë“¤ !/\.journal !/\.updated !/var/lib/dhcp/dhcpd\.leases.* !/var/lib/logrotate\.status !/var/lib/random-seed !/var/lib/systemd !/var/lib/dbus AIDE ìë™í™” ë° ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # /usr/local/bin/aide-monitor.sh # AIDE ìë™ ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼ ì‹œìŠ¤í…œ AIDE_CONFIG="/etc/aide/aide.conf" AIDE_DB="/var/lib/aide/aide.db.gz" AIDE_NEW_DB="/var/lib/aide/aide.db.new.gz" LOG_FILE="/var/log/aide/aide-monitor.log" ALERT_LOG="/var/log/aide/aide-alerts.log" EMAIL_TO="admin@example.com" LOCKFILE="/var/run/aide-monitor.lock" # í•¨ìˆ˜ ì •ì˜ log_message() { echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" | tee -a "$LOG_FILE" } send_alert() { local subject="$1" local message="$2" echo "$(date '+%Y-%m-%d %H:%M:%S') - ALERT: $subject" &gt;&gt; "$ALERT_LOG" echo "$message" &gt;&gt; "$ALERT_LOG" # ì´ë©”ì¼ ë°œì†¡ (sendmail ë˜ëŠ” mail ëª…ë ¹ ì‚¬ìš©) if command -v mail &gt;/dev/null 2&gt;&amp;1; then echo "$message" | mail -s "AIDE Alert: $subject" "$EMAIL_TO" fi # Slack ì›¹í›… (ì„¤ì •ëœ ê²½ìš°) if [ -n "$SLACK_WEBHOOK" ]; then curl -X POST -H 'Content-type: application/json' \ --data "{\"text\":\"ğŸš¨ AIDE Alert: $subject\n$message\"}" \ "$SLACK_WEBHOOK" fi # syslogì—ë„ ê¸°ë¡ logger -p local0.alert "AIDE Alert: $subject" } check_prerequisites() { # AIDE ì„¤ì¹˜ í™•ì¸ if ! command -v aide &gt;/dev/null 2&gt;&amp;1; then log_message "ERROR: AIDE is not installed" exit 1 fi # ë°ì´í„°ë² ì´ìŠ¤ ì¡´ì¬ í™•ì¸ if [ ! -f "$AIDE_DB" ]; then log_message "ERROR: AIDE database not found at $AIDE_DB" log_message "Run: aide --init &amp;&amp; mv $AIDE_NEW_DB $AIDE_DB" exit 1 fi # ë¡œê·¸ ë””ë ‰í† ë¦¬ ìƒì„± mkdir -p "$(dirname "$LOG_FILE")" mkdir -p "$(dirname "$ALERT_LOG")" } # ë½ íŒŒì¼ í™•ì¸ (ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€) if [ -f "$LOCKFILE" ]; then PID=$(cat "$LOCKFILE") if ps -p "$PID" &gt; /dev/null 2&gt;&amp;1; then log_message "Another instance is running (PID: $PID)" exit 1 else rm -f "$LOCKFILE" fi fi # ë½ íŒŒì¼ ìƒì„± echo $$ &gt; "$LOCKFILE" trap "rm -f $LOCKFILE" EXIT # ì•¡ì…˜ íŒŒë¼ë¯¸í„° ACTION=${1:-check} case $ACTION in "init") log_message "Initializing AIDE database..." check_prerequisites aide --init if [ $? -eq 0 ]; then mv "$AIDE_NEW_DB" "$AIDE_DB" log_message "AIDE database initialized successfully" else log_message "ERROR: AIDE database initialization failed" exit 1 fi ;; "check") log_message "Starting AIDE integrity check..." check_prerequisites # ì„ì‹œ íŒŒì¼ì— ê²°ê³¼ ì €ì¥ TEMP_RESULT="/tmp/aide-result-$$" # AIDE ì‹¤í–‰ aide --check &gt; "$TEMP_RESULT" 2&gt;&amp;1 AIDE_EXIT_CODE=$? case $AIDE_EXIT_CODE in 0) log_message "AIDE check completed - No changes detected" ;; 1) log_message "WARNING: AIDE detected file changes" # ë³€ê²½ ì‚¬í•­ ë¶„ì„ CHANGES=$(grep -E "(added|removed|changed)" "$TEMP_RESULT" | wc -l) # ìƒì„¸ ë³€ê²½ ë‚´ì—­ CHANGE_DETAILS=$(grep -A 5 -B 5 -E "(added|removed|changed)" "$TEMP_RESULT") # ì•Œë¦¼ ë°œì†¡ ALERT_MESSAGE="AIDE detected $CHANGES file system changes: $CHANGE_DETAILS Full report saved to: $LOG_FILE Time: $(date) Hostname: $(hostname)" send_alert "File System Changes Detected" "$ALERT_MESSAGE" # ì „ì²´ ê²°ê³¼ë¥¼ ë¡œê·¸ì— ì €ì¥ cat "$TEMP_RESULT" &gt;&gt; "$LOG_FILE" ;; 2|3|4|5|6|7|14|15|16|17) log_message "ERROR: AIDE check failed with exit code $AIDE_EXIT_CODE" send_alert "AIDE Check Failed" "AIDE integrity check failed with exit code: $AIDE_EXIT_CODE" ;; esac rm -f "$TEMP_RESULT" ;; "update") log_message "Updating AIDE database..." check_prerequisites # ë°±ì—… ìƒì„± BACKUP_DB="/var/lib/aide/aide.db.backup.$(date +%Y%m%d-%H%M%S).gz" cp "$AIDE_DB" "$BACKUP_DB" log_message "Database backed up to $BACKUP_DB" # ìƒˆ ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± aide --init if [ $? -eq 0 ]; then mv "$AIDE_NEW_DB" "$AIDE_DB" log_message "AIDE database updated successfully" else log_message "ERROR: AIDE database update failed" exit 1 fi ;; "config-test") log_message "Testing AIDE configuration..." aide --config-check if [ $? -eq 0 ]; then log_message "AIDE configuration is valid" else log_message "ERROR: AIDE configuration has errors" exit 1 fi ;; "stats") log_message "AIDE Statistics:" echo "Database size: $(du -h $AIDE_DB 2&gt;/dev/null || echo 'N/A')" echo "Database date: $(stat -c %y $AIDE_DB 2&gt;/dev/null || echo 'N/A')" echo "Config file: $AIDE_CONFIG" echo "Log file: $LOG_FILE" # ìµœê·¼ ì²´í¬ ì´ë ¥ echo "Recent checks:" tail -n 10 "$LOG_FILE" 2&gt;/dev/null || echo "No recent checks found" ;; "report") DAYS=${2:-7} log_message "Generating AIDE report for last $DAYS days..." echo "=== AIDE Activity Report (Last $DAYS days) ===" echo "Generated: $(date)" echo "" # ìµœê·¼ ì²´í¬ ê²°ê³¼ echo "Recent integrity checks:" grep -E "AIDE check completed|AIDE detected|ERROR:" "$LOG_FILE" 2&gt;/dev/null | \ awk -v days="$DAYS" ' BEGIN { cutoff = systime() - (days * 24 * 60 * 60) } { # ë‚ ì§œ íŒŒì‹± (ê°„ë‹¨í•œ ë°©ë²•) print $0 }' | tail -n 20 echo "" echo "Alert summary:" grep "ALERT:" "$ALERT_LOG" 2&gt;/dev/null | tail -n 10 || echo "No alerts in period" ;; *) echo "Usage: $0 {init|check|update|config-test|stats|report} [days]" echo "" echo "Actions:" echo " init - Initialize AIDE database" echo " check - Perform integrity check" echo " update - Update AIDE database" echo " config-test - Test configuration" echo " stats - Show statistics" echo " report - Generate activity report" echo "" echo "Examples:" echo " $0 check # Perform integrity check" echo " $0 report 30 # Generate 30-day report" exit 1 ;; esac log_message "AIDE monitor completed successfully" AIDE ìë™í™” í¬ë¡ ì¡ ì„¤ì • # /etc/cron.d/aide-monitoring # AIDE ìë™ ëª¨ë‹ˆí„°ë§ í¬ë¡  ì„¤ì • # ë§¤ì¼ 02:00ì— ë¬´ê²°ì„± ê²€ì‚¬ ì‹¤í–‰ 0 2 * * * root /usr/local/bin/aide-monitor.sh check # ë§¤ì£¼ ì¼ìš”ì¼ 03:00ì— ì£¼ê°„ ë¦¬í¬íŠ¸ ìƒì„± 0 3 * * 0 root /usr/local/bin/aide-monitor.sh report 7 # ë§¤ì›” 1ì¼ 04:00ì— ì›”ê°„ ë¦¬í¬íŠ¸ ìƒì„± 0 4 1 * * root /usr/local/bin/aide-monitor.sh report 30 # logrotate ì„¤ì • # /etc/logrotate.d/aide /var/log/aide/*.log { daily missingok rotate 365 compress delaycompress notifempty create 644 root root postrotate # AIDE ë¡œê·¸ ìˆœí™˜ í›„ ì²˜ë¦¬ (í•„ìš”ì‹œ) endscript } Fail2Ban ê³ ê¸‰ ì„¤ì • | Advanced Fail2Ban Configuration ğŸš« í¬ê´„ì ì¸ ì¹¨ì… ì°¨ë‹¨ ì‹œìŠ¤í…œ Fail2Ban ê³ ê¸‰ ë©”ì¸ ì„¤ì • # /etc/fail2ban/jail.local # ì¢…í•©ì ì¸ Fail2Ban ì„¤ì • [DEFAULT] # ê¸°ë³¸ ì„¤ì • ignorelist = 127.0.0.1/8 ::1 192.168.1.0/24 10.0.0.0/8 bantime = 3600 findtime = 600 maxretry = 3 backend = auto # ë°±ì—”ë“œ ìš°ì„ ìˆœìœ„: systemd &gt; pyinotify &gt; gamin &gt; polling backend = systemd # ì•¡ì…˜ ì„¤ì • banaction = iptables-multiport banaction_allports = iptables-allports action_ = %(banaction)s[name=%(__name__)s, bantime="%(bantime)s", port="%(port)s", protocol="%(protocol)s", chain="%(chain)s"] # ì´ë©”ì¼ ì•¡ì…˜ action_mw = %(banaction)s[name=%(__name__)s, bantime="%(bantime)s", port="%(port)s", protocol="%(protocol)s", chain="%(chain)s"] %(mta)s-whois[name=%(__name__)s, sender="%(sender)s", dest="%(destemail)s", protocol="%(protocol)s", chain="%(chain)s"] # ì´ë©”ì¼ + ë¡œê·¸ ì•¡ì…˜ action_mwl = %(banaction)s[name=%(__name__)s, bantime="%(bantime)s", port="%(port)s", protocol="%(protocol)s", chain="%(chain)s"] %(mta)s-whois-lines[name=%(__name__)s, sender="%(sender)s", dest="%(destemail)s", logpath="%(logpath)s", chain="%(chain)s"] # ê¸°ë³¸ ì•¡ì…˜ action = %(action_mwl)s # ì´ë©”ì¼ ì„¤ì • destemail = admin@example.com sender = fail2ban@example.com mta = sendmail # ë¡œê·¸ ë ˆë²¨ loglevel = INFO logtarget = /var/log/fail2ban.log # ì†Œì¼“ ì„¤ì • socket = /var/run/fail2ban/fail2ban.sock pidfile = /var/run/fail2ban/fail2ban.pid # ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • dbfile = /var/lib/fail2ban/fail2ban.sqlite3 dbpurgeage = 86400 # # SSH ë³´ì•ˆ ê°•í™” # [sshd] enabled = true port = ssh,2222 filter = sshd logpath = /var/log/auth.log maxretry = 3 bantime = 3600 findtime = 600 [sshd-ddos] enabled = true port = ssh,2222 filter = sshd-ddos logpath = /var/log/auth.log maxretry = 6 bantime = 1800 findtime = 120 # # ì›¹ ì„œë²„ ë³´ì•ˆ # [apache-auth] enabled = true port = http,https filter = apache-auth logpath = /var/log/apache2/error.log maxretry = 3 bantime = 3600 [apache-badbots] enabled = true port = http,https filter = apache-badbots logpath = /var/log/apache2/access.log maxretry = 2 bantime = 7200 [apache-noscript] enabled = true port = http,https filter = apache-noscript logpath = /var/log/apache2/access.log maxretry = 6 bantime = 1800 [apache-overflows] enabled = true port = http,https filter = apache-overflows logpath = /var/log/apache2/error.log maxretry = 2 bantime = 7200 [apache-nohome] enabled = true port = http,https filter = apache-nohome logpath = /var/log/apache2/access.log maxretry = 2 bantime = 3600 [apache-botsearch] enabled = true port = http,https filter = apache-botsearch logpath = /var/log/apache2/access.log maxretry = 2 bantime = 7200 # # Nginx ë³´ì•ˆ # [nginx-http-auth] enabled = true port = http,https filter = nginx-http-auth logpath = /var/log/nginx/error.log maxretry = 3 bantime = 3600 [nginx-limit-req] enabled = true port = http,https filter = nginx-limit-req logpath = /var/log/nginx/error.log maxretry = 10 bantime = 600 findtime = 60 [nginx-botsearch] enabled = true port = http,https filter = nginx-botsearch logpath = /var/log/nginx/access.log maxretry = 2 bantime = 7200 # # ë©”ì¼ ì„œë²„ ë³´ì•ˆ # [postfix] enabled = true port = smtp,465,submission filter = postfix logpath = /var/log/mail.log maxretry = 3 bantime = 3600 [dovecot] enabled = true port = pop3,pop3s,imap,imaps,submission,465,sieve filter = dovecot logpath = /var/log/mail.log maxretry = 3 bantime = 3600 # # FTP ë³´ì•ˆ # [vsftpd] enabled = true port = ftp,ftp-data,ftps,ftps-data filter = vsftpd logpath = /var/log/vsftpd.log maxretry = 3 bantime = 3600 # # ë°ì´í„°ë² ì´ìŠ¤ ë³´ì•ˆ # [mysqld-auth] enabled = true port = 3306 filter = mysqld-auth logpath = /var/log/mysql/error.log maxretry = 3 bantime = 3600 # # ì»¤ìŠ¤í…€ ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆ # [custom-app] enabled = true port = 8080,8443 filter = custom-app logpath = /var/log/custom-app/security.log maxretry = 5 bantime = 7200 findtime = 300 # # ì‹œìŠ¤í…œ ë¡œê·¸ ëª¨ë‹ˆí„°ë§ # [pam-generic] enabled = true filter = pam-generic logpath = /var/log/auth.log maxretry = 6 bantime = 1800 [sudo] enabled = true filter = sudo logpath = /var/log/auth.log maxretry = 3 bantime = 3600 ê³ ê¸‰ ì»¤ìŠ¤í…€ í•„í„° ì‘ì„± # /etc/fail2ban/filter.d/custom-app.conf # ì»¤ìŠ¤í…€ ì• í”Œë¦¬ì¼€ì´ì…˜ìš© í•„í„° [Definition] # ì‹¤íŒ¨í•œ ë¡œê·¸ì¸ ì‹œë„ failregex = ^&lt;HOST&gt; .* "POST /api/login HTTP.*" 401 .*$ ^&lt;HOST&gt; .* "POST /admin/login HTTP.*" 403 .*$ ^&lt;HOST&gt; .* "Failed login attempt for user .* from &lt;HOST&gt;"$ ^&lt;HOST&gt; .* "Invalid API key from &lt;HOST&gt;"$ ^&lt;HOST&gt; .* "Suspicious activity detected from &lt;HOST&gt;"$ ^&lt;HOST&gt; .* "Rate limit exceeded for &lt;HOST&gt;"$ ^&lt;HOST&gt; .* "Brute force attempt detected from &lt;HOST&gt;"$ # ë¬´ì‹œí•  íŒ¨í„´ ignoreregex = ^&lt;HOST&gt; .* "GET /health HTTP.*" 200 .*$ ^&lt;HOST&gt; .* "GET /status HTTP.*" 200 .*$ # /etc/fail2ban/filter.d/nginx-botsearch.conf # Nginx ë´‡ ê²€ìƒ‰ íŒ¨í„´ í•„í„° [Definition] failregex = ^&lt;HOST&gt; -.*GET.*(\.php|\.asp|\.exe|\.pl|\.cgi|\.scgi) ^&lt;HOST&gt; -.*GET.*admin ^&lt;HOST&gt; -.*GET.*phpMyAdmin ^&lt;HOST&gt; -.*GET.*wp-admin ^&lt;HOST&gt; -.*GET.*wp-login ^&lt;HOST&gt; -.*GET.*/etc/passwd ^&lt;HOST&gt; -.*GET.*\.\./ ^&lt;HOST&gt; -.*GET.*(proc/self/environ|etc/shadow|etc/passwd) ^&lt;HOST&gt; -.*GET.*(cmd\.exe|command\.com) ^&lt;HOST&gt; -.*GET.*sql.*dump ignoreregex = # /etc/fail2ban/filter.d/wordpress-security.conf # WordPress ë³´ì•ˆ ì „ìš© í•„í„° [Definition] failregex = ^&lt;HOST&gt; .*POST.*/wp-login\.php.* 200 ^&lt;HOST&gt; .*POST.*/wp-admin/admin-ajax\.php.* 400 ^&lt;HOST&gt; .*GET.*/wp-admin.* ^&lt;HOST&gt; .*GET.*/wp-content/.*\.php ^&lt;HOST&gt; .*GET.*\?author=\d+ ^&lt;HOST&gt; .*GET.*/xmlrpc\.php ignoreregex = ^&lt;HOST&gt; .*POST.*/wp-login\.php.* "WordPress/.*" # /etc/fail2ban/filter.d/ddos.conf # DDoS ê³µê²© ê°ì§€ í•„í„° [Definition] failregex = ^&lt;HOST&gt; -.*GET.* ignoreregex = # /etc/fail2ban/filter.d/port-scan.conf # í¬íŠ¸ ìŠ¤ìº” ê°ì§€ í•„í„° [Definition] failregex = ^.*kernel:.*IN=.*SRC=&lt;HOST&gt;.*DPT=(1|7|9|11|15|70|79|80|109|110|143|443|993|995).* ^.*kernel:.*SRC=&lt;HOST&gt;.*DPT=(23|53|111|137|139|445|513|514|515|993|995|1433|1521|3389).* ignoreregex = Fail2Ban ê³ ê¸‰ ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # /usr/local/bin/fail2ban-manager.sh # Fail2Ban ê³ ê¸‰ ê´€ë¦¬ ë„êµ¬ ACTION=$1 JAIL=$2 IP=$3 # ìƒ‰ìƒ ì •ì˜ RED='\033[0;31m' GREEN='\033[0;32m' YELLOW='\033[1;33m' BLUE='\033[0;34m' NC='\033[0m' # No Color print_color() { echo -e "${2}${1}${NC}" } check_fail2ban() { if ! systemctl is-active --quiet fail2ban; then print_color "ERROR: Fail2Ban is not running" "$RED" exit 1 fi } case $ACTION in "status") check_fail2ban echo "=== Fail2Ban Status ===" fail2ban-client status if [ -n "$JAIL" ]; then echo "" echo "=== Jail: $JAIL ===" fail2ban-client status "$JAIL" fi ;; "ban") if [ -z "$JAIL" ] || [ -z "$IP" ]; then echo "Usage: $0 ban &lt;jail&gt; &lt;ip&gt;" exit 1 fi check_fail2ban print_color "Banning IP $IP in jail $JAIL..." "$YELLOW" fail2ban-client set "$JAIL" banip "$IP" print_color "IP $IP banned successfully" "$GREEN" ;; "unban") if [ -z "$IP" ]; then echo "Usage: $0 unban &lt;jail|all&gt; &lt;ip&gt;" exit 1 fi check_fail2ban if [ "$JAIL" = "all" ]; then print_color "Unbanning IP $IP from all jails..." "$YELLOW" for jail in $(fail2ban-client status | grep "Jail list:" | cut -d: -f2 | tr ',' ' '); do jail=$(echo $jail | xargs) # trim whitespace fail2ban-client set "$jail" unbanip "$IP" 2&gt;/dev/null || true done else print_color "Unbanning IP $IP from jail $JAIL..." "$YELLOW" fail2ban-client set "$JAIL" unbanip "$IP" fi print_color "IP $IP unbanned successfully" "$GREEN" ;; "list-banned") check_fail2ban if [ -n "$JAIL" ]; then echo "=== Banned IPs in jail: $JAIL ===" fail2ban-client get "$JAIL" banip else echo "=== All Banned IPs ===" for jail in $(fail2ban-client status | grep "Jail list:" | cut -d: -f2 | tr ',' ' '); do jail=$(echo $jail | xargs) banned=$(fail2ban-client get "$jail" banip 2&gt;/dev/null) if [ -n "$banned" ] &amp;&amp; [ "$banned" != "[]" ]; then echo "Jail: $jail" echo "$banned" echo "" fi done fi ;; "stats") check_fail2ban echo "=== Fail2Ban Statistics ===" echo "" # ì „ì²´ í†µê³„ echo "Active jails:" fail2ban-client status | grep "Jail list:" | cut -d: -f2 echo "" echo "Jail statistics:" for jail in $(fail2ban-client status | grep "Jail list:" | cut -d: -f2 | tr ',' ' '); do jail=$(echo $jail | xargs) status=$(fail2ban-client status "$jail" 2&gt;/dev/null) if [ $? -eq 0 ]; then currently_failed=$(echo "$status" | grep "Currently failed:" | awk '{print $NF}') total_failed=$(echo "$status" | grep "Total failed:" | awk '{print $NF}') currently_banned=$(echo "$status" | grep "Currently banned:" | awk '{print $NF}') total_banned=$(echo "$status" | grep "Total banned:" | awk '{print $NF}') echo " $jail: Failed=$currently_failed/$total_failed, Banned=$currently_banned/$total_banned" fi done echo "" echo "Top banned IPs:" grep "Ban " /var/log/fail2ban.log 2&gt;/dev/null | \ awk '{print $(NF-1)}' | sort | uniq -c | sort -nr | head -10 ;; "top-attackers") DAYS=${JAIL:-7} echo "=== Top Attackers (Last $DAYS days) ===" # ì§€ì •ëœ ë‚ ì§œë¶€í„°ì˜ ë¡œê·¸ ë¶„ì„ if [ $DAYS -gt 0 ]; then DATE_FILTER="-since \"$DAYS days ago\"" else DATE_FILTER="" fi # ë¡œê·¸ì—ì„œ ê³µê²© IP ì¶”ì¶œ ë° ë¶„ì„ eval journalctl -u fail2ban $DATE_FILTER 2&gt;/dev/null | \ grep "Ban " | \ awk '{print $(NF-1)}' | \ sort | uniq -c | sort -nr | head -20 | \ while read count ip; do # IP ì§€ì—­ ì •ë³´ ì¡°íšŒ (geoip ì‚¬ìš©, ì„¤ì¹˜ëœ ê²½ìš°) if command -v geoiplookup &gt;/dev/null 2&gt;&amp;1; then country=$(geoiplookup "$ip" 2&gt;/dev/null | cut -d: -f2 | xargs) else country="Unknown" fi printf "%-6s %-15s %s\n" "$count" "$ip" "$country" done ;; "analyze") HOURS=${JAIL:-24} echo "=== Fail2Ban Analysis (Last $HOURS hours) ===" # ìµœê·¼ í™œë™ ë¶„ì„ eval journalctl -u fail2ban --since "$HOURS hours ago" 2&gt;/dev/null | \ grep -E "(Ban|Unban)" | \ awk '{ if ($0 ~ /Ban /) bans++ if ($0 ~ /Unban/) unbans++ } END { print "Total bans: " (bans ? bans : 0) print "Total unbans: " (unbans ? unbans : 0) print "Net banned: " ((bans ? bans : 0) - (unbans ? unbans : 0)) }' echo "" echo "Activity by jail:" eval journalctl -u fail2ban --since "$HOURS hours ago" 2&gt;/dev/null | \ grep "Ban " | \ awk '{ # jail ì´ë¦„ ì¶”ì¶œ (ë¡œê·¸ í˜•ì‹ì— ë”°ë¼ ì¡°ì • í•„ìš”) match($0, /\[([^\]]+)\]/, arr) if (arr[1]) jails[arr[1]]++ } END { for (jail in jails) { print " " jail ": " jails[jail] } }' ;; "reload") print_color "Reloading Fail2Ban configuration..." "$YELLOW" systemctl reload fail2ban print_color "Fail2Ban reloaded successfully" "$GREEN" ;; "test-filter") if [ -z "$JAIL" ]; then echo "Usage: $0 test-filter &lt;filter-name&gt; [log-file]" exit 1 fi FILTER=$JAIL LOGFILE=${IP:-/var/log/auth.log} echo "=== Testing filter: $FILTER ===" echo "Log file: $LOGFILE" echo "" fail2ban-regex "$LOGFILE" "/etc/fail2ban/filter.d/${FILTER}.conf" ;; "whitelist") if [ -z "$JAIL" ] || [ -z "$IP" ]; then echo "Usage: $0 whitelist &lt;add|remove|list&gt; &lt;ip|network&gt;" exit 1 fi WHITELIST_ACTION=$JAIL TARGET_IP=$IP case $WHITELIST_ACTION in "add") print_color "Adding $TARGET_IP to whitelist..." "$YELLOW" # jail.localì˜ ignoreipì— ì¶”ê°€ if grep -q "ignoreip.*$TARGET_IP" /etc/fail2ban/jail.local; then print_color "IP $TARGET_IP is already whitelisted" "$BLUE" else sed -i "/^ignoreip = / s/$/ $TARGET_IP/" /etc/fail2ban/jail.local systemctl reload fail2ban print_color "IP $TARGET_IP added to whitelist" "$GREEN" fi ;; "remove") print_color "Removing $TARGET_IP from whitelist..." "$YELLOW" sed -i "s/ $TARGET_IP//g" /etc/fail2ban/jail.local systemctl reload fail2ban print_color "IP $TARGET_IP removed from whitelist" "$GREEN" ;; "list") echo "=== Current Whitelist ===" grep "^ignoreip" /etc/fail2ban/jail.local ;; esac ;; "backup") BACKUP_DIR="/etc/fail2ban/backup/$(date +%Y%m%d-%H%M%S)" mkdir -p "$BACKUP_DIR" cp -r /etc/fail2ban/jail.local "$BACKUP_DIR/" 2&gt;/dev/null || true cp -r /etc/fail2ban/filter.d/* "$BACKUP_DIR/" 2&gt;/dev/null || true cp -r /etc/fail2ban/action.d/* "$BACKUP_DIR/" 2&gt;/dev/null || true print_color "Fail2Ban configuration backed up to: $BACKUP_DIR" "$GREEN" ;; *) echo "Usage: $0 {status|ban|unban|list-banned|stats|top-attackers|analyze|reload|test-filter|whitelist|backup} [options]" echo "" echo "Commands:" echo " status [jail] - Show Fail2Ban status" echo " ban &lt;jail&gt; &lt;ip&gt; - Ban IP in specific jail" echo " unban &lt;jail|all&gt; &lt;ip&gt; - Unban IP from jail or all jails" echo " list-banned [jail] - List banned IPs" echo " stats - Show comprehensive statistics" echo " top-attackers [days] - Show top attacking IPs" echo " analyze [hours] - Analyze recent activity" echo " reload - Reload configuration" echo " test-filter &lt;filter&gt; [logfile] - Test filter regex" echo " whitelist &lt;add|remove|list&gt; &lt;ip&gt; - Manage whitelist" echo " backup - Backup configuration" echo "" echo "Examples:" echo " $0 status sshd" echo " $0 ban sshd 192.168.1.100" echo " $0 unban all 192.168.1.100" echo " $0 top-attackers 30" echo " $0 test-filter sshd" exit 1 ;; esac ë‹¤ìŒ í¸ ì˜ˆê³  ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” Wazuh SIEMê³¼ ì»¨í…Œì´ë„ˆ ë³´ì•ˆì„ ìƒì„¸íˆ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤: Wazuh ì™„ì „ êµ¬ì¶• ë° ì„¤ì • ì‹¤ì‹œê°„ ìœ„í˜‘ íƒì§€ ë£° ì‘ì„± Docker/Kubernetes ë³´ì•ˆ ê°•í™” ì»´í”Œë¼ì´ì–¸ìŠ¤ ë° ê°ì‚¬ ë¡œê·¸ ê´€ë¦¬ AIDEì™€ Fail2Banìœ¼ë¡œ ê°•ë ¥í•œ ì¹¨ì… íƒì§€ ì‹œìŠ¤í…œì„ ì™„ì„±í•˜ì…¨ë‚˜ìš”? ğŸ”ğŸ›¡ï¸]]></summary></entry><entry><title type="html">ë„¤íŠ¸ì›Œí‚¹ ì™„ì „ ê°€ì´ë“œ 5í¸ - ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆê³¼ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… | Complete Network Guide Part 5 - Network Security &amp;amp; Troubleshooting</title><link href="https://leeyonghe.github.io/infra-blog/blog/2025/03/07/networking-guide-part5.html" rel="alternate" type="text/html" title="ë„¤íŠ¸ì›Œí‚¹ ì™„ì „ ê°€ì´ë“œ 5í¸ - ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆê³¼ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… | Complete Network Guide Part 5 - Network Security &amp;amp; Troubleshooting" /><published>2025-03-07T03:00:00+00:00</published><updated>2025-03-07T03:00:00+00:00</updated><id>https://leeyonghe.github.io/infra-blog/blog/2025/03/07/networking-guide-part5</id><content type="html" xml:base="https://leeyonghe.github.io/infra-blog/blog/2025/03/07/networking-guide-part5.html"><![CDATA[<p>ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆì˜ ìµœì‹  ê¸°ìˆ ê³¼ ê³ ê¸‰ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê¸°ë²•ì„ ì‹¤ë¬´ ì¤‘ì‹¬ìœ¼ë¡œ ì™„ì „íˆ ë§ˆìŠ¤í„°í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<h2 id="ì°¨ì„¸ëŒ€-ë°©í™”ë²½-ngfw--next-generation-firewall">ì°¨ì„¸ëŒ€ ë°©í™”ë²½ (NGFW) | Next-Generation Firewall</h2>

<h3 id="-ngfw-ê¸°ëŠ¥ê³¼-íŠ¹ì§•">ğŸ”¥ NGFW ê¸°ëŠ¥ê³¼ íŠ¹ì§•</h3>

<h4 id="ì „í†µ-ë°©í™”ë²½-vs-ngfw-ë¹„êµ">ì „í†µ ë°©í™”ë²½ vs NGFW ë¹„êµ</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Traditional Firewall:
- L3/L4 íŒ¨í‚· í•„í„°ë§ <span class="o">(</span>IP, Port<span class="o">)</span>
- Stateful ì—°ê²° ì¶”ì 
- NAT/PAT ê¸°ëŠ¥

Next-Generation Firewall <span class="o">(</span>NGFW<span class="o">)</span>:
- Application Awareness <span class="o">(</span>L7<span class="o">)</span>
- Intrusion Prevention <span class="o">(</span>IPS<span class="o">)</span>
- SSL/TLS Decryption
- User Identity Integration
- Advanced Threat Protection
- Sandboxing
</code></pre></div></div>

<h4 id="palo-alto-ngfw-ì„¤ì •-ì‹¤ìŠµ">Palo Alto NGFW ì„¤ì • ì‹¤ìŠµ</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë³´ì•ˆ ì •ì±… ì„¤ì •</span>
<span class="c"># ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ë°˜ ì •ì±…</span>
configure
<span class="nb">set </span>rulebase security rules <span class="s2">"Allow-Office365"</span> from any
<span class="nb">set </span>rulebase security rules <span class="s2">"Allow-Office365"</span> to any
<span class="nb">set </span>rulebase security rules <span class="s2">"Allow-Office365"</span> <span class="nb">source </span>any
<span class="nb">set </span>rulebase security rules <span class="s2">"Allow-Office365"</span> destination any
<span class="nb">set </span>rulebase security rules <span class="s2">"Allow-Office365"</span> application <span class="o">[</span> ms-office365 outlook-web-access <span class="o">]</span>
<span class="nb">set </span>rulebase security rules <span class="s2">"Allow-Office365"</span> service application-default
<span class="nb">set </span>rulebase security rules <span class="s2">"Allow-Office365"</span> action allow

<span class="c"># ì‚¬ìš©ì ê¸°ë°˜ ì •ì±…</span>
<span class="nb">set </span>rulebase security rules <span class="s2">"Block-Social-Media"</span> from trust
<span class="nb">set </span>rulebase security rules <span class="s2">"Block-Social-Media"</span> to untrust
<span class="nb">set </span>rulebase security rules <span class="s2">"Block-Social-Media"</span> source-user <span class="o">[</span> <span class="s2">"DOMAIN</span><span class="se">\s</span><span class="s2">ales-team"</span> <span class="o">]</span>
<span class="nb">set </span>rulebase security rules <span class="s2">"Block-Social-Media"</span> application <span class="o">[</span> facebook twitter instagram <span class="o">]</span>
<span class="nb">set </span>rulebase security rules <span class="s2">"Block-Social-Media"</span> action deny

<span class="c"># SSL Decryption ì •ì±…</span>
<span class="nb">set </span>shared ssl-decrypt ssl-decrypt-policy <span class="s2">"Decrypt-Inbound"</span> rules <span class="s2">"web-traffic"</span>
<span class="nb">set </span>shared ssl-decrypt ssl-decrypt-policy <span class="s2">"Decrypt-Inbound"</span> rules <span class="s2">"web-traffic"</span> category <span class="o">[</span> <span class="s2">"business-and-economy"</span> <span class="s2">"computer-and-internet-info"</span> <span class="o">]</span>
<span class="nb">set </span>shared ssl-decrypt ssl-decrypt-policy <span class="s2">"Decrypt-Inbound"</span> rules <span class="s2">"web-traffic"</span> action decrypt
</code></pre></div></div>

<h4 id="pfsense-ì˜¤í”ˆì†ŒìŠ¤-ë°©í™”ë²½-ì„¤ì •">pfSense ì˜¤í”ˆì†ŒìŠ¤ ë°©í™”ë²½ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># pfSense íŒ¨í‚¤ì§€ ì„¤ì¹˜</span>
pkg <span class="nb">install </span>pfSense-pkg-suricata
pkg <span class="nb">install </span>pfSense-pkg-pfBlockerNG

<span class="c"># Suricata IPS ì„¤ì •</span>
<span class="c"># /usr/local/etc/suricata/suricata.yaml</span>
HOME_NET: <span class="s2">"[192.168.1.0/24,10.0.0.0/8]"</span>
EXTERNAL_NET: <span class="s2">"!</span><span class="nv">$HOME_NET</span><span class="s2">"</span>

rule-files:
  - emerging-threats.rules
  - botcc.rules
  - emerging-malware.rules

<span class="c"># ì‚¬ìš©ì ì •ì˜ ë£°</span>
<span class="c"># /usr/local/etc/suricata/rules/local.rules</span>
alert tcp <span class="nv">$HOME_NET</span> any -&gt; <span class="nv">$EXTERNAL_NET</span> 80 <span class="o">(</span>msg:<span class="s2">"HTTP outbound connection"</span><span class="p">;</span> sid:1000001<span class="p">;</span> rev:1<span class="p">;</span><span class="o">)</span>
alert tcp any any -&gt; <span class="nv">$HOME_NET</span> 22 <span class="o">(</span>msg:<span class="s2">"SSH connection attempt"</span><span class="p">;</span> threshold: <span class="nb">type </span>both, track by_src, count 5, seconds 60<span class="p">;</span> sid:1000002<span class="p">;</span> rev:1<span class="p">;</span><span class="o">)</span>

<span class="c"># pfBlockerNG GeoIP ì°¨ë‹¨</span>
<span class="c"># ëŸ¬ì‹œì•„, ì¤‘êµ­, ë¶í•œ IP ëŒ€ì—­ ì°¨ë‹¨</span>
Asia_Russia: Deny_Inbound, Deny_Outbound
Asia_China: Deny_Inbound, Permit_Outbound
Asia_North_Korea: Deny_Both
</code></pre></div></div>

<h3 id="ï¸-idsips-ì‹œìŠ¤í…œ">ğŸ›¡ï¸ IDS/IPS ì‹œìŠ¤í…œ</h3>

<h4 id="suricata-idsips-ë°°í¬">Suricata IDS/IPS ë°°í¬</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Suricata ì„¤ì¹˜ (Ubuntu)</span>
<span class="nb">sudo </span>add-apt-repository ppa:oisf/suricata-stable
<span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>suricata

<span class="c"># ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ì„¤ì •</span>
<span class="c"># /etc/suricata/suricata.yaml</span>
af-packet:
  - interface: eth0
    cluster-id: 99
    cluster-type: cluster_flow
    defrag: <span class="nb">yes
    </span>use-mmap: <span class="nb">yes
    </span>mmap-locked: <span class="nb">yes</span>

<span class="c"># ë£°ì…‹ ì—…ë°ì´íŠ¸</span>
<span class="nb">sudo </span>suricata-update
<span class="nb">sudo </span>suricata-update list-sources
<span class="nb">sudo </span>suricata-update enable-source et/pro  <span class="c"># Emerging Threats Pro</span>
<span class="nb">sudo </span>suricata-update enable-source ptresearch/attackdetection

<span class="c"># ì»¤ìŠ¤í…€ ë£° ì‘ì„±</span>
<span class="c"># /etc/suricata/rules/local.rules</span>
<span class="c"># DDoS ê³µê²© íƒì§€</span>
alert tcp any any -&gt; <span class="nv">$HOME_NET</span> any <span class="o">(</span>msg:<span class="s2">"Possible DDoS attack"</span><span class="p">;</span> flags:S<span class="p">;</span> threshold: <span class="nb">type </span>both, track by_src, count 100, seconds 10<span class="p">;</span> sid:1000003<span class="p">;</span> rev:1<span class="p">;</span><span class="o">)</span>

<span class="c"># SQL ì¸ì ì…˜ íƒì§€  </span>
alert http any any -&gt; <span class="nv">$HOME_NET</span> any <span class="o">(</span>msg:<span class="s2">"SQL Injection Attack"</span><span class="p">;</span> content:<span class="s2">"union select"</span><span class="p">;</span> nocase<span class="p">;</span> http_uri<span class="p">;</span> sid:1000004<span class="p">;</span> rev:1<span class="p">;</span><span class="o">)</span>

<span class="c"># í¬ë¦¬ë´ì…œ ìŠ¤í„°í•‘ íƒì§€</span>
alert http any any -&gt; <span class="nv">$HOME_NET</span> any <span class="o">(</span>msg:<span class="s2">"Credential Stuffing Attack"</span><span class="p">;</span> content:<span class="s2">"POST"</span><span class="p">;</span> http_method<span class="p">;</span> threshold: <span class="nb">type </span>both, track by_src, count 50, seconds 60<span class="p">;</span> sid:1000005<span class="p">;</span> rev:1<span class="p">;</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="zeek-bro-ë„¤íŠ¸ì›Œí¬-ë¶„ì„">Zeek (Bro) ë„¤íŠ¸ì›Œí¬ ë¶„ì„</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Zeek ì„¤ì¹˜</span>
<span class="nb">sudo </span>apt <span class="nb">install </span>zeek

<span class="c"># ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ì„¤ì •</span>
<span class="c"># /opt/zeek/etc/node.cfg</span>
<span class="o">[</span>zeek]
<span class="nb">type</span><span class="o">=</span>standalone
<span class="nv">host</span><span class="o">=</span>localhost
<span class="nv">interface</span><span class="o">=</span>eth0

<span class="c"># ì»¤ìŠ¤í…€ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±</span>
<span class="c"># /opt/zeek/share/zeek/site/local.zeek</span>
@load base/protocols/http
@load base/protocols/dns
@load base/protocols/ssl

<span class="c"># HTTP íŠ¸ë˜í”½ ëª¨ë‹ˆí„°ë§</span>
event http_request<span class="o">(</span>c: connection, method: string, original_URI: string, unescaped_URI: string, version: string<span class="o">)</span>
<span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span> /<span class="se">\.</span><span class="o">(</span>exe|zip|rar|7z<span class="o">)</span><span class="nv">$/</span> <span class="k">in </span>unescaped_URI <span class="o">)</span>
        print <span class="nb">fmt</span><span class="o">(</span><span class="s2">"%s ë‹¤ìš´ë¡œë“œ: %s -&gt; %s%s"</span>, 
                 strftime<span class="o">(</span><span class="s2">"%Y-%m-%d %H:%M:%S"</span>, network_time<span class="o">())</span>, 
                 c<span class="nv">$id$orig_h</span>, c<span class="nv">$id$resp_h</span>, unescaped_URI<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>

<span class="c"># DNS ëª¨ë‹ˆí„°ë§</span>
event dns_request<span class="o">(</span>c: connection, msg: dns_msg, query: string, qtype: count, qclass: count<span class="o">)</span>
<span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span> /[0-9]<span class="o">{</span>1,3<span class="o">}</span><span class="se">\.</span><span class="o">[</span>0-9]<span class="o">{</span>1,3<span class="o">}</span><span class="se">\.</span><span class="o">[</span>0-9]<span class="o">{</span>1,3<span class="o">}</span><span class="se">\.</span><span class="o">[</span>0-9]<span class="o">{</span>1,3<span class="o">}</span><span class="se">\.</span><span class="k">in</span><span class="nt">-addr</span><span class="se">\.</span>arpa/ <span class="o">!</span><span class="k">in </span>query <span class="o">)</span>
    <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span> /<span class="se">\.</span>tk<span class="nv">$|</span><span class="se">\.</span>ml<span class="nv">$|</span><span class="se">\.</span>ga<span class="nv">$|</span><span class="se">\.</span>cf<span class="nv">$/</span> <span class="k">in </span>query <span class="o">)</span>
            print <span class="nb">fmt</span><span class="o">(</span><span class="s2">"ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ë„ë©”ì¸ ì§ˆì˜: %s -&gt; %s"</span>, c<span class="nv">$id$orig_h</span>, query<span class="o">)</span><span class="p">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c"># ì„œë¹„ìŠ¤ ì‹œì‘</span>
<span class="nb">sudo </span>zeekctl deploy
<span class="nb">sudo </span>zeekctl status
</code></pre></div></div>

<h2 id="ì œë¡œ-íŠ¸ëŸ¬ìŠ¤íŠ¸-ë„¤íŠ¸ì›Œí¬--zero-trust-network">ì œë¡œ íŠ¸ëŸ¬ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ | Zero Trust Network</h2>

<h3 id="-ì œë¡œ-íŠ¸ëŸ¬ìŠ¤íŠ¸-ì•„í‚¤í…ì²˜">ğŸ”’ ì œë¡œ íŠ¸ëŸ¬ìŠ¤íŠ¸ ì•„í‚¤í…ì²˜</h3>

<h4 id="ì œë¡œ-íŠ¸ëŸ¬ìŠ¤íŠ¸-ì›ì¹™">ì œë¡œ íŠ¸ëŸ¬ìŠ¤íŠ¸ ì›ì¹™</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Never Trust, Always Verify:
- ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  íŠ¸ë˜í”½ ì°¨ë‹¨
- ëª…ì‹œì  ê²€ì¦ê³¼ ì¸ê°€
- ìµœì†Œ ê¶Œí•œ ì›ì¹™

Verify Explicitly:
- ì‚¬ìš©ì ì‹ ì› í™•ì¸
- ë””ë°”ì´ìŠ¤ ìƒíƒœ ê²€ì¦
- ë„¤íŠ¸ì›Œí¬ ìœ„ì¹˜ ë¬´ê´€

Least Privileged Access:
- Just-in-Time <span class="o">(</span>JIT<span class="o">)</span> ì•¡ì„¸ìŠ¤
- Just-Enough-Access <span class="o">(</span>JEA<span class="o">)</span>
- ìœ„í—˜ ê¸°ë°˜ ì ì‘í˜• ì •ì±…

Assume Breach:
- ì„¸ê·¸ë©˜í…Œì´ì…˜ê³¼ ê²©ë¦¬
- íš¡ì  ì´ë™ ì°¨ë‹¨
- ì§€ì†ì  ëª¨ë‹ˆí„°ë§
</code></pre></div></div>

<h4 id="ë§ˆì´í¬ë¡œ-ì„¸ê·¸ë©˜í…Œì´ì…˜-êµ¬í˜„">ë§ˆì´í¬ë¡œ ì„¸ê·¸ë©˜í…Œì´ì…˜ êµ¬í˜„</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Cisco ACI ë§ˆì´í¬ë¡œ ì„¸ê·¸ë©˜í…Œì´ì…˜</span>
<span class="c"># ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œíŒŒì¼ ìƒì„±</span>
apic1# configure
apic1<span class="o">(</span>config<span class="o">)</span><span class="c"># tenant production</span>
apic1<span class="o">(</span>config-tenant<span class="o">)</span><span class="c"># application app-web</span>
apic1<span class="o">(</span>config-tenant-app<span class="o">)</span><span class="c"># epg web-tier</span>
apic1<span class="o">(</span>config-tenant-app-epg<span class="o">)</span><span class="c"># bridge-domain web-bd</span>
apic1<span class="o">(</span>config-tenant-app-epg<span class="o">)</span><span class="c"># exit</span>

<span class="c"># ê³„ì•½ (Contract) ì •ì˜</span>
apic1<span class="o">(</span>config-tenant-app<span class="o">)</span><span class="c"># contract web-to-db</span>
apic1<span class="o">(</span>config-tenant-app-contract<span class="o">)</span><span class="c"># subject db-access</span>
apic1<span class="o">(</span>config-tenant-app-contract-subject<span class="o">)</span><span class="c"># filter mysql-filter</span>
apic1<span class="o">(</span>config-tenant-app-contract-subject-filter<span class="o">)</span><span class="c"># entry mysql</span>
apic1<span class="o">(</span>config-tenant-app-contract-subject-filter-entry<span class="o">)</span><span class="c"># ether-type ip</span>
apic1<span class="o">(</span>config-tenant-app-contract-subject-filter-entry<span class="o">)</span><span class="c"># ip-protocol tcp</span>
apic1<span class="o">(</span>config-tenant-app-contract-subject-filter-entry<span class="o">)</span><span class="c"># destination-port-range from 3306 to 3306</span>

<span class="c"># VMware NSX ë§ˆì´í¬ë¡œ ì„¸ê·¸ë©˜í…Œì´ì…˜</span>
<span class="c"># ë¶„ì‚° ë°©í™”ë²½ ì •ì±…</span>
nsxcli&gt; configure firewall
nsxcli<span class="o">(</span>firewall<span class="o">)&gt;</span> add rule web-tier-protection
nsxcli<span class="o">(</span>firewall-rule<span class="o">)&gt;</span> <span class="nb">set source </span>security-group web-servers
nsxcli<span class="o">(</span>firewall-rule<span class="o">)&gt;</span> <span class="nb">set </span>destination security-group db-servers
nsxcli<span class="o">(</span>firewall-rule<span class="o">)&gt;</span> <span class="nb">set </span>service MYSQL
nsxcli<span class="o">(</span>firewall-rule<span class="o">)&gt;</span> <span class="nb">set </span>action allow
nsxcli<span class="o">(</span>firewall-rule<span class="o">)&gt;</span> <span class="nb">set </span>applied-to security-group web-servers
nsxcli<span class="o">(</span>firewall-rule<span class="o">)&gt;</span> commit
</code></pre></div></div>

<h4 id="kubernetes-ë„¤íŠ¸ì›Œí¬-ì •ì±…">Kubernetes ë„¤íŠ¸ì›Œí¬ ì •ì±…</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê²©ë¦¬ ì •ì±…</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NetworkPolicy</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">default-deny-all</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">production</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">podSelector</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="na">policyTypes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">Ingress</span>
  <span class="pi">-</span> <span class="s">Egress</span>

<span class="nn">---</span>
<span class="c1"># ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ì±…</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NetworkPolicy</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">web-app-policy</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">production</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">podSelector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">web-frontend</span>
  <span class="na">policyTypes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">Ingress</span>
  <span class="pi">-</span> <span class="s">Egress</span>
  <span class="na">ingress</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">from</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">namespaceSelector</span><span class="pi">:</span>
        <span class="na">matchLabels</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-nginx</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
  <span class="na">egress</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">to</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">podSelector</span><span class="pi">:</span>
        <span class="na">matchLabels</span><span class="pi">:</span>
          <span class="na">app</span><span class="pi">:</span> <span class="s">api-backend</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">3000</span>
  <span class="pi">-</span> <span class="na">to</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">namespaceSelector</span><span class="pi">:</span>
        <span class="na">matchLabels</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">kube-system</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">UDP</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">53</span>  <span class="c1"># DNS</span>

<span class="nn">---</span>
<span class="c1"># ë°ì´í„°ë² ì´ìŠ¤ ì •ì±…</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NetworkPolicy</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">database-policy</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">production</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">podSelector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">mysql-db</span>
  <span class="na">policyTypes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">Ingress</span>
  <span class="na">ingress</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">from</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">podSelector</span><span class="pi">:</span>
        <span class="na">matchLabels</span><span class="pi">:</span>
          <span class="na">app</span><span class="pi">:</span> <span class="s">api-backend</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">3306</span>
</code></pre></div></div>

<h2 id="ë„¤íŠ¸ì›Œí¬-í¬ë Œì‹--network-forensics">ë„¤íŠ¸ì›Œí¬ í¬ë Œì‹ | Network Forensics</h2>

<h3 id="-íŒ¨í‚·-ë¶„ì„ê³¼-ì¦ê±°-ìˆ˜ì§‘">ğŸ” íŒ¨í‚· ë¶„ì„ê³¼ ì¦ê±° ìˆ˜ì§‘</h3>

<h4 id="wireshark-ê³ ê¸‰-ë¶„ì„-ê¸°ë²•">Wireshark ê³ ê¸‰ ë¶„ì„ ê¸°ë²•</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì˜ì‹¬ìŠ¤ëŸ¬ìš´ íŠ¸ë˜í”½ í•„í„°ë§</span>
<span class="c"># ëŒ€ëŸ‰ ë°ì´í„° ì „ì†¡ íƒì§€</span>
tcp.len <span class="o">&gt;</span> 1400 and ip.src <span class="o">==</span> 192.168.1.100

<span class="c"># DNS í„°ë„ë§ íƒì§€</span>
dns.qry.name contains <span class="s2">"."</span>
dns.qry.name matches <span class="s2">"^[a-f0-9]{20,}</span><span class="se">\\</span><span class="s2">."</span>

<span class="c"># HTTP POST ë°ì´í„° exfiltration</span>
http.request.method <span class="o">==</span> <span class="s2">"POST"</span> and http.content_length <span class="o">&gt;</span> 10000

<span class="c"># ë¹„ì •ìƒì ì¸ í¬íŠ¸ ì‚¬ìš©</span>
tcp.port <span class="o">==</span> 443 and not ssl.handshake.type
tcp.port <span class="o">==</span> 80 and ssl.handshake.type

<span class="c"># ì»¤ë§¨ë“œ ì•¤ ì»¨íŠ¸ë¡¤ í†µì‹  íŒ¨í„´</span>
<span class="o">(</span>tcp.flags.push <span class="o">==</span> 1<span class="o">)</span> and <span class="o">(</span>tcp.len &lt; 100<span class="o">)</span> and <span class="o">(</span>tcp.len <span class="o">&gt;</span> 10<span class="o">)</span>

<span class="c"># í†µê³„ ë¶„ì„ì„ ìœ„í•œ tshark ì‚¬ìš©</span>
<span class="c"># ìƒìœ„ í†µì‹  í˜¸ìŠ¤íŠ¸</span>
tshark <span class="nt">-r</span> capture.pcap <span class="nt">-q</span> <span class="nt">-z</span> conv,ip | <span class="nb">sort</span> <span class="nt">-k7</span> <span class="nt">-nr</span> | <span class="nb">head</span> <span class="nt">-20</span>

<span class="c"># í”„ë¡œí† ì½œ ë¶„í¬</span>
tshark <span class="nt">-r</span> capture.pcap <span class="nt">-q</span> <span class="nt">-z</span> prot,colinfo

<span class="c"># ì‹œê°„ë³„ íŠ¸ë˜í”½ ë¶„ì„</span>
tshark <span class="nt">-r</span> capture.pcap <span class="nt">-T</span> fields <span class="nt">-e</span> frame.time <span class="nt">-e</span> ip.src <span class="nt">-e</span> ip.dst <span class="nt">-e</span> tcp.srcport <span class="nt">-e</span> tcp.dstport | 
<span class="nb">awk</span> <span class="s1">'{print $1 " " $2 ":" $4 " -&gt; " $3 ":" $5}'</span> | <span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="nb">sort</span> <span class="nt">-nr</span>
</code></pre></div></div>

<h4 id="ë„¤íŠ¸ì›Œí¬-í”Œë¡œìš°-ë¶„ì„-nfcapd">ë„¤íŠ¸ì›Œí¬ í”Œë¡œìš° ë¶„ì„ (nfcapd)</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># nfcapd ì„¤ì • ë° ì‹œì‘</span>
nfcapd <span class="nt">-w</span> <span class="nt">-D</span> <span class="nt">-p</span> 9995 <span class="nt">-l</span> /var/cache/nfcapd

<span class="c"># ë¼ìš°í„°ì—ì„œ NetFlow í™œì„±í™” (Cisco)</span>
interface FastEthernet0/1
 ip flow ingress
 ip flow egress

ip flow-export <span class="nb">source </span>FastEthernet0/1
ip flow-export version 9
ip flow-export destination 192.168.1.100 9995

<span class="c"># í”Œë¡œìš° ë°ì´í„° ë¶„ì„</span>
<span class="c"># ìƒìœ„ í†µì‹ ëŸ‰ í˜¸ìŠ¤íŠ¸</span>
nfdump <span class="nt">-r</span> /var/cache/nfcapd/nfcapd.<span class="k">*</span> <span class="nt">-s</span> srcip/bytes <span class="nt">-n</span> 20

<span class="c"># íŠ¹ì • ì‹œê°„ëŒ€ ë¶„ì„</span>
nfdump <span class="nt">-r</span> /var/cache/nfcapd/nfcapd.<span class="k">*</span> <span class="nt">-t</span> 2024-03-30.10:00:00-2024-03-30.11:00:00 <span class="nt">-s</span> dstip/packets

<span class="c"># ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í¬íŠ¸ ì‚¬ìš© </span>
nfdump <span class="nt">-r</span> /var/cache/nfcapd/nfcapd.<span class="k">*</span> <span class="s1">'port &gt; 10000 and port &lt; 65000'</span> <span class="nt">-s</span> srcip/flows

<span class="c"># ëŒ€ìš©ëŸ‰ ì „ì†¡ íƒì§€</span>
nfdump <span class="nt">-r</span> /var/cache/nfcapd/nfcapd.<span class="k">*</span> <span class="s1">'bytes &gt; 100000000'</span> <span class="nt">-o</span> extended
</code></pre></div></div>

<h3 id="ï¸-ìœ„í˜‘-í—ŒíŒ…-threat-hunting">ğŸ•µï¸ ìœ„í˜‘ í—ŒíŒ… (Threat Hunting)</h3>

<h4 id="elk-ìŠ¤íƒ-ê¸°ë°˜-ìœ„í˜‘-í—ŒíŒ…">ELK ìŠ¤íƒ ê¸°ë°˜ ìœ„í˜‘ í—ŒíŒ…</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Logstash ì„¤ì • - ë„¤íŠ¸ì›Œí¬ ë¡œê·¸ íŒŒì‹±</span>
<span class="c1"># /etc/logstash/conf.d/network-logs.conf</span>
<span class="s">input {</span>
  <span class="s">beats {</span>
    <span class="s">port =&gt; </span><span class="m">5044</span>
  <span class="err">}</span>
  <span class="s">syslog {</span>
    <span class="s">port =&gt; </span><span class="m">514</span>
    <span class="s">type =&gt; "firewall"</span>
  <span class="s">}</span>
<span class="err">}</span>

<span class="s">filter {</span>
  <span class="s">if [type] == "firewall" {</span>
    <span class="s">grok {</span>
      <span class="s">match =&gt; {</span> 
        <span class="s">"message" =&gt; "%{TIMESTAMP_ISO8601:timestamp} %{WORD:device} %{WORD:action} %{IP:src_ip}:%{INT:src_port} -&gt; %{IP:dst_ip}:%{INT:dst_port} %{WORD:protocol}"</span>
      <span class="s">}</span>
    <span class="s">}</span>
    
    <span class="s">geoip {</span>
      <span class="s">source =&gt; "src_ip"</span>
      <span class="s">target =&gt; "src_geoip"</span>
    <span class="s">}</span>
    
    <span class="s">if [src_geoip][country_name] in ["Russia", "China", "North Korea"] {</span>
      <span class="s">mutate {</span>
        <span class="s">add_tag =&gt; [ "suspicious_geo" ]</span>
      <span class="s">}</span>
    <span class="s">}</span>
  <span class="s">}</span>
<span class="err">}</span>

<span class="s">output {</span>
  <span class="s">elasticsearch {</span>
    <span class="s">hosts =&gt; ["localhost:9200"]</span>
    <span class="s">index =&gt; "network-logs-%{+YYYY.MM.dd}"</span>
  <span class="s">}</span>
<span class="err">}</span>
</code></pre></div></div>

<h4 id="kibana-ìœ„í˜‘-í—ŒíŒ…-ì¿¼ë¦¬">Kibana ìœ„í˜‘ í—ŒíŒ… ì¿¼ë¦¬</h4>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"bool"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"must"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"@timestamp"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nl">"gte"</span><span class="p">:</span><span class="w"> </span><span class="s2">"now-1h"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"terms"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"tags"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"suspicious_geo"</span><span class="p">]</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"should"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"bytes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nl">"gte"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000000</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"script"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"script"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nl">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"doc['dst_port'].value &gt; 10000 &amp;&amp; doc['dst_port'].value &lt; 65000"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"aggs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"suspicious_ips"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"terms"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"src_ip"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"aggs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"unique_ports"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"cardinality"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dst_port"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"total_bytes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"sum"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bytes"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="yara-ë£°-ê¸°ë°˜-ë„¤íŠ¸ì›Œí¬-íƒì§€">YARA ë£° ê¸°ë°˜ ë„¤íŠ¸ì›Œí¬ íƒì§€</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># YARA ë£° ì˜ˆì‹œ - ì•…ì„±ì½”ë“œ í†µì‹  íŒ¨í„´</span>
rule APT_Communication_Pattern
<span class="o">{</span>
    meta:
        description <span class="o">=</span> <span class="s2">"APT ê·¸ë£¹ í†µì‹  íŒ¨í„´ íƒì§€"</span>
        author <span class="o">=</span> <span class="s2">"Security Team"</span>
        <span class="nb">date</span> <span class="o">=</span> <span class="s2">"2024-03-30"</span>
        
    strings:
        <span class="nv">$user_agent</span> <span class="o">=</span> <span class="s2">"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)"</span>
        <span class="nv">$uri_pattern</span> <span class="o">=</span> /<span class="se">\/</span><span class="o">[</span>a-f0-9]<span class="o">{</span>8<span class="o">}</span><span class="se">\/</span><span class="o">[</span>a-f0-9]<span class="o">{</span>8<span class="o">}</span>/
        <span class="nv">$post_data</span> <span class="o">=</span> <span class="o">{</span> 48 54 54 50 2F 31 2E 31 20 32 30 30 20 4F 4B <span class="o">}</span>  // <span class="s2">"HTTP/1.1 200 OK"</span>
        
    condition:
        <span class="nv">$user_agent</span> and <span class="nv">$uri_pattern</span> and <span class="nv">$post_data</span>
<span class="o">}</span>

rule DNS_Tunneling
<span class="o">{</span>
    meta:
        description <span class="o">=</span> <span class="s2">"DNS í„°ë„ë§ íŒ¨í„´ íƒì§€"</span>
        
    strings:
        <span class="nv">$long_subdomain</span> <span class="o">=</span> /[a-zA-Z0-9]<span class="o">{</span>50,<span class="o">}</span><span class="se">\.</span>.<span class="k">*</span><span class="se">\.</span><span class="o">(</span>com|net|org<span class="o">)</span>/
        <span class="nv">$base64_pattern</span> <span class="o">=</span> /[A-Za-z0-9+<span class="se">\/</span><span class="o">]{</span>20,<span class="o">}={</span>0,2<span class="o">}</span>/
        
    condition:
        <span class="nv">$long_subdomain</span> or <span class="nv">$base64_pattern</span>
<span class="o">}</span>

<span class="c"># ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì— YARA ì ìš©</span>
suricata <span class="nt">-c</span> /etc/suricata/suricata.yaml <span class="nt">-i</span> eth0 <span class="nt">--runmode</span> single
</code></pre></div></div>

<h2 id="ê³ ê¸‰-íŠ¸ëŸ¬ë¸”ìŠˆíŒ…--advanced-troubleshooting">ê³ ê¸‰ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… | Advanced Troubleshooting</h2>

<h3 id="-ë„¤íŠ¸ì›Œí¬-ì„±ëŠ¥-ë¬¸ì œ-í•´ê²°">ğŸ”§ ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ ë¬¸ì œ í•´ê²°</h3>

<h4 id="ëŒ€ì—­í­ê³¼-ì§€ì—°ì‹œê°„-ë¶„ì„">ëŒ€ì—­í­ê³¼ ì§€ì—°ì‹œê°„ ë¶„ì„</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># iperf3ë¥¼ ì´ìš©í•œ ì„±ëŠ¥ ì¸¡ì •</span>
<span class="c"># ì„œë²„ ì¸¡</span>
iperf3 <span class="nt">-s</span> <span class="nt">-p</span> 5201

<span class="c"># í´ë¼ì´ì–¸íŠ¸ ì¸¡ - TCP í…ŒìŠ¤íŠ¸</span>
iperf3 <span class="nt">-c</span> 192.168.1.100 <span class="nt">-t</span> 30 <span class="nt">-i</span> 1 <span class="nt">-P</span> 4
<span class="c"># -t: í…ŒìŠ¤íŠ¸ ì‹œê°„, -i: ì¸í„°ë²Œ, -P: ë³‘ë ¬ ì—°ê²°</span>

<span class="c"># UDP í…ŒìŠ¤íŠ¸ (íŒ¨í‚· ì†ì‹¤ í™•ì¸)</span>
iperf3 <span class="nt">-c</span> 192.168.1.100 <span class="nt">-u</span> <span class="nt">-b</span> 100M <span class="nt">-t</span> 30

<span class="c"># ì–‘ë°©í–¥ í…ŒìŠ¤íŠ¸</span>
iperf3 <span class="nt">-c</span> 192.168.1.100 <span class="nt">--bidir</span> <span class="nt">-t</span> 30

<span class="c"># MTU í¬ê¸° ìµœì í™” í…ŒìŠ¤íŠ¸</span>
ping <span class="nt">-M</span> <span class="k">do</span> <span class="nt">-s</span> 1472 192.168.1.100  <span class="c"># Linux</span>
ping <span class="nt">-f</span> <span class="nt">-l</span> 1472 192.168.1.100     <span class="c"># Windows</span>

<span class="c"># ì ì§„ì  MTU í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="k">for </span>size <span class="k">in</span> <span class="o">{</span>1200..1500..50<span class="o">}</span><span class="p">;</span> <span class="k">do
    </span><span class="nb">echo</span> <span class="s2">"Testing MTU size: </span><span class="nv">$size</span><span class="s2">"</span>
    ping <span class="nt">-M</span> <span class="k">do</span> <span class="nt">-s</span> <span class="nv">$size</span> <span class="nt">-c</span> 1 192.168.1.100 <span class="o">&gt;</span> /dev/null 2&gt;&amp;1
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"âœ… MTU </span><span class="nv">$size</span><span class="s2">: Success"</span>
    <span class="k">else
        </span><span class="nb">echo</span> <span class="s2">"âŒ MTU </span><span class="nv">$size</span><span class="s2">: Failed"</span>
    <span class="k">fi
done</span>
</code></pre></div></div>

<h4 id="ë„¤íŠ¸ì›Œí¬-ì§€ì—°ì‹œê°„-ìƒì„¸-ë¶„ì„">ë„¤íŠ¸ì›Œí¬ ì§€ì—°ì‹œê°„ ìƒì„¸ ë¶„ì„</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># hping3ë¥¼ ì´ìš©í•œ ë‹¤ì–‘í•œ í…ŒìŠ¤íŠ¸</span>
<span class="c"># TCP SYN í”ŒëŸ¬ë“œ í…ŒìŠ¤íŠ¸</span>
hping3 <span class="nt">-S</span> <span class="nt">-p</span> 80 <span class="nt">-i</span> u1000 192.168.1.100

<span class="c"># UDP í¬íŠ¸ ìŠ¤ìº”</span>
hping3 <span class="nt">--udp</span> <span class="nt">-p</span> 53 <span class="nt">-c</span> 3 192.168.1.100

<span class="c"># ICMP íƒ€ì„ìŠ¤íƒ¬í”„ ìš”ì²­</span>
hping3 <span class="nt">--icmp-ts</span> 192.168.1.100

<span class="c"># traceroute ê³ ê¸‰ ì˜µì…˜</span>
<span class="c"># TCP traceroute</span>
traceroute <span class="nt">-T</span> <span class="nt">-p</span> 443 google.com

<span class="c"># UDP traceroute  </span>
traceroute <span class="nt">-U</span> <span class="nt">-p</span> 53 8.8.8.8

<span class="c"># Paris traceroute (ë¡œë“œ ë°¸ëŸ°ì‹± ê³ ë ¤)</span>
paris-traceroute google.com

<span class="c"># mtr - ì‹¤ì‹œê°„ traceroute</span>
mtr <span class="nt">--report</span> <span class="nt">--report-cycles</span> 100 <span class="nt">--no-dns</span> google.com
</code></pre></div></div>

<h3 id="-ë„¤íŠ¸ì›Œí¬-ëª¨ë‹ˆí„°ë§ê³¼-ë¶„ì„">ğŸ“Š ë„¤íŠ¸ì›Œí¬ ëª¨ë‹ˆí„°ë§ê³¼ ë¶„ì„</h3>

<h4 id="snmp-ê¸°ë°˜-ëª¨ë‹ˆí„°ë§">SNMP ê¸°ë°˜ ëª¨ë‹ˆí„°ë§</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pysnmp.hlapi</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="k">class</span> <span class="nc">NetworkMonitor</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">community</span><span class="o">=</span><span class="sh">'</span><span class="s">public</span><span class="sh">'</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="n">self</span><span class="p">.</span><span class="n">community</span> <span class="o">=</span> <span class="n">community</span>
        
    <span class="k">def</span> <span class="nf">get_interface_stats</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">interface_index</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì¸í„°í˜ì´ìŠ¤ í†µê³„ ìˆ˜ì§‘</span><span class="sh">"""</span>
        <span class="n">oids</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">ifInOctets</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">1.3.6.1.2.1.2.2.1.10.</span><span class="si">{</span><span class="n">interface_index</span><span class="si">}</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">ifOutOctets</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">1.3.6.1.2.1.2.2.1.16.</span><span class="si">{</span><span class="n">interface_index</span><span class="si">}</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">ifSpeed</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">1.3.6.1.2.1.2.2.1.5.</span><span class="si">{</span><span class="n">interface_index</span><span class="si">}</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">ifOperStatus</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">1.3.6.1.2.1.2.2.1.8.</span><span class="si">{</span><span class="n">interface_index</span><span class="si">}</span><span class="sh">'</span>
        <span class="p">}</span>
        
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">oid</span> <span class="ow">in</span> <span class="n">oids</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="nf">for </span><span class="p">(</span><span class="n">errorIndication</span><span class="p">,</span> <span class="n">errorStatus</span><span class="p">,</span> <span class="n">errorIndex</span><span class="p">,</span> <span class="n">varBinds</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">nextCmd</span><span class="p">(</span>
                <span class="nc">SnmpEngine</span><span class="p">(),</span>
                <span class="nc">CommunityData</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">community</span><span class="p">),</span>
                <span class="nc">UdpTransportTarget</span><span class="p">((</span><span class="n">self</span><span class="p">.</span><span class="n">host</span><span class="p">,</span> <span class="mi">161</span><span class="p">)),</span>
                <span class="nc">ContextData</span><span class="p">(),</span>
                <span class="nc">ObjectType</span><span class="p">(</span><span class="nc">ObjectIdentity</span><span class="p">(</span><span class="n">oid</span><span class="p">)),</span>
                <span class="n">lexicographicMode</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
                
                <span class="k">if</span> <span class="n">errorIndication</span><span class="p">:</span>
                    <span class="nf">print</span><span class="p">(</span><span class="n">errorIndication</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">errorStatus</span><span class="p">:</span>
                    <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">%s at %s</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">errorStatus</span><span class="p">.</span><span class="nf">prettyPrint</span><span class="p">(),</span>
                                        <span class="n">errorIndex</span> <span class="ow">and</span> <span class="n">varBinds</span><span class="p">[</span><span class="nf">int</span><span class="p">(</span><span class="n">errorIndex</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="sh">'</span><span class="s">?</span><span class="sh">'</span><span class="p">))</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">varBind</span> <span class="ow">in</span> <span class="n">varBinds</span><span class="p">:</span>
                        <span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">varBind</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">break</span>
                    
        <span class="k">return</span> <span class="n">results</span>
    
    <span class="k">def</span> <span class="nf">calculate_bandwidth_utilization</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">60</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ëŒ€ì—­í­ ì‚¬ìš©ë¥  ê³„ì‚°</span><span class="sh">"""</span>
        <span class="n">prev_stats</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_interface_stats</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
        
        <span class="n">utilizations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">timestamps</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>
            <span class="n">current_stats</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_interface_stats</span><span class="p">()</span>
            
            <span class="c1"># ë°”ì´íŠ¸ ì¦ê°€ëŸ‰ ê³„ì‚°
</span>            <span class="n">in_bytes</span> <span class="o">=</span> <span class="n">current_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">ifInOctets</span><span class="sh">'</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">ifInOctets</span><span class="sh">'</span><span class="p">]</span>
            <span class="n">out_bytes</span> <span class="o">=</span> <span class="n">current_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">ifOutOctets</span><span class="sh">'</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">ifOutOctets</span><span class="sh">'</span><span class="p">]</span>
            
            <span class="c1"># ë¹„íŠ¸ë¡œ ë³€í™˜í•˜ê³  ì´ˆë‹¹ ê³„ì‚°
</span>            <span class="n">in_bps</span> <span class="o">=</span> <span class="p">(</span><span class="n">in_bytes</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="n">interval</span>
            <span class="n">out_bps</span> <span class="o">=</span> <span class="p">(</span><span class="n">out_bytes</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="n">interval</span>
            
            <span class="c1"># ì‚¬ìš©ë¥  ê³„ì‚° (%)
</span>            <span class="n">interface_speed</span> <span class="o">=</span> <span class="n">current_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">ifSpeed</span><span class="sh">'</span><span class="p">]</span>
            <span class="n">in_utilization</span> <span class="o">=</span> <span class="p">(</span><span class="n">in_bps</span> <span class="o">/</span> <span class="n">interface_speed</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="n">out_utilization</span> <span class="o">=</span> <span class="p">(</span><span class="n">out_bps</span> <span class="o">/</span> <span class="n">interface_speed</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
            
            <span class="n">utilizations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">(),</span>
                <span class="sh">'</span><span class="s">in_utilization</span><span class="sh">'</span><span class="p">:</span> <span class="n">in_utilization</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">out_utilization</span><span class="sh">'</span><span class="p">:</span> <span class="n">out_utilization</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">in_bps</span><span class="sh">'</span><span class="p">:</span> <span class="n">in_bps</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">out_bps</span><span class="sh">'</span><span class="p">:</span> <span class="n">out_bps</span>
            <span class="p">})</span>
            
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ì‹œê°„: </span><span class="si">{</span><span class="n">time</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%H</span><span class="si">:</span><span class="o">%</span><span class="n">M</span><span class="si">:</span><span class="o">%</span><span class="n">S</span><span class="sh">'</span><span class="s">)</span><span class="si">}</span><span class="s">, </span><span class="sh">"</span>
                  <span class="sa">f</span><span class="sh">"</span><span class="s">In: </span><span class="si">{</span><span class="n">in_utilization</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">% (</span><span class="si">{</span><span class="n">in_bps</span><span class="o">/</span><span class="mi">1000000</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">Mbps), </span><span class="sh">"</span>
                  <span class="sa">f</span><span class="sh">"</span><span class="s">Out: </span><span class="si">{</span><span class="n">out_utilization</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">% (</span><span class="si">{</span><span class="n">out_bps</span><span class="o">/</span><span class="mi">1000000</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">Mbps)</span><span class="sh">"</span><span class="p">)</span>
            
            <span class="n">prev_stats</span> <span class="o">=</span> <span class="n">current_stats</span>
            <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">utilizations</span>

<span class="c1"># ì‚¬ìš© ì˜ˆì‹œ
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">monitor</span> <span class="o">=</span> <span class="nc">NetworkMonitor</span><span class="p">(</span><span class="sh">'</span><span class="s">192.168.1.1</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">monitor</span><span class="p">.</span><span class="nf">calculate_bandwidth_utilization</span><span class="p">()</span>
    
    <span class="c1"># ê·¸ë˜í”„ ìƒì„±
</span>    <span class="n">timestamps</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
    <span class="n">in_util</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="sh">'</span><span class="s">in_utilization</span><span class="sh">'</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
    <span class="n">out_util</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="sh">'</span><span class="s">out_utilization</span><span class="sh">'</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
    
    <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">in_util</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Inbound</span><span class="sh">'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">out_util</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Outbound</span><span class="sh">'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Time</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Bandwidth Utilization (%)</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Network Interface Utilization</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="-ë„¤íŠ¸ì›Œí¬-ì¥ì• -ëŒ€ì‘-í”„ë¡œì„¸ìŠ¤">ğŸš¨ ë„¤íŠ¸ì›Œí¬ ì¥ì•  ëŒ€ì‘ í”„ë¡œì„¸ìŠ¤</h3>

<h4 id="ìë™í™”ëœ-ì¥ì• -ëŒ€ì‘-ìŠ¤í¬ë¦½íŠ¸">ìë™í™”ëœ ì¥ì•  ëŒ€ì‘ ìŠ¤í¬ë¦½íŠ¸</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># ë„¤íŠ¸ì›Œí¬ ì¥ì•  ìë™ ì§„ë‹¨ ë° ëŒ€ì‘ ìŠ¤í¬ë¦½íŠ¸</span>

<span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">"/var/log/network_troubleshoot.log"</span>
<span class="nv">ALERT_THRESHOLD</span><span class="o">=</span>5  <span class="c"># 5% íŒ¨í‚· ì†ì‹¤ ì„ê³„ê°’</span>

log_message<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">"[</span><span class="si">$(</span><span class="nb">date</span> <span class="s1">'+%Y-%m-%d %H:%M:%S'</span><span class="si">)</span><span class="s2">] </span><span class="nv">$1</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="nv">$LOG_FILE</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># 1ë‹¨ê³„: ê¸°ë³¸ ì—°ê²°ì„± í™•ì¸</span>
check_connectivity<span class="o">()</span> <span class="o">{</span>
    log_message <span class="s2">"=== 1ë‹¨ê³„: ê¸°ë³¸ ì—°ê²°ì„± í™•ì¸ ==="</span>
    
    <span class="c"># ê²Œì´íŠ¸ì›¨ì´ í•‘ í…ŒìŠ¤íŠ¸</span>
    <span class="nv">gateway</span><span class="o">=</span><span class="si">$(</span>ip route | <span class="nb">grep </span>default | <span class="nb">awk</span> <span class="s1">'{print $3}'</span> | <span class="nb">head</span> <span class="nt">-1</span><span class="si">)</span>
    log_message <span class="s2">"ê¸°ë³¸ ê²Œì´íŠ¸ì›¨ì´: </span><span class="nv">$gateway</span><span class="s2">"</span>
    
    <span class="nv">packet_loss</span><span class="o">=</span><span class="si">$(</span>ping <span class="nt">-c</span> 5 <span class="nv">$gateway</span> | <span class="nb">grep</span> <span class="s2">"packet loss"</span> | <span class="nb">awk</span> <span class="s1">'{print $6}'</span> | <span class="nb">sed</span> <span class="s1">'s/%//'</span><span class="si">)</span>
    
    <span class="k">if</span> <span class="o">((</span> <span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$packet_loss</span><span class="s2"> &gt; </span><span class="nv">$ALERT_THRESHOLD</span><span class="s2">"</span> | bc <span class="nt">-l</span><span class="si">)</span> <span class="o">))</span><span class="p">;</span> <span class="k">then
        </span>log_message <span class="s2">"âŒ ê²Œì´íŠ¸ì›¨ì´ ì—°ê²° ë¬¸ì œ ê°ì§€: </span><span class="k">${</span><span class="nv">packet_loss</span><span class="k">}</span><span class="s2">% íŒ¨í‚· ì†ì‹¤"</span>
        <span class="k">return </span>1
    <span class="k">else
        </span>log_message <span class="s2">"âœ… ê²Œì´íŠ¸ì›¨ì´ ì—°ê²° ì •ìƒ: </span><span class="k">${</span><span class="nv">packet_loss</span><span class="k">}</span><span class="s2">% íŒ¨í‚· ì†ì‹¤"</span>
        <span class="k">return </span>0
    <span class="k">fi</span>
<span class="o">}</span>

<span class="c"># 2ë‹¨ê³„: DNS í•´ìƒë„ í™•ì¸  </span>
check_dns<span class="o">()</span> <span class="o">{</span>
    log_message <span class="s2">"=== 2ë‹¨ê³„: DNS í•´ìƒë„ í™•ì¸ ==="</span>
    
    <span class="nv">dns_servers</span><span class="o">=(</span><span class="s2">"8.8.8.8"</span> <span class="s2">"1.1.1.1"</span> <span class="s2">"168.126.63.1"</span><span class="o">)</span>
    <span class="nv">test_domains</span><span class="o">=(</span><span class="s2">"google.com"</span> <span class="s2">"naver.com"</span> <span class="s2">"github.com"</span><span class="o">)</span>
    
    <span class="k">for </span>server <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">dns_servers</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
        for </span>domain <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">test_domains</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
            </span><span class="nv">response_time</span><span class="o">=</span><span class="si">$(</span>dig @<span class="nv">$server</span> <span class="nv">$domain</span> +short +time<span class="o">=</span>3 2&gt;&amp;1<span class="si">)</span>
            <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$response_time</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
                </span>log_message <span class="s2">"âœ… DNS ì„œë²„ </span><span class="nv">$server</span><span class="s2">: </span><span class="nv">$domain</span><span class="s2"> í•´ìƒë„ ì„±ê³µ"</span>
            <span class="k">else
                </span>log_message <span class="s2">"âŒ DNS ì„œë²„ </span><span class="nv">$server</span><span class="s2">: </span><span class="nv">$domain</span><span class="s2"> í•´ìƒë„ ì‹¤íŒ¨"</span>
            <span class="k">fi
        done
    done</span>
<span class="o">}</span>

<span class="c"># 3ë‹¨ê³„: ì¸í„°í˜ì´ìŠ¤ ìƒíƒœ í™•ì¸</span>
check_interfaces<span class="o">()</span> <span class="o">{</span>
    log_message <span class="s2">"=== 3ë‹¨ê³„: ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ í™•ì¸ ==="</span>
    
    ip <span class="nb">link </span>show | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"^[0-9]+:"</span> | <span class="k">while </span><span class="nb">read </span>line<span class="p">;</span> <span class="k">do
        </span><span class="nv">interface</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$line</span> | <span class="nb">cut</span> <span class="nt">-d</span>: <span class="nt">-f2</span> | <span class="nb">sed</span> <span class="s1">'s/ //'</span><span class="si">)</span>
        <span class="nv">status</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$line</span> | <span class="nb">grep</span> <span class="nt">-o</span> <span class="s2">"state [A-Z]*"</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="s1">' '</span> <span class="nt">-f2</span><span class="si">)</span>
        
        <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$status</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"UP"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span>log_message <span class="s2">"âœ… ì¸í„°í˜ì´ìŠ¤ </span><span class="nv">$interface</span><span class="s2">: </span><span class="nv">$status</span><span class="s2">"</span>
        <span class="k">else
            </span>log_message <span class="s2">"âŒ ì¸í„°í˜ì´ìŠ¤ </span><span class="nv">$interface</span><span class="s2">: </span><span class="nv">$status</span><span class="s2">"</span>
            
            <span class="c"># ì¸í„°í˜ì´ìŠ¤ ì¬ì‹œì‘ ì‹œë„</span>
            log_message <span class="s2">"ì¸í„°í˜ì´ìŠ¤ </span><span class="nv">$interface</span><span class="s2"> ì¬ì‹œì‘ ì‹œë„ì¤‘..."</span>
            <span class="nb">sudo </span>ip <span class="nb">link set</span> <span class="nv">$interface</span> down
            <span class="nb">sleep </span>2
            <span class="nb">sudo </span>ip <span class="nb">link set</span> <span class="nv">$interface</span> up
            <span class="nb">sleep </span>5
            
            <span class="c"># ì¬í™•ì¸</span>
            <span class="nv">new_status</span><span class="o">=</span><span class="si">$(</span>ip <span class="nb">link </span>show <span class="nv">$interface</span> | <span class="nb">grep</span> <span class="nt">-o</span> <span class="s2">"state [A-Z]*"</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="s1">' '</span> <span class="nt">-f2</span><span class="si">)</span>
            log_message <span class="s2">"ì¬ì‹œì‘ í›„ ìƒíƒœ: </span><span class="nv">$new_status</span><span class="s2">"</span>
        <span class="k">fi
    done</span>
<span class="o">}</span>

<span class="c"># 4ë‹¨ê³„: ë¼ìš°íŒ… í…Œì´ë¸” í™•ì¸</span>
check_routing<span class="o">()</span> <span class="o">{</span>
    log_message <span class="s2">"=== 4ë‹¨ê³„: ë¼ìš°íŒ… í…Œì´ë¸” í™•ì¸ ==="</span>
    
    <span class="c"># ê¸°ë³¸ ê²Œì´íŠ¸ì›¨ì´ í™•ì¸</span>
    <span class="nv">default_routes</span><span class="o">=</span><span class="si">$(</span>ip route | <span class="nb">grep </span>default | <span class="nb">wc</span> <span class="nt">-l</span><span class="si">)</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$default_routes</span> <span class="nt">-eq</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>log_message <span class="s2">"âŒ ê¸°ë³¸ ê²Œì´íŠ¸ì›¨ì´ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ"</span>
        
        <span class="c"># DHCP ê°±ì‹  ì‹œë„</span>
        log_message <span class="s2">"DHCP ê°±ì‹  ì‹œë„ì¤‘..."</span>
        <span class="nb">sudo </span>dhclient <span class="nt">-r</span>
        <span class="nb">sudo </span>dhclient
    <span class="k">elif</span> <span class="o">[</span> <span class="nv">$default_routes</span> <span class="nt">-gt</span> 1 <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>log_message <span class="s2">"âš ï¸  ì—¬ëŸ¬ ê°œì˜ ê¸°ë³¸ ê²Œì´íŠ¸ì›¨ì´ ê°ì§€"</span>
        ip route | <span class="nb">grep </span>default
    <span class="k">else
        </span>log_message <span class="s2">"âœ… ê¸°ë³¸ ê²Œì´íŠ¸ì›¨ì´ ì •ìƒ"</span>
    <span class="k">fi</span>
    
    <span class="c"># ë¼ìš°íŒ… í…Œì´ë¸” ì¶œë ¥</span>
    log_message <span class="s2">"í˜„ì¬ ë¼ìš°íŒ… í…Œì´ë¸”:"</span>
    ip route <span class="o">&gt;&gt;</span> <span class="nv">$LOG_FILE</span>
<span class="o">}</span>

<span class="c"># 5ë‹¨ê³„: í¬íŠ¸ ìŠ¤ìº” (ì„œë¹„ìŠ¤ ê°€ìš©ì„± í™•ì¸)</span>
check_services<span class="o">()</span> <span class="o">{</span>
    log_message <span class="s2">"=== 5ë‹¨ê³„: í•µì‹¬ ì„œë¹„ìŠ¤ í™•ì¸ ==="</span>
    
    <span class="nv">services</span><span class="o">=(</span>
        <span class="s2">"8.8.8.8:53:DNS"</span>
        <span class="s2">"google.com:80:HTTP"</span>
        <span class="s2">"google.com:443:HTTPS"</span>
        <span class="s2">"github.com:22:SSH"</span>
    <span class="o">)</span>
    
    <span class="k">for </span>service <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">services</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
        </span><span class="nv">IFS</span><span class="o">=</span><span class="s1">':'</span> <span class="nb">read</span> <span class="nt">-r</span> host port name <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$service</span><span class="s2">"</span>
        
        <span class="k">if </span><span class="nb">timeout </span>5 bash <span class="nt">-c</span> <span class="s2">"echo &gt;/dev/tcp/</span><span class="nv">$host</span><span class="s2">/</span><span class="nv">$port</span><span class="s2">"</span> 2&gt;/dev/null<span class="p">;</span> <span class="k">then
            </span>log_message <span class="s2">"âœ… </span><span class="nv">$name</span><span class="s2"> (</span><span class="nv">$host</span><span class="s2">:</span><span class="nv">$port</span><span class="s2">): ì ‘ê·¼ ê°€ëŠ¥"</span>
        <span class="k">else
            </span>log_message <span class="s2">"âŒ </span><span class="nv">$name</span><span class="s2"> (</span><span class="nv">$host</span><span class="s2">:</span><span class="nv">$port</span><span class="s2">): ì ‘ê·¼ ë¶ˆê°€"</span>
        <span class="k">fi
    done</span>
<span class="o">}</span>

<span class="c"># 6ë‹¨ê³„: ìë™ ë³µêµ¬ ì‹œë„</span>
auto_recovery<span class="o">()</span> <span class="o">{</span>
    log_message <span class="s2">"=== 6ë‹¨ê³„: ìë™ ë³µêµ¬ ì‹œë„ ==="</span>
    
    <span class="c"># ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬ì ì¬ì‹œì‘</span>
    <span class="k">if </span>systemctl is-active NetworkManager <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
        </span>log_message <span class="s2">"NetworkManager ì¬ì‹œì‘ ì¤‘..."</span>
        <span class="nb">sudo </span>systemctl restart NetworkManager
        <span class="nb">sleep </span>10
    <span class="k">fi</span>
    
    <span class="c"># ë°©í™”ë²½ ê·œì¹™ ì´ˆê¸°í™” (ì„ì‹œ)</span>
    log_message <span class="s2">"ë°©í™”ë²½ ê·œì¹™ ì„ì‹œ í—ˆìš©..."</span>
    <span class="nb">sudo </span>iptables <span class="nt">-P</span> INPUT ACCEPT
    <span class="nb">sudo </span>iptables <span class="nt">-P</span> FORWARD ACCEPT
    <span class="nb">sudo </span>iptables <span class="nt">-P</span> OUTPUT ACCEPT
    
    <span class="c"># DNS ìºì‹œ í”ŒëŸ¬ì‹œ</span>
    log_message <span class="s2">"DNS ìºì‹œ í”ŒëŸ¬ì‹œ..."</span>
    <span class="nb">sudo </span>systemctl restart systemd-resolved
    
    log_message <span class="s2">"ìë™ ë³µêµ¬ ì™„ë£Œ. 5ë¶„ í›„ ì¬í…ŒìŠ¤íŠ¸ ì˜ˆì •..."</span>
<span class="o">}</span>

<span class="c"># ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜</span>
main<span class="o">()</span> <span class="o">{</span>
    log_message <span class="s2">"==================== ë„¤íŠ¸ì›Œí¬ ì§„ë‹¨ ì‹œì‘ ===================="</span>
    
    <span class="nv">failure_count</span><span class="o">=</span>0
    
    check_connectivity <span class="o">||</span> <span class="o">((</span>failure_count++<span class="o">))</span>
    check_dns <span class="o">||</span> <span class="o">((</span>failure_count++<span class="o">))</span>  
    check_interfaces <span class="o">||</span> <span class="o">((</span>failure_count++<span class="o">))</span>
    check_routing <span class="o">||</span> <span class="o">((</span>failure_count++<span class="o">))</span>
    check_services <span class="o">||</span> <span class="o">((</span>failure_count++<span class="o">))</span>
    
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$failure_count</span> <span class="nt">-gt</span> 2 <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>log_message <span class="s2">"âš ï¸  ì‹¬ê°í•œ ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ ê°ì§€ (</span><span class="nv">$failure_count</span><span class="s2"> ê°œ ì‹¤íŒ¨)"</span>
        auto_recovery
        
        <span class="c"># 5ë¶„ í›„ ì¬í…ŒìŠ¤íŠ¸</span>
        <span class="nb">sleep </span>300
        log_message <span class="s2">"==================== ë³µêµ¬ í›„ ì¬ì§„ë‹¨ ===================="</span>
        main
    <span class="k">else
        </span>log_message <span class="s2">"âœ… ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ì •ìƒ (ì‹¤íŒ¨: </span><span class="nv">$failure_count</span><span class="s2"> ê°œ)"</span>
    <span class="k">fi
    
    </span>log_message <span class="s2">"==================== ì§„ë‹¨ ì™„ë£Œ ===================="</span>
<span class="o">}</span>

<span class="c"># ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰</span>
main
</code></pre></div></div>

<h2 id="ìµœì‹ -ë³´ì•ˆ-ìœ„í˜‘ê³¼-ëŒ€ì‘">ìµœì‹  ë³´ì•ˆ ìœ„í˜‘ê³¼ ëŒ€ì‘</h2>

<h3 id="-aiml-ê¸°ë°˜-ìœ„í˜‘-íƒì§€">ğŸ¯ AI/ML ê¸°ë°˜ ìœ„í˜‘ íƒì§€</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">IsolationForest</span>
<span class="kn">from</span> <span class="n">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="k">class</span> <span class="nc">NetworkAnomalyDetector</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="nc">IsolationForest</span><span class="p">(</span><span class="n">contamination</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">scaler</span> <span class="o">=</span> <span class="nc">StandardScaler</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">prepare_features</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">network_data</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë„¤íŠ¸ì›Œí¬ ë°ì´í„°ì—ì„œ í”¼ì²˜ ì¶”ì¶œ</span><span class="sh">"""</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">()</span>
        
        <span class="c1"># ì‹œê°„ëŒ€ë³„ íŠ¸ë˜í”½ íŒ¨í„´
</span>        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">hour</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">network_data</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">]).</span><span class="n">dt</span><span class="p">.</span><span class="n">hour</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">day_of_week</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">network_data</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">]).</span><span class="n">dt</span><span class="p">.</span><span class="n">dayofweek</span>
        
        <span class="c1"># íŠ¸ë˜í”½ ë³¼ë¥¨
</span>        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">bytes_per_second</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">network_data</span><span class="p">[</span><span class="sh">'</span><span class="s">bytes</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">network_data</span><span class="p">[</span><span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">packets_per_second</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">network_data</span><span class="p">[</span><span class="sh">'</span><span class="s">packets</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">network_data</span><span class="p">[</span><span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="c1"># ì—°ê²° íŒ¨í„´
</span>        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">unique_src_ports</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">network_data</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">src_ip</span><span class="sh">'</span><span class="p">)[</span><span class="sh">'</span><span class="s">src_port</span><span class="sh">'</span><span class="p">].</span><span class="nf">nunique</span><span class="p">()</span>
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">unique_dst_ports</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">network_data</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">src_ip</span><span class="sh">'</span><span class="p">)[</span><span class="sh">'</span><span class="s">dst_port</span><span class="sh">'</span><span class="p">].</span><span class="nf">nunique</span><span class="p">()</span> 
        <span class="n">features</span><span class="p">[</span><span class="sh">'</span><span class="s">connection_count</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">network_data</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">src_ip</span><span class="sh">'</span><span class="p">).</span><span class="nf">size</span><span class="p">()</span>
        
        <span class="c1"># í”„ë¡œí† ì½œ ë¶„í¬
</span>        <span class="n">protocol_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">get_dummies</span><span class="p">(</span><span class="n">network_data</span><span class="p">[</span><span class="sh">'</span><span class="s">protocol</span><span class="sh">'</span><span class="p">])</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">features</span><span class="p">.</span><span class="nf">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> 
                            <span class="n">protocol_counts</span><span class="p">.</span><span class="nf">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">features</span><span class="p">.</span><span class="nf">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">training_data</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì •ìƒ íŠ¸ë˜í”½ìœ¼ë¡œ ëª¨ë¸ í•™ìŠµ</span><span class="sh">"""</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">prepare_features</span><span class="p">(</span><span class="n">training_data</span><span class="p">)</span>
        <span class="n">scaled_features</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">scaler</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">scaled_features</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">detect_anomalies</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">test_data</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì´ìƒ íŠ¸ë˜í”½ íƒì§€</span><span class="sh">"""</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">prepare_features</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
        <span class="n">scaled_features</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">scaler</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        
        <span class="c1"># ì´ìƒ ì ìˆ˜ ê³„ì‚° (-1: ì´ìƒ, 1: ì •ìƒ)
</span>        <span class="n">predictions</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">scaled_features</span><span class="p">)</span>
        <span class="n">anomaly_scores</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">score_samples</span><span class="p">(</span><span class="n">scaled_features</span><span class="p">)</span>
        
        <span class="c1"># ê²°ê³¼ ë°ì´í„°í”„ë ˆì„ ìƒì„±
</span>        <span class="n">results</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">is_anomaly</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictions</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">anomaly_score</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">anomaly_scores</span>
        
        <span class="k">return</span> <span class="n">results</span>
    
    <span class="k">def</span> <span class="nf">visualize_anomalies</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì´ìƒ íƒì§€ ê²°ê³¼ ì‹œê°í™”</span><span class="sh">"""</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        
        <span class="c1"># ì‹œê°„ë³„ ì´ìƒ íŠ¸ë˜í”½
</span>        <span class="n">hourly_anomalies</span> <span class="o">=</span> <span class="n">results</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span>
            <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">]).</span><span class="n">dt</span><span class="p">.</span><span class="n">hour</span>
        <span class="p">)[</span><span class="sh">'</span><span class="s">is_anomaly</span><span class="sh">'</span><span class="p">].</span><span class="nf">sum</span><span class="p">()</span>
        
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">].</span><span class="nf">bar</span><span class="p">(</span><span class="n">hourly_anomalies</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">hourly_anomalies</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">ì‹œê°„ëŒ€ë³„ ì´ìƒ íŠ¸ë˜í”½</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">ì‹œê°„</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">ì´ìƒ íŠ¸ë˜í”½ ìˆ˜</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># IPë³„ ì´ìƒ ì ìˆ˜ ë¶„í¬
</span>        <span class="n">ip_scores</span> <span class="o">=</span> <span class="n">results</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">src_ip</span><span class="sh">'</span><span class="p">)[</span><span class="sh">'</span><span class="s">anomaly_score</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">().</span><span class="nf">sort_values</span><span class="p">()</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">].</span><span class="nf">barh</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">ip_scores</span><span class="p">.</span><span class="nf">tail</span><span class="p">(</span><span class="mi">10</span><span class="p">))),</span> <span class="n">ip_scores</span><span class="p">.</span><span class="nf">tail</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="n">values</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_yticks</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">ip_scores</span><span class="p">.</span><span class="nf">tail</span><span class="p">(</span><span class="mi">10</span><span class="p">))))</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_yticklabels</span><span class="p">(</span><span class="n">ip_scores</span><span class="p">.</span><span class="nf">tail</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="n">index</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">ìƒìœ„ 10ê°œ ì˜ì‹¬ IP</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># í¬íŠ¸ ìŠ¤ìº” íŒ¨í„´
</span>        <span class="n">port_scan_ips</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">unique_dst_ports</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">][</span><span class="sh">'</span><span class="s">src_ip</span><span class="sh">'</span><span class="p">].</span><span class="nf">value_counts</span><span class="p">()</span>
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">port_scan_ips</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">].</span><span class="nf">bar</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">port_scan_ips</span><span class="p">.</span><span class="nf">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))),</span> <span class="n">port_scan_ips</span><span class="p">.</span><span class="nf">head</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="n">values</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_xticks</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">port_scan_ips</span><span class="p">.</span><span class="nf">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))))</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_xticklabels</span><span class="p">(</span><span class="n">port_scan_ips</span><span class="p">.</span><span class="nf">head</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="n">index</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">í¬íŠ¸ ìŠ¤ìº” ì˜ì‹¬ IP</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># ë°ì´í„° ì „ì†¡ëŸ‰ ë¶„í¬
</span>        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">].</span><span class="nf">scatter</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">bytes</span><span class="sh">'</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">anomaly_score</span><span class="sh">'</span><span class="p">],</span> 
                         <span class="n">c</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">is_anomaly</span><span class="sh">'</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">ì „ì†¡ ë°”ì´íŠ¸</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">ì´ìƒ ì ìˆ˜</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">ë°ì´í„° ì „ì†¡ëŸ‰ vs ì´ìƒ ì ìˆ˜</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="c1"># ì‚¬ìš© ì˜ˆì‹œ
</span><span class="n">detector</span> <span class="o">=</span> <span class="nc">NetworkAnomalyDetector</span><span class="p">()</span>

<span class="c1"># ëª¨ì˜ ë„¤íŠ¸ì›Œí¬ ë°ì´í„° ìƒì„±
</span><span class="n">training_data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span>
    <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">'</span><span class="s">2024-03-01</span><span class="sh">'</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">'</span><span class="s">1min</span><span class="sh">'</span><span class="p">),</span>
    <span class="sh">'</span><span class="s">src_ip</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">([</span><span class="sh">'</span><span class="s">192.168.1.100</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">192.168.1.101</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">192.168.1.102</span><span class="sh">'</span><span class="p">],</span> <span class="mi">10000</span><span class="p">),</span>
    <span class="sh">'</span><span class="s">dst_ip</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">([</span><span class="sh">'</span><span class="s">8.8.8.8</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">1.1.1.1</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">208.67.222.222</span><span class="sh">'</span><span class="p">],</span> <span class="mi">10000</span><span class="p">),</span>
    <span class="sh">'</span><span class="s">src_port</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">65535</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span>
    <span class="sh">'</span><span class="s">dst_port</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">([</span><span class="mi">80</span><span class="p">,</span> <span class="mi">443</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">22</span><span class="p">],</span> <span class="mi">10000</span><span class="p">),</span>
    <span class="sh">'</span><span class="s">protocol</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">([</span><span class="sh">'</span><span class="s">TCP</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">UDP</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ICMP</span><span class="sh">'</span><span class="p">],</span> <span class="mi">10000</span><span class="p">),</span>
    <span class="sh">'</span><span class="s">bytes</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">lognormal</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span>
    <span class="sh">'</span><span class="s">packets</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">poisson</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span>
    <span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">exponential</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="p">})</span>

<span class="n">detector</span><span class="p">.</span><span class="nf">train</span><span class="p">(</span><span class="n">training_data</span><span class="p">)</span>

<span class="c1"># í…ŒìŠ¤íŠ¸ ë°ì´í„°ì— ì¼ë¶€ ì´ìƒ íŠ¸ë˜í”½ í¬í•¨
</span><span class="n">test_data</span> <span class="o">=</span> <span class="n">training_data</span><span class="p">.</span><span class="nf">sample</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span><span class="nf">copy</span><span class="p">()</span>
<span class="c1"># í¬íŠ¸ ìŠ¤ìº” ì‹œë®¬ë ˆì´ì…˜
</span><span class="n">test_data</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span> <span class="sh">'</span><span class="s">dst_port</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
<span class="n">test_data</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span> <span class="sh">'</span><span class="s">src_ip</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">10.0.0.100</span><span class="sh">'</span>  <span class="c1"># ì™¸ë¶€ IP
</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">detector</span><span class="p">.</span><span class="nf">detect_anomalies</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
<span class="n">detector</span><span class="p">.</span><span class="nf">visualize_anomalies</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="ë§ˆë¬´ë¦¬">ë§ˆë¬´ë¦¬</h2>

<p>ì´ ì‹œë¦¬ì¦ˆë¥¼ í†µí•´ ë„¤íŠ¸ì›Œí‚¹ì˜ ëª¨ë“  ì¸¡ë©´ì„ ë‹¤ë¤˜ìŠµë‹ˆë‹¤:</p>

<ol>
  <li><strong>Part 1</strong>: OSI 7ê³„ì¸µê³¼ TCP/IP í”„ë¡œí† ì½œ ê¸°ì´ˆ</li>
  <li><strong>Part 2</strong>: IP ì£¼ì†Œ ì²´ê³„ì™€ ì„œë¸Œë„¤íŒ…</li>
  <li><strong>Part 3</strong>: ë¼ìš°íŒ…ê³¼ ìŠ¤ìœ„ì¹­ ê³ ê¸‰ ê¸°ìˆ </li>
  <li><strong>Part 4</strong>: ë¬´ì„  ë„¤íŠ¸ì›Œí‚¹ê³¼ ìµœì‹  ê¸°ìˆ  ë™í–¥</li>
  <li><strong>Part 5</strong>: ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆê³¼ ê³ ê¸‰ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…</li>
</ol>

<p>ì‹¤ë¬´ì—ì„œ ì´ ì§€ì‹ë“¤ì„ ì ê·¹ í™œìš©í•˜ì—¬ ì•ˆì „í•˜ê³  íš¨ìœ¨ì ì¸ ë„¤íŠ¸ì›Œí¬ ì¸í”„ë¼ë¥¼ êµ¬ì¶•í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤! ğŸŒğŸ”’</p>

<h2 id="ì¶”ì²œ-í•™ìŠµ-ìë£Œ">ì¶”ì²œ í•™ìŠµ ìë£Œ</h2>

<ul>
  <li><strong>ì„œì </strong>: â€œComputer Networking: A Top-Down Approachâ€ - Kurose &amp; Ross</li>
  <li><strong>ì‹¤ìŠµ</strong>: Packet Tracer, GNS3, EVE-NG</li>
  <li><strong>ì¸ì¦</strong>: CCNA, CCNP, CCIE (Cisco), JNCIA, JNCIP (Juniper)</li>
  <li><strong>ì˜¤í”ˆì†ŒìŠ¤</strong>: Wireshark, pfSense, OpenWrt, Suricata</li>
</ul>

<p>ë„¤íŠ¸ì›Œí¬ ë§ˆìŠ¤í„°ì˜ ê¸¸, í•¨ê»˜ ê±¸ì–´ê°€ìš”! ğŸš€</p>]]></content><author><name>DevOps Engineer</name></author><category term="Networking" /><category term="Security" /><category term="network-security" /><category term="firewall" /><category term="ids" /><category term="ips" /><category term="zero-trust" /><category term="troubleshooting" /><category term="forensics" /><summary type="html"><![CDATA[ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆì˜ ìµœì‹  ê¸°ìˆ ê³¼ ê³ ê¸‰ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê¸°ë²•ì„ ì‹¤ë¬´ ì¤‘ì‹¬ìœ¼ë¡œ ì™„ì „íˆ ë§ˆìŠ¤í„°í•´ë³´ê² ìŠµë‹ˆë‹¤. ì°¨ì„¸ëŒ€ ë°©í™”ë²½ (NGFW) | Next-Generation Firewall ğŸ”¥ NGFW ê¸°ëŠ¥ê³¼ íŠ¹ì§• ì „í†µ ë°©í™”ë²½ vs NGFW ë¹„êµ Traditional Firewall: - L3/L4 íŒ¨í‚· í•„í„°ë§ (IP, Port) - Stateful ì—°ê²° ì¶”ì  - NAT/PAT ê¸°ëŠ¥ Next-Generation Firewall (NGFW): - Application Awareness (L7) - Intrusion Prevention (IPS) - SSL/TLS Decryption - User Identity Integration - Advanced Threat Protection - Sandboxing Palo Alto NGFW ì„¤ì • ì‹¤ìŠµ # ë³´ì•ˆ ì •ì±… ì„¤ì • # ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ë°˜ ì •ì±… configure set rulebase security rules "Allow-Office365" from any set rulebase security rules "Allow-Office365" to any set rulebase security rules "Allow-Office365" source any set rulebase security rules "Allow-Office365" destination any set rulebase security rules "Allow-Office365" application [ ms-office365 outlook-web-access ] set rulebase security rules "Allow-Office365" service application-default set rulebase security rules "Allow-Office365" action allow # ì‚¬ìš©ì ê¸°ë°˜ ì •ì±… set rulebase security rules "Block-Social-Media" from trust set rulebase security rules "Block-Social-Media" to untrust set rulebase security rules "Block-Social-Media" source-user [ "DOMAIN\sales-team" ] set rulebase security rules "Block-Social-Media" application [ facebook twitter instagram ] set rulebase security rules "Block-Social-Media" action deny # SSL Decryption ì •ì±… set shared ssl-decrypt ssl-decrypt-policy "Decrypt-Inbound" rules "web-traffic" set shared ssl-decrypt ssl-decrypt-policy "Decrypt-Inbound" rules "web-traffic" category [ "business-and-economy" "computer-and-internet-info" ] set shared ssl-decrypt ssl-decrypt-policy "Decrypt-Inbound" rules "web-traffic" action decrypt pfSense ì˜¤í”ˆì†ŒìŠ¤ ë°©í™”ë²½ ì„¤ì • # pfSense íŒ¨í‚¤ì§€ ì„¤ì¹˜ pkg install pfSense-pkg-suricata pkg install pfSense-pkg-pfBlockerNG # Suricata IPS ì„¤ì • # /usr/local/etc/suricata/suricata.yaml HOME_NET: "[192.168.1.0/24,10.0.0.0/8]" EXTERNAL_NET: "!$HOME_NET" rule-files: - emerging-threats.rules - botcc.rules - emerging-malware.rules # ì‚¬ìš©ì ì •ì˜ ë£° # /usr/local/etc/suricata/rules/local.rules alert tcp $HOME_NET any -&gt; $EXTERNAL_NET 80 (msg:"HTTP outbound connection"; sid:1000001; rev:1;) alert tcp any any -&gt; $HOME_NET 22 (msg:"SSH connection attempt"; threshold: type both, track by_src, count 5, seconds 60; sid:1000002; rev:1;) # pfBlockerNG GeoIP ì°¨ë‹¨ # ëŸ¬ì‹œì•„, ì¤‘êµ­, ë¶í•œ IP ëŒ€ì—­ ì°¨ë‹¨ Asia_Russia: Deny_Inbound, Deny_Outbound Asia_China: Deny_Inbound, Permit_Outbound Asia_North_Korea: Deny_Both ğŸ›¡ï¸ IDS/IPS ì‹œìŠ¤í…œ Suricata IDS/IPS ë°°í¬ # Suricata ì„¤ì¹˜ (Ubuntu) sudo add-apt-repository ppa:oisf/suricata-stable sudo apt update sudo apt install suricata # ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ì„¤ì • # /etc/suricata/suricata.yaml af-packet: - interface: eth0 cluster-id: 99 cluster-type: cluster_flow defrag: yes use-mmap: yes mmap-locked: yes # ë£°ì…‹ ì—…ë°ì´íŠ¸ sudo suricata-update sudo suricata-update list-sources sudo suricata-update enable-source et/pro # Emerging Threats Pro sudo suricata-update enable-source ptresearch/attackdetection # ì»¤ìŠ¤í…€ ë£° ì‘ì„± # /etc/suricata/rules/local.rules # DDoS ê³µê²© íƒì§€ alert tcp any any -&gt; $HOME_NET any (msg:"Possible DDoS attack"; flags:S; threshold: type both, track by_src, count 100, seconds 10; sid:1000003; rev:1;) # SQL ì¸ì ì…˜ íƒì§€ alert http any any -&gt; $HOME_NET any (msg:"SQL Injection Attack"; content:"union select"; nocase; http_uri; sid:1000004; rev:1;) # í¬ë¦¬ë´ì…œ ìŠ¤í„°í•‘ íƒì§€ alert http any any -&gt; $HOME_NET any (msg:"Credential Stuffing Attack"; content:"POST"; http_method; threshold: type both, track by_src, count 50, seconds 60; sid:1000005; rev:1;) Zeek (Bro) ë„¤íŠ¸ì›Œí¬ ë¶„ì„ # Zeek ì„¤ì¹˜ sudo apt install zeek # ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ì„¤ì • # /opt/zeek/etc/node.cfg [zeek] type=standalone host=localhost interface=eth0 # ì»¤ìŠ¤í…€ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± # /opt/zeek/share/zeek/site/local.zeek @load base/protocols/http @load base/protocols/dns @load base/protocols/ssl # HTTP íŠ¸ë˜í”½ ëª¨ë‹ˆí„°ë§ event http_request(c: connection, method: string, original_URI: string, unescaped_URI: string, version: string) { if ( /\.(exe|zip|rar|7z)$/ in unescaped_URI ) print fmt("%s ë‹¤ìš´ë¡œë“œ: %s -&gt; %s%s", strftime("%Y-%m-%d %H:%M:%S", network_time()), c$id$orig_h, c$id$resp_h, unescaped_URI); } # DNS ëª¨ë‹ˆí„°ë§ event dns_request(c: connection, msg: dns_msg, query: string, qtype: count, qclass: count) { if ( /[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.in-addr\.arpa/ !in query ) { if ( /\.tk$|\.ml$|\.ga$|\.cf$/ in query ) print fmt("ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ë„ë©”ì¸ ì§ˆì˜: %s -&gt; %s", c$id$orig_h, query); } } # ì„œë¹„ìŠ¤ ì‹œì‘ sudo zeekctl deploy sudo zeekctl status ì œë¡œ íŠ¸ëŸ¬ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ | Zero Trust Network ğŸ”’ ì œë¡œ íŠ¸ëŸ¬ìŠ¤íŠ¸ ì•„í‚¤í…ì²˜ ì œë¡œ íŠ¸ëŸ¬ìŠ¤íŠ¸ ì›ì¹™ Never Trust, Always Verify: - ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  íŠ¸ë˜í”½ ì°¨ë‹¨ - ëª…ì‹œì  ê²€ì¦ê³¼ ì¸ê°€ - ìµœì†Œ ê¶Œí•œ ì›ì¹™ Verify Explicitly: - ì‚¬ìš©ì ì‹ ì› í™•ì¸ - ë””ë°”ì´ìŠ¤ ìƒíƒœ ê²€ì¦ - ë„¤íŠ¸ì›Œí¬ ìœ„ì¹˜ ë¬´ê´€ Least Privileged Access: - Just-in-Time (JIT) ì•¡ì„¸ìŠ¤ - Just-Enough-Access (JEA) - ìœ„í—˜ ê¸°ë°˜ ì ì‘í˜• ì •ì±… Assume Breach: - ì„¸ê·¸ë©˜í…Œì´ì…˜ê³¼ ê²©ë¦¬ - íš¡ì  ì´ë™ ì°¨ë‹¨ - ì§€ì†ì  ëª¨ë‹ˆí„°ë§ ë§ˆì´í¬ë¡œ ì„¸ê·¸ë©˜í…Œì´ì…˜ êµ¬í˜„ # Cisco ACI ë§ˆì´í¬ë¡œ ì„¸ê·¸ë©˜í…Œì´ì…˜ # ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œíŒŒì¼ ìƒì„± apic1# configure apic1(config)# tenant production apic1(config-tenant)# application app-web apic1(config-tenant-app)# epg web-tier apic1(config-tenant-app-epg)# bridge-domain web-bd apic1(config-tenant-app-epg)# exit # ê³„ì•½ (Contract) ì •ì˜ apic1(config-tenant-app)# contract web-to-db apic1(config-tenant-app-contract)# subject db-access apic1(config-tenant-app-contract-subject)# filter mysql-filter apic1(config-tenant-app-contract-subject-filter)# entry mysql apic1(config-tenant-app-contract-subject-filter-entry)# ether-type ip apic1(config-tenant-app-contract-subject-filter-entry)# ip-protocol tcp apic1(config-tenant-app-contract-subject-filter-entry)# destination-port-range from 3306 to 3306 # VMware NSX ë§ˆì´í¬ë¡œ ì„¸ê·¸ë©˜í…Œì´ì…˜ # ë¶„ì‚° ë°©í™”ë²½ ì •ì±… nsxcli&gt; configure firewall nsxcli(firewall)&gt; add rule web-tier-protection nsxcli(firewall-rule)&gt; set source security-group web-servers nsxcli(firewall-rule)&gt; set destination security-group db-servers nsxcli(firewall-rule)&gt; set service MYSQL nsxcli(firewall-rule)&gt; set action allow nsxcli(firewall-rule)&gt; set applied-to security-group web-servers nsxcli(firewall-rule)&gt; commit Kubernetes ë„¤íŠ¸ì›Œí¬ ì •ì±… # ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê²©ë¦¬ ì •ì±… apiVersion: networking.k8s.io/v1 kind: NetworkPolicy metadata: name: default-deny-all namespace: production spec: podSelector: {} policyTypes: - Ingress - Egress --- # ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ì±… apiVersion: networking.k8s.io/v1 kind: NetworkPolicy metadata: name: web-app-policy namespace: production spec: podSelector: matchLabels: app: web-frontend policyTypes: - Ingress - Egress ingress: - from: - namespaceSelector: matchLabels: name: ingress-nginx ports: - protocol: TCP port: 8080 egress: - to: - podSelector: matchLabels: app: api-backend ports: - protocol: TCP port: 3000 - to: - namespaceSelector: matchLabels: name: kube-system ports: - protocol: UDP port: 53 # DNS --- # ë°ì´í„°ë² ì´ìŠ¤ ì •ì±… apiVersion: networking.k8s.io/v1 kind: NetworkPolicy metadata: name: database-policy namespace: production spec: podSelector: matchLabels: app: mysql-db policyTypes: - Ingress ingress: - from: - podSelector: matchLabels: app: api-backend ports: - protocol: TCP port: 3306 ë„¤íŠ¸ì›Œí¬ í¬ë Œì‹ | Network Forensics ğŸ” íŒ¨í‚· ë¶„ì„ê³¼ ì¦ê±° ìˆ˜ì§‘ Wireshark ê³ ê¸‰ ë¶„ì„ ê¸°ë²• # ì˜ì‹¬ìŠ¤ëŸ¬ìš´ íŠ¸ë˜í”½ í•„í„°ë§ # ëŒ€ëŸ‰ ë°ì´í„° ì „ì†¡ íƒì§€ tcp.len &gt; 1400 and ip.src == 192.168.1.100 # DNS í„°ë„ë§ íƒì§€ dns.qry.name contains "." dns.qry.name matches "^[a-f0-9]{20,}\\." # HTTP POST ë°ì´í„° exfiltration http.request.method == "POST" and http.content_length &gt; 10000 # ë¹„ì •ìƒì ì¸ í¬íŠ¸ ì‚¬ìš© tcp.port == 443 and not ssl.handshake.type tcp.port == 80 and ssl.handshake.type # ì»¤ë§¨ë“œ ì•¤ ì»¨íŠ¸ë¡¤ í†µì‹  íŒ¨í„´ (tcp.flags.push == 1) and (tcp.len &lt; 100) and (tcp.len &gt; 10) # í†µê³„ ë¶„ì„ì„ ìœ„í•œ tshark ì‚¬ìš© # ìƒìœ„ í†µì‹  í˜¸ìŠ¤íŠ¸ tshark -r capture.pcap -q -z conv,ip | sort -k7 -nr | head -20 # í”„ë¡œí† ì½œ ë¶„í¬ tshark -r capture.pcap -q -z prot,colinfo # ì‹œê°„ë³„ íŠ¸ë˜í”½ ë¶„ì„ tshark -r capture.pcap -T fields -e frame.time -e ip.src -e ip.dst -e tcp.srcport -e tcp.dstport | awk '{print $1 " " $2 ":" $4 " -&gt; " $3 ":" $5}' | sort | uniq -c | sort -nr ë„¤íŠ¸ì›Œí¬ í”Œë¡œìš° ë¶„ì„ (nfcapd) # nfcapd ì„¤ì • ë° ì‹œì‘ nfcapd -w -D -p 9995 -l /var/cache/nfcapd # ë¼ìš°í„°ì—ì„œ NetFlow í™œì„±í™” (Cisco) interface FastEthernet0/1 ip flow ingress ip flow egress ip flow-export source FastEthernet0/1 ip flow-export version 9 ip flow-export destination 192.168.1.100 9995 # í”Œë¡œìš° ë°ì´í„° ë¶„ì„ # ìƒìœ„ í†µì‹ ëŸ‰ í˜¸ìŠ¤íŠ¸ nfdump -r /var/cache/nfcapd/nfcapd.* -s srcip/bytes -n 20 # íŠ¹ì • ì‹œê°„ëŒ€ ë¶„ì„ nfdump -r /var/cache/nfcapd/nfcapd.* -t 2024-03-30.10:00:00-2024-03-30.11:00:00 -s dstip/packets # ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í¬íŠ¸ ì‚¬ìš© nfdump -r /var/cache/nfcapd/nfcapd.* 'port &gt; 10000 and port &lt; 65000' -s srcip/flows # ëŒ€ìš©ëŸ‰ ì „ì†¡ íƒì§€ nfdump -r /var/cache/nfcapd/nfcapd.* 'bytes &gt; 100000000' -o extended ğŸ•µï¸ ìœ„í˜‘ í—ŒíŒ… (Threat Hunting) ELK ìŠ¤íƒ ê¸°ë°˜ ìœ„í˜‘ í—ŒíŒ… # Logstash ì„¤ì • - ë„¤íŠ¸ì›Œí¬ ë¡œê·¸ íŒŒì‹± # /etc/logstash/conf.d/network-logs.conf input { beats { port =&gt; 5044 } syslog { port =&gt; 514 type =&gt; "firewall" } } filter { if [type] == "firewall" { grok { match =&gt; { "message" =&gt; "%{TIMESTAMP_ISO8601:timestamp} %{WORD:device} %{WORD:action} %{IP:src_ip}:%{INT:src_port} -&gt; %{IP:dst_ip}:%{INT:dst_port} %{WORD:protocol}" } } geoip { source =&gt; "src_ip" target =&gt; "src_geoip" } if [src_geoip][country_name] in ["Russia", "China", "North Korea"] { mutate { add_tag =&gt; [ "suspicious_geo" ] } } } } output { elasticsearch { hosts =&gt; ["localhost:9200"] index =&gt; "network-logs-%{+YYYY.MM.dd}" } } Kibana ìœ„í˜‘ í—ŒíŒ… ì¿¼ë¦¬ { "query": { "bool": { "must": [ { "range": { "@timestamp": { "gte": "now-1h" } } }, { "terms": { "tags": ["suspicious_geo"] } } ], "should": [ { "range": { "bytes": { "gte": 1000000 } } }, { "script": { "script": { "source": "doc['dst_port'].value &gt; 10000 &amp;&amp; doc['dst_port'].value &lt; 65000" } } } ] } }, "aggs": { "suspicious_ips": { "terms": { "field": "src_ip", "size": 100 }, "aggs": { "unique_ports": { "cardinality": { "field": "dst_port" } }, "total_bytes": { "sum": { "field": "bytes" } } } } } } YARA ë£° ê¸°ë°˜ ë„¤íŠ¸ì›Œí¬ íƒì§€ # YARA ë£° ì˜ˆì‹œ - ì•…ì„±ì½”ë“œ í†µì‹  íŒ¨í„´ rule APT_Communication_Pattern { meta: description = "APT ê·¸ë£¹ í†µì‹  íŒ¨í„´ íƒì§€" author = "Security Team" date = "2024-03-30" strings: $user_agent = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)" $uri_pattern = /\/[a-f0-9]{8}\/[a-f0-9]{8}/ $post_data = { 48 54 54 50 2F 31 2E 31 20 32 30 30 20 4F 4B } // "HTTP/1.1 200 OK" condition: $user_agent and $uri_pattern and $post_data } rule DNS_Tunneling { meta: description = "DNS í„°ë„ë§ íŒ¨í„´ íƒì§€" strings: $long_subdomain = /[a-zA-Z0-9]{50,}\..*\.(com|net|org)/ $base64_pattern = /[A-Za-z0-9+\/]{20,}={0,2}/ condition: $long_subdomain or $base64_pattern } # ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì— YARA ì ìš© suricata -c /etc/suricata/suricata.yaml -i eth0 --runmode single ê³ ê¸‰ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… | Advanced Troubleshooting ğŸ”§ ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ ë¬¸ì œ í•´ê²° ëŒ€ì—­í­ê³¼ ì§€ì—°ì‹œê°„ ë¶„ì„ # iperf3ë¥¼ ì´ìš©í•œ ì„±ëŠ¥ ì¸¡ì • # ì„œë²„ ì¸¡ iperf3 -s -p 5201 # í´ë¼ì´ì–¸íŠ¸ ì¸¡ - TCP í…ŒìŠ¤íŠ¸ iperf3 -c 192.168.1.100 -t 30 -i 1 -P 4 # -t: í…ŒìŠ¤íŠ¸ ì‹œê°„, -i: ì¸í„°ë²Œ, -P: ë³‘ë ¬ ì—°ê²° # UDP í…ŒìŠ¤íŠ¸ (íŒ¨í‚· ì†ì‹¤ í™•ì¸) iperf3 -c 192.168.1.100 -u -b 100M -t 30 # ì–‘ë°©í–¥ í…ŒìŠ¤íŠ¸ iperf3 -c 192.168.1.100 --bidir -t 30 # MTU í¬ê¸° ìµœì í™” í…ŒìŠ¤íŠ¸ ping -M do -s 1472 192.168.1.100 # Linux ping -f -l 1472 192.168.1.100 # Windows # ì ì§„ì  MTU í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash for size in {1200..1500..50}; do echo "Testing MTU size: $size" ping -M do -s $size -c 1 192.168.1.100 &gt; /dev/null 2&gt;&amp;1 if [ $? -eq 0 ]; then echo "âœ… MTU $size: Success" else echo "âŒ MTU $size: Failed" fi done ë„¤íŠ¸ì›Œí¬ ì§€ì—°ì‹œê°„ ìƒì„¸ ë¶„ì„ # hping3ë¥¼ ì´ìš©í•œ ë‹¤ì–‘í•œ í…ŒìŠ¤íŠ¸ # TCP SYN í”ŒëŸ¬ë“œ í…ŒìŠ¤íŠ¸ hping3 -S -p 80 -i u1000 192.168.1.100 # UDP í¬íŠ¸ ìŠ¤ìº” hping3 --udp -p 53 -c 3 192.168.1.100 # ICMP íƒ€ì„ìŠ¤íƒ¬í”„ ìš”ì²­ hping3 --icmp-ts 192.168.1.100 # traceroute ê³ ê¸‰ ì˜µì…˜ # TCP traceroute traceroute -T -p 443 google.com # UDP traceroute traceroute -U -p 53 8.8.8.8 # Paris traceroute (ë¡œë“œ ë°¸ëŸ°ì‹± ê³ ë ¤) paris-traceroute google.com # mtr - ì‹¤ì‹œê°„ traceroute mtr --report --report-cycles 100 --no-dns google.com ğŸ“Š ë„¤íŠ¸ì›Œí¬ ëª¨ë‹ˆí„°ë§ê³¼ ë¶„ì„ SNMP ê¸°ë°˜ ëª¨ë‹ˆí„°ë§ from pysnmp.hlapi import * import time import matplotlib.pyplot as plt class NetworkMonitor: def __init__(self, host, community='public'): self.host = host self.community = community def get_interface_stats(self, interface_index=2): """ì¸í„°í˜ì´ìŠ¤ í†µê³„ ìˆ˜ì§‘""" oids = { 'ifInOctets': f'1.3.6.1.2.1.2.2.1.10.{interface_index}', 'ifOutOctets': f'1.3.6.1.2.1.2.2.1.16.{interface_index}', 'ifSpeed': f'1.3.6.1.2.1.2.2.1.5.{interface_index}', 'ifOperStatus': f'1.3.6.1.2.1.2.2.1.8.{interface_index}' } results = {} for name, oid in oids.items(): for (errorIndication, errorStatus, errorIndex, varBinds) in nextCmd( SnmpEngine(), CommunityData(self.community), UdpTransportTarget((self.host, 161)), ContextData(), ObjectType(ObjectIdentity(oid)), lexicographicMode=False): if errorIndication: print(errorIndication) break elif errorStatus: print('%s at %s' % (errorStatus.prettyPrint(), errorIndex and varBinds[int(errorIndex) - 1][0] or '?')) break else: for varBind in varBinds: results[name] = int(varBind[1]) break return results def calculate_bandwidth_utilization(self, interval=5, samples=60): """ëŒ€ì—­í­ ì‚¬ìš©ë¥  ê³„ì‚°""" prev_stats = self.get_interface_stats() time.sleep(interval) utilizations = [] timestamps = [] for i in range(samples): current_stats = self.get_interface_stats() # ë°”ì´íŠ¸ ì¦ê°€ëŸ‰ ê³„ì‚° in_bytes = current_stats['ifInOctets'] - prev_stats['ifInOctets'] out_bytes = current_stats['ifOutOctets'] - prev_stats['ifOutOctets'] # ë¹„íŠ¸ë¡œ ë³€í™˜í•˜ê³  ì´ˆë‹¹ ê³„ì‚° in_bps = (in_bytes * 8) / interval out_bps = (out_bytes * 8) / interval # ì‚¬ìš©ë¥  ê³„ì‚° (%) interface_speed = current_stats['ifSpeed'] in_utilization = (in_bps / interface_speed) * 100 out_utilization = (out_bps / interface_speed) * 100 utilizations.append({ 'timestamp': time.time(), 'in_utilization': in_utilization, 'out_utilization': out_utilization, 'in_bps': in_bps, 'out_bps': out_bps }) print(f"ì‹œê°„: {time.strftime('%H:%M:%S')}, " f"In: {in_utilization:.2f}% ({in_bps/1000000:.2f}Mbps), " f"Out: {out_utilization:.2f}% ({out_bps/1000000:.2f}Mbps)") prev_stats = current_stats time.sleep(interval) return utilizations # ì‚¬ìš© ì˜ˆì‹œ if __name__ == "__main__": monitor = NetworkMonitor('192.168.1.1') data = monitor.calculate_bandwidth_utilization() # ê·¸ë˜í”„ ìƒì„± timestamps = [d['timestamp'] for d in data] in_util = [d['in_utilization'] for d in data] out_util = [d['out_utilization'] for d in data] plt.figure(figsize=(12, 6)) plt.plot(timestamps, in_util, label='Inbound', color='blue') plt.plot(timestamps, out_util, label='Outbound', color='red') plt.xlabel('Time') plt.ylabel('Bandwidth Utilization (%)') plt.title('Network Interface Utilization') plt.legend() plt.grid(True) plt.show() ğŸš¨ ë„¤íŠ¸ì›Œí¬ ì¥ì•  ëŒ€ì‘ í”„ë¡œì„¸ìŠ¤ ìë™í™”ëœ ì¥ì•  ëŒ€ì‘ ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # ë„¤íŠ¸ì›Œí¬ ì¥ì•  ìë™ ì§„ë‹¨ ë° ëŒ€ì‘ ìŠ¤í¬ë¦½íŠ¸ LOG_FILE="/var/log/network_troubleshoot.log" ALERT_THRESHOLD=5 # 5% íŒ¨í‚· ì†ì‹¤ ì„ê³„ê°’ log_message() { echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" &gt;&gt; $LOG_FILE echo "$1" } # 1ë‹¨ê³„: ê¸°ë³¸ ì—°ê²°ì„± í™•ì¸ check_connectivity() { log_message "=== 1ë‹¨ê³„: ê¸°ë³¸ ì—°ê²°ì„± í™•ì¸ ===" # ê²Œì´íŠ¸ì›¨ì´ í•‘ í…ŒìŠ¤íŠ¸ gateway=$(ip route | grep default | awk '{print $3}' | head -1) log_message "ê¸°ë³¸ ê²Œì´íŠ¸ì›¨ì´: $gateway" packet_loss=$(ping -c 5 $gateway | grep "packet loss" | awk '{print $6}' | sed 's/%//') if (( $(echo "$packet_loss &gt; $ALERT_THRESHOLD" | bc -l) )); then log_message "âŒ ê²Œì´íŠ¸ì›¨ì´ ì—°ê²° ë¬¸ì œ ê°ì§€: ${packet_loss}% íŒ¨í‚· ì†ì‹¤" return 1 else log_message "âœ… ê²Œì´íŠ¸ì›¨ì´ ì—°ê²° ì •ìƒ: ${packet_loss}% íŒ¨í‚· ì†ì‹¤" return 0 fi } # 2ë‹¨ê³„: DNS í•´ìƒë„ í™•ì¸ check_dns() { log_message "=== 2ë‹¨ê³„: DNS í•´ìƒë„ í™•ì¸ ===" dns_servers=("8.8.8.8" "1.1.1.1" "168.126.63.1") test_domains=("google.com" "naver.com" "github.com") for server in "${dns_servers[@]}"; do for domain in "${test_domains[@]}"; do response_time=$(dig @$server $domain +short +time=3 2&gt;&amp;1) if [ $? -eq 0 ] &amp;&amp; [ -n "$response_time" ]; then log_message "âœ… DNS ì„œë²„ $server: $domain í•´ìƒë„ ì„±ê³µ" else log_message "âŒ DNS ì„œë²„ $server: $domain í•´ìƒë„ ì‹¤íŒ¨" fi done done } # 3ë‹¨ê³„: ì¸í„°í˜ì´ìŠ¤ ìƒíƒœ í™•ì¸ check_interfaces() { log_message "=== 3ë‹¨ê³„: ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ í™•ì¸ ===" ip link show | grep -E "^[0-9]+:" | while read line; do interface=$(echo $line | cut -d: -f2 | sed 's/ //') status=$(echo $line | grep -o "state [A-Z]*" | cut -d' ' -f2) if [ "$status" = "UP" ]; then log_message "âœ… ì¸í„°í˜ì´ìŠ¤ $interface: $status" else log_message "âŒ ì¸í„°í˜ì´ìŠ¤ $interface: $status" # ì¸í„°í˜ì´ìŠ¤ ì¬ì‹œì‘ ì‹œë„ log_message "ì¸í„°í˜ì´ìŠ¤ $interface ì¬ì‹œì‘ ì‹œë„ì¤‘..." sudo ip link set $interface down sleep 2 sudo ip link set $interface up sleep 5 # ì¬í™•ì¸ new_status=$(ip link show $interface | grep -o "state [A-Z]*" | cut -d' ' -f2) log_message "ì¬ì‹œì‘ í›„ ìƒíƒœ: $new_status" fi done } # 4ë‹¨ê³„: ë¼ìš°íŒ… í…Œì´ë¸” í™•ì¸ check_routing() { log_message "=== 4ë‹¨ê³„: ë¼ìš°íŒ… í…Œì´ë¸” í™•ì¸ ===" # ê¸°ë³¸ ê²Œì´íŠ¸ì›¨ì´ í™•ì¸ default_routes=$(ip route | grep default | wc -l) if [ $default_routes -eq 0 ]; then log_message "âŒ ê¸°ë³¸ ê²Œì´íŠ¸ì›¨ì´ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ" # DHCP ê°±ì‹  ì‹œë„ log_message "DHCP ê°±ì‹  ì‹œë„ì¤‘..." sudo dhclient -r sudo dhclient elif [ $default_routes -gt 1 ]; then log_message "âš ï¸ ì—¬ëŸ¬ ê°œì˜ ê¸°ë³¸ ê²Œì´íŠ¸ì›¨ì´ ê°ì§€" ip route | grep default else log_message "âœ… ê¸°ë³¸ ê²Œì´íŠ¸ì›¨ì´ ì •ìƒ" fi # ë¼ìš°íŒ… í…Œì´ë¸” ì¶œë ¥ log_message "í˜„ì¬ ë¼ìš°íŒ… í…Œì´ë¸”:" ip route &gt;&gt; $LOG_FILE } # 5ë‹¨ê³„: í¬íŠ¸ ìŠ¤ìº” (ì„œë¹„ìŠ¤ ê°€ìš©ì„± í™•ì¸) check_services() { log_message "=== 5ë‹¨ê³„: í•µì‹¬ ì„œë¹„ìŠ¤ í™•ì¸ ===" services=( "8.8.8.8:53:DNS" "google.com:80:HTTP" "google.com:443:HTTPS" "github.com:22:SSH" ) for service in "${services[@]}"; do IFS=':' read -r host port name &lt;&lt;&lt; "$service" if timeout 5 bash -c "echo &gt;/dev/tcp/$host/$port" 2&gt;/dev/null; then log_message "âœ… $name ($host:$port): ì ‘ê·¼ ê°€ëŠ¥" else log_message "âŒ $name ($host:$port): ì ‘ê·¼ ë¶ˆê°€" fi done } # 6ë‹¨ê³„: ìë™ ë³µêµ¬ ì‹œë„ auto_recovery() { log_message "=== 6ë‹¨ê³„: ìë™ ë³µêµ¬ ì‹œë„ ===" # ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬ì ì¬ì‹œì‘ if systemctl is-active NetworkManager &gt;/dev/null 2&gt;&amp;1; then log_message "NetworkManager ì¬ì‹œì‘ ì¤‘..." sudo systemctl restart NetworkManager sleep 10 fi # ë°©í™”ë²½ ê·œì¹™ ì´ˆê¸°í™” (ì„ì‹œ) log_message "ë°©í™”ë²½ ê·œì¹™ ì„ì‹œ í—ˆìš©..." sudo iptables -P INPUT ACCEPT sudo iptables -P FORWARD ACCEPT sudo iptables -P OUTPUT ACCEPT # DNS ìºì‹œ í”ŒëŸ¬ì‹œ log_message "DNS ìºì‹œ í”ŒëŸ¬ì‹œ..." sudo systemctl restart systemd-resolved log_message "ìë™ ë³µêµ¬ ì™„ë£Œ. 5ë¶„ í›„ ì¬í…ŒìŠ¤íŠ¸ ì˜ˆì •..." } # ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜ main() { log_message "==================== ë„¤íŠ¸ì›Œí¬ ì§„ë‹¨ ì‹œì‘ ====================" failure_count=0 check_connectivity || ((failure_count++)) check_dns || ((failure_count++)) check_interfaces || ((failure_count++)) check_routing || ((failure_count++)) check_services || ((failure_count++)) if [ $failure_count -gt 2 ]; then log_message "âš ï¸ ì‹¬ê°í•œ ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ ê°ì§€ ($failure_count ê°œ ì‹¤íŒ¨)" auto_recovery # 5ë¶„ í›„ ì¬í…ŒìŠ¤íŠ¸ sleep 300 log_message "==================== ë³µêµ¬ í›„ ì¬ì§„ë‹¨ ====================" main else log_message "âœ… ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ì •ìƒ (ì‹¤íŒ¨: $failure_count ê°œ)" fi log_message "==================== ì§„ë‹¨ ì™„ë£Œ ====================" } # ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ main ìµœì‹  ë³´ì•ˆ ìœ„í˜‘ê³¼ ëŒ€ì‘ ğŸ¯ AI/ML ê¸°ë°˜ ìœ„í˜‘ íƒì§€ import pandas as pd import numpy as np from sklearn.ensemble import IsolationForest from sklearn.preprocessing import StandardScaler import matplotlib.pyplot as plt class NetworkAnomalyDetector: def __init__(self): self.model = IsolationForest(contamination=0.1, random_state=42) self.scaler = StandardScaler() def prepare_features(self, network_data): """ë„¤íŠ¸ì›Œí¬ ë°ì´í„°ì—ì„œ í”¼ì²˜ ì¶”ì¶œ""" features = pd.DataFrame() # ì‹œê°„ëŒ€ë³„ íŠ¸ë˜í”½ íŒ¨í„´ features['hour'] = pd.to_datetime(network_data['timestamp']).dt.hour features['day_of_week'] = pd.to_datetime(network_data['timestamp']).dt.dayofweek # íŠ¸ë˜í”½ ë³¼ë¥¨ features['bytes_per_second'] = network_data['bytes'] / network_data['duration'] features['packets_per_second'] = network_data['packets'] / network_data['duration'] # ì—°ê²° íŒ¨í„´ features['unique_src_ports'] = network_data.groupby('src_ip')['src_port'].nunique() features['unique_dst_ports'] = network_data.groupby('src_ip')['dst_port'].nunique() features['connection_count'] = network_data.groupby('src_ip').size() # í”„ë¡œí† ì½œ ë¶„í¬ protocol_counts = pd.get_dummies(network_data['protocol']) features = pd.concat([features.reset_index(drop=True), protocol_counts.reset_index(drop=True)], axis=1) return features.fillna(0) def train(self, training_data): """ì •ìƒ íŠ¸ë˜í”½ìœ¼ë¡œ ëª¨ë¸ í•™ìŠµ""" features = self.prepare_features(training_data) scaled_features = self.scaler.fit_transform(features) self.model.fit(scaled_features) def detect_anomalies(self, test_data): """ì´ìƒ íŠ¸ë˜í”½ íƒì§€""" features = self.prepare_features(test_data) scaled_features = self.scaler.transform(features) # ì´ìƒ ì ìˆ˜ ê³„ì‚° (-1: ì´ìƒ, 1: ì •ìƒ) predictions = self.model.predict(scaled_features) anomaly_scores = self.model.score_samples(scaled_features) # ê²°ê³¼ ë°ì´í„°í”„ë ˆì„ ìƒì„± results = test_data.copy() results['is_anomaly'] = predictions == -1 results['anomaly_score'] = anomaly_scores return results def visualize_anomalies(self, results): """ì´ìƒ íƒì§€ ê²°ê³¼ ì‹œê°í™”""" fig, axes = plt.subplots(2, 2, figsize=(15, 10)) # ì‹œê°„ë³„ ì´ìƒ íŠ¸ë˜í”½ hourly_anomalies = results.groupby( pd.to_datetime(results['timestamp']).dt.hour )['is_anomaly'].sum() axes[0,0].bar(hourly_anomalies.index, hourly_anomalies.values) axes[0,0].set_title('ì‹œê°„ëŒ€ë³„ ì´ìƒ íŠ¸ë˜í”½') axes[0,0].set_xlabel('ì‹œê°„') axes[0,0].set_ylabel('ì´ìƒ íŠ¸ë˜í”½ ìˆ˜') # IPë³„ ì´ìƒ ì ìˆ˜ ë¶„í¬ ip_scores = results.groupby('src_ip')['anomaly_score'].mean().sort_values() axes[0,1].barh(range(len(ip_scores.tail(10))), ip_scores.tail(10).values) axes[0,1].set_yticks(range(len(ip_scores.tail(10)))) axes[0,1].set_yticklabels(ip_scores.tail(10).index) axes[0,1].set_title('ìƒìœ„ 10ê°œ ì˜ì‹¬ IP') # í¬íŠ¸ ìŠ¤ìº” íŒ¨í„´ port_scan_ips = results[results['unique_dst_ports'] &gt; 100]['src_ip'].value_counts() if len(port_scan_ips) &gt; 0: axes[1,0].bar(range(len(port_scan_ips.head(10))), port_scan_ips.head(10).values) axes[1,0].set_xticks(range(len(port_scan_ips.head(10)))) axes[1,0].set_xticklabels(port_scan_ips.head(10).index, rotation=45) axes[1,0].set_title('í¬íŠ¸ ìŠ¤ìº” ì˜ì‹¬ IP') # ë°ì´í„° ì „ì†¡ëŸ‰ ë¶„í¬ axes[1,1].scatter(results['bytes'], results['anomaly_score'], c=results['is_anomaly'], alpha=0.6) axes[1,1].set_xlabel('ì „ì†¡ ë°”ì´íŠ¸') axes[1,1].set_ylabel('ì´ìƒ ì ìˆ˜') axes[1,1].set_title('ë°ì´í„° ì „ì†¡ëŸ‰ vs ì´ìƒ ì ìˆ˜') plt.tight_layout() plt.show() # ì‚¬ìš© ì˜ˆì‹œ detector = NetworkAnomalyDetector() # ëª¨ì˜ ë„¤íŠ¸ì›Œí¬ ë°ì´í„° ìƒì„± training_data = pd.DataFrame({ 'timestamp': pd.date_range('2024-03-01', periods=10000, freq='1min'), 'src_ip': np.random.choice(['192.168.1.100', '192.168.1.101', '192.168.1.102'], 10000), 'dst_ip': np.random.choice(['8.8.8.8', '1.1.1.1', '208.67.222.222'], 10000), 'src_port': np.random.randint(1024, 65535, 10000), 'dst_port': np.random.choice([80, 443, 53, 22], 10000), 'protocol': np.random.choice(['TCP', 'UDP', 'ICMP'], 10000), 'bytes': np.random.lognormal(8, 2, 10000), 'packets': np.random.poisson(50, 10000), 'duration': np.random.exponential(30, 10000) }) detector.train(training_data) # í…ŒìŠ¤íŠ¸ ë°ì´í„°ì— ì¼ë¶€ ì´ìƒ íŠ¸ë˜í”½ í¬í•¨ test_data = training_data.sample(1000).copy() # í¬íŠ¸ ìŠ¤ìº” ì‹œë®¬ë ˆì´ì…˜ test_data.loc[0:50, 'dst_port'] = range(1, 51) test_data.loc[0:50, 'src_ip'] = '10.0.0.100' # ì™¸ë¶€ IP results = detector.detect_anomalies(test_data) detector.visualize_anomalies(results) ë§ˆë¬´ë¦¬ ì´ ì‹œë¦¬ì¦ˆë¥¼ í†µí•´ ë„¤íŠ¸ì›Œí‚¹ì˜ ëª¨ë“  ì¸¡ë©´ì„ ë‹¤ë¤˜ìŠµë‹ˆë‹¤: Part 1: OSI 7ê³„ì¸µê³¼ TCP/IP í”„ë¡œí† ì½œ ê¸°ì´ˆ Part 2: IP ì£¼ì†Œ ì²´ê³„ì™€ ì„œë¸Œë„¤íŒ… Part 3: ë¼ìš°íŒ…ê³¼ ìŠ¤ìœ„ì¹­ ê³ ê¸‰ ê¸°ìˆ  Part 4: ë¬´ì„  ë„¤íŠ¸ì›Œí‚¹ê³¼ ìµœì‹  ê¸°ìˆ  ë™í–¥ Part 5: ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆê³¼ ê³ ê¸‰ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ì‹¤ë¬´ì—ì„œ ì´ ì§€ì‹ë“¤ì„ ì ê·¹ í™œìš©í•˜ì—¬ ì•ˆì „í•˜ê³  íš¨ìœ¨ì ì¸ ë„¤íŠ¸ì›Œí¬ ì¸í”„ë¼ë¥¼ êµ¬ì¶•í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤! ğŸŒğŸ”’ ì¶”ì²œ í•™ìŠµ ìë£Œ ì„œì : â€œComputer Networking: A Top-Down Approachâ€ - Kurose &amp; Ross ì‹¤ìŠµ: Packet Tracer, GNS3, EVE-NG ì¸ì¦: CCNA, CCNP, CCIE (Cisco), JNCIA, JNCIP (Juniper) ì˜¤í”ˆì†ŒìŠ¤: Wireshark, pfSense, OpenWrt, Suricata ë„¤íŠ¸ì›Œí¬ ë§ˆìŠ¤í„°ì˜ ê¸¸, í•¨ê»˜ ê±¸ì–´ê°€ìš”! ğŸš€]]></summary></entry><entry><title type="html">ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ 3í¸ - SELinux/AppArmorì™€ ì‹œìŠ¤í…œ í•˜ë“œë‹ | Linux Security Guide Part 3 - SELinux/AppArmor &amp;amp; System Hardening</title><link href="https://leeyonghe.github.io/infra-blog/blog/2025/02/19/linux-security-guide-part3.html" rel="alternate" type="text/html" title="ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ 3í¸ - SELinux/AppArmorì™€ ì‹œìŠ¤í…œ í•˜ë“œë‹ | Linux Security Guide Part 3 - SELinux/AppArmor &amp;amp; System Hardening" /><published>2025-02-19T00:00:00+00:00</published><updated>2025-02-19T00:00:00+00:00</updated><id>https://leeyonghe.github.io/infra-blog/blog/2025/02/19/linux-security-guide-part3</id><content type="html" xml:base="https://leeyonghe.github.io/infra-blog/blog/2025/02/19/linux-security-guide-part3.html"><![CDATA[<p>ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œì˜ í•µì‹¬ ë³´ì•ˆ ë ˆì´ì–´ì¸ SELinux/AppArmorì™€ ì‹œìŠ¤í…œ í•˜ë“œë‹ ê¸°ë²•ì„ ì™„ì „íˆ ë§ˆìŠ¤í„°í•´ë³´ê² ìŠµë‹ˆë‹¤. ê°•ì œ ì ‘ê·¼ ì œì–´ë¶€í„° ì»¤ë„ ë³´ì•ˆ ë§¤ê°œë³€ìˆ˜ê¹Œì§€ ìµœê³  ìˆ˜ì¤€ì˜ ì‹œìŠ¤í…œ ë³´ì•ˆì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ë‹¤ë£¹ë‹ˆë‹¤.</p>

<h2 id="selinux-ì™„ì „-ë§ˆìŠ¤í„°--selinux-complete-mastery">SELinux ì™„ì „ ë§ˆìŠ¤í„° | SELinux Complete Mastery</h2>

<h3 id="-selinux-ê¸°ì´ˆë¶€í„°-ê³ ê¸‰ê¹Œì§€">ğŸ” SELinux ê¸°ì´ˆë¶€í„° ê³ ê¸‰ê¹Œì§€</h3>

<h4 id="selinux-ê°œë…-ë°-ì´ˆê¸°-ì„¤ì •">SELinux ê°œë… ë° ì´ˆê¸° ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># SELinux ìƒíƒœ ë° ì •ë³´ í™•ì¸</span>
sestatus                    <span class="c"># ì „ì²´ ìƒíƒœ í™•ì¸</span>
getenforce                  <span class="c"># í˜„ì¬ ëª¨ë“œ í™•ì¸</span>
seinfo                      <span class="c"># ì •ì±… í†µê³„</span>
semanage <span class="nt">-l</span>                 <span class="c"># ê´€ë¦¬ ê°€ëŠ¥í•œ ê°ì²´ ëª©ë¡</span>

<span class="c"># SELinux ëª¨ë“œ ì„¤ì •</span>
<span class="c"># /etc/selinux/config</span>
<span class="nv">SELINUX</span><span class="o">=</span>enforcing           <span class="c"># enforcing, permissive, disabled</span>
<span class="nv">SELINUXTYPE</span><span class="o">=</span>targeted        <span class="c"># targeted, minimum, mls</span>

<span class="c"># ì„ì‹œ ëª¨ë“œ ë³€ê²½ (ì¬ë¶€íŒ… ì‹œ ì›ë³µ)</span>
setenforce 1                <span class="c"># enforcing ëª¨ë“œ</span>
setenforce 0                <span class="c"># permissive ëª¨ë“œ</span>

<span class="c"># SELinux ë¼ë²¨ë§ ì‹œìŠ¤í…œ ì´í•´</span>
<span class="c"># ëª¨ë“  ê°ì²´ëŠ” security contextë¥¼ ê°€ì§: user:role:type:level</span>
<span class="nb">ls</span> <span class="nt">-Z</span> /var/www/html/        <span class="c"># íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ í™•ì¸</span>
ps auxZ                     <span class="c"># í”„ë¡œì„¸ìŠ¤ ì»¨í…ìŠ¤íŠ¸ í™•ì¸</span>
<span class="nb">id</span> <span class="nt">-Z</span>                       <span class="c"># í˜„ì¬ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸</span>

<span class="c"># ì»¨í…ìŠ¤íŠ¸ êµ¬ì„± ìš”ì†Œ</span>
<span class="c"># user: SELinux ì‚¬ìš©ì (unconfined_u, system_u, user_u ë“±)</span>
<span class="c"># role: ì—­í•  (unconfined_r, system_r, object_r ë“±)  </span>
<span class="c"># type: íƒ€ì…/ë„ë©”ì¸ (httpd_t, httpd_exec_t, user_home_t ë“±)</span>
<span class="c"># level: MLS/MCS ë ˆë²¨ (s0, s0:c0,c1 ë“±)</span>
</code></pre></div></div>

<h4 id="íŒŒì¼-ì»¨í…ìŠ¤íŠ¸-ê´€ë¦¬">íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ í™•ì¸ ë° ë³µì›</span>
<span class="nb">ls</span> <span class="nt">-lZ</span> /var/www/html/
restorecon <span class="nt">-Rv</span> /var/www/html/      <span class="c"># ê¸°ë³¸ ì»¨í…ìŠ¤íŠ¸ë¡œ ë³µì›</span>
restorecon <span class="nt">-RvF</span> /var/www/html/     <span class="c"># ê°•ì œ ë³µì›</span>

<span class="c"># íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ ìˆ˜ë™ ì„¤ì •</span>
<span class="nb">chcon</span> <span class="nt">-t</span> httpd_exec_t /usr/local/apache2/bin/httpd
<span class="nb">chcon</span> <span class="nt">-u</span> system_u /var/www/html/index.html
<span class="nb">chcon</span> <span class="nt">--reference</span><span class="o">=</span>/var/www/html/index.html /var/www/html/newfile.html

<span class="c"># ì˜êµ¬ì ì¸ ì»¨í…ìŠ¤íŠ¸ ì„¤ì • (ì •ì±…ì— ì¶”ê°€)</span>
semanage fcontext <span class="nt">-a</span> <span class="nt">-t</span> httpd_exec_t <span class="s2">"/usr/local/apache2/bin/httpd"</span>
semanage fcontext <span class="nt">-a</span> <span class="nt">-t</span> httpd_config_t <span class="s2">"/etc/myapp/.*</span><span class="se">\.</span><span class="s2">conf"</span>
semanage fcontext <span class="nt">-a</span> <span class="nt">-t</span> user_home_t <span class="s2">"/home/[^/]+/mydata(/.*)?"</span>

<span class="c"># ì»¨í…ìŠ¤íŠ¸ ì •ì±… í™•ì¸</span>
semanage fcontext <span class="nt">-l</span> | <span class="nb">grep </span>httpd
matchpathcon /var/www/html/index.html    <span class="c"># ì˜ˆìƒ ì»¨í…ìŠ¤íŠ¸ í™•ì¸</span>

<span class="c"># ì»¨í…ìŠ¤íŠ¸ ë³€ê²½ ë‚´ì—­ ì¶”ì </span>
ausearch <span class="nt">-m</span> AVC <span class="nt">-ts</span> today              <span class="c"># AVC ê±°ë¶€ ë¡œê·¸</span>
sealert <span class="nt">-a</span> /var/log/audit/audit.log    <span class="c"># ì •ì±… ì œì•ˆ</span>

<span class="c"># ê³ ê¸‰ ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/selinux-context-manager.sh</span>

<span class="nv">ACTION</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">TARGET</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">CONTEXT</span><span class="o">=</span><span class="nv">$3</span>

<span class="k">case</span> <span class="nv">$ACTION</span> <span class="k">in</span>
    <span class="s2">"scan"</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"=== SELinux Context Scan ==="</span>
        find <span class="s2">"</span><span class="nv">$TARGET</span><span class="s2">"</span> <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nb">ls</span> <span class="nt">-lZ</span> | <span class="se">\</span>
        <span class="nb">awk</span> <span class="s1">'{print $4, $9}'</span> | <span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="nb">sort</span> <span class="nt">-nr</span>
        <span class="p">;;</span>
        
    <span class="s2">"restore"</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Restoring contexts for </span><span class="nv">$TARGET</span><span class="s2">..."</span>
        restorecon <span class="nt">-RvF</span> <span class="s2">"</span><span class="nv">$TARGET</span><span class="s2">"</span>
        <span class="p">;;</span>
        
    <span class="s2">"set-bulk"</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Setting bulk context </span><span class="nv">$CONTEXT</span><span class="s2"> for </span><span class="nv">$TARGET</span><span class="s2">..."</span>
        find <span class="s2">"</span><span class="nv">$TARGET</span><span class="s2">"</span> <span class="nt">-type</span> f <span class="nt">-exec</span> <span class="nb">chcon</span> <span class="nt">-t</span> <span class="s2">"</span><span class="nv">$CONTEXT</span><span class="s2">"</span> <span class="o">{}</span> <span class="se">\;</span>
        <span class="p">;;</span>
        
    <span class="s2">"analyze"</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"=== Context Analysis for </span><span class="nv">$TARGET</span><span class="s2"> ==="</span>
        <span class="c"># ë¹„ì •ìƒì ì¸ ì»¨í…ìŠ¤íŠ¸ ì°¾ê¸°</span>
        find <span class="s2">"</span><span class="nv">$TARGET</span><span class="s2">"</span> <span class="nt">-type</span> f <span class="nt">-exec</span> <span class="nb">ls</span> <span class="nt">-lZ</span> <span class="o">{}</span> <span class="se">\;</span> | <span class="se">\</span>
        <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"system_u:object_r"</span> | <span class="se">\</span>
        <span class="nb">awk</span> <span class="s1">'{print "Unusual context:", $4, $9}'</span>
        <span class="p">;;</span>
        
    <span class="k">*</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> {scan|restore|set-bulk|analyze} &lt;path&gt; [context]"</span>
        <span class="nb">exit </span>1
        <span class="p">;;</span>
<span class="k">esac</span>
</code></pre></div></div>

<h4 id="selinux-ë¶ˆë¦°-ê°’-ê´€ë¦¬">SELinux ë¶ˆë¦° ê°’ ê´€ë¦¬</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë¶ˆë¦° ê°’ í™•ì¸</span>
getsebool <span class="nt">-a</span>                          <span class="c"># ëª¨ë“  ë¶ˆë¦° ê°’</span>
getsebool <span class="nt">-a</span> | <span class="nb">grep </span>httpd            <span class="c"># httpd ê´€ë ¨ ë¶ˆë¦°</span>
getsebool httpd_can_network_connect   <span class="c"># íŠ¹ì • ë¶ˆë¦°</span>

<span class="c"># ë¶ˆë¦° ê°’ ì„¤ì •</span>
setsebool httpd_can_network_connect on           <span class="c"># ì„ì‹œ ì„¤ì •</span>
setsebool <span class="nt">-P</span> httpd_can_network_connect on        <span class="c"># ì˜êµ¬ ì„¤ì •</span>

<span class="c"># ì£¼ìš” ì›¹ ì„œë²„ ë¶ˆë¦° ê°’ë“¤</span>
setsebool <span class="nt">-P</span> httpd_can_network_connect on        <span class="c"># ë„¤íŠ¸ì›Œí¬ ì—°ê²° í—ˆìš©</span>
setsebool <span class="nt">-P</span> httpd_can_sendmail on               <span class="c"># ë©”ì¼ ë°œì†¡ í—ˆìš©</span>
setsebool <span class="nt">-P</span> httpd_enable_cgi on                 <span class="c"># CGI ì‹¤í–‰ í—ˆìš©</span>
setsebool <span class="nt">-P</span> httpd_read_user_content on          <span class="c"># ì‚¬ìš©ì ì½˜í…ì¸  ì½ê¸°</span>
setsebool <span class="nt">-P</span> httpd_enable_homedirs on            <span class="c"># í™ˆ ë””ë ‰í† ë¦¬ ì ‘ê·¼</span>
setsebool <span class="nt">-P</span> httpd_execmem on                    <span class="c"># ë©”ëª¨ë¦¬ ì‹¤í–‰ í—ˆìš©</span>
setsebool <span class="nt">-P</span> httpd_use_nfs on                    <span class="c"># NFS ì‚¬ìš© í—ˆìš©</span>

<span class="c"># ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ ë¶ˆë¦°</span>
setsebool <span class="nt">-P</span> allow_user_mysql_connect on         <span class="c"># MySQL ì—°ê²° í—ˆìš©</span>
setsebool <span class="nt">-P</span> mysql_connect_any on                <span class="c"># MySQL ì„ì˜ ì—°ê²°</span>

<span class="c"># SSH ê´€ë ¨ ë¶ˆë¦°</span>
setsebool <span class="nt">-P</span> ssh_chroot_rw_homedirs on           <span class="c"># chrootì—ì„œ í™ˆë””ë ‰í† ë¦¬ ì“°ê¸°</span>

<span class="c"># ë¶ˆë¦° ê°’ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/selinux-bool-monitor.sh</span>

<span class="c"># í˜„ì¬ ë¶ˆë¦° ì„¤ì • ë°±ì—…</span>
getsebool <span class="nt">-a</span> <span class="o">&gt;</span> /var/log/selinux-bools-<span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span>.log

<span class="c"># ë³€ê²½ëœ ë¶ˆë¦° ê°’ ê°ì§€</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> /var/log/selinux-bools-last.log <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"=== Boolean Changes Detected ==="</span>
    diff /var/log/selinux-bools-last.log /var/log/selinux-bools-<span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span>.log
<span class="k">fi

</span><span class="nb">cp</span> /var/log/selinux-bools-<span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span>.log /var/log/selinux-bools-last.log

<span class="c"># ë³´ì•ˆì— ë¯¼ê°í•œ ë¶ˆë¦° ê°’ë“¤ ì²´í¬</span>
<span class="nv">CRITICAL_BOOLS</span><span class="o">=(</span>
    <span class="s2">"httpd_execmem"</span>
    <span class="s2">"httpd_enable_cgi"</span>
    <span class="s2">"allow_execheap"</span>
    <span class="s2">"allow_execstack"</span>
    <span class="s2">"selinuxuser_execstack"</span>
<span class="o">)</span>

<span class="nb">echo</span> <span class="s2">"=== Critical Boolean Status ==="</span>
<span class="k">for </span>bool <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">CRITICAL_BOOLS</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
    </span><span class="nv">status</span><span class="o">=</span><span class="si">$(</span>getsebool <span class="s2">"</span><span class="nv">$bool</span><span class="s2">"</span> 2&gt;/dev/null<span class="si">)</span>
    <span class="k">if </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$status</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">" on"</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"WARNING: </span><span class="nv">$bool</span><span class="s2"> is enabled"</span>
    <span class="k">else
        </span><span class="nb">echo</span> <span class="s2">"OK: </span><span class="nv">$bool</span><span class="s2"> is disabled"</span>
    <span class="k">fi
done</span>
</code></pre></div></div>

<h4 id="í¬íŠ¸-ë¼ë²¨-ê´€ë¦¬">í¬íŠ¸ ë¼ë²¨ ê´€ë¦¬</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í¬íŠ¸ ë¼ë²¨ í™•ì¸</span>
semanage port <span class="nt">-l</span>                    <span class="c"># ëª¨ë“  í¬íŠ¸ ë¼ë²¨</span>
semanage port <span class="nt">-l</span> | <span class="nb">grep </span>http        <span class="c"># HTTP ê´€ë ¨ í¬íŠ¸</span>
ss <span class="nt">-tlnZ</span>                           <span class="c"># ë„¤íŠ¸ì›Œí¬ ì„œë¹„ìŠ¤ì™€ ì»¨í…ìŠ¤íŠ¸</span>

<span class="c"># ìƒˆë¡œìš´ í¬íŠ¸ì— ë¼ë²¨ í• ë‹¹</span>
semanage port <span class="nt">-a</span> <span class="nt">-t</span> http_port_t <span class="nt">-p</span> tcp 8080      <span class="c"># HTTP í¬íŠ¸ ì¶”ê°€</span>
semanage port <span class="nt">-a</span> <span class="nt">-t</span> ssh_port_t <span class="nt">-p</span> tcp 2222       <span class="c"># SSH í¬íŠ¸ ì¶”ê°€</span>
semanage port <span class="nt">-a</span> <span class="nt">-t</span> mysqld_port_t <span class="nt">-p</span> tcp 3307    <span class="c"># MySQL í¬íŠ¸ ì¶”ê°€</span>

<span class="c"># í¬íŠ¸ ë¼ë²¨ ìˆ˜ì •</span>
semanage port <span class="nt">-m</span> <span class="nt">-t</span> http_port_t <span class="nt">-p</span> tcp 8080

<span class="c"># í¬íŠ¸ ë¼ë²¨ ì œê±°</span>
semanage port <span class="nt">-d</span> <span class="nt">-t</span> http_port_t <span class="nt">-p</span> tcp 8080

<span class="c"># ì»¤ìŠ¤í…€ í¬íŠ¸ íƒ€ì… ìƒì„± (ê³ ê¸‰)</span>
<span class="c"># myapp.te íŒŒì¼ ìƒì„±</span>
<span class="nb">cat</span> <span class="o">&gt;</span> myapp.te <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
policy_module(myapp, 1.0)

type myapp_port_t;
corenet_port(myapp_port_t)

allow httpd_t myapp_port_t:tcp_socket name_bind;
</span><span class="no">EOF

</span><span class="c"># ì •ì±… ì»´íŒŒì¼ ë° ì„¤ì¹˜</span>
make <span class="nt">-f</span> /usr/share/selinux/devel/Makefile myapp.pp
semodule <span class="nt">-i</span> myapp.pp
semanage port <span class="nt">-a</span> <span class="nt">-t</span> myapp_port_t <span class="nt">-p</span> tcp 9999
</code></pre></div></div>

<h3 id="ï¸-selinux-ì»¤ìŠ¤í…€-ì •ì±…-ì‘ì„±">ğŸ›¡ï¸ SELinux ì»¤ìŠ¤í…€ ì •ì±… ì‘ì„±</h3>

<h4 id="ì •ì±…-ëª¨ë“ˆ-ê°œë°œ">ì •ì±… ëª¨ë“ˆ ê°œë°œ</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì •ì±… ê°œë°œ í™˜ê²½ ì¤€ë¹„</span>
yum <span class="nb">install </span>selinux-policy-devel    <span class="c"># CentOS/RHEL</span>
apt-get <span class="nb">install </span>selinux-policy-dev  <span class="c"># Ubuntu/Debian</span>

<span class="c"># AVC ê±°ë¶€ ë¶„ì„ ë° ì •ì±… ìƒì„±</span>
<span class="c"># 1. ì„œë¹„ìŠ¤ ì‹¤í–‰í•˜ì—¬ AVC ê±°ë¶€ ë¡œê·¸ ìˆ˜ì§‘</span>
systemctl start myapp
<span class="nb">tail</span> <span class="nt">-f</span> /var/log/audit/audit.log | <span class="nb">grep </span>AVC

<span class="c"># 2. audit2allowë¡œ ì •ì±… ì œì•ˆ ìƒì„±</span>
<span class="nb">grep </span>myapp /var/log/audit/audit.log | audit2allow <span class="nt">-m</span> myapp_policy
<span class="nb">grep </span>myapp /var/log/audit/audit.log | audit2allow <span class="nt">-M</span> myapp_policy

<span class="c"># 3. ìˆ˜ë™ìœ¼ë¡œ ì •ì±… ëª¨ë“ˆ ì‘ì„±</span>
<span class="nb">cat</span> <span class="o">&gt;</span> myapp_custom.te <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
policy_module(myapp_custom, 1.0)

########################################
#
# Declarations
#

type myapp_t;
type myapp_exec_t;
init_daemon_domain(myapp_t, myapp_exec_t)

type myapp_config_t;
files_config_file(myapp_config_t)

type myapp_var_lib_t;
files_type(myapp_var_lib_t)

type myapp_log_t;
logging_log_file(myapp_log_t)

type myapp_port_t;
corenet_port(myapp_port_t)

########################################
#
# myapp local policy
#

# ê¸°ë³¸ ë„ë©”ì¸ ê¶Œí•œ
allow myapp_t self:process { fork signal_perms };
allow myapp_t self:fifo_file rw_fifo_file_perms;
allow myapp_t self:unix_stream_socket create_stream_socket_perms;

# ë„¤íŠ¸ì›Œí¬ ê¶Œí•œ
allow myapp_t self:tcp_socket create_stream_socket_perms;
allow myapp_t myapp_port_t:tcp_socket name_bind;
corenet_tcp_sendrecv_generic_if(myapp_t)
corenet_tcp_sendrecv_generic_node(myapp_t)

# íŒŒì¼ ì‹œìŠ¤í…œ ê¶Œí•œ
allow myapp_t myapp_config_t:file read_file_perms;
allow myapp_t myapp_var_lib_t:dir create_dir_perms;
allow myapp_t myapp_var_lib_t:file create_file_perms;
allow myapp_t myapp_log_t:file create_file_perms;

# ì‹œìŠ¤í…œ ì„œë¹„ìŠ¤ ìƒí˜¸ì‘ìš©
can_exec(myapp_t, myapp_exec_t)
files_read_etc_files(myapp_t)
libs_use_ld_so(myapp_t)
libs_use_shared_libs(myapp_t)

# ë¡œê¹…
logging_send_syslog_msg(myapp_t)
</span><span class="no">EOF

</span><span class="c"># 4. íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ ì •ì˜</span>
<span class="nb">cat</span> <span class="o">&gt;</span> myapp_custom.fc <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
/usr/local/bin/myapp        --      gen_context(system_u:object_r:myapp_exec_t,s0)
/etc/myapp(/.*)?                    gen_context(system_u:object_r:myapp_config_t,s0)
/var/lib/myapp(/.*)?                gen_context(system_u:object_r:myapp_var_lib_t,s0)
/var/log/myapp(/.*)?                gen_context(system_u:object_r:myapp_log_t,s0)
</span><span class="no">EOF

</span><span class="c"># 5. ì¸í„°í˜ì´ìŠ¤ íŒŒì¼ (ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œ ì‚¬ìš©í•  ì¸í„°í˜ì´ìŠ¤)</span>
<span class="nb">cat</span> <span class="o">&gt;</span> myapp_custom.if <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
## &lt;summary&gt;MyApp custom policy&lt;/summary&gt;

########################################
## &lt;summary&gt;
##  Execute myapp in the myapp domain.
## &lt;/summary&gt;
## &lt;param name="domain"&gt;
##  &lt;summary&gt;
##  Domain allowed to transition.
##  &lt;/summary&gt;
## &lt;/param&gt;
#
interface(`myapp_domtrans',`
    gen_require(`
        type myapp_t, myapp_exec_t;
    ')

    corecmd_search_bin(</span><span class="nv">$1</span><span class="sh">)
    domtrans_pattern(</span><span class="nv">$1</span><span class="sh">, myapp_exec_t, myapp_t)
')

########################################
## &lt;summary&gt;
##  Read myapp configuration files.
## &lt;/summary&gt;
## &lt;param name="domain"&gt;
##  &lt;summary&gt;
##  Domain allowed access.
##  &lt;/summary&gt;
## &lt;/param&gt;
#
interface(`myapp_read_config',`
    gen_require(`
        type myapp_config_t;
    ')

    files_search_etc(</span><span class="nv">$1</span><span class="sh">)
    read_files_pattern(</span><span class="nv">$1</span><span class="sh">, myapp_config_t, myapp_config_t)
')
</span><span class="no">EOF

</span><span class="c"># 6. ì •ì±… ì»´íŒŒì¼ ë° ì„¤ì¹˜</span>
make <span class="nt">-f</span> /usr/share/selinux/devel/Makefile myapp_custom.pp
semodule <span class="nt">-i</span> myapp_custom.pp

<span class="c"># 7. íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ ì ìš©</span>
semanage fcontext <span class="nt">-a</span> <span class="nt">-f</span> <span class="s2">""</span> <span class="nt">-t</span> myapp_exec_t <span class="s2">"/usr/local/bin/myapp"</span>
semanage fcontext <span class="nt">-a</span> <span class="nt">-f</span> <span class="s2">""</span> <span class="nt">-t</span> myapp_config_t <span class="s2">"/etc/myapp(/.*)?"</span>
restorecon <span class="nt">-Rv</span> /usr/local/bin/myapp /etc/myapp

<span class="c"># 8. í¬íŠ¸ ë¼ë²¨ ì„¤ì •</span>
semanage port <span class="nt">-a</span> <span class="nt">-t</span> myapp_port_t <span class="nt">-p</span> tcp 9090
</code></pre></div></div>

<h4 id="ì •ì±…-ë””ë²„ê¹…-ë°-ìµœì í™”">ì •ì±… ë””ë²„ê¹… ë° ìµœì í™”</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/selinux-debug.sh</span>
<span class="c"># SELinux ì •ì±… ë””ë²„ê¹… ë„êµ¬</span>

<span class="nv">MODE</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">MODULE</span><span class="o">=</span><span class="nv">$2</span>

<span class="k">case</span> <span class="nv">$MODE</span> <span class="k">in</span>
    <span class="s2">"avc-analysis"</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"=== AVC Denial Analysis ==="</span>
        ausearch <span class="nt">-m</span> AVC <span class="nt">-ts</span> today | <span class="nb">grep</span> <span class="s2">"</span><span class="nv">$MODULE</span><span class="s2">"</span> | <span class="se">\</span>
        <span class="k">while </span><span class="nb">read </span>line<span class="p">;</span> <span class="k">do
            </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span> | audit2allow <span class="nt">-R</span>
            <span class="nb">echo</span> <span class="s2">"---"</span>
        <span class="k">done</span>
        <span class="p">;;</span>
        
    <span class="s2">"permissive-test"</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Setting </span><span class="nv">$MODULE</span><span class="s2"> to permissive mode for testing..."</span>
        semanage permissive <span class="nt">-a</span> <span class="k">${</span><span class="nv">MODULE</span><span class="k">}</span>_t
        <span class="nb">echo</span> <span class="s2">"Test your application, then check denials:"</span>
        <span class="nb">echo</span> <span class="s2">"ausearch -m AVC -ts now"</span>
        <span class="nb">echo</span> <span class="s2">"When done, remove permissive mode:"</span>
        <span class="nb">echo</span> <span class="s2">"semanage permissive -d </span><span class="k">${</span><span class="nv">MODULE</span><span class="k">}</span><span class="s2">_t"</span>
        <span class="p">;;</span>
        
    <span class="s2">"policy-stats"</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"=== Policy Statistics ==="</span>
        seinfo <span class="nt">-t</span> | <span class="nb">grep</span> <span class="s2">"</span><span class="nv">$MODULE</span><span class="s2">"</span>
        seinfo <span class="nt">-r</span> | <span class="nb">grep</span> <span class="s2">"</span><span class="nv">$MODULE</span><span class="s2">"</span>
        seinfo <span class="nt">-u</span> | <span class="nb">grep</span> <span class="s2">"</span><span class="nv">$MODULE</span><span class="s2">"</span>
        <span class="p">;;</span>
        
    <span class="s2">"generate-policy"</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Generating policy for </span><span class="nv">$MODULE</span><span class="s2">..."</span>
        ausearch <span class="nt">-m</span> AVC <span class="nt">-ts</span> today | <span class="nb">grep</span> <span class="s2">"</span><span class="nv">$MODULE</span><span class="s2">"</span> | <span class="se">\</span>
        audit2allow <span class="nt">-M</span> <span class="k">${</span><span class="nv">MODULE</span><span class="k">}</span>_additional
        
        <span class="nb">echo</span> <span class="s2">"Generated policy module: </span><span class="k">${</span><span class="nv">MODULE</span><span class="k">}</span><span class="s2">_additional.pp"</span>
        <span class="nb">echo</span> <span class="s2">"Install with: semodule -i </span><span class="k">${</span><span class="nv">MODULE</span><span class="k">}</span><span class="s2">_additional.pp"</span>
        <span class="p">;;</span>
        
    <span class="s2">"module-deps"</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"=== Module Dependencies for </span><span class="nv">$MODULE</span><span class="s2"> ==="</span>
        semodule <span class="nt">-l</span> | <span class="nb">grep</span> <span class="s2">"</span><span class="nv">$MODULE</span><span class="s2">"</span>
        <span class="p">;;</span>
        
    <span class="k">*</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> {avc-analysis|permissive-test|policy-stats|generate-policy|module-deps} &lt;module&gt;"</span>
        <span class="nb">echo</span> <span class="s2">""</span>
        <span class="nb">echo</span> <span class="s2">"Examples:"</span>
        <span class="nb">echo</span> <span class="s2">"  </span><span class="nv">$0</span><span class="s2"> avc-analysis httpd"</span>
        <span class="nb">echo</span> <span class="s2">"  </span><span class="nv">$0</span><span class="s2"> permissive-test myapp"</span>
        <span class="nb">echo</span> <span class="s2">"  </span><span class="nv">$0</span><span class="s2"> generate-policy myapp"</span>
        <span class="nb">exit </span>1
        <span class="p">;;</span>
<span class="k">esac</span>
</code></pre></div></div>

<h2 id="apparmor-ì™„ì „-ë§ˆìŠ¤í„°--apparmor-complete-mastery">AppArmor ì™„ì „ ë§ˆìŠ¤í„° | AppArmor Complete Mastery</h2>

<h3 id="ï¸-apparmor-í”„ë¡œíŒŒì¼-ì‘ì„±-ë°-ê´€ë¦¬">ğŸ›¡ï¸ AppArmor í”„ë¡œíŒŒì¼ ì‘ì„± ë° ê´€ë¦¬</h3>

<h4 id="apparmor-ê¸°ë³¸-ê´€ë¦¬">AppArmor ê¸°ë³¸ ê´€ë¦¬</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># AppArmor ìƒíƒœ í™•ì¸</span>
aa-status                   <span class="c"># ì „ì²´ ìƒíƒœ</span>
aa-enabled                  <span class="c"># í™œì„±í™” ì—¬ë¶€</span>
aa-unconfined               <span class="c"># ì œí•œë˜ì§€ ì•Šì€ í”„ë¡œì„¸ìŠ¤</span>

<span class="c"># í”„ë¡œíŒŒì¼ ëª¨ë“œ ê´€ë¦¬</span>
aa-enforce /etc/apparmor.d/usr.bin.firefox     <span class="c"># enforce ëª¨ë“œ</span>
aa-complain /etc/apparmor.d/usr.bin.firefox    <span class="c"># complain ëª¨ë“œ  </span>
aa-disable /etc/apparmor.d/usr.bin.firefox     <span class="c"># ë¹„í™œì„±í™”</span>

<span class="c"># í”„ë¡œíŒŒì¼ ì¬ë¡œë“œ</span>
apparmor_parser <span class="nt">-r</span> /etc/apparmor.d/usr.bin.firefox
apparmor_parser <span class="nt">-R</span> /etc/apparmor.d/            <span class="c"># ëª¨ë“  í”„ë¡œíŒŒì¼ ì¬ë¡œë“œ</span>

<span class="c"># í”„ë¡œíŒŒì¼ ìƒíƒœ í™•ì¸</span>
aa-status | <span class="nb">grep </span>firefox
</code></pre></div></div>

<h4 id="ê³ ê¸‰-apparmor-í”„ë¡œíŒŒì¼-ì‘ì„±">ê³ ê¸‰ AppArmor í”„ë¡œíŒŒì¼ ì‘ì„±</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ìš© ì»¤ìŠ¤í…€ í”„ë¡œíŒŒì¼</span>
<span class="c"># /etc/apparmor.d/usr.local.bin.webapp</span>
<span class="c">#include &lt;tunables/global&gt;</span>

profile /usr/local/bin/webapp <span class="nv">flags</span><span class="o">=(</span>attach_disconnected,mediate_deleted<span class="o">)</span> <span class="o">{</span>
  <span class="c">#include &lt;abstractions/base&gt;</span>
  <span class="c">#include &lt;abstractions/nameservice&gt;</span>
  <span class="c">#include &lt;abstractions/openssl&gt;</span>
  <span class="c">#include &lt;abstractions/ssl_certs&gt;</span>
  
  <span class="c"># ì‹¤í–‰ ê¶Œí•œ</span>
  /usr/local/bin/webapp mr,
  
  <span class="c"># ë¼ì´ë¸ŒëŸ¬ë¦¬ ì ‘ê·¼</span>
  /lib<span class="o">{</span>,32,64<span class="o">}</span>/<span class="k">**</span> mr,
  /usr/lib<span class="o">{</span>,32,64<span class="o">}</span>/<span class="k">**</span> mr,
  /usr/local/lib/<span class="k">**</span> mr,
  
  <span class="c"># ì„¤ì • íŒŒì¼ (ì½ê¸° ì „ìš©)</span>
  /etc/webapp/ r,
  /etc/webapp/<span class="k">**</span> r,
  owner /etc/webapp/webapp.conf r,
  
  <span class="c"># ì‚¬ìš©ìë³„ ì„¤ì • ë° ë°ì´í„°</span>
  owner @<span class="o">{</span>HOME<span class="o">}</span>/.webapp/ rw,
  owner @<span class="o">{</span>HOME<span class="o">}</span>/.webapp/<span class="k">**</span> rw,
  owner @<span class="o">{</span>HOME<span class="o">}</span>/.webapp/cache/<span class="k">**</span> rwk,
  
  <span class="c"># ì• í”Œë¦¬ì¼€ì´ì…˜ ë°ì´í„° ë””ë ‰í† ë¦¬</span>
  /var/lib/webapp/ r,
  /var/lib/webapp/<span class="k">**</span> rw,
  /var/cache/webapp/ r,
  /var/cache/webapp/<span class="k">**</span> rw,
  
  <span class="c"># ë¡œê·¸ íŒŒì¼</span>
  /var/log/webapp/ r,
  /var/log/webapp/<span class="k">*</span>.log w,
  /var/log/webapp/<span class="k">*</span>.log.[0-9] w,
  
  <span class="c"># ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼</span>
  network inet stream,
  network inet6 stream,
  network inet dgram,
  network inet6 dgram,
  network netlink raw,
  
  <span class="c"># í”„ë¡œì„¸ìŠ¤ ì œì–´</span>
  capability setuid,
  capability setgid,
  capability dac_override,
  capability net_bind_service,
  
  <span class="c"># ì„ì‹œ íŒŒì¼</span>
  /tmp/ r,
  /tmp/webapp.<span class="k">**</span> rw,
  owner /tmp/webapp-@<span class="o">{</span>pid<span class="o">}</span>-<span class="k">*</span> rw,
  /var/tmp/ r,
  /var/tmp/webapp.<span class="k">**</span> rw,
  
  <span class="c"># ì‹œìŠ¤í…œ ì •ë³´ ì ‘ê·¼</span>
  /proc/sys/kernel/random/uuid r,
  /proc/loadavg r,
  /proc/meminfo r,
  /sys/devices/system/cpu/ r,
  /sys/devices/system/cpu/cpu[0-9]<span class="k">*</span>/cpufreq/scaling_cur_freq r,
  
  <span class="c"># ê±°ë¶€í•  ì ‘ê·¼ë“¤ (ëª…ì‹œì  ê±°ë¶€)</span>
  deny /etc/passwd r,
  deny /etc/shadow r,
  deny /etc/gshadow r,
  deny owner /home/<span class="k">*</span>/.ssh/<span class="k">**</span> rw,
  deny /proc/[0-9]<span class="k">*</span>/maps r,
  deny /proc/[0-9]<span class="k">*</span>/mem r,
  deny /proc/kmem r,
  deny /proc/kcore r,
  deny /boot/<span class="k">**</span> r,
  
  <span class="c"># í•˜ìœ„ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰</span>
  /bin/dash ix,
  /bin/bash ix,
  /usr/bin/python3 ix,
  /usr/bin/python3.[0-9] ix,
  /usr/local/bin/webapp-helper Cx -&gt; helper,
  
  <span class="c"># ì¡°ê±´ë¶€ ì‹¤í–‰ ê·œì¹™</span>
  profile helper <span class="o">{</span>
    <span class="c">#include &lt;abstractions/base&gt;</span>
    
    /usr/local/bin/webapp-helper mr,
    /var/lib/webapp/helper-data/<span class="k">**</span> r,
    /tmp/helper-<span class="k">**</span> rw,
    
    <span class="c"># ë¶€ëª¨ë¡œë¶€í„° ìƒì†ë°›ì€ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ë§Œ ì‚¬ìš©</span>
    deny network,
    deny capability,
  <span class="o">}</span>
  
  <span class="c"># ì‹ í˜¸ ì²˜ë¦¬</span>
  signal <span class="o">(</span>send<span class="o">)</span> <span class="nb">set</span><span class="o">=(</span>term,kill,usr1,usr2<span class="o">)</span> <span class="nv">peer</span><span class="o">=</span>/usr/local/bin/webapp,
  signal <span class="o">(</span>receive<span class="o">)</span> <span class="nb">set</span><span class="o">=(</span>term,kill,usr1,usr2<span class="o">)</span>,
  
  <span class="c"># DBus ì ‘ê·¼ (í•„ìš”ì‹œ)</span>
  dbus <span class="o">(</span>send<span class="o">)</span>
       <span class="nv">bus</span><span class="o">=</span>session
       <span class="nv">path</span><span class="o">=</span>/org/freedesktop/Notifications
       <span class="nv">interface</span><span class="o">=</span>org.freedesktop.Notifications
       <span class="nv">member</span><span class="o">=</span>Notify
       <span class="nv">peer</span><span class="o">=(</span><span class="nv">name</span><span class="o">=</span>org.freedesktop.Notifications<span class="o">)</span>,
<span class="o">}</span>

<span class="c"># ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ìš© í”„ë¡œíŒŒì¼</span>
<span class="c"># /etc/apparmor.d/usr.sbin.mysqld-custom</span>
<span class="c">#include &lt;tunables/global&gt;</span>

profile /usr/sbin/mysqld-custom <span class="nv">flags</span><span class="o">=(</span>attach_disconnected,mediate_deleted<span class="o">)</span> <span class="o">{</span>
  <span class="c">#include &lt;abstractions/base&gt;</span>
  <span class="c">#include &lt;abstractions/mysql&gt;</span>
  <span class="c">#include &lt;abstractions/nameservice&gt;</span>
  <span class="c">#include &lt;abstractions/user-tmp&gt;</span>
  
  capability dac_override,
  capability setgid,
  capability setuid,
  capability sys_resource,
  capability net_bind_service,
  
  <span class="c"># MySQL ë°”ì´ë„ˆë¦¬</span>
  /usr/sbin/mysqld mr,
  /usr/sbin/mysqld-debug mr,
  
  <span class="c"># ì„¤ì • íŒŒì¼</span>
  /etc/mysql/ r,
  /etc/mysql/<span class="k">**</span> r,
  /etc/my.cnf r,
  /etc/my.cnf.d/ r,
  /etc/my.cnf.d/<span class="k">*</span>.cnf r,
  
  <span class="c"># ë°ì´í„° ë””ë ‰í† ë¦¬</span>
  /var/lib/mysql/ r,
  /var/lib/mysql/<span class="k">**</span> rwk,
  /var/lib/mysql-files/ r,
  /var/lib/mysql-files/<span class="k">**</span> rw,
  
  <span class="c"># ë¡œê·¸ íŒŒì¼</span>
  /var/log/mysql/ r,
  /var/log/mysql/<span class="k">*</span>.log rw,
  /var/log/mysql.log rw,
  /var/log/mysql/error.log rw,
  
  <span class="c"># ì†Œì¼“ íŒŒì¼</span>
  /var/run/mysqld/ rw,
  /var/run/mysqld/mysqld.sock rw,
  /tmp/mysql.sock rw,
  
  <span class="c"># ë„¤íŠ¸ì›Œí¬</span>
  network tcp,
  
  <span class="c"># í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹ </span>
  /proc/<span class="k">*</span>/status r,
  /proc/sys/vm/overcommit_memory r,
  
  <span class="c"># ì„ì‹œ íŒŒì¼</span>
  /tmp/ r,
  /tmp/mysql-<span class="k">**</span> rw,
  /var/tmp/ r,
  /var/tmp/mysql-<span class="k">**</span> rw,
  
  <span class="c"># ë³´ì•ˆ ì œí•œ</span>
  deny capability sys_ptrace,
  deny @<span class="o">{</span>PROC<span class="o">}</span>/sys/kernel/core_pattern w,
  deny /etc/passwd r,
  deny /etc/shadow r,
<span class="o">}</span>
</code></pre></div></div>

<h4 id="apparmor-í”„ë¡œíŒŒì¼-ìë™-ìƒì„±-ë°-íŠœë‹">AppArmor í”„ë¡œíŒŒì¼ ìë™ ìƒì„± ë° íŠœë‹</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/apparmor-manager.sh</span>
<span class="c"># AppArmor í”„ë¡œíŒŒì¼ ê´€ë¦¬ ë„êµ¬</span>

<span class="nv">ACTION</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">BINARY</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">PROFILE_NAME</span><span class="o">=</span><span class="k">${</span><span class="nv">3</span><span class="k">:-</span><span class="si">$(</span><span class="nb">basename</span> <span class="nv">$BINARY</span><span class="si">)</span><span class="k">}</span>

<span class="k">case</span> <span class="nv">$ACTION</span> <span class="k">in</span>
    <span class="s2">"generate"</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Generating AppArmor profile for </span><span class="nv">$BINARY</span><span class="s2">..."</span>
        
        <span class="c"># 1. ê¸°ë³¸ í”„ë¡œíŒŒì¼ ìƒì„±</span>
        aa-genprof <span class="s2">"</span><span class="nv">$BINARY</span><span class="s2">"</span>
        
        <span class="nb">echo</span> <span class="s2">"Profile generation completed."</span>
        <span class="nb">echo</span> <span class="s2">"Test your application and run: </span><span class="nv">$0</span><span class="s2"> tune </span><span class="nv">$BINARY</span><span class="s2">"</span>
        <span class="p">;;</span>
        
    <span class="s2">"tune"</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Tuning AppArmor profile for </span><span class="nv">$BINARY</span><span class="s2">..."</span>
        
        <span class="c"># ë¡œê·¸í”„ë¡œíŒŒì¼ë§ ì‹¤í–‰</span>
        aa-logprof
        
        <span class="nb">echo</span> <span class="s2">"Profile tuning completed."</span>
        <span class="p">;;</span>
        
    <span class="s2">"analyze"</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"=== AppArmor Profile Analysis for </span><span class="nv">$PROFILE_NAME</span><span class="s2"> ==="</span>
        
        <span class="c"># í”„ë¡œíŒŒì¼ êµ¬ë¬¸ ê²€ì‚¬</span>
        apparmor_parser <span class="nt">-p</span> /etc/apparmor.d/<span class="nv">$PROFILE_NAME</span> 2&gt;&amp;1 | <span class="se">\</span>
        <span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"(ERROR|WARNING)"</span> <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"âœ“ Syntax OK"</span>
        
        <span class="c"># í”„ë¡œíŒŒì¼ í†µê³„</span>
        <span class="nb">echo</span> <span class="s2">""</span>
        <span class="nb">echo</span> <span class="s2">"Profile statistics:"</span>
        <span class="nb">grep</span> <span class="nt">-c</span> <span class="s2">"^[[:space:]]*/"</span> /etc/apparmor.d/<span class="nv">$PROFILE_NAME</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"File rules"</span>
        <span class="nb">grep</span> <span class="nt">-c</span> <span class="s2">"capability"</span> /etc/apparmor.d/<span class="nv">$PROFILE_NAME</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"Capabilities"</span>
        <span class="nb">grep</span> <span class="nt">-c</span> <span class="s2">"network"</span> /etc/apparmor.d/<span class="nv">$PROFILE_NAME</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"Network rules"</span>
        <span class="nb">grep</span> <span class="nt">-c</span> <span class="s2">"deny"</span> /etc/apparmor.d/<span class="nv">$PROFILE_NAME</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"Deny rules"</span>
        
        <span class="c"># ë³´ì•ˆ ê²€ì‚¬</span>
        <span class="nb">echo</span> <span class="s2">""</span>
        <span class="nb">echo</span> <span class="s2">"Security analysis:"</span>
        <span class="k">if </span><span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"capability sys_admin"</span> /etc/apparmor.d/<span class="nv">$PROFILE_NAME</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"âš ï¸  WARNING: sys_admin capability found"</span>
        <span class="k">fi
        
        if </span><span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"/etc/shadow"</span> /etc/apparmor.d/<span class="nv">$PROFILE_NAME</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"âš ï¸  WARNING: Shadow file access found"</span>  
        <span class="k">fi
        
        if </span><span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"network raw"</span> /etc/apparmor.d/<span class="nv">$PROFILE_NAME</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"âš ï¸  WARNING: Raw network access found"</span>
        <span class="k">fi</span>
        <span class="p">;;</span>
        
    <span class="s2">"template"</span><span class="p">)</span>
        <span class="nv">TEMPLATE_TYPE</span><span class="o">=</span><span class="nv">$3</span>
        <span class="nb">echo</span> <span class="s2">"Creating AppArmor profile template for </span><span class="nv">$BINARY</span><span class="s2"> (</span><span class="nv">$TEMPLATE_TYPE</span><span class="s2">)..."</span>
        
        <span class="k">case</span> <span class="nv">$TEMPLATE_TYPE</span> <span class="k">in</span>
            <span class="s2">"webapp"</span><span class="p">)</span>
                <span class="nb">cat</span> <span class="o">&gt;</span> /etc/apparmor.d/<span class="nv">$PROFILE_NAME</span> <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
#include &lt;tunables/global&gt;

profile BINARY_PATH {
  #include &lt;abstractions/base&gt;
  #include &lt;abstractions/nameservice&gt;
  
  # Binary execution
  BINARY_PATH mr,
  
  # Libraries
  /lib{,32,64}/** mr,
  /usr/lib{,32,64}/** mr,
  
  # Configuration
  /etc/APP_NAME/ r,
  /etc/APP_NAME/** r,
  
  # Data directories
  /var/lib/APP_NAME/** rw,
  /var/log/APP_NAME/** w,
  
  # Network
  network inet stream,
  
  # Capabilities
  capability setuid,
  capability setgid,
  
  # Temporary files
  /tmp/APP_NAME.** rw,
}
</span><span class="no">EOF
</span>                <span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s|BINARY_PATH|</span><span class="nv">$BINARY</span><span class="s2">|g"</span> /etc/apparmor.d/<span class="nv">$PROFILE_NAME</span>
                <span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s|APP_NAME|</span><span class="si">$(</span><span class="nb">basename</span> <span class="nv">$BINARY</span><span class="si">)</span><span class="s2">|g"</span> /etc/apparmor.d/<span class="nv">$PROFILE_NAME</span>
                <span class="p">;;</span>
                
            <span class="s2">"service"</span><span class="p">)</span>
                <span class="nb">cat</span> <span class="o">&gt;</span> /etc/apparmor.d/<span class="nv">$PROFILE_NAME</span> <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
#include &lt;tunables/global&gt;

profile BINARY_PATH flags=(attach_disconnected) {
  #include &lt;abstractions/base&gt;
  #include &lt;abstractions/nameservice&gt;
  
  # Service binary
  BINARY_PATH mr,
  
  # System libraries
  /lib{,32,64}/** mr,
  /usr/lib{,32,64}/** mr,
  
  # Service configuration
  /etc/APP_NAME/ r,
  /etc/APP_NAME/** r,
  
  # Runtime directories
  /var/run/APP_NAME/ rw,
  /var/run/APP_NAME/** rw,
  
  # Log files
  /var/log/APP_NAME/ r,
  /var/log/APP_NAME/*.log w,
  
  # PID file
  /var/run/APP_NAME.pid w,
  
  # Network access
  network inet stream,
  network inet dgram,
  
  # System capabilities
  capability setuid,
  capability setgid,
  capability net_bind_service,
  
  # Signal handling
  signal (receive) set=(term,kill,usr1),
}
</span><span class="no">EOF
</span>                <span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s|BINARY_PATH|</span><span class="nv">$BINARY</span><span class="s2">|g"</span> /etc/apparmor.d/<span class="nv">$PROFILE_NAME</span>
                <span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s|APP_NAME|</span><span class="si">$(</span><span class="nb">basename</span> <span class="nv">$BINARY</span><span class="si">)</span><span class="s2">|g"</span> /etc/apparmor.d/<span class="nv">$PROFILE_NAME</span>
                <span class="p">;;</span>
        <span class="k">esac</span>
        
        <span class="nb">echo</span> <span class="s2">"Template created: /etc/apparmor.d/</span><span class="nv">$PROFILE_NAME</span><span class="s2">"</span>
        <span class="nb">echo</span> <span class="s2">"Edit the template and then load it with:"</span>
        <span class="nb">echo</span> <span class="s2">"apparmor_parser -r /etc/apparmor.d/</span><span class="nv">$PROFILE_NAME</span><span class="s2">"</span>
        <span class="p">;;</span>
        
    <span class="s2">"test"</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Testing AppArmor profile for </span><span class="nv">$BINARY</span><span class="s2">..."</span>
        
        <span class="c"># complain ëª¨ë“œë¡œ ì „í™˜</span>
        aa-complain /etc/apparmor.d/<span class="nv">$PROFILE_NAME</span>
        
        <span class="nb">echo</span> <span class="s2">"Profile set to complain mode."</span>
        <span class="nb">echo</span> <span class="s2">"Run your application tests, then check logs:"</span>
        <span class="nb">echo</span> <span class="s2">"journalctl -f | grep apparmor"</span>
        <span class="nb">echo</span> <span class="s2">""</span>
        <span class="nb">echo</span> <span class="s2">"When testing is complete, switch to enforce mode:"</span>
        <span class="nb">echo</span> <span class="s2">"aa-enforce /etc/apparmor.d/</span><span class="nv">$PROFILE_NAME</span><span class="s2">"</span>
        <span class="p">;;</span>
        
    <span class="s2">"backup"</span><span class="p">)</span>
        <span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">"/etc/apparmor.d/backups/</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span><span class="s2">"</span>
        <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$BACKUP_DIR</span><span class="s2">"</span>
        <span class="nb">cp</span> /etc/apparmor.d/<span class="nv">$PROFILE_NAME</span> <span class="s2">"</span><span class="nv">$BACKUP_DIR</span><span class="s2">/"</span>
        <span class="nb">echo</span> <span class="s2">"Profile backed up to: </span><span class="nv">$BACKUP_DIR</span><span class="s2">/</span><span class="nv">$PROFILE_NAME</span><span class="s2">"</span>
        <span class="p">;;</span>
        
    <span class="k">*</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> {generate|tune|analyze|template|test|backup} &lt;binary&gt; [profile-name]"</span>
        <span class="nb">echo</span> <span class="s2">""</span>
        <span class="nb">echo</span> <span class="s2">"Template types for 'template' action:"</span>
        <span class="nb">echo</span> <span class="s2">"  webapp  - Web application template"</span>
        <span class="nb">echo</span> <span class="s2">"  service - System service template"</span>
        <span class="nb">echo</span> <span class="s2">""</span>
        <span class="nb">echo</span> <span class="s2">"Examples:"</span>
        <span class="nb">echo</span> <span class="s2">"  </span><span class="nv">$0</span><span class="s2"> generate /usr/local/bin/myapp"</span>
        <span class="nb">echo</span> <span class="s2">"  </span><span class="nv">$0</span><span class="s2"> template /usr/local/bin/myapp webapp"</span>
        <span class="nb">echo</span> <span class="s2">"  </span><span class="nv">$0</span><span class="s2"> analyze myapp"</span>
        <span class="nb">echo</span> <span class="s2">"  </span><span class="nv">$0</span><span class="s2"> test myapp"</span>
        <span class="nb">exit </span>1
        <span class="p">;;</span>
<span class="k">esac</span>
</code></pre></div></div>

<h2 id="ì‹œìŠ¤í…œ-í•˜ë“œë‹--system-hardening">ì‹œìŠ¤í…œ í•˜ë“œë‹ | System Hardening</h2>

<h3 id="-ì»¤ë„-ë³´ì•ˆ-ë§¤ê°œë³€ìˆ˜-ìµœì í™”">ğŸ”§ ì»¤ë„ ë³´ì•ˆ ë§¤ê°œë³€ìˆ˜ ìµœì í™”</h3>

<h4 id="ê³ ê¸‰-sysctl-ë³´ì•ˆ-ì„¤ì •">ê³ ê¸‰ sysctl ë³´ì•ˆ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/sysctl.d/99-security-hardening.conf</span>
<span class="c"># ì¢…í•©ì ì¸ ì‹œìŠ¤í…œ ë³´ì•ˆ ê°•í™” ì„¤ì •</span>

<span class="c"># ==================== ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ ====================</span>
<span class="c"># IPv4 ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ</span>
net.ipv4.ip_forward <span class="o">=</span> 0                          <span class="c"># IP í¬ì›Œë”© ë¹„í™œì„±í™”</span>
net.ipv4.conf.all.send_redirects <span class="o">=</span> 0             <span class="c"># ICMP ë¦¬ë””ë ‰íŠ¸ ì „ì†¡ ì°¨ë‹¨</span>
net.ipv4.conf.default.send_redirects <span class="o">=</span> 0
net.ipv4.conf.all.accept_redirects <span class="o">=</span> 0           <span class="c"># ICMP ë¦¬ë””ë ‰íŠ¸ ìˆ˜ì‹  ì°¨ë‹¨</span>
net.ipv4.conf.default.accept_redirects <span class="o">=</span> 0
net.ipv4.conf.all.secure_redirects <span class="o">=</span> 0           <span class="c"># ë³´ì•ˆ ë¦¬ë””ë ‰íŠ¸ë„ ì°¨ë‹¨</span>
net.ipv4.conf.default.secure_redirects <span class="o">=</span> 0
net.ipv4.conf.all.accept_source_route <span class="o">=</span> 0        <span class="c"># ì†ŒìŠ¤ ë¼ìš°íŒ… ì°¨ë‹¨</span>
net.ipv4.conf.default.accept_source_route <span class="o">=</span> 0
net.ipv4.conf.all.rp_filter <span class="o">=</span> 1                 <span class="c"># ì—­ë°©í–¥ ê²½ë¡œ í•„í„°ë§</span>
net.ipv4.conf.default.rp_filter <span class="o">=</span> 1
net.ipv4.conf.all.log_martians <span class="o">=</span> 1              <span class="c"># ë¹„ì •ìƒ íŒ¨í‚· ë¡œê¹…</span>
net.ipv4.conf.default.log_martians <span class="o">=</span> 1

<span class="c"># SYN Flood ê³µê²© ë°©ì§€</span>
net.ipv4.tcp_syncookies <span class="o">=</span> 1
net.ipv4.tcp_max_syn_backlog <span class="o">=</span> 2048
net.ipv4.tcp_synack_retries <span class="o">=</span> 2
net.ipv4.tcp_syn_retries <span class="o">=</span> 5
net.ipv4.tcp_fin_timeout <span class="o">=</span> 15
net.ipv4.tcp_keepalive_time <span class="o">=</span> 300
net.ipv4.tcp_keepalive_probes <span class="o">=</span> 5
net.ipv4.tcp_keepalive_intvl <span class="o">=</span> 15

<span class="c"># ICMP ë³´ì•ˆ</span>
net.ipv4.icmp_echo_ignore_broadcasts <span class="o">=</span> 1         <span class="c"># ë¸Œë¡œë“œìºìŠ¤íŠ¸ ping ë¬´ì‹œ</span>
net.ipv4.icmp_ignore_bogus_error_responses <span class="o">=</span> 1   <span class="c"># ì˜ëª»ëœ ICMP ì—ëŸ¬ ë¬´ì‹œ</span>
net.ipv4.icmp_echo_ignore_all <span class="o">=</span> 0                <span class="c"># ì¼ë°˜ pingì€ í—ˆìš© (í•„ìš”ì‹œ 1ë¡œ ë³€ê²½)</span>
net.ipv4.icmp_ratelimit <span class="o">=</span> 100                    <span class="c"># ICMP ì†ë„ ì œí•œ</span>

<span class="c"># IPv6 ë³´ì•ˆ (IPv6 ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°)</span>
net.ipv6.conf.all.disable_ipv6 <span class="o">=</span> 1
net.ipv6.conf.default.disable_ipv6 <span class="o">=</span> 1
net.ipv6.conf.lo.disable_ipv6 <span class="o">=</span> 1

<span class="c"># IPv6 ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì˜ ë³´ì•ˆ ì„¤ì •</span>
<span class="c"># net.ipv6.conf.all.accept_ra = 0                # ë¼ìš°í„° ê´‘ê³  ì°¨ë‹¨</span>
<span class="c"># net.ipv6.conf.default.accept_ra = 0</span>
<span class="c"># net.ipv6.conf.all.accept_redirects = 0         # IPv6 ë¦¬ë””ë ‰íŠ¸ ì°¨ë‹¨</span>
<span class="c"># net.ipv6.conf.default.accept_redirects = 0</span>
<span class="c"># net.ipv6.conf.all.accept_source_route = 0      # IPv6 ì†ŒìŠ¤ ë¼ìš°íŒ… ì°¨ë‹¨</span>
<span class="c"># net.ipv6.conf.default.accept_source_route = 0</span>

<span class="c"># ==================== ë©”ëª¨ë¦¬ ë³´ì•ˆ ====================</span>
<span class="c"># ASLR (Address Space Layout Randomization)</span>
kernel.randomize_va_space <span class="o">=</span> 2                    <span class="c"># ì „ì²´ ì£¼ì†Œ ê³µê°„ ë¬´ì‘ìœ„í™”</span>

<span class="c"># ë©”ëª¨ë¦¬ ë³´í˜¸</span>
vm.mmap_min_addr <span class="o">=</span> 65536                        <span class="c"># mmap ìµœì†Œ ì£¼ì†Œ (NULL í¬ì¸í„° ì—­ì°¸ì¡° ë°©ì§€)</span>
kernel.exec-shield <span class="o">=</span> 1                          <span class="c"># ì‹¤í–‰ ì‰´ë“œ í™œì„±í™” (ê°€ëŠ¥í•œ ê²½ìš°)</span>
kernel.dmesg_restrict <span class="o">=</span> 1                       <span class="c"># dmesg ì œí•œ (ì¼ë°˜ ì‚¬ìš©ì ì°¨ë‹¨)</span>
kernel.kptr_restrict <span class="o">=</span> 2                        <span class="c"># ì»¤ë„ í¬ì¸í„° ì •ë³´ ì œí•œ</span>

<span class="c"># ë©”ëª¨ë¦¬ í• ë‹¹ ë³´ì•ˆ</span>
vm.overcommit_memory <span class="o">=</span> 2                        <span class="c"># ë©”ëª¨ë¦¬ ì˜¤ë²„ì»¤ë°‹ ì œí•œ</span>
vm.overcommit_ratio <span class="o">=</span> 80                        <span class="c"># ì˜¤ë²„ì»¤ë°‹ ë¹„ìœ¨ 80%</span>

<span class="c"># ==================== í”„ë¡œì„¸ìŠ¤ ë³´ì•ˆ ====================</span>
<span class="c"># ì½”ì–´ ë¤í”„ ë³´ì•ˆ</span>
fs.suid_dumpable <span class="o">=</span> 0                            <span class="c"># SUID í”„ë¡œê·¸ë¨ ì½”ì–´ ë¤í”„ ê¸ˆì§€</span>
kernel.core_uses_pid <span class="o">=</span> 1                        <span class="c"># ì½”ì–´ íŒŒì¼ì— PID í¬í•¨</span>
kernel.core_pattern <span class="o">=</span> |/bin/false               <span class="c"># ì½”ì–´ ë¤í”„ ì™„ì „ ë¹„í™œì„±í™”</span>

<span class="c"># í”„ë¡œì„¸ìŠ¤ ì œí•œ</span>
kernel.pid_max <span class="o">=</span> 65536                          <span class="c"># ìµœëŒ€ í”„ë¡œì„¸ìŠ¤ ID</span>
kernel.threads-max <span class="o">=</span> 65536                      <span class="c"># ìµœëŒ€ ìŠ¤ë ˆë“œ ìˆ˜</span>

<span class="c"># ì‹œìŠ¤í…œ í˜¸ì¶œ ë³´ì•ˆ</span>
kernel.yama.ptrace_scope <span class="o">=</span> 1                    <span class="c"># ptrace ì œí•œ (ë””ë²„ê¹… ë°©ì§€)</span>
kernel.unprivileged_bpf_disabled <span class="o">=</span> 1            <span class="c"># ë¹„íŠ¹ê¶Œ BPF ë¹„í™œì„±í™”</span>
net.core.bpf_jit_harden <span class="o">=</span> 2                     <span class="c"># BPF JIT ê°•í™”</span>

<span class="c"># ==================== íŒŒì¼ ì‹œìŠ¤í…œ ë³´ì•ˆ ====================</span>
<span class="c"># íŒŒì¼ ì‹œìŠ¤í…œ ë³´ì•ˆ</span>
fs.protected_hardlinks <span class="o">=</span> 1                      <span class="c"># í•˜ë“œë§í¬ ë³´í˜¸</span>
fs.protected_symlinks <span class="o">=</span> 1                       <span class="c"># ì‹¬ë³¼ë¦­ë§í¬ ë³´í˜¸</span>
fs.protected_fifos <span class="o">=</span> 2                          <span class="c"># FIFO ë³´í˜¸</span>
fs.protected_regular <span class="o">=</span> 2                        <span class="c"># ì¼ë°˜ íŒŒì¼ ë³´í˜¸</span>

<span class="c"># íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ì œí•œ</span>
fs.file-max <span class="o">=</span> 2097152                          <span class="c"># ì‹œìŠ¤í…œ ì „ì²´ ìµœëŒ€ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°</span>
fs.nr_open <span class="o">=</span> 1048576                           <span class="c"># í”„ë¡œì„¸ìŠ¤ë‹¹ ìµœëŒ€ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°</span>

<span class="c"># ==================== ì‹œìŠ¤í…œ ì œì–´ ====================</span>
<span class="c"># ì‹œìŠ¤í…œ í‚¤ ì¡°í•© ë¹„í™œì„±í™”</span>
kernel.sysrq <span class="o">=</span> 0                               <span class="c"># SysRq í‚¤ ë¹„í™œì„±í™”</span>
kernel.ctrl-alt-del <span class="o">=</span> 0                        <span class="c"># Ctrl+Alt+Del ë¹„í™œì„±í™”</span>

<span class="c"># ì»¤ë„ ëª¨ë“ˆ ë³´ì•ˆ</span>
kernel.modules_disabled <span class="o">=</span> 1                     <span class="c"># ëŸ°íƒ€ì„ ì»¤ë„ ëª¨ë“ˆ ë¡œë”© ë¹„í™œì„±í™” (ì‹ ì¤‘íˆ ì‚¬ìš©)</span>
kernel.kexec_load_disabled <span class="o">=</span> 1                 <span class="c"># kexec ë¹„í™œì„±í™”</span>

<span class="c"># ==================== ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ ë° ë³´ì•ˆ ====================</span>
<span class="c"># ë„¤íŠ¸ì›Œí¬ ë²„í¼ í¬ê¸°</span>
net.core.rmem_default <span class="o">=</span> 262144
net.core.rmem_max <span class="o">=</span> 16777216
net.core.wmem_default <span class="o">=</span> 262144  
net.core.wmem_max <span class="o">=</span> 16777216

<span class="c"># TCP ìœˆë„ìš° ìŠ¤ì¼€ì¼ë§</span>
net.ipv4.tcp_window_scaling <span class="o">=</span> 1
net.ipv4.tcp_rmem <span class="o">=</span> 4096 87380 16777216
net.ipv4.tcp_wmem <span class="o">=</span> 4096 65536 16777216

<span class="c"># ë„¤íŠ¸ì›Œí¬ í ì„¤ì •</span>
net.core.netdev_max_backlog <span class="o">=</span> 5000

<span class="c"># ==================== ë¡œê¹… ë° ê°ì‚¬ ====================</span>
<span class="c"># ì»¤ë„ ë¡œê¹…</span>
kernel.printk <span class="o">=</span> 3 4 1 3                        <span class="c"># ë¡œê¹… ë ˆë²¨ ì¡°ì •</span>

<span class="c"># ì„¤ì • ì ìš© ë° í™•ì¸ ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/apply-sysctl-security.sh</span>

<span class="nb">echo</span> <span class="s2">"Applying sysctl security settings..."</span>

<span class="c"># í˜„ì¬ ì„¤ì • ë°±ì—…</span>
sysctl <span class="nt">-a</span> <span class="o">&gt;</span> /etc/sysctl.backup.<span class="si">$(</span><span class="nb">date</span> +%Y%m%d-%H%M%S<span class="si">)</span>

<span class="c"># ìƒˆ ì„¤ì • ì ìš©</span>
sysctl <span class="nt">-p</span> /etc/sysctl.d/99-security-hardening.conf

<span class="c"># ì ìš© ê²°ê³¼ í™•ì¸</span>
<span class="nb">echo</span> <span class="s2">"=== Security Sysctl Settings Applied ==="</span>
<span class="nb">echo</span> <span class="s2">"Network security:"</span>
sysctl net.ipv4.ip_forward net.ipv4.conf.all.accept_redirects net.ipv4.tcp_syncookies

<span class="nb">echo</span> <span class="s2">"Memory security:"</span>
sysctl kernel.randomize_va_space vm.mmap_min_addr kernel.dmesg_restrict

<span class="nb">echo</span> <span class="s2">"Process security:"</span>
sysctl fs.suid_dumpable kernel.yama.ptrace_scope kernel.unprivileged_bpf_disabled

<span class="nb">echo</span> <span class="s2">"File system security:"</span>
sysctl fs.protected_hardlinks fs.protected_symlinks

<span class="nb">echo</span> <span class="s2">"System control:"</span>
sysctl kernel.sysrq kernel.ctrl-alt-del

<span class="nb">echo</span> <span class="s2">""</span>
<span class="nb">echo</span> <span class="s2">"Settings applied successfully!"</span>
<span class="nb">echo</span> <span class="s2">"Reboot recommended to ensure all settings take effect."</span>
</code></pre></div></div>

<h2 id="ë‹¤ìŒ-í¸-ì˜ˆê³ ">ë‹¤ìŒ í¸ ì˜ˆê³ </h2>

<p>ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” <strong>ì¹¨ì… íƒì§€ ì‹œìŠ¤í…œê³¼ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</strong>ì„ ìƒì„¸íˆ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤:</p>
<ul>
  <li>AIDE íŒŒì¼ ë¬´ê²°ì„± ëª¨ë‹ˆí„°ë§</li>
  <li>Fail2Ban ê³ ê¸‰ ì„¤ì • ë° ì»¤ìŠ¤í„°ë§ˆì´ì§•</li>
  <li>Wazuh SIEM êµ¬ì¶• ë° ìš´ì˜</li>
  <li>ì‹¤ì‹œê°„ ìœ„í˜‘ íƒì§€ ë° ëŒ€ì‘</li>
</ul>

<p>SELinux/AppArmorì™€ ì‹œìŠ¤í…œ í•˜ë“œë‹ì„ ì™„ë²½í•˜ê²Œ ë§ˆìŠ¤í„°í•˜ì…¨ë‚˜ìš”? ğŸ›¡ï¸ğŸ”’</p>]]></content><author><name>DevOps Engineer</name></author><category term="Security" /><category term="Linux" /><category term="selinux" /><category term="apparmor" /><category term="system-hardening" /><category term="kernel-security" /><category term="filesystem-security" /><category term="mandatory-access-control" /><summary type="html"><![CDATA[ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œì˜ í•µì‹¬ ë³´ì•ˆ ë ˆì´ì–´ì¸ SELinux/AppArmorì™€ ì‹œìŠ¤í…œ í•˜ë“œë‹ ê¸°ë²•ì„ ì™„ì „íˆ ë§ˆìŠ¤í„°í•´ë³´ê² ìŠµë‹ˆë‹¤. ê°•ì œ ì ‘ê·¼ ì œì–´ë¶€í„° ì»¤ë„ ë³´ì•ˆ ë§¤ê°œë³€ìˆ˜ê¹Œì§€ ìµœê³  ìˆ˜ì¤€ì˜ ì‹œìŠ¤í…œ ë³´ì•ˆì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ë‹¤ë£¹ë‹ˆë‹¤. SELinux ì™„ì „ ë§ˆìŠ¤í„° | SELinux Complete Mastery ğŸ” SELinux ê¸°ì´ˆë¶€í„° ê³ ê¸‰ê¹Œì§€ SELinux ê°œë… ë° ì´ˆê¸° ì„¤ì • # SELinux ìƒíƒœ ë° ì •ë³´ í™•ì¸ sestatus # ì „ì²´ ìƒíƒœ í™•ì¸ getenforce # í˜„ì¬ ëª¨ë“œ í™•ì¸ seinfo # ì •ì±… í†µê³„ semanage -l # ê´€ë¦¬ ê°€ëŠ¥í•œ ê°ì²´ ëª©ë¡ # SELinux ëª¨ë“œ ì„¤ì • # /etc/selinux/config SELINUX=enforcing # enforcing, permissive, disabled SELINUXTYPE=targeted # targeted, minimum, mls # ì„ì‹œ ëª¨ë“œ ë³€ê²½ (ì¬ë¶€íŒ… ì‹œ ì›ë³µ) setenforce 1 # enforcing ëª¨ë“œ setenforce 0 # permissive ëª¨ë“œ # SELinux ë¼ë²¨ë§ ì‹œìŠ¤í…œ ì´í•´ # ëª¨ë“  ê°ì²´ëŠ” security contextë¥¼ ê°€ì§: user:role:type:level ls -Z /var/www/html/ # íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ í™•ì¸ ps auxZ # í”„ë¡œì„¸ìŠ¤ ì»¨í…ìŠ¤íŠ¸ í™•ì¸ id -Z # í˜„ì¬ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ # ì»¨í…ìŠ¤íŠ¸ êµ¬ì„± ìš”ì†Œ # user: SELinux ì‚¬ìš©ì (unconfined_u, system_u, user_u ë“±) # role: ì—­í•  (unconfined_r, system_r, object_r ë“±) # type: íƒ€ì…/ë„ë©”ì¸ (httpd_t, httpd_exec_t, user_home_t ë“±) # level: MLS/MCS ë ˆë²¨ (s0, s0:c0,c1 ë“±) íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ # íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ í™•ì¸ ë° ë³µì› ls -lZ /var/www/html/ restorecon -Rv /var/www/html/ # ê¸°ë³¸ ì»¨í…ìŠ¤íŠ¸ë¡œ ë³µì› restorecon -RvF /var/www/html/ # ê°•ì œ ë³µì› # íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ ìˆ˜ë™ ì„¤ì • chcon -t httpd_exec_t /usr/local/apache2/bin/httpd chcon -u system_u /var/www/html/index.html chcon --reference=/var/www/html/index.html /var/www/html/newfile.html # ì˜êµ¬ì ì¸ ì»¨í…ìŠ¤íŠ¸ ì„¤ì • (ì •ì±…ì— ì¶”ê°€) semanage fcontext -a -t httpd_exec_t "/usr/local/apache2/bin/httpd" semanage fcontext -a -t httpd_config_t "/etc/myapp/.*\.conf" semanage fcontext -a -t user_home_t "/home/[^/]+/mydata(/.*)?" # ì»¨í…ìŠ¤íŠ¸ ì •ì±… í™•ì¸ semanage fcontext -l | grep httpd matchpathcon /var/www/html/index.html # ì˜ˆìƒ ì»¨í…ìŠ¤íŠ¸ í™•ì¸ # ì»¨í…ìŠ¤íŠ¸ ë³€ê²½ ë‚´ì—­ ì¶”ì  ausearch -m AVC -ts today # AVC ê±°ë¶€ ë¡œê·¸ sealert -a /var/log/audit/audit.log # ì •ì±… ì œì•ˆ # ê³ ê¸‰ ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # /usr/local/bin/selinux-context-manager.sh ACTION=$1 TARGET=$2 CONTEXT=$3 case $ACTION in "scan") echo "=== SELinux Context Scan ===" find "$TARGET" -print0 | xargs -0 ls -lZ | \ awk '{print $4, $9}' | sort | uniq -c | sort -nr ;; "restore") echo "Restoring contexts for $TARGET..." restorecon -RvF "$TARGET" ;; "set-bulk") echo "Setting bulk context $CONTEXT for $TARGET..." find "$TARGET" -type f -exec chcon -t "$CONTEXT" {} \; ;; "analyze") echo "=== Context Analysis for $TARGET ===" # ë¹„ì •ìƒì ì¸ ì»¨í…ìŠ¤íŠ¸ ì°¾ê¸° find "$TARGET" -type f -exec ls -lZ {} \; | \ grep -v "system_u:object_r" | \ awk '{print "Unusual context:", $4, $9}' ;; *) echo "Usage: $0 {scan|restore|set-bulk|analyze} &lt;path&gt; [context]" exit 1 ;; esac SELinux ë¶ˆë¦° ê°’ ê´€ë¦¬ # ë¶ˆë¦° ê°’ í™•ì¸ getsebool -a # ëª¨ë“  ë¶ˆë¦° ê°’ getsebool -a | grep httpd # httpd ê´€ë ¨ ë¶ˆë¦° getsebool httpd_can_network_connect # íŠ¹ì • ë¶ˆë¦° # ë¶ˆë¦° ê°’ ì„¤ì • setsebool httpd_can_network_connect on # ì„ì‹œ ì„¤ì • setsebool -P httpd_can_network_connect on # ì˜êµ¬ ì„¤ì • # ì£¼ìš” ì›¹ ì„œë²„ ë¶ˆë¦° ê°’ë“¤ setsebool -P httpd_can_network_connect on # ë„¤íŠ¸ì›Œí¬ ì—°ê²° í—ˆìš© setsebool -P httpd_can_sendmail on # ë©”ì¼ ë°œì†¡ í—ˆìš© setsebool -P httpd_enable_cgi on # CGI ì‹¤í–‰ í—ˆìš© setsebool -P httpd_read_user_content on # ì‚¬ìš©ì ì½˜í…ì¸  ì½ê¸° setsebool -P httpd_enable_homedirs on # í™ˆ ë””ë ‰í† ë¦¬ ì ‘ê·¼ setsebool -P httpd_execmem on # ë©”ëª¨ë¦¬ ì‹¤í–‰ í—ˆìš© setsebool -P httpd_use_nfs on # NFS ì‚¬ìš© í—ˆìš© # ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ ë¶ˆë¦° setsebool -P allow_user_mysql_connect on # MySQL ì—°ê²° í—ˆìš© setsebool -P mysql_connect_any on # MySQL ì„ì˜ ì—°ê²° # SSH ê´€ë ¨ ë¶ˆë¦° setsebool -P ssh_chroot_rw_homedirs on # chrootì—ì„œ í™ˆë””ë ‰í† ë¦¬ ì“°ê¸° # ë¶ˆë¦° ê°’ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # /usr/local/bin/selinux-bool-monitor.sh # í˜„ì¬ ë¶ˆë¦° ì„¤ì • ë°±ì—… getsebool -a &gt; /var/log/selinux-bools-$(date +%Y%m%d).log # ë³€ê²½ëœ ë¶ˆë¦° ê°’ ê°ì§€ if [ -f /var/log/selinux-bools-last.log ]; then echo "=== Boolean Changes Detected ===" diff /var/log/selinux-bools-last.log /var/log/selinux-bools-$(date +%Y%m%d).log fi cp /var/log/selinux-bools-$(date +%Y%m%d).log /var/log/selinux-bools-last.log # ë³´ì•ˆì— ë¯¼ê°í•œ ë¶ˆë¦° ê°’ë“¤ ì²´í¬ CRITICAL_BOOLS=( "httpd_execmem" "httpd_enable_cgi" "allow_execheap" "allow_execstack" "selinuxuser_execstack" ) echo "=== Critical Boolean Status ===" for bool in "${CRITICAL_BOOLS[@]}"; do status=$(getsebool "$bool" 2&gt;/dev/null) if echo "$status" | grep -q " on"; then echo "WARNING: $bool is enabled" else echo "OK: $bool is disabled" fi done í¬íŠ¸ ë¼ë²¨ ê´€ë¦¬ # í¬íŠ¸ ë¼ë²¨ í™•ì¸ semanage port -l # ëª¨ë“  í¬íŠ¸ ë¼ë²¨ semanage port -l | grep http # HTTP ê´€ë ¨ í¬íŠ¸ ss -tlnZ # ë„¤íŠ¸ì›Œí¬ ì„œë¹„ìŠ¤ì™€ ì»¨í…ìŠ¤íŠ¸ # ìƒˆë¡œìš´ í¬íŠ¸ì— ë¼ë²¨ í• ë‹¹ semanage port -a -t http_port_t -p tcp 8080 # HTTP í¬íŠ¸ ì¶”ê°€ semanage port -a -t ssh_port_t -p tcp 2222 # SSH í¬íŠ¸ ì¶”ê°€ semanage port -a -t mysqld_port_t -p tcp 3307 # MySQL í¬íŠ¸ ì¶”ê°€ # í¬íŠ¸ ë¼ë²¨ ìˆ˜ì • semanage port -m -t http_port_t -p tcp 8080 # í¬íŠ¸ ë¼ë²¨ ì œê±° semanage port -d -t http_port_t -p tcp 8080 # ì»¤ìŠ¤í…€ í¬íŠ¸ íƒ€ì… ìƒì„± (ê³ ê¸‰) # myapp.te íŒŒì¼ ìƒì„± cat &gt; myapp.te &lt;&lt; 'EOF' policy_module(myapp, 1.0) type myapp_port_t; corenet_port(myapp_port_t) allow httpd_t myapp_port_t:tcp_socket name_bind; EOF # ì •ì±… ì»´íŒŒì¼ ë° ì„¤ì¹˜ make -f /usr/share/selinux/devel/Makefile myapp.pp semodule -i myapp.pp semanage port -a -t myapp_port_t -p tcp 9999 ğŸ›¡ï¸ SELinux ì»¤ìŠ¤í…€ ì •ì±… ì‘ì„± ì •ì±… ëª¨ë“ˆ ê°œë°œ # ì •ì±… ê°œë°œ í™˜ê²½ ì¤€ë¹„ yum install selinux-policy-devel # CentOS/RHEL apt-get install selinux-policy-dev # Ubuntu/Debian # AVC ê±°ë¶€ ë¶„ì„ ë° ì •ì±… ìƒì„± # 1. ì„œë¹„ìŠ¤ ì‹¤í–‰í•˜ì—¬ AVC ê±°ë¶€ ë¡œê·¸ ìˆ˜ì§‘ systemctl start myapp tail -f /var/log/audit/audit.log | grep AVC # 2. audit2allowë¡œ ì •ì±… ì œì•ˆ ìƒì„± grep myapp /var/log/audit/audit.log | audit2allow -m myapp_policy grep myapp /var/log/audit/audit.log | audit2allow -M myapp_policy # 3. ìˆ˜ë™ìœ¼ë¡œ ì •ì±… ëª¨ë“ˆ ì‘ì„± cat &gt; myapp_custom.te &lt;&lt; 'EOF' policy_module(myapp_custom, 1.0) ######################################## # # Declarations # type myapp_t; type myapp_exec_t; init_daemon_domain(myapp_t, myapp_exec_t) type myapp_config_t; files_config_file(myapp_config_t) type myapp_var_lib_t; files_type(myapp_var_lib_t) type myapp_log_t; logging_log_file(myapp_log_t) type myapp_port_t; corenet_port(myapp_port_t) ######################################## # # myapp local policy # # ê¸°ë³¸ ë„ë©”ì¸ ê¶Œí•œ allow myapp_t self:process { fork signal_perms }; allow myapp_t self:fifo_file rw_fifo_file_perms; allow myapp_t self:unix_stream_socket create_stream_socket_perms; # ë„¤íŠ¸ì›Œí¬ ê¶Œí•œ allow myapp_t self:tcp_socket create_stream_socket_perms; allow myapp_t myapp_port_t:tcp_socket name_bind; corenet_tcp_sendrecv_generic_if(myapp_t) corenet_tcp_sendrecv_generic_node(myapp_t) # íŒŒì¼ ì‹œìŠ¤í…œ ê¶Œí•œ allow myapp_t myapp_config_t:file read_file_perms; allow myapp_t myapp_var_lib_t:dir create_dir_perms; allow myapp_t myapp_var_lib_t:file create_file_perms; allow myapp_t myapp_log_t:file create_file_perms; # ì‹œìŠ¤í…œ ì„œë¹„ìŠ¤ ìƒí˜¸ì‘ìš© can_exec(myapp_t, myapp_exec_t) files_read_etc_files(myapp_t) libs_use_ld_so(myapp_t) libs_use_shared_libs(myapp_t) # ë¡œê¹… logging_send_syslog_msg(myapp_t) EOF # 4. íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ ì •ì˜ cat &gt; myapp_custom.fc &lt;&lt; 'EOF' /usr/local/bin/myapp -- gen_context(system_u:object_r:myapp_exec_t,s0) /etc/myapp(/.*)? gen_context(system_u:object_r:myapp_config_t,s0) /var/lib/myapp(/.*)? gen_context(system_u:object_r:myapp_var_lib_t,s0) /var/log/myapp(/.*)? gen_context(system_u:object_r:myapp_log_t,s0) EOF # 5. ì¸í„°í˜ì´ìŠ¤ íŒŒì¼ (ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œ ì‚¬ìš©í•  ì¸í„°í˜ì´ìŠ¤) cat &gt; myapp_custom.if &lt;&lt; 'EOF' ## &lt;summary&gt;MyApp custom policy&lt;/summary&gt; ######################################## ## &lt;summary&gt; ## Execute myapp in the myapp domain. ## &lt;/summary&gt; ## &lt;param name="domain"&gt; ## &lt;summary&gt; ## Domain allowed to transition. ## &lt;/summary&gt; ## &lt;/param&gt; # interface(`myapp_domtrans',` gen_require(` type myapp_t, myapp_exec_t; ') corecmd_search_bin($1) domtrans_pattern($1, myapp_exec_t, myapp_t) ') ######################################## ## &lt;summary&gt; ## Read myapp configuration files. ## &lt;/summary&gt; ## &lt;param name="domain"&gt; ## &lt;summary&gt; ## Domain allowed access. ## &lt;/summary&gt; ## &lt;/param&gt; # interface(`myapp_read_config',` gen_require(` type myapp_config_t; ') files_search_etc($1) read_files_pattern($1, myapp_config_t, myapp_config_t) ') EOF # 6. ì •ì±… ì»´íŒŒì¼ ë° ì„¤ì¹˜ make -f /usr/share/selinux/devel/Makefile myapp_custom.pp semodule -i myapp_custom.pp # 7. íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ ì ìš© semanage fcontext -a -f "" -t myapp_exec_t "/usr/local/bin/myapp" semanage fcontext -a -f "" -t myapp_config_t "/etc/myapp(/.*)?" restorecon -Rv /usr/local/bin/myapp /etc/myapp # 8. í¬íŠ¸ ë¼ë²¨ ì„¤ì • semanage port -a -t myapp_port_t -p tcp 9090 ì •ì±… ë””ë²„ê¹… ë° ìµœì í™” #!/bin/bash # /usr/local/bin/selinux-debug.sh # SELinux ì •ì±… ë””ë²„ê¹… ë„êµ¬ MODE=$1 MODULE=$2 case $MODE in "avc-analysis") echo "=== AVC Denial Analysis ===" ausearch -m AVC -ts today | grep "$MODULE" | \ while read line; do echo "$line" | audit2allow -R echo "---" done ;; "permissive-test") echo "Setting $MODULE to permissive mode for testing..." semanage permissive -a ${MODULE}_t echo "Test your application, then check denials:" echo "ausearch -m AVC -ts now" echo "When done, remove permissive mode:" echo "semanage permissive -d ${MODULE}_t" ;; "policy-stats") echo "=== Policy Statistics ===" seinfo -t | grep "$MODULE" seinfo -r | grep "$MODULE" seinfo -u | grep "$MODULE" ;; "generate-policy") echo "Generating policy for $MODULE..." ausearch -m AVC -ts today | grep "$MODULE" | \ audit2allow -M ${MODULE}_additional echo "Generated policy module: ${MODULE}_additional.pp" echo "Install with: semodule -i ${MODULE}_additional.pp" ;; "module-deps") echo "=== Module Dependencies for $MODULE ===" semodule -l | grep "$MODULE" ;; *) echo "Usage: $0 {avc-analysis|permissive-test|policy-stats|generate-policy|module-deps} &lt;module&gt;" echo "" echo "Examples:" echo " $0 avc-analysis httpd" echo " $0 permissive-test myapp" echo " $0 generate-policy myapp" exit 1 ;; esac AppArmor ì™„ì „ ë§ˆìŠ¤í„° | AppArmor Complete Mastery ğŸ›¡ï¸ AppArmor í”„ë¡œíŒŒì¼ ì‘ì„± ë° ê´€ë¦¬ AppArmor ê¸°ë³¸ ê´€ë¦¬ # AppArmor ìƒíƒœ í™•ì¸ aa-status # ì „ì²´ ìƒíƒœ aa-enabled # í™œì„±í™” ì—¬ë¶€ aa-unconfined # ì œí•œë˜ì§€ ì•Šì€ í”„ë¡œì„¸ìŠ¤ # í”„ë¡œíŒŒì¼ ëª¨ë“œ ê´€ë¦¬ aa-enforce /etc/apparmor.d/usr.bin.firefox # enforce ëª¨ë“œ aa-complain /etc/apparmor.d/usr.bin.firefox # complain ëª¨ë“œ aa-disable /etc/apparmor.d/usr.bin.firefox # ë¹„í™œì„±í™” # í”„ë¡œíŒŒì¼ ì¬ë¡œë“œ apparmor_parser -r /etc/apparmor.d/usr.bin.firefox apparmor_parser -R /etc/apparmor.d/ # ëª¨ë“  í”„ë¡œíŒŒì¼ ì¬ë¡œë“œ # í”„ë¡œíŒŒì¼ ìƒíƒœ í™•ì¸ aa-status | grep firefox ê³ ê¸‰ AppArmor í”„ë¡œíŒŒì¼ ì‘ì„± # ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ìš© ì»¤ìŠ¤í…€ í”„ë¡œíŒŒì¼ # /etc/apparmor.d/usr.local.bin.webapp #include &lt;tunables/global&gt; profile /usr/local/bin/webapp flags=(attach_disconnected,mediate_deleted) { #include &lt;abstractions/base&gt; #include &lt;abstractions/nameservice&gt; #include &lt;abstractions/openssl&gt; #include &lt;abstractions/ssl_certs&gt; # ì‹¤í–‰ ê¶Œí•œ /usr/local/bin/webapp mr, # ë¼ì´ë¸ŒëŸ¬ë¦¬ ì ‘ê·¼ /lib{,32,64}/** mr, /usr/lib{,32,64}/** mr, /usr/local/lib/** mr, # ì„¤ì • íŒŒì¼ (ì½ê¸° ì „ìš©) /etc/webapp/ r, /etc/webapp/** r, owner /etc/webapp/webapp.conf r, # ì‚¬ìš©ìë³„ ì„¤ì • ë° ë°ì´í„° owner @{HOME}/.webapp/ rw, owner @{HOME}/.webapp/** rw, owner @{HOME}/.webapp/cache/** rwk, # ì• í”Œë¦¬ì¼€ì´ì…˜ ë°ì´í„° ë””ë ‰í† ë¦¬ /var/lib/webapp/ r, /var/lib/webapp/** rw, /var/cache/webapp/ r, /var/cache/webapp/** rw, # ë¡œê·¸ íŒŒì¼ /var/log/webapp/ r, /var/log/webapp/*.log w, /var/log/webapp/*.log.[0-9] w, # ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ network inet stream, network inet6 stream, network inet dgram, network inet6 dgram, network netlink raw, # í”„ë¡œì„¸ìŠ¤ ì œì–´ capability setuid, capability setgid, capability dac_override, capability net_bind_service, # ì„ì‹œ íŒŒì¼ /tmp/ r, /tmp/webapp.** rw, owner /tmp/webapp-@{pid}-* rw, /var/tmp/ r, /var/tmp/webapp.** rw, # ì‹œìŠ¤í…œ ì •ë³´ ì ‘ê·¼ /proc/sys/kernel/random/uuid r, /proc/loadavg r, /proc/meminfo r, /sys/devices/system/cpu/ r, /sys/devices/system/cpu/cpu[0-9]*/cpufreq/scaling_cur_freq r, # ê±°ë¶€í•  ì ‘ê·¼ë“¤ (ëª…ì‹œì  ê±°ë¶€) deny /etc/passwd r, deny /etc/shadow r, deny /etc/gshadow r, deny owner /home/*/.ssh/** rw, deny /proc/[0-9]*/maps r, deny /proc/[0-9]*/mem r, deny /proc/kmem r, deny /proc/kcore r, deny /boot/** r, # í•˜ìœ„ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ /bin/dash ix, /bin/bash ix, /usr/bin/python3 ix, /usr/bin/python3.[0-9] ix, /usr/local/bin/webapp-helper Cx -&gt; helper, # ì¡°ê±´ë¶€ ì‹¤í–‰ ê·œì¹™ profile helper { #include &lt;abstractions/base&gt; /usr/local/bin/webapp-helper mr, /var/lib/webapp/helper-data/** r, /tmp/helper-** rw, # ë¶€ëª¨ë¡œë¶€í„° ìƒì†ë°›ì€ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ë§Œ ì‚¬ìš© deny network, deny capability, } # ì‹ í˜¸ ì²˜ë¦¬ signal (send) set=(term,kill,usr1,usr2) peer=/usr/local/bin/webapp, signal (receive) set=(term,kill,usr1,usr2), # DBus ì ‘ê·¼ (í•„ìš”ì‹œ) dbus (send) bus=session path=/org/freedesktop/Notifications interface=org.freedesktop.Notifications member=Notify peer=(name=org.freedesktop.Notifications), } # ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ìš© í”„ë¡œíŒŒì¼ # /etc/apparmor.d/usr.sbin.mysqld-custom #include &lt;tunables/global&gt; profile /usr/sbin/mysqld-custom flags=(attach_disconnected,mediate_deleted) { #include &lt;abstractions/base&gt; #include &lt;abstractions/mysql&gt; #include &lt;abstractions/nameservice&gt; #include &lt;abstractions/user-tmp&gt; capability dac_override, capability setgid, capability setuid, capability sys_resource, capability net_bind_service, # MySQL ë°”ì´ë„ˆë¦¬ /usr/sbin/mysqld mr, /usr/sbin/mysqld-debug mr, # ì„¤ì • íŒŒì¼ /etc/mysql/ r, /etc/mysql/** r, /etc/my.cnf r, /etc/my.cnf.d/ r, /etc/my.cnf.d/*.cnf r, # ë°ì´í„° ë””ë ‰í† ë¦¬ /var/lib/mysql/ r, /var/lib/mysql/** rwk, /var/lib/mysql-files/ r, /var/lib/mysql-files/** rw, # ë¡œê·¸ íŒŒì¼ /var/log/mysql/ r, /var/log/mysql/*.log rw, /var/log/mysql.log rw, /var/log/mysql/error.log rw, # ì†Œì¼“ íŒŒì¼ /var/run/mysqld/ rw, /var/run/mysqld/mysqld.sock rw, /tmp/mysql.sock rw, # ë„¤íŠ¸ì›Œí¬ network tcp, # í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹  /proc/*/status r, /proc/sys/vm/overcommit_memory r, # ì„ì‹œ íŒŒì¼ /tmp/ r, /tmp/mysql-** rw, /var/tmp/ r, /var/tmp/mysql-** rw, # ë³´ì•ˆ ì œí•œ deny capability sys_ptrace, deny @{PROC}/sys/kernel/core_pattern w, deny /etc/passwd r, deny /etc/shadow r, } AppArmor í”„ë¡œíŒŒì¼ ìë™ ìƒì„± ë° íŠœë‹ #!/bin/bash # /usr/local/bin/apparmor-manager.sh # AppArmor í”„ë¡œíŒŒì¼ ê´€ë¦¬ ë„êµ¬ ACTION=$1 BINARY=$2 PROFILE_NAME=${3:-$(basename $BINARY)} case $ACTION in "generate") echo "Generating AppArmor profile for $BINARY..." # 1. ê¸°ë³¸ í”„ë¡œíŒŒì¼ ìƒì„± aa-genprof "$BINARY" echo "Profile generation completed." echo "Test your application and run: $0 tune $BINARY" ;; "tune") echo "Tuning AppArmor profile for $BINARY..." # ë¡œê·¸í”„ë¡œíŒŒì¼ë§ ì‹¤í–‰ aa-logprof echo "Profile tuning completed." ;; "analyze") echo "=== AppArmor Profile Analysis for $PROFILE_NAME ===" # í”„ë¡œíŒŒì¼ êµ¬ë¬¸ ê²€ì‚¬ apparmor_parser -p /etc/apparmor.d/$PROFILE_NAME 2&gt;&amp;1 | \ grep -E "(ERROR|WARNING)" || echo "âœ“ Syntax OK" # í”„ë¡œíŒŒì¼ í†µê³„ echo "" echo "Profile statistics:" grep -c "^[[:space:]]*/" /etc/apparmor.d/$PROFILE_NAME &amp;&amp; echo "File rules" grep -c "capability" /etc/apparmor.d/$PROFILE_NAME &amp;&amp; echo "Capabilities" grep -c "network" /etc/apparmor.d/$PROFILE_NAME &amp;&amp; echo "Network rules" grep -c "deny" /etc/apparmor.d/$PROFILE_NAME &amp;&amp; echo "Deny rules" # ë³´ì•ˆ ê²€ì‚¬ echo "" echo "Security analysis:" if grep -q "capability sys_admin" /etc/apparmor.d/$PROFILE_NAME; then echo "âš ï¸ WARNING: sys_admin capability found" fi if grep -q "/etc/shadow" /etc/apparmor.d/$PROFILE_NAME; then echo "âš ï¸ WARNING: Shadow file access found" fi if grep -q "network raw" /etc/apparmor.d/$PROFILE_NAME; then echo "âš ï¸ WARNING: Raw network access found" fi ;; "template") TEMPLATE_TYPE=$3 echo "Creating AppArmor profile template for $BINARY ($TEMPLATE_TYPE)..." case $TEMPLATE_TYPE in "webapp") cat &gt; /etc/apparmor.d/$PROFILE_NAME &lt;&lt; 'EOF' #include &lt;tunables/global&gt; profile BINARY_PATH { #include &lt;abstractions/base&gt; #include &lt;abstractions/nameservice&gt; # Binary execution BINARY_PATH mr, # Libraries /lib{,32,64}/** mr, /usr/lib{,32,64}/** mr, # Configuration /etc/APP_NAME/ r, /etc/APP_NAME/** r, # Data directories /var/lib/APP_NAME/** rw, /var/log/APP_NAME/** w, # Network network inet stream, # Capabilities capability setuid, capability setgid, # Temporary files /tmp/APP_NAME.** rw, } EOF sed -i "s|BINARY_PATH|$BINARY|g" /etc/apparmor.d/$PROFILE_NAME sed -i "s|APP_NAME|$(basename $BINARY)|g" /etc/apparmor.d/$PROFILE_NAME ;; "service") cat &gt; /etc/apparmor.d/$PROFILE_NAME &lt;&lt; 'EOF' #include &lt;tunables/global&gt; profile BINARY_PATH flags=(attach_disconnected) { #include &lt;abstractions/base&gt; #include &lt;abstractions/nameservice&gt; # Service binary BINARY_PATH mr, # System libraries /lib{,32,64}/** mr, /usr/lib{,32,64}/** mr, # Service configuration /etc/APP_NAME/ r, /etc/APP_NAME/** r, # Runtime directories /var/run/APP_NAME/ rw, /var/run/APP_NAME/** rw, # Log files /var/log/APP_NAME/ r, /var/log/APP_NAME/*.log w, # PID file /var/run/APP_NAME.pid w, # Network access network inet stream, network inet dgram, # System capabilities capability setuid, capability setgid, capability net_bind_service, # Signal handling signal (receive) set=(term,kill,usr1), } EOF sed -i "s|BINARY_PATH|$BINARY|g" /etc/apparmor.d/$PROFILE_NAME sed -i "s|APP_NAME|$(basename $BINARY)|g" /etc/apparmor.d/$PROFILE_NAME ;; esac echo "Template created: /etc/apparmor.d/$PROFILE_NAME" echo "Edit the template and then load it with:" echo "apparmor_parser -r /etc/apparmor.d/$PROFILE_NAME" ;; "test") echo "Testing AppArmor profile for $BINARY..." # complain ëª¨ë“œë¡œ ì „í™˜ aa-complain /etc/apparmor.d/$PROFILE_NAME echo "Profile set to complain mode." echo "Run your application tests, then check logs:" echo "journalctl -f | grep apparmor" echo "" echo "When testing is complete, switch to enforce mode:" echo "aa-enforce /etc/apparmor.d/$PROFILE_NAME" ;; "backup") BACKUP_DIR="/etc/apparmor.d/backups/$(date +%Y%m%d)" mkdir -p "$BACKUP_DIR" cp /etc/apparmor.d/$PROFILE_NAME "$BACKUP_DIR/" echo "Profile backed up to: $BACKUP_DIR/$PROFILE_NAME" ;; *) echo "Usage: $0 {generate|tune|analyze|template|test|backup} &lt;binary&gt; [profile-name]" echo "" echo "Template types for 'template' action:" echo " webapp - Web application template" echo " service - System service template" echo "" echo "Examples:" echo " $0 generate /usr/local/bin/myapp" echo " $0 template /usr/local/bin/myapp webapp" echo " $0 analyze myapp" echo " $0 test myapp" exit 1 ;; esac ì‹œìŠ¤í…œ í•˜ë“œë‹ | System Hardening ğŸ”§ ì»¤ë„ ë³´ì•ˆ ë§¤ê°œë³€ìˆ˜ ìµœì í™” ê³ ê¸‰ sysctl ë³´ì•ˆ ì„¤ì • # /etc/sysctl.d/99-security-hardening.conf # ì¢…í•©ì ì¸ ì‹œìŠ¤í…œ ë³´ì•ˆ ê°•í™” ì„¤ì • # ==================== ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ ==================== # IPv4 ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ net.ipv4.ip_forward = 0 # IP í¬ì›Œë”© ë¹„í™œì„±í™” net.ipv4.conf.all.send_redirects = 0 # ICMP ë¦¬ë””ë ‰íŠ¸ ì „ì†¡ ì°¨ë‹¨ net.ipv4.conf.default.send_redirects = 0 net.ipv4.conf.all.accept_redirects = 0 # ICMP ë¦¬ë””ë ‰íŠ¸ ìˆ˜ì‹  ì°¨ë‹¨ net.ipv4.conf.default.accept_redirects = 0 net.ipv4.conf.all.secure_redirects = 0 # ë³´ì•ˆ ë¦¬ë””ë ‰íŠ¸ë„ ì°¨ë‹¨ net.ipv4.conf.default.secure_redirects = 0 net.ipv4.conf.all.accept_source_route = 0 # ì†ŒìŠ¤ ë¼ìš°íŒ… ì°¨ë‹¨ net.ipv4.conf.default.accept_source_route = 0 net.ipv4.conf.all.rp_filter = 1 # ì—­ë°©í–¥ ê²½ë¡œ í•„í„°ë§ net.ipv4.conf.default.rp_filter = 1 net.ipv4.conf.all.log_martians = 1 # ë¹„ì •ìƒ íŒ¨í‚· ë¡œê¹… net.ipv4.conf.default.log_martians = 1 # SYN Flood ê³µê²© ë°©ì§€ net.ipv4.tcp_syncookies = 1 net.ipv4.tcp_max_syn_backlog = 2048 net.ipv4.tcp_synack_retries = 2 net.ipv4.tcp_syn_retries = 5 net.ipv4.tcp_fin_timeout = 15 net.ipv4.tcp_keepalive_time = 300 net.ipv4.tcp_keepalive_probes = 5 net.ipv4.tcp_keepalive_intvl = 15 # ICMP ë³´ì•ˆ net.ipv4.icmp_echo_ignore_broadcasts = 1 # ë¸Œë¡œë“œìºìŠ¤íŠ¸ ping ë¬´ì‹œ net.ipv4.icmp_ignore_bogus_error_responses = 1 # ì˜ëª»ëœ ICMP ì—ëŸ¬ ë¬´ì‹œ net.ipv4.icmp_echo_ignore_all = 0 # ì¼ë°˜ pingì€ í—ˆìš© (í•„ìš”ì‹œ 1ë¡œ ë³€ê²½) net.ipv4.icmp_ratelimit = 100 # ICMP ì†ë„ ì œí•œ # IPv6 ë³´ì•ˆ (IPv6 ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°) net.ipv6.conf.all.disable_ipv6 = 1 net.ipv6.conf.default.disable_ipv6 = 1 net.ipv6.conf.lo.disable_ipv6 = 1 # IPv6 ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì˜ ë³´ì•ˆ ì„¤ì • # net.ipv6.conf.all.accept_ra = 0 # ë¼ìš°í„° ê´‘ê³  ì°¨ë‹¨ # net.ipv6.conf.default.accept_ra = 0 # net.ipv6.conf.all.accept_redirects = 0 # IPv6 ë¦¬ë””ë ‰íŠ¸ ì°¨ë‹¨ # net.ipv6.conf.default.accept_redirects = 0 # net.ipv6.conf.all.accept_source_route = 0 # IPv6 ì†ŒìŠ¤ ë¼ìš°íŒ… ì°¨ë‹¨ # net.ipv6.conf.default.accept_source_route = 0 # ==================== ë©”ëª¨ë¦¬ ë³´ì•ˆ ==================== # ASLR (Address Space Layout Randomization) kernel.randomize_va_space = 2 # ì „ì²´ ì£¼ì†Œ ê³µê°„ ë¬´ì‘ìœ„í™” # ë©”ëª¨ë¦¬ ë³´í˜¸ vm.mmap_min_addr = 65536 # mmap ìµœì†Œ ì£¼ì†Œ (NULL í¬ì¸í„° ì—­ì°¸ì¡° ë°©ì§€) kernel.exec-shield = 1 # ì‹¤í–‰ ì‰´ë“œ í™œì„±í™” (ê°€ëŠ¥í•œ ê²½ìš°) kernel.dmesg_restrict = 1 # dmesg ì œí•œ (ì¼ë°˜ ì‚¬ìš©ì ì°¨ë‹¨) kernel.kptr_restrict = 2 # ì»¤ë„ í¬ì¸í„° ì •ë³´ ì œí•œ # ë©”ëª¨ë¦¬ í• ë‹¹ ë³´ì•ˆ vm.overcommit_memory = 2 # ë©”ëª¨ë¦¬ ì˜¤ë²„ì»¤ë°‹ ì œí•œ vm.overcommit_ratio = 80 # ì˜¤ë²„ì»¤ë°‹ ë¹„ìœ¨ 80% # ==================== í”„ë¡œì„¸ìŠ¤ ë³´ì•ˆ ==================== # ì½”ì–´ ë¤í”„ ë³´ì•ˆ fs.suid_dumpable = 0 # SUID í”„ë¡œê·¸ë¨ ì½”ì–´ ë¤í”„ ê¸ˆì§€ kernel.core_uses_pid = 1 # ì½”ì–´ íŒŒì¼ì— PID í¬í•¨ kernel.core_pattern = |/bin/false # ì½”ì–´ ë¤í”„ ì™„ì „ ë¹„í™œì„±í™” # í”„ë¡œì„¸ìŠ¤ ì œí•œ kernel.pid_max = 65536 # ìµœëŒ€ í”„ë¡œì„¸ìŠ¤ ID kernel.threads-max = 65536 # ìµœëŒ€ ìŠ¤ë ˆë“œ ìˆ˜ # ì‹œìŠ¤í…œ í˜¸ì¶œ ë³´ì•ˆ kernel.yama.ptrace_scope = 1 # ptrace ì œí•œ (ë””ë²„ê¹… ë°©ì§€) kernel.unprivileged_bpf_disabled = 1 # ë¹„íŠ¹ê¶Œ BPF ë¹„í™œì„±í™” net.core.bpf_jit_harden = 2 # BPF JIT ê°•í™” # ==================== íŒŒì¼ ì‹œìŠ¤í…œ ë³´ì•ˆ ==================== # íŒŒì¼ ì‹œìŠ¤í…œ ë³´ì•ˆ fs.protected_hardlinks = 1 # í•˜ë“œë§í¬ ë³´í˜¸ fs.protected_symlinks = 1 # ì‹¬ë³¼ë¦­ë§í¬ ë³´í˜¸ fs.protected_fifos = 2 # FIFO ë³´í˜¸ fs.protected_regular = 2 # ì¼ë°˜ íŒŒì¼ ë³´í˜¸ # íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ì œí•œ fs.file-max = 2097152 # ì‹œìŠ¤í…œ ì „ì²´ ìµœëŒ€ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° fs.nr_open = 1048576 # í”„ë¡œì„¸ìŠ¤ë‹¹ ìµœëŒ€ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° # ==================== ì‹œìŠ¤í…œ ì œì–´ ==================== # ì‹œìŠ¤í…œ í‚¤ ì¡°í•© ë¹„í™œì„±í™” kernel.sysrq = 0 # SysRq í‚¤ ë¹„í™œì„±í™” kernel.ctrl-alt-del = 0 # Ctrl+Alt+Del ë¹„í™œì„±í™” # ì»¤ë„ ëª¨ë“ˆ ë³´ì•ˆ kernel.modules_disabled = 1 # ëŸ°íƒ€ì„ ì»¤ë„ ëª¨ë“ˆ ë¡œë”© ë¹„í™œì„±í™” (ì‹ ì¤‘íˆ ì‚¬ìš©) kernel.kexec_load_disabled = 1 # kexec ë¹„í™œì„±í™” # ==================== ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ ë° ë³´ì•ˆ ==================== # ë„¤íŠ¸ì›Œí¬ ë²„í¼ í¬ê¸° net.core.rmem_default = 262144 net.core.rmem_max = 16777216 net.core.wmem_default = 262144 net.core.wmem_max = 16777216 # TCP ìœˆë„ìš° ìŠ¤ì¼€ì¼ë§ net.ipv4.tcp_window_scaling = 1 net.ipv4.tcp_rmem = 4096 87380 16777216 net.ipv4.tcp_wmem = 4096 65536 16777216 # ë„¤íŠ¸ì›Œí¬ í ì„¤ì • net.core.netdev_max_backlog = 5000 # ==================== ë¡œê¹… ë° ê°ì‚¬ ==================== # ì»¤ë„ ë¡œê¹… kernel.printk = 3 4 1 3 # ë¡œê¹… ë ˆë²¨ ì¡°ì • # ì„¤ì • ì ìš© ë° í™•ì¸ ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # /usr/local/bin/apply-sysctl-security.sh echo "Applying sysctl security settings..." # í˜„ì¬ ì„¤ì • ë°±ì—… sysctl -a &gt; /etc/sysctl.backup.$(date +%Y%m%d-%H%M%S) # ìƒˆ ì„¤ì • ì ìš© sysctl -p /etc/sysctl.d/99-security-hardening.conf # ì ìš© ê²°ê³¼ í™•ì¸ echo "=== Security Sysctl Settings Applied ===" echo "Network security:" sysctl net.ipv4.ip_forward net.ipv4.conf.all.accept_redirects net.ipv4.tcp_syncookies echo "Memory security:" sysctl kernel.randomize_va_space vm.mmap_min_addr kernel.dmesg_restrict echo "Process security:" sysctl fs.suid_dumpable kernel.yama.ptrace_scope kernel.unprivileged_bpf_disabled echo "File system security:" sysctl fs.protected_hardlinks fs.protected_symlinks echo "System control:" sysctl kernel.sysrq kernel.ctrl-alt-del echo "" echo "Settings applied successfully!" echo "Reboot recommended to ensure all settings take effect." ë‹¤ìŒ í¸ ì˜ˆê³  ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ì¹¨ì… íƒì§€ ì‹œìŠ¤í…œê³¼ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ì„ ìƒì„¸íˆ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤: AIDE íŒŒì¼ ë¬´ê²°ì„± ëª¨ë‹ˆí„°ë§ Fail2Ban ê³ ê¸‰ ì„¤ì • ë° ì»¤ìŠ¤í„°ë§ˆì´ì§• Wazuh SIEM êµ¬ì¶• ë° ìš´ì˜ ì‹¤ì‹œê°„ ìœ„í˜‘ íƒì§€ ë° ëŒ€ì‘ SELinux/AppArmorì™€ ì‹œìŠ¤í…œ í•˜ë“œë‹ì„ ì™„ë²½í•˜ê²Œ ë§ˆìŠ¤í„°í•˜ì…¨ë‚˜ìš”? ğŸ›¡ï¸ğŸ”’]]></summary></entry><entry><title type="html">ë„¤íŠ¸ì›Œí‚¹ ì™„ì „ ê°€ì´ë“œ 4í¸ - ë¬´ì„  ë„¤íŠ¸ì›Œí‚¹ê³¼ ìµœì‹  ê¸°ìˆ  | Complete Network Guide Part 4 - Wireless Networking &amp;amp; Modern Technologies</title><link href="https://leeyonghe.github.io/infra-blog/blog/2025/01/18/networking-guide-part4.html" rel="alternate" type="text/html" title="ë„¤íŠ¸ì›Œí‚¹ ì™„ì „ ê°€ì´ë“œ 4í¸ - ë¬´ì„  ë„¤íŠ¸ì›Œí‚¹ê³¼ ìµœì‹  ê¸°ìˆ  | Complete Network Guide Part 4 - Wireless Networking &amp;amp; Modern Technologies" /><published>2025-01-18T03:00:00+00:00</published><updated>2025-01-18T03:00:00+00:00</updated><id>https://leeyonghe.github.io/infra-blog/blog/2025/01/18/networking-guide-part4</id><content type="html" xml:base="https://leeyonghe.github.io/infra-blog/blog/2025/01/18/networking-guide-part4.html"><![CDATA[<p>ë¬´ì„  ë„¤íŠ¸ì›Œí‚¹ ê¸°ìˆ ê³¼ ìµœì‹  ë„¤íŠ¸ì›Œí¬ ê¸°ìˆ  ë™í–¥ì„ ê¹Šì´ ìˆê²Œ ì•Œì•„ë³´ê³  ì‹¤ë¬´ì— ì ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<h2 id="ë¬´ì„ -ë„¤íŠ¸ì›Œí‚¹-ê¸°ì´ˆ--wireless-networking-fundamentals">ë¬´ì„  ë„¤íŠ¸ì›Œí‚¹ ê¸°ì´ˆ | Wireless Networking Fundamentals</h2>

<h3 id="-ë¬´ì„ -í†µì‹ -ê¸°ë³¸-ê°œë…">ğŸ“¡ ë¬´ì„  í†µì‹  ê¸°ë³¸ ê°œë…</h3>

<h4 id="ì „íŒŒì˜-íŠ¹ì„±">ì „íŒŒì˜ íŠ¹ì„±</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì£¼íŒŒìˆ˜ ëŒ€ì—­ë³„ íŠ¹ì„±</span>
2.4GHz ëŒ€ì—­:
- ì „íŒŒ ë„ë‹¬ ê±°ë¦¬: ê¸¸ìŒ <span class="o">(</span>ë²½ íˆ¬ê³¼ë ¥ ì¢‹ìŒ<span class="o">)</span>
- ëŒ€ì—­í­: ì œí•œì  <span class="o">(</span>ìµœëŒ€ 3ê°œ ë¹„ê°„ì„­ ì±„ë„<span class="o">)</span>
- ê°„ì„­: ë§ìŒ <span class="o">(</span>ì „ìë ˆì¸ì§€, ë¸”ë£¨íˆ¬ìŠ¤ ë“±<span class="o">)</span>

5GHz ëŒ€ì—­:  
- ì „íŒŒ ë„ë‹¬ ê±°ë¦¬: ì§§ìŒ <span class="o">(</span>ì§ì§„ì„± ê°•í•¨<span class="o">)</span>
- ëŒ€ì—­í­: í’ë¶€ <span class="o">(</span>ìµœëŒ€ 25ê°œ ë¹„ê°„ì„­ ì±„ë„<span class="o">)</span>
- ê°„ì„­: ì ìŒ

6GHz ëŒ€ì—­ <span class="o">(</span>Wi-Fi 6E<span class="o">)</span>:
- ì „íŒŒ ë„ë‹¬ ê±°ë¦¬: ë§¤ìš° ì§§ìŒ
- ëŒ€ì—­í­: ë§¤ìš° í’ë¶€ <span class="o">(</span>59ê°œ 20MHz ì±„ë„<span class="o">)</span>
- ê°„ì„­: ê±°ì˜ ì—†ìŒ
</code></pre></div></div>

<h4 id="dbmê³¼-ì‹ í˜¸-ê°•ë„">dBmê³¼ ì‹ í˜¸ ê°•ë„</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># dBm ì°¸ì¡°í‘œ</span>
<span class="nt">-30</span> dBm: ë§¤ìš° ê°•í•¨ <span class="o">(</span>AP ë°”ë¡œ ì˜†<span class="o">)</span>
<span class="nt">-50</span> dBm: ê°•í•¨ <span class="o">(</span>ìš°ìˆ˜í•œ ì—°ê²°<span class="o">)</span>
<span class="nt">-60</span> dBm: ì¢‹ìŒ <span class="o">(</span>ì•ˆì •ì  ì—°ê²°<span class="o">)</span>
<span class="nt">-70</span> dBm: ì•½í•¨ <span class="o">(</span>ìµœì†Œ ì—°ê²° ê°€ëŠ¥<span class="o">)</span>
<span class="nt">-80</span> dBm: ë§¤ìš° ì•½í•¨ <span class="o">(</span>ì—°ê²° ë¶ˆì•ˆì •<span class="o">)</span>
<span class="nt">-90</span> dBm: ì—°ê²° ë¶ˆê°€

<span class="c"># ì‹ í˜¸ ê°•ë„ ì¸¡ì • (Linux)</span>
iwconfig wlan0
iw dev wlan0 scan | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"SSID|signal|freq"</span>
wavemon  <span class="c"># ì‹¤ì‹œê°„ ë¬´ì„  ëª¨ë‹ˆí„°ë§</span>
</code></pre></div></div>

<h3 id="-wi-fi-ë³´ì•ˆ-ê¸°ìˆ ">ğŸ” Wi-Fi ë³´ì•ˆ ê¸°ìˆ </h3>

<h4 id="ë³´ì•ˆ-í”„ë¡œí† ì½œ-ë°œì „ì‚¬">ë³´ì•ˆ í”„ë¡œí† ì½œ ë°œì „ì‚¬</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WEP <span class="o">(</span>Wired Equivalent Privacy<span class="o">)</span>:
- 1997ë…„ ë„ì…, í˜„ì¬ ì‚¬ìš© ê¸ˆì§€
- 40/104ë¹„íŠ¸ í‚¤ ê¸¸ì´
- RC4 ì•”í˜¸í™”, ì‰½ê²Œ í¬ë™ë¨

WPA <span class="o">(</span>Wi-Fi Protected Access<span class="o">)</span>:
- 2003ë…„ ë„ì…, WEPì˜ ì„ì‹œ ëŒ€ì•ˆ
- TKIP ì•”í˜¸í™”, RC4 ê¸°ë°˜
- ë™ì  í‚¤ ìƒì„±

WPA2 <span class="o">(</span>802.11i<span class="o">)</span>:
- 2004ë…„ ë„ì…, í˜„ì¬ í‘œì¤€
- AES-CCMP ì•”í˜¸í™”
- PSK<span class="o">(</span>ê°œì¸ìš©<span class="o">)</span> / Enterprise<span class="o">(</span>ê¸°ì—…ìš©<span class="o">)</span>

WPA3 <span class="o">(</span>2018ë…„ ë„ì…<span class="o">)</span>:
- SAE <span class="o">(</span>Simultaneous Authentication of Equals<span class="o">)</span>
- ê°œì„ ëœ ì˜¤í”ˆ ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ
- ë” ê°•ë ¥í•œ ì•”í˜¸í™” <span class="o">(</span>192ë¹„íŠ¸<span class="o">)</span>
</code></pre></div></div>

<h4 id="wpa2wpa3-enterprise-ì„¤ì •">WPA2/WPA3 Enterprise ì„¤ì •</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># FreeRADIUS ì„œë²„ ì„¤ì • (/etc/freeradius/clients.conf)</span>
client wireless-controller <span class="o">{</span>
    ipaddr <span class="o">=</span> 192.168.1.10
    secret <span class="o">=</span> radiusSecret123
    shortname <span class="o">=</span> wlc
<span class="o">}</span>

<span class="c"># ì‚¬ìš©ì ì¸ì¦ ì„¤ì • (/etc/freeradius/users)</span>
john    Cleartext-Password :<span class="o">=</span> <span class="s2">"password123"</span>
        Tunnel-Type <span class="o">=</span> VLAN,
        Tunnel-Medium-Type <span class="o">=</span> IEEE-802,
        Tunnel-Private-Group-Id <span class="o">=</span> 10

<span class="c"># ì¸ì¦ì„œ ê¸°ë°˜ ì„¤ì • (802.1X EAP-TLS)</span>
alice   TLS-Cert-Serial :<span class="o">=</span> <span class="s2">"1234567890"</span>
        Tunnel-Type <span class="o">=</span> VLAN,
        Tunnel-Medium-Type <span class="o">=</span> IEEE-802,
        Tunnel-Private-Group-Id <span class="o">=</span> 20

<span class="c"># Cisco WLC RADIUS ì„¤ì •</span>
<span class="o">(</span>Cisco Controller<span class="o">)</span> <span class="o">&gt;</span> configure terminal
<span class="o">(</span>Cisco Controller<span class="o">)</span> <span class="o">&gt;</span> radius auth add 1 192.168.1.100 1812 radiusSecret123
<span class="o">(</span>Cisco Controller<span class="o">)</span> <span class="o">&gt;</span> radius acct add 1 192.168.1.100 1813 radiusSecret123
<span class="o">(</span>Cisco Controller<span class="o">)</span> <span class="o">&gt;</span> wlan create 10 CORPORATE
<span class="o">(</span>Cisco Controller<span class="o">)</span> <span class="o">&gt;</span> wlan security 802.1x <span class="nb">enable </span>10
<span class="o">(</span>Cisco Controller<span class="o">)</span> <span class="o">&gt;</span> wlan security wpa akm 802.1x <span class="nb">enable </span>10
</code></pre></div></div>

<h3 id="-wi-fi-66e-ê¸°ìˆ ">ğŸ“¶ Wi-Fi 6/6E ê¸°ìˆ </h3>

<h4 id="wi-fi-6-80211ax-ì£¼ìš”-íŠ¹ì§•">Wi-Fi 6 (802.11ax) ì£¼ìš” íŠ¹ì§•</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OFDMA <span class="o">(</span>Orthogonal Frequency Division Multiple Access<span class="o">)</span>:
- ë‹¤ì¤‘ ì‚¬ìš©ì ë™ì‹œ ì „ì†¡
- íš¨ìœ¨ì ì¸ ìŠ¤í™íŠ¸ëŸ¼ ì‚¬ìš©
- ì§€ì—° ì‹œê°„ ê°ì†Œ

MU-MIMO <span class="o">(</span>Multi-User MIMO<span class="o">)</span>:
- ìµœëŒ€ 8x8 ì•ˆí…Œë‚˜ ì§€ì›
- ë‹¤ìš´ë§í¬/ì—…ë§í¬ ëª¨ë‘ ì§€ì›
- ë™ì‹œ ë‹¤ì¤‘ ì‚¬ìš©ì ì„œë¹„ìŠ¤

1024-QAM:
- 25% ë†’ì€ ë°ì´í„° ì „ì†¡ë¥ 
- ì‹ í˜¸ í’ˆì§ˆì´ ì¢‹ì€ í™˜ê²½ì—ì„œ íš¨ê³¼ì 

TWT <span class="o">(</span>Target Wake Time<span class="o">)</span>:
- IoT ë””ë°”ì´ìŠ¤ ë°°í„°ë¦¬ ìˆ˜ëª… ì—°ì¥
- ìŠ¤ì¼€ì¤„ë§ëœ í†µì‹ 
</code></pre></div></div>

<h4 id="wi-fi-6-ap-ì„¤ì •-ì‹¤ìŠµ">Wi-Fi 6 AP ì„¤ì • ì‹¤ìŠµ</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Cisco Wi-Fi 6 AP ì„¤ì •</span>
<span class="c"># 802.11ax í™œì„±í™”</span>
ap dot11 24ghz radio 1
 station-role root
 power <span class="nb">local </span>maximum 20
 channel width 80
 txpower auto

<span class="c"># OFDMA í™œì„±í™”  </span>
ap dot11 5ghz radio 2
 station-role root
 power <span class="nb">local </span>maximum 23
 channel width 160
 ofdma
 mu-mimo

<span class="c"># BSS Coloring ì„¤ì • (ê°„ì„­ ê°ì†Œ)</span>
wlan 10
 bss-color 1-63
 
<span class="c"># TWT ì„¤ì •</span>
ap name AP-WIFI6-01
 twt <span class="nb">enable</span>
</code></pre></div></div>

<h2 id="5gì™€-ì…€ë£°ëŸ¬-ê¸°ìˆ --5g-and-cellular-technology">5Gì™€ ì…€ë£°ëŸ¬ ê¸°ìˆ  | 5G and Cellular Technology</h2>

<h3 id="-5g-ê¸°ìˆ -ê°œìš”">ğŸ“± 5G ê¸°ìˆ  ê°œìš”</h3>

<h4 id="5g-ë„¤íŠ¸ì›Œí¬-ì•„í‚¤í…ì²˜">5G ë„¤íŠ¸ì›Œí¬ ì•„í‚¤í…ì²˜</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 5G í•µì‹¬ êµ¬ì„±ìš”ì†Œ</span>
RAN <span class="o">(</span>Radio Access Network<span class="o">)</span>:
- gNB <span class="o">(</span>5G Base Station<span class="o">)</span>
- CU <span class="o">(</span>Centralized Unit<span class="o">)</span>  
- DU <span class="o">(</span>Distributed Unit<span class="o">)</span>
- RU <span class="o">(</span>Radio Unit<span class="o">)</span>

Core Network <span class="o">(</span>5GC<span class="o">)</span>:
- AMF <span class="o">(</span>Access and Mobility Management Function<span class="o">)</span>
- SMF <span class="o">(</span>Session Management Function<span class="o">)</span>
- UPF <span class="o">(</span>User Plane Function<span class="o">)</span>
- AUSF <span class="o">(</span>Authentication Server Function<span class="o">)</span>
- UDM <span class="o">(</span>Unified Data Management<span class="o">)</span>

<span class="c"># 5G ì£¼íŒŒìˆ˜ ëŒ€ì—­</span>
Sub-6GHz <span class="o">(</span>FR1<span class="o">)</span>:
- ì €ì£¼íŒŒ: 600MHz ~ 6GHz
- ë„“ì€ ì»¤ë²„ë¦¬ì§€, ê±´ë¬¼ íˆ¬ê³¼ë ¥ ì¢‹ìŒ
- ìµœëŒ€ ì†ë„: 1Gbps

mmWave <span class="o">(</span>FR2<span class="o">)</span>:
- ê³ ì£¼íŒŒ: 24GHz ~ 100GHz  
- ì´ˆê³ ì†, ì´ˆì €ì§€ì—°
- ì»¤ë²„ë¦¬ì§€ ì œí•œì 
- ìµœëŒ€ ì†ë„: 10Gbps+
</code></pre></div></div>

<h4 id="5g-ë„¤íŠ¸ì›Œí¬-ìŠ¬ë¼ì´ì‹±">5G ë„¤íŠ¸ì›Œí¬ ìŠ¬ë¼ì´ì‹±</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ìŠ¬ë¼ì´ìŠ¤ ìœ í˜•ë³„ íŠ¹ì„±</span>
eMBB <span class="o">(</span>Enhanced Mobile Broadband<span class="o">)</span>:
- ë†’ì€ ëŒ€ì—­í­ <span class="o">(</span>20Gbps+<span class="o">)</span>  
- 4K/8K ë¹„ë””ì˜¤, AR/VR
- ì§€ì—°ì‹œê°„: 4ms ì´í•˜

URLLC <span class="o">(</span>Ultra-Reliable Low-Latency Communications<span class="o">)</span>:
- ì´ˆì €ì§€ì—° <span class="o">(</span>1ms<span class="o">)</span>
- 99.999% ì‹ ë¢°ì„±
- ììœ¨ì£¼í–‰, ì‚°ì—… ìë™í™”

mMTC <span class="o">(</span>Massive Machine Type Communications<span class="o">)</span>:  
- ëŒ€ëŸ‰ IoT ë””ë°”ì´ìŠ¤ <span class="o">(</span>1M/kmÂ²<span class="o">)</span>
- ì €ì „ë ¥, ì €ë¹„ìš©
- ìŠ¤ë§ˆíŠ¸ì‹œí‹°, ë†ì—… IoT
</code></pre></div></div>

<h3 id="-sd-wan-ê¸°ìˆ ">ğŸŒ SD-WAN ê¸°ìˆ </h3>

<p>SD-WANì€ ì†Œí”„íŠ¸ì›¨ì–´ ì •ì˜ ë°©ì‹ìœ¼ë¡œ WANì„ ê´€ë¦¬í•˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤.</p>

<h4 id="sd-wan-ì•„í‚¤í…ì²˜">SD-WAN ì•„í‚¤í…ì²˜</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># SD-WAN êµ¬ì„±ìš”ì†Œ</span>
Edge Device <span class="o">(</span>vCPE/uCPE<span class="o">)</span>:
- ì§€ì‚¬ì— ì„¤ì¹˜ë˜ëŠ” SD-WAN ì¥ë¹„
- íŠ¸ë˜í”½ ë¼ìš°íŒ… ë° ì •ì±… ì ìš©

Orchestrator:  
- ì¤‘ì•™ ì§‘ì¤‘ì‹ ê´€ë¦¬ í”Œë«í¼
- ì •ì±… ì„¤ì • ë° ë°°í¬

Controller:
- ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€ ê´€ë¦¬
- ê²½ë¡œ ìµœì í™” ê²°ì •

<span class="c"># ì „ì†¡ ë°©ì‹</span>
MPLS: ë†’ì€ í’ˆì§ˆ, ë†’ì€ ë¹„ìš©
Internet: ë‚®ì€ ë¹„ìš©, ê°€ë³€ì  í’ˆì§ˆ  
LTE/5G: ì´ë™ì„±, ë°±ì—…ìš©
</code></pre></div></div>

<h4 id="sd-wan-êµ¬í˜„-velocloudvmware">SD-WAN êµ¬í˜„ (VeloCloud/VMware)</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Edge ì„¤ì • ì˜ˆì‹œ</span>
<span class="c"># WAN ì¸í„°í˜ì´ìŠ¤ ì„¤ì •</span>
configure
interface GE1
 ip dhcp
 wan-interface internet1
 <span class="nb">exit

</span>interface GE2  
 ip address 10.1.1.1/30
 wan-interface mpls1
 <span class="nb">exit</span>

<span class="c"># ë¹„ì¦ˆë‹ˆìŠ¤ ì •ì±… ì„¤ì •</span>
business-policy VOICE
 application-classification voice
 sla latency 150
 sla jitter 30
 sla loss 1
 path-preference mpls1
 path-preference internet1

<span class="c"># ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ë°˜ ë¼ìš°íŒ…</span>
application-map
 application office365 path internet1
 application salesforce path internet1
 application voice path mpls1
 application video path mpls1
</code></pre></div></div>

<h4 id="open-source-sd-wan-flexiwan">Open Source SD-WAN (FlexiWAN)</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># FlexiWAN Agent ì„¤ì¹˜</span>
curl <span class="nt">-s</span> https://get.flexiwan.com | <span class="nb">sudo </span>bash

<span class="c"># ë””ë°”ì´ìŠ¤ ë“±ë¡</span>
flexiwan-mgmt device register <span class="nt">--token</span> &lt;registration-token&gt;

<span class="c"># ì¸í„°í˜ì´ìŠ¤ ì„¤ì •</span>
<span class="o">{</span>
  <span class="s2">"interfaces"</span>: <span class="o">[</span>
    <span class="o">{</span>
      <span class="s2">"name"</span>: <span class="s2">"eth0"</span>,
      <span class="s2">"type"</span>: <span class="s2">"WAN"</span>, 
      <span class="s2">"dhcp"</span>: <span class="s2">"yes"</span>,
      <span class="s2">"metric"</span>: 100
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">"name"</span>: <span class="s2">"eth1"</span>,
      <span class="s2">"type"</span>: <span class="s2">"LAN"</span>,
      <span class="s2">"addr"</span>: <span class="s2">"192.168.1.1/24"</span>
    <span class="o">}</span>
  <span class="o">]</span>
<span class="o">}</span>

<span class="c"># í„°ë„ ì„¤ì •</span>
<span class="o">{</span>
  <span class="s2">"tunnels"</span>: <span class="o">[</span>
    <span class="o">{</span>
      <span class="s2">"num"</span>: 1,
      <span class="s2">"peer"</span>: <span class="s2">"203.0.113.2"</span>,
      <span class="s2">"peer_port"</span>: 4789,
      <span class="s2">"local_port"</span>: 4789,
      <span class="s2">"encryption"</span>: <span class="s2">"yes"</span>
    <span class="o">}</span>
  <span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="ë„¤íŠ¸ì›Œí¬-ê°€ìƒí™”--network-virtualization">ë„¤íŠ¸ì›Œí¬ ê°€ìƒí™” | Network Virtualization</h2>

<h3 id="-sdn-software-defined-networking">ğŸ”€ SDN (Software Defined Networking)</h3>

<h4 id="openflow-ê¸°ë³¸-ê°œë…">OpenFlow ê¸°ë³¸ ê°œë…</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># OpenFlow ìŠ¤ìœ„ì¹˜ êµ¬ì¡°</span>
Flow Table â†’ Group Table â†’ Meter Table

<span class="c"># Flow Entry êµ¬ì„±</span>
Match Fields: íŒ¨í‚· ë§¤ì¹­ ì¡°ê±´
Instructions: ìˆ˜í–‰í•  ë™ì‘  
Counters: í†µê³„ ì •ë³´
Timeouts: íƒ€ì„ì•„ì›ƒ ì„¤ì •
Priority: ìš°ì„ ìˆœìœ„

<span class="c"># OpenFlow ë©”ì‹œì§€ ìœ í˜•</span>
Controller-to-Switch:
- Flow-Mod: í”Œë¡œìš° í…Œì´ë¸” ìˆ˜ì •
- Group-Mod: ê·¸ë£¹ í…Œì´ë¸” ìˆ˜ì •
- Port-Mod: í¬íŠ¸ ì„¤ì • ìˆ˜ì •

Switch-to-Controller:
- Packet-In: ë§¤ì¹­ë˜ì§€ ì•Šì€ íŒ¨í‚· ì „ì†¡
- Flow-Removed: í”Œë¡œìš° ì œê±° ì•Œë¦¼
</code></pre></div></div>

<h4 id="opendaylight-ì»¨íŠ¸ë¡¤ëŸ¬-ì„¤ì •">OpenDaylight ì»¨íŠ¸ë¡¤ëŸ¬ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># OpenDaylight ì„¤ì¹˜</span>
wget https://nexus.opendaylight.org/content/repositories/opendaylight.release/org/opendaylight/integration/karaf/0.13.3/karaf-0.13.3.tar.gz
<span class="nb">tar</span> <span class="nt">-xzf</span> karaf-0.13.3.tar.gz
<span class="nb">cd </span>karaf-0.13.3

<span class="c"># ì»¨íŠ¸ë¡¤ëŸ¬ ì‹œì‘</span>
./bin/karaf

<span class="c"># í•„ìˆ˜ í”¼ì²˜ ì„¤ì¹˜</span>
opendaylight-user@root&gt; feature:install odl-restconf odl-l2switch-switch-ui odl-mdsal-apidocs

<span class="c"># REST APIë¥¼ í†µí•œ í”Œë¡œìš° ì¶”ê°€</span>
curl <span class="nt">-u</span> admin:admin <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="nt">-X</span> PUT <span class="se">\</span>
http://localhost:8181/restconf/config/opendaylight-inventory:nodes/node/openflow:1/flow-node-inventory:table/0/flow/1 <span class="se">\</span>
<span class="nt">-d</span> <span class="s1">'{
  "flow": [
    {
      "id": "1",
      "match": {
        "ethernet-match": {
          "ethernet-type": {
            "type": 2048
          }
        },
        "ipv4-destination": "192.168.1.100/32"
      },
      "instructions": {
        "instruction": [
          {
            "order": 0,
            "apply-actions": {
              "action": [
                {
                  "order": 0,
                  "output-action": {
                    "output-node-connector": "2"
                  }
                }
              ]
            }
          }
        ]
      }
    }
  ]
}'</span>
</code></pre></div></div>

<h3 id="ï¸-ë„¤íŠ¸ì›Œí¬-í•¨ìˆ˜-ê°€ìƒí™”-nfv">â˜ï¸ ë„¤íŠ¸ì›Œí¬ í•¨ìˆ˜ ê°€ìƒí™” (NFV)</h3>

<h4 id="vnf-virtual-network-function-êµ¬í˜„">VNF (Virtual Network Function) êµ¬í˜„</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ê°€ìƒ ë¼ìš°í„° (VyOS) ë°°í¬</span>
<span class="c"># Docker ì»¨í…Œì´ë„ˆë¡œ ë°°í¬</span>
docker run <span class="nt">-d</span> <span class="nt">--name</span> vyos-router <span class="se">\</span>
  <span class="nt">--privileged</span> <span class="se">\</span>
  <span class="nt">--cap-add</span><span class="o">=</span>NET_ADMIN <span class="se">\</span>
  <span class="nt">-v</span> /lib/modules:/lib/modules:ro <span class="se">\</span>
  vyos/vyos:1.3

<span class="c"># ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì„¤ì •</span>
ip netns add router-ns
ip <span class="nb">link </span>add veth0 <span class="nb">type </span>veth peer name veth1
ip <span class="nb">link set </span>veth1 netns router-ns
ip netns <span class="nb">exec </span>router-ns ip addr add 10.0.1.1/24 dev veth1
ip netns <span class="nb">exec </span>router-ns ip <span class="nb">link set </span>veth1 up

<span class="c"># ê°€ìƒ ë°©í™”ë²½ (iptables ê¸°ë°˜)</span>
<span class="c">#!/bin/bash</span>
<span class="c"># Virtual Firewall Function</span>
iptables <span class="nt">-F</span>
iptables <span class="nt">-P</span> INPUT DROP
iptables <span class="nt">-P</span> FORWARD DROP  
iptables <span class="nt">-P</span> OUTPUT ACCEPT

<span class="c"># í—ˆìš© ê·œì¹™</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-i</span> lo <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> INPUT <span class="nt">-m</span> state <span class="nt">--state</span> ESTABLISHED,RELATED <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 22 <span class="nt">-s</span> 192.168.1.0/24 <span class="nt">-j</span> ACCEPT

<span class="c"># í¬ì›Œë”© ê·œì¹™</span>
iptables <span class="nt">-A</span> FORWARD <span class="nt">-i</span> eth0 <span class="nt">-o</span> eth1 <span class="nt">-m</span> state <span class="nt">--state</span> ESTABLISHED,RELATED <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> FORWARD <span class="nt">-i</span> eth1 <span class="nt">-o</span> eth0 <span class="nt">-j</span> ACCEPT

<span class="c"># NAT ì„¤ì •</span>
iptables <span class="nt">-t</span> nat <span class="nt">-A</span> POSTROUTING <span class="nt">-o</span> eth0 <span class="nt">-j</span> MASQUERADE
</code></pre></div></div>

<h2 id="ì—£ì§€-ì»´í“¨íŒ…--edge-computing">ì—£ì§€ ì»´í“¨íŒ… | Edge Computing</h2>

<h3 id="ï¸-mec-multi-access-edge-computing">ğŸ—ï¸ MEC (Multi-access Edge Computing)</h3>

<h4 id="mec-í”Œë«í¼-êµ¬ì¡°">MEC í”Œë«í¼ êµ¬ì¡°</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># MEC êµ¬ì„±ìš”ì†Œ</span>
MEC Platform:
- ì• í”Œë¦¬ì¼€ì´ì…˜ ë¼ì´í”„ì‚¬ì´í´ ê´€ë¦¬
- ì„œë¹„ìŠ¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ë° ë°œê²¬
- íŠ¸ë˜í”½ ë¼ìš°íŒ…

MEC Apps:
- ì‹¤ì‹œê°„ ë¹„ë””ì˜¤ ë¶„ì„
- AR/VR ì• í”Œë¦¬ì¼€ì´ì…˜  
- IoT ë°ì´í„° ì²˜ë¦¬

<span class="c"># MEC ë°°í¬ ì‹œë‚˜ë¦¬ì˜¤</span>
Corporate Edge: ê¸°ì—… ìº í¼ìŠ¤
Service Provider Edge: í†µì‹ ì‚¬ CO
Access Edge: ê¸°ì§€êµ­, Wi-Fi AP
Device Edge: CPE, ê²Œì´íŠ¸ì›¨ì´
</code></pre></div></div>

<h4 id="kubernetes-ê¸°ë°˜-ì—£ì§€-ì»´í“¨íŒ…">Kubernetes ê¸°ë°˜ ì—£ì§€ ì»´í“¨íŒ…</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Edge Node ì„¤ì •</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Node</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">edge-node-01</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">node-type</span><span class="pi">:</span> <span class="s">edge</span>
    <span class="na">location</span><span class="pi">:</span> <span class="s">branch-office</span>
    <span class="na">kubernetes.io/arch</span><span class="pi">:</span> <span class="s">arm64</span>

<span class="c1"># Edge ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">video-analytics</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">video-analytics</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">video-analytics</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">nodeSelector</span><span class="pi">:</span>
        <span class="na">node-type</span><span class="pi">:</span> <span class="s">edge</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">analytics</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">video-analytics:latest</span>
        <span class="na">resources</span><span class="pi">:</span>
          <span class="na">limits</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1Gi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">500m"</span>
          <span class="na">requests</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">512Mi"</span> 
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">250m"</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">CAMERA_URL</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">rtsp://192.168.1.100:554/stream"</span>
</code></pre></div></div>

<h2 id="ë„¤íŠ¸ì›Œí¬-ìë™í™”--network-automation">ë„¤íŠ¸ì›Œí¬ ìë™í™” | Network Automation</h2>

<h3 id="-ansible-ë„¤íŠ¸ì›Œí¬-ìë™í™”">ğŸ¤– Ansible ë„¤íŠ¸ì›Œí¬ ìë™í™”</h3>

<h4 id="ë„¤íŠ¸ì›Œí¬-ì¸ë²¤í† ë¦¬-ì„¤ì •">ë„¤íŠ¸ì›Œí¬ ì¸ë²¤í† ë¦¬ ì„¤ì •</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># inventory.yml</span>
<span class="na">all</span><span class="pi">:</span>
  <span class="na">children</span><span class="pi">:</span>
    <span class="na">routers</span><span class="pi">:</span>
      <span class="na">hosts</span><span class="pi">:</span>
        <span class="na">router01</span><span class="pi">:</span>
          <span class="na">ansible_host</span><span class="pi">:</span> <span class="s">192.168.1.1</span>
          <span class="na">ansible_network_os</span><span class="pi">:</span> <span class="s">ios</span>
        <span class="na">router02</span><span class="pi">:</span>
          <span class="na">ansible_host</span><span class="pi">:</span> <span class="s">192.168.1.2</span>
          <span class="na">ansible_network_os</span><span class="pi">:</span> <span class="s">ios</span>
    <span class="na">switches</span><span class="pi">:</span>
      <span class="na">hosts</span><span class="pi">:</span>
        <span class="na">switch01</span><span class="pi">:</span>
          <span class="na">ansible_host</span><span class="pi">:</span> <span class="s">192.168.1.10</span>
          <span class="na">ansible_network_os</span><span class="pi">:</span> <span class="s">ios</span>
        <span class="na">switch02</span><span class="pi">:</span>
          <span class="na">ansible_host</span><span class="pi">:</span> <span class="s">192.168.1.11</span>
          <span class="na">ansible_network_os</span><span class="pi">:</span> <span class="s">ios</span>

  <span class="na">vars</span><span class="pi">:</span>
    <span class="na">ansible_connection</span><span class="pi">:</span> <span class="s">network_cli</span>
    <span class="na">ansible_user</span><span class="pi">:</span> <span class="s">admin</span>
    <span class="na">ansible_ssh_pass</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">ansible_become</span><span class="pi">:</span> <span class="s">yes</span>
    <span class="na">ansible_become_method</span><span class="pi">:</span> <span class="s">enable</span>
    <span class="na">ansible_become_pass</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
</code></pre></div></div>

<h4 id="vlan-ìë™-ë°°í¬-í”Œë ˆì´ë¶">VLAN ìë™ ë°°í¬ í”Œë ˆì´ë¶</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># deploy-vlans.yml</span>
<span class="nn">---</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Configure VLANs across switches</span>
  <span class="na">hosts</span><span class="pi">:</span> <span class="s">switches</span>
  <span class="na">gather_facts</span><span class="pi">:</span> <span class="s">no</span>
  <span class="na">vars</span><span class="pi">:</span>
    <span class="na">vlans</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="m">10</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">SALES</span>
        <span class="na">ports</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">1</span><span class="pi">,</span> <span class="nv">2</span><span class="pi">,</span> <span class="nv">3</span><span class="pi">,</span> <span class="nv">4</span><span class="pi">,</span> <span class="nv">5</span><span class="pi">]</span>
      <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="m">20</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">ENGINEERING</span>  
        <span class="na">ports</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">6</span><span class="pi">,</span> <span class="nv">7</span><span class="pi">,</span> <span class="nv">8</span><span class="pi">,</span> <span class="nv">9</span><span class="pi">,</span> <span class="nv">10</span><span class="pi">]</span>
      <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="m">30</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">GUEST</span>
        <span class="na">ports</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">11</span><span class="pi">,</span> <span class="nv">12</span><span class="pi">]</span>

  <span class="na">tasks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Create VLANs</span>
      <span class="na">ios_vlan</span><span class="pi">:</span>
        <span class="na">vlan_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">state</span><span class="pi">:</span> <span class="s">present</span>
      <span class="na">loop</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Configure access ports</span>
      <span class="na">ios_l2_interfaces</span><span class="pi">:</span>
        <span class="na">config</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">FastEthernet0/"</span>
            <span class="na">access</span><span class="pi">:</span>
              <span class="na">vlan</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">with_subelements</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">"</span>
        <span class="pi">-</span> <span class="s">ports</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Configure trunk port</span>
      <span class="na">ios_l2_interfaces</span><span class="pi">:</span>
        <span class="na">config</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">FastEthernet0/24</span>
            <span class="na">trunk</span><span class="pi">:</span>
              <span class="na">allowed_vlans</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10,20,30"</span>
              <span class="na">native_vlan</span><span class="pi">:</span> <span class="m">1</span>
</code></pre></div></div>

<h3 id="-python-ë„¤íŠ¸ì›Œí¬-ìë™í™”">ğŸ Python ë„¤íŠ¸ì›Œí¬ ìë™í™”</h3>

<h4 id="napalmì„-ì´ìš©í•œ-ë„¤íŠ¸ì›Œí¬-ê´€ë¦¬">NAPALMì„ ì´ìš©í•œ ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">napalm</span> <span class="kn">import</span> <span class="n">get_network_driver</span>
<span class="kn">import</span> <span class="n">json</span>

<span class="c1"># ë””ë°”ì´ìŠ¤ ì—°ê²° ì„¤ì •
</span><span class="n">driver</span> <span class="o">=</span> <span class="nf">get_network_driver</span><span class="p">(</span><span class="sh">'</span><span class="s">ios</span><span class="sh">'</span><span class="p">)</span>
<span class="n">device</span> <span class="o">=</span> <span class="nf">driver</span><span class="p">(</span><span class="sh">'</span><span class="s">192.168.1.1</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">admin</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">password</span><span class="sh">'</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># ë””ë°”ì´ìŠ¤ ì—°ê²°
</span>    <span class="n">device</span><span class="p">.</span><span class="nf">open</span><span class="p">()</span>
    
    <span class="c1"># ì¸í„°í˜ì´ìŠ¤ ì •ë³´ ìˆ˜ì§‘
</span>    <span class="n">interfaces</span> <span class="o">=</span> <span class="n">device</span><span class="p">.</span><span class="nf">get_interfaces</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">interfaces</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># ë¼ìš°íŒ… í…Œì´ë¸” í™•ì¸
</span>    <span class="n">routes</span> <span class="o">=</span> <span class="n">device</span><span class="p">.</span><span class="nf">get_route_to</span><span class="p">(</span><span class="sh">'</span><span class="s">8.8.8.8</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">routes</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># ì„¤ì • ë³€ê²½ (ACL ì¶”ê°€)
</span>    <span class="n">config</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
    ip access-list extended BLOCK_SOCIAL
    deny tcp any host 23.35.67.140 eq 80
    permit ip any any
    </span><span class="sh">"""</span>
    
    <span class="c1"># ì„¤ì • ë¡œë“œ (ì•„ì§ ì ìš©í•˜ì§€ ì•ŠìŒ)
</span>    <span class="n">device</span><span class="p">.</span><span class="nf">load_merge_candidate</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
    
    <span class="c1"># ì„¤ì • ì°¨ì´ í™•ì¸
</span>    <span class="n">diff</span> <span class="o">=</span> <span class="n">device</span><span class="p">.</span><span class="nf">compare_config</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Configuration diff:</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
        
        <span class="c1"># ì‚¬ìš©ì í™•ì¸ í›„ ì ìš©
</span>        <span class="n">confirm</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">Apply configuration? (y/n): </span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">confirm</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">'</span><span class="s">y</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">device</span><span class="p">.</span><span class="nf">commit_config</span><span class="p">()</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Configuration applied successfully</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">device</span><span class="p">.</span><span class="nf">discard_config</span><span class="p">()</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Configuration discarded</span><span class="sh">"</span><span class="p">)</span>
    
<span class="k">finally</span><span class="p">:</span>
    <span class="n">device</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre></div></div>

<h4 id="netmikoë¥¼-ì´ìš©í•œ-ëŒ€ëŸ‰-ì„¤ì •">Netmikoë¥¼ ì´ìš©í•œ ëŒ€ëŸ‰ ì„¤ì •</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">netmiko</span> <span class="kn">import</span> <span class="n">ConnectHandler</span>
<span class="kn">from</span> <span class="n">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="kn">import</span> <span class="n">threading</span>

<span class="c1"># ë””ë°”ì´ìŠ¤ ë¦¬ìŠ¤íŠ¸
</span><span class="n">devices</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="sh">'</span><span class="s">device_type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">cisco_ios</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">host</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">192.168.1.1</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">admin</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">password</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">password</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">hostname</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Router01</span><span class="sh">'</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="sh">'</span><span class="s">device_type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">cisco_ios</span><span class="sh">'</span><span class="p">,</span> 
        <span class="sh">'</span><span class="s">host</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">192.168.1.2</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">admin</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">password</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">password</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">hostname</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Router02</span><span class="sh">'</span>
    <span class="p">}</span>
<span class="p">]</span>

<span class="k">def</span> <span class="nf">configure_device</span><span class="p">(</span><span class="n">device</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ê°œë³„ ë””ë°”ì´ìŠ¤ ì„¤ì • í•¨ìˆ˜</span><span class="sh">"""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># SSH ì—°ê²°
</span>        <span class="n">connection</span> <span class="o">=</span> <span class="nc">ConnectHandler</span><span class="p">(</span><span class="o">**</span><span class="n">device</span><span class="p">)</span>
        
        <span class="c1"># NTP ì„œë²„ ì„¤ì •
</span>        <span class="n">ntp_config</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sh">'</span><span class="s">ntp server 192.168.1.100</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">ntp server 8.8.8.8</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">clock timezone KST 9 0</span><span class="sh">'</span>
        <span class="p">]</span>
        
        <span class="c1"># ì„¤ì • ì ìš©
</span>        <span class="n">output</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="nf">send_config_set</span><span class="p">(</span><span class="n">ntp_config</span><span class="p">)</span>
        
        <span class="c1"># SNMP ì„¤ì •
</span>        <span class="n">snmp_config</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sh">'</span><span class="s">snmp-server community public ro</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">snmp-server host 192.168.1.200 version 2c public</span><span class="sh">'</span>
        <span class="p">]</span>
        
        <span class="n">output</span> <span class="o">+=</span> <span class="n">connection</span><span class="p">.</span><span class="nf">send_config_set</span><span class="p">(</span><span class="n">snmp_config</span><span class="p">)</span>
        
        <span class="c1"># ì„¤ì • ì €ì¥
</span>        <span class="n">save_output</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="nf">save_config</span><span class="p">()</span>
        
        <span class="n">connection</span><span class="p">.</span><span class="nf">disconnect</span><span class="p">()</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">âœ… </span><span class="si">{</span><span class="n">device</span><span class="p">[</span><span class="sh">'</span><span class="s">hostname</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">: Configuration completed</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
        
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">âŒ </span><span class="si">{</span><span class="n">device</span><span class="p">[</span><span class="sh">'</span><span class="s">hostname</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">: Error - </span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="c1"># ë³‘ë ¬ ì‹¤í–‰
</span><span class="k">with</span> <span class="nc">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">executor</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="n">configure_device</span><span class="p">,</span> <span class="n">devices</span><span class="p">))</span>

<span class="n">success_count</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">ì™„ë£Œ: </span><span class="si">{</span><span class="n">success_count</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span><span class="si">}</span><span class="s"> ë””ë°”ì´ìŠ¤</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="-ë„¤íŠ¸ì›Œí¬-ëª¨ë‹ˆí„°ë§-ìë™í™”">ğŸ“Š ë„¤íŠ¸ì›Œí¬ ëª¨ë‹ˆí„°ë§ ìë™í™”</h3>

<h4 id="prometheus--grafana-ëª¨ë‹ˆí„°ë§">Prometheus + Grafana ëª¨ë‹ˆí„°ë§</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># prometheus.yml</span>
<span class="na">global</span><span class="pi">:</span>
  <span class="na">scrape_interval</span><span class="pi">:</span> <span class="s">15s</span>

<span class="na">scrape_configs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">snmp-devices'</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">192.168.1.1</span>  <span class="c1"># Router01</span>
        <span class="pi">-</span> <span class="s">192.168.1.2</span>  <span class="c1"># Router02</span>
        <span class="pi">-</span> <span class="s">192.168.1.10</span> <span class="c1"># Switch01</span>
    <span class="na">metrics_path</span><span class="pi">:</span> <span class="s">/snmp</span>
    <span class="na">params</span><span class="pi">:</span>
      <span class="na">module</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">if_mib</span><span class="pi">]</span>
    <span class="na">relabel_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">source_labels</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">__address__</span><span class="pi">]</span>
        <span class="na">target_label</span><span class="pi">:</span> <span class="s">__param_target</span>
      <span class="pi">-</span> <span class="na">source_labels</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">__param_target</span><span class="pi">]</span>
        <span class="na">target_label</span><span class="pi">:</span> <span class="s">instance</span>
      <span class="pi">-</span> <span class="na">target_label</span><span class="pi">:</span> <span class="s">__address__</span>
        <span class="na">replacement</span><span class="pi">:</span> <span class="s">192.168.1.100:9116</span>  <span class="c1"># SNMP Exporter</span>

  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">snmp-exporter'</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">192.168.1.100:9116'</span><span class="pi">]</span>
</code></pre></div></div>

<h4 id="ë„¤íŠ¸ì›Œí¬-ì¥ì• -ì•Œë¦¼-ìë™í™”">ë„¤íŠ¸ì›Œí¬ ì¥ì•  ì•Œë¦¼ ìë™í™”</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">smtplib</span>
<span class="kn">from</span> <span class="n">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>
<span class="kn">import</span> <span class="n">time</span>

<span class="k">class</span> <span class="nc">NetworkMonitor</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Router01</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ip</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">192.168.1.1</span><span class="sh">'</span><span class="p">},</span>
            <span class="p">{</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Switch01</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ip</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">192.168.1.10</span><span class="sh">'</span><span class="p">},</span>
            <span class="p">{</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">AP01</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ip</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">192.168.1.20</span><span class="sh">'</span><span class="p">}</span>
        <span class="p">]</span>
        <span class="n">self</span><span class="p">.</span><span class="n">previous_status</span> <span class="o">=</span> <span class="p">{}</span>
        
    <span class="k">def</span> <span class="nf">check_device</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">SNMP ë˜ëŠ” PINGìœ¼ë¡œ ë””ë°”ì´ìŠ¤ ìƒíƒœ í™•ì¸</span><span class="sh">"""</span>
        <span class="kn">import</span> <span class="n">subprocess</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># PING í…ŒìŠ¤íŠ¸
</span>            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span>
                <span class="p">[</span><span class="sh">'</span><span class="s">ping</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">-c</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">3</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">-W</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">3</span><span class="sh">'</span><span class="p">,</span> <span class="n">device</span><span class="p">[</span><span class="sh">'</span><span class="s">ip</span><span class="sh">'</span><span class="p">]],</span> 
                <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span>
            <span class="p">)</span>
            
            <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="sh">'</span><span class="s">UP</span><span class="sh">'</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="sh">'</span><span class="s">DOWN</span><span class="sh">'</span>
                
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error checking </span><span class="si">{</span><span class="n">device</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="sh">'</span><span class="s">ERROR</span><span class="sh">'</span>
    
    <span class="k">def</span> <span class="nf">send_alert</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Slack ë˜ëŠ” ì´ë©”ì¼ë¡œ ì•Œë¦¼ ì „ì†¡</span><span class="sh">"""</span>
        <span class="c1"># Slack ì•Œë¦¼
</span>        <span class="n">webhook_url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">https://hooks.slack.com/services/YOUR/WEBHOOK/URL</span><span class="sh">"</span>
        
        <span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">text</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="s">ğŸš¨ Network Alert: </span><span class="si">{</span><span class="n">device</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s"> is </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">attachments</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="sh">"</span><span class="s">color</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">danger</span><span class="sh">"</span> <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="sh">'</span><span class="s">DOWN</span><span class="sh">'</span> <span class="k">else</span> <span class="sh">"</span><span class="s">good</span><span class="sh">"</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">fields</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Device</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="n">device</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">],</span> <span class="sh">"</span><span class="s">short</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
                        <span class="p">{</span><span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">IP</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="n">device</span><span class="p">[</span><span class="sh">'</span><span class="s">ip</span><span class="sh">'</span><span class="p">],</span> <span class="sh">"</span><span class="s">short</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
                        <span class="p">{</span><span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Status</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span> <span class="sh">"</span><span class="s">short</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
                        <span class="p">{</span><span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">"</span><span class="s">%Y-%m-%d %H:%M:%S</span><span class="sh">"</span><span class="p">),</span> <span class="sh">"</span><span class="s">short</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">webhook_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Alert sent for </span><span class="si">{</span><span class="n">device</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to send alert: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">monitor_loop</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë©”ì¸ ëª¨ë‹ˆí„°ë§ ë£¨í”„</span><span class="sh">"""</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">devices</span><span class="p">:</span>
                <span class="n">current_status</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">check_device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
                <span class="n">previous_status</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">previous_status</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">],</span> <span class="sh">'</span><span class="s">UP</span><span class="sh">'</span><span class="p">)</span>
                
                <span class="c1"># ìƒíƒœ ë³€í™” ê°ì§€
</span>                <span class="k">if</span> <span class="n">current_status</span> <span class="o">!=</span> <span class="n">previous_status</span><span class="p">:</span>
                    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">device</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s"> status changed: </span><span class="si">{</span><span class="n">previous_status</span><span class="si">}</span><span class="s"> -&gt; </span><span class="si">{</span><span class="n">current_status</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                    <span class="n">self</span><span class="p">.</span><span class="nf">send_alert</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">current_status</span><span class="p">)</span>
                    
                <span class="n">self</span><span class="p">.</span><span class="n">previous_status</span><span class="p">[</span><span class="n">device</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">current_status</span>
                
            <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>  <span class="c1"># 1ë¶„ë§ˆë‹¤ ì²´í¬
</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">monitor</span> <span class="o">=</span> <span class="nc">NetworkMonitor</span><span class="p">()</span>
    <span class="n">monitor</span><span class="p">.</span><span class="nf">monitor_loop</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="ë‹¤ìŒ-í¸-ì˜ˆê³ ">ë‹¤ìŒ í¸ ì˜ˆê³ </h2>

<p>ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” <strong>ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆê³¼ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…</strong>ì˜ ê³ ê¸‰ ì£¼ì œë“¤ì„ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤:</p>
<ul>
  <li>ì°¨ì„¸ëŒ€ ë°©í™”ë²½ê³¼ IDS/IPS</li>
  <li>ë„¤íŠ¸ì›Œí¬ í¬ë Œì‹ê³¼ ìœ„í˜‘ í—ŒíŒ…</li>
  <li>ì œë¡œ íŠ¸ëŸ¬ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ ì•„í‚¤í…ì²˜</li>
  <li>ê³ ê¸‰ ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ í•´ê²° ê¸°ë²•</li>
</ul>

<p>ë¬´ì„  ë„¤íŠ¸ì›Œí‚¹ê³¼ ìµœì‹  ê¸°ìˆ ë“¤ì„ ë§ˆìŠ¤í„°í•˜ì…¨ë‚˜ìš”? ğŸŒâœ¨</p>]]></content><author><name>DevOps Engineer</name></author><category term="Networking" /><category term="Wireless" /><category term="wifi" /><category term="wireless" /><category term="5g" /><category term="sd-wan" /><category term="network-automation" /><category term="edge-computing" /><category term="wifi6" /><summary type="html"><![CDATA[ë¬´ì„  ë„¤íŠ¸ì›Œí‚¹ ê¸°ìˆ ê³¼ ìµœì‹  ë„¤íŠ¸ì›Œí¬ ê¸°ìˆ  ë™í–¥ì„ ê¹Šì´ ìˆê²Œ ì•Œì•„ë³´ê³  ì‹¤ë¬´ì— ì ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤. ë¬´ì„  ë„¤íŠ¸ì›Œí‚¹ ê¸°ì´ˆ | Wireless Networking Fundamentals ğŸ“¡ ë¬´ì„  í†µì‹  ê¸°ë³¸ ê°œë… ì „íŒŒì˜ íŠ¹ì„± # ì£¼íŒŒìˆ˜ ëŒ€ì—­ë³„ íŠ¹ì„± 2.4GHz ëŒ€ì—­: - ì „íŒŒ ë„ë‹¬ ê±°ë¦¬: ê¸¸ìŒ (ë²½ íˆ¬ê³¼ë ¥ ì¢‹ìŒ) - ëŒ€ì—­í­: ì œí•œì  (ìµœëŒ€ 3ê°œ ë¹„ê°„ì„­ ì±„ë„) - ê°„ì„­: ë§ìŒ (ì „ìë ˆì¸ì§€, ë¸”ë£¨íˆ¬ìŠ¤ ë“±) 5GHz ëŒ€ì—­: - ì „íŒŒ ë„ë‹¬ ê±°ë¦¬: ì§§ìŒ (ì§ì§„ì„± ê°•í•¨) - ëŒ€ì—­í­: í’ë¶€ (ìµœëŒ€ 25ê°œ ë¹„ê°„ì„­ ì±„ë„) - ê°„ì„­: ì ìŒ 6GHz ëŒ€ì—­ (Wi-Fi 6E): - ì „íŒŒ ë„ë‹¬ ê±°ë¦¬: ë§¤ìš° ì§§ìŒ - ëŒ€ì—­í­: ë§¤ìš° í’ë¶€ (59ê°œ 20MHz ì±„ë„) - ê°„ì„­: ê±°ì˜ ì—†ìŒ dBmê³¼ ì‹ í˜¸ ê°•ë„ # dBm ì°¸ì¡°í‘œ -30 dBm: ë§¤ìš° ê°•í•¨ (AP ë°”ë¡œ ì˜†) -50 dBm: ê°•í•¨ (ìš°ìˆ˜í•œ ì—°ê²°) -60 dBm: ì¢‹ìŒ (ì•ˆì •ì  ì—°ê²°) -70 dBm: ì•½í•¨ (ìµœì†Œ ì—°ê²° ê°€ëŠ¥) -80 dBm: ë§¤ìš° ì•½í•¨ (ì—°ê²° ë¶ˆì•ˆì •) -90 dBm: ì—°ê²° ë¶ˆê°€ # ì‹ í˜¸ ê°•ë„ ì¸¡ì • (Linux) iwconfig wlan0 iw dev wlan0 scan | grep -E "SSID|signal|freq" wavemon # ì‹¤ì‹œê°„ ë¬´ì„  ëª¨ë‹ˆí„°ë§ ğŸ” Wi-Fi ë³´ì•ˆ ê¸°ìˆ  ë³´ì•ˆ í”„ë¡œí† ì½œ ë°œì „ì‚¬ WEP (Wired Equivalent Privacy): - 1997ë…„ ë„ì…, í˜„ì¬ ì‚¬ìš© ê¸ˆì§€ - 40/104ë¹„íŠ¸ í‚¤ ê¸¸ì´ - RC4 ì•”í˜¸í™”, ì‰½ê²Œ í¬ë™ë¨ WPA (Wi-Fi Protected Access): - 2003ë…„ ë„ì…, WEPì˜ ì„ì‹œ ëŒ€ì•ˆ - TKIP ì•”í˜¸í™”, RC4 ê¸°ë°˜ - ë™ì  í‚¤ ìƒì„± WPA2 (802.11i): - 2004ë…„ ë„ì…, í˜„ì¬ í‘œì¤€ - AES-CCMP ì•”í˜¸í™” - PSK(ê°œì¸ìš©) / Enterprise(ê¸°ì—…ìš©) WPA3 (2018ë…„ ë„ì…): - SAE (Simultaneous Authentication of Equals) - ê°œì„ ëœ ì˜¤í”ˆ ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ - ë” ê°•ë ¥í•œ ì•”í˜¸í™” (192ë¹„íŠ¸) WPA2/WPA3 Enterprise ì„¤ì • # FreeRADIUS ì„œë²„ ì„¤ì • (/etc/freeradius/clients.conf) client wireless-controller { ipaddr = 192.168.1.10 secret = radiusSecret123 shortname = wlc } # ì‚¬ìš©ì ì¸ì¦ ì„¤ì • (/etc/freeradius/users) john Cleartext-Password := "password123" Tunnel-Type = VLAN, Tunnel-Medium-Type = IEEE-802, Tunnel-Private-Group-Id = 10 # ì¸ì¦ì„œ ê¸°ë°˜ ì„¤ì • (802.1X EAP-TLS) alice TLS-Cert-Serial := "1234567890" Tunnel-Type = VLAN, Tunnel-Medium-Type = IEEE-802, Tunnel-Private-Group-Id = 20 # Cisco WLC RADIUS ì„¤ì • (Cisco Controller) &gt; configure terminal (Cisco Controller) &gt; radius auth add 1 192.168.1.100 1812 radiusSecret123 (Cisco Controller) &gt; radius acct add 1 192.168.1.100 1813 radiusSecret123 (Cisco Controller) &gt; wlan create 10 CORPORATE (Cisco Controller) &gt; wlan security 802.1x enable 10 (Cisco Controller) &gt; wlan security wpa akm 802.1x enable 10 ğŸ“¶ Wi-Fi 6/6E ê¸°ìˆ  Wi-Fi 6 (802.11ax) ì£¼ìš” íŠ¹ì§• OFDMA (Orthogonal Frequency Division Multiple Access): - ë‹¤ì¤‘ ì‚¬ìš©ì ë™ì‹œ ì „ì†¡ - íš¨ìœ¨ì ì¸ ìŠ¤í™íŠ¸ëŸ¼ ì‚¬ìš© - ì§€ì—° ì‹œê°„ ê°ì†Œ MU-MIMO (Multi-User MIMO): - ìµœëŒ€ 8x8 ì•ˆí…Œë‚˜ ì§€ì› - ë‹¤ìš´ë§í¬/ì—…ë§í¬ ëª¨ë‘ ì§€ì› - ë™ì‹œ ë‹¤ì¤‘ ì‚¬ìš©ì ì„œë¹„ìŠ¤ 1024-QAM: - 25% ë†’ì€ ë°ì´í„° ì „ì†¡ë¥  - ì‹ í˜¸ í’ˆì§ˆì´ ì¢‹ì€ í™˜ê²½ì—ì„œ íš¨ê³¼ì  TWT (Target Wake Time): - IoT ë””ë°”ì´ìŠ¤ ë°°í„°ë¦¬ ìˆ˜ëª… ì—°ì¥ - ìŠ¤ì¼€ì¤„ë§ëœ í†µì‹  Wi-Fi 6 AP ì„¤ì • ì‹¤ìŠµ # Cisco Wi-Fi 6 AP ì„¤ì • # 802.11ax í™œì„±í™” ap dot11 24ghz radio 1 station-role root power local maximum 20 channel width 80 txpower auto # OFDMA í™œì„±í™” ap dot11 5ghz radio 2 station-role root power local maximum 23 channel width 160 ofdma mu-mimo # BSS Coloring ì„¤ì • (ê°„ì„­ ê°ì†Œ) wlan 10 bss-color 1-63 # TWT ì„¤ì • ap name AP-WIFI6-01 twt enable 5Gì™€ ì…€ë£°ëŸ¬ ê¸°ìˆ  | 5G and Cellular Technology ğŸ“± 5G ê¸°ìˆ  ê°œìš” 5G ë„¤íŠ¸ì›Œí¬ ì•„í‚¤í…ì²˜ # 5G í•µì‹¬ êµ¬ì„±ìš”ì†Œ RAN (Radio Access Network): - gNB (5G Base Station) - CU (Centralized Unit) - DU (Distributed Unit) - RU (Radio Unit) Core Network (5GC): - AMF (Access and Mobility Management Function) - SMF (Session Management Function) - UPF (User Plane Function) - AUSF (Authentication Server Function) - UDM (Unified Data Management) # 5G ì£¼íŒŒìˆ˜ ëŒ€ì—­ Sub-6GHz (FR1): - ì €ì£¼íŒŒ: 600MHz ~ 6GHz - ë„“ì€ ì»¤ë²„ë¦¬ì§€, ê±´ë¬¼ íˆ¬ê³¼ë ¥ ì¢‹ìŒ - ìµœëŒ€ ì†ë„: 1Gbps mmWave (FR2): - ê³ ì£¼íŒŒ: 24GHz ~ 100GHz - ì´ˆê³ ì†, ì´ˆì €ì§€ì—° - ì»¤ë²„ë¦¬ì§€ ì œí•œì  - ìµœëŒ€ ì†ë„: 10Gbps+ 5G ë„¤íŠ¸ì›Œí¬ ìŠ¬ë¼ì´ì‹± # ìŠ¬ë¼ì´ìŠ¤ ìœ í˜•ë³„ íŠ¹ì„± eMBB (Enhanced Mobile Broadband): - ë†’ì€ ëŒ€ì—­í­ (20Gbps+) - 4K/8K ë¹„ë””ì˜¤, AR/VR - ì§€ì—°ì‹œê°„: 4ms ì´í•˜ URLLC (Ultra-Reliable Low-Latency Communications): - ì´ˆì €ì§€ì—° (1ms) - 99.999% ì‹ ë¢°ì„± - ììœ¨ì£¼í–‰, ì‚°ì—… ìë™í™” mMTC (Massive Machine Type Communications): - ëŒ€ëŸ‰ IoT ë””ë°”ì´ìŠ¤ (1M/kmÂ²) - ì €ì „ë ¥, ì €ë¹„ìš© - ìŠ¤ë§ˆíŠ¸ì‹œí‹°, ë†ì—… IoT ğŸŒ SD-WAN ê¸°ìˆ  SD-WANì€ ì†Œí”„íŠ¸ì›¨ì–´ ì •ì˜ ë°©ì‹ìœ¼ë¡œ WANì„ ê´€ë¦¬í•˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤. SD-WAN ì•„í‚¤í…ì²˜ # SD-WAN êµ¬ì„±ìš”ì†Œ Edge Device (vCPE/uCPE): - ì§€ì‚¬ì— ì„¤ì¹˜ë˜ëŠ” SD-WAN ì¥ë¹„ - íŠ¸ë˜í”½ ë¼ìš°íŒ… ë° ì •ì±… ì ìš© Orchestrator: - ì¤‘ì•™ ì§‘ì¤‘ì‹ ê´€ë¦¬ í”Œë«í¼ - ì •ì±… ì„¤ì • ë° ë°°í¬ Controller: - ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€ ê´€ë¦¬ - ê²½ë¡œ ìµœì í™” ê²°ì • # ì „ì†¡ ë°©ì‹ MPLS: ë†’ì€ í’ˆì§ˆ, ë†’ì€ ë¹„ìš© Internet: ë‚®ì€ ë¹„ìš©, ê°€ë³€ì  í’ˆì§ˆ LTE/5G: ì´ë™ì„±, ë°±ì—…ìš© SD-WAN êµ¬í˜„ (VeloCloud/VMware) # Edge ì„¤ì • ì˜ˆì‹œ # WAN ì¸í„°í˜ì´ìŠ¤ ì„¤ì • configure interface GE1 ip dhcp wan-interface internet1 exit interface GE2 ip address 10.1.1.1/30 wan-interface mpls1 exit # ë¹„ì¦ˆë‹ˆìŠ¤ ì •ì±… ì„¤ì • business-policy VOICE application-classification voice sla latency 150 sla jitter 30 sla loss 1 path-preference mpls1 path-preference internet1 # ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ë°˜ ë¼ìš°íŒ… application-map application office365 path internet1 application salesforce path internet1 application voice path mpls1 application video path mpls1 Open Source SD-WAN (FlexiWAN) # FlexiWAN Agent ì„¤ì¹˜ curl -s https://get.flexiwan.com | sudo bash # ë””ë°”ì´ìŠ¤ ë“±ë¡ flexiwan-mgmt device register --token &lt;registration-token&gt; # ì¸í„°í˜ì´ìŠ¤ ì„¤ì • { "interfaces": [ { "name": "eth0", "type": "WAN", "dhcp": "yes", "metric": 100 }, { "name": "eth1", "type": "LAN", "addr": "192.168.1.1/24" } ] } # í„°ë„ ì„¤ì • { "tunnels": [ { "num": 1, "peer": "203.0.113.2", "peer_port": 4789, "local_port": 4789, "encryption": "yes" } ] } ë„¤íŠ¸ì›Œí¬ ê°€ìƒí™” | Network Virtualization ğŸ”€ SDN (Software Defined Networking) OpenFlow ê¸°ë³¸ ê°œë… # OpenFlow ìŠ¤ìœ„ì¹˜ êµ¬ì¡° Flow Table â†’ Group Table â†’ Meter Table # Flow Entry êµ¬ì„± Match Fields: íŒ¨í‚· ë§¤ì¹­ ì¡°ê±´ Instructions: ìˆ˜í–‰í•  ë™ì‘ Counters: í†µê³„ ì •ë³´ Timeouts: íƒ€ì„ì•„ì›ƒ ì„¤ì • Priority: ìš°ì„ ìˆœìœ„ # OpenFlow ë©”ì‹œì§€ ìœ í˜• Controller-to-Switch: - Flow-Mod: í”Œë¡œìš° í…Œì´ë¸” ìˆ˜ì • - Group-Mod: ê·¸ë£¹ í…Œì´ë¸” ìˆ˜ì • - Port-Mod: í¬íŠ¸ ì„¤ì • ìˆ˜ì • Switch-to-Controller: - Packet-In: ë§¤ì¹­ë˜ì§€ ì•Šì€ íŒ¨í‚· ì „ì†¡ - Flow-Removed: í”Œë¡œìš° ì œê±° ì•Œë¦¼ OpenDaylight ì»¨íŠ¸ë¡¤ëŸ¬ ì„¤ì • # OpenDaylight ì„¤ì¹˜ wget https://nexus.opendaylight.org/content/repositories/opendaylight.release/org/opendaylight/integration/karaf/0.13.3/karaf-0.13.3.tar.gz tar -xzf karaf-0.13.3.tar.gz cd karaf-0.13.3 # ì»¨íŠ¸ë¡¤ëŸ¬ ì‹œì‘ ./bin/karaf # í•„ìˆ˜ í”¼ì²˜ ì„¤ì¹˜ opendaylight-user@root&gt; feature:install odl-restconf odl-l2switch-switch-ui odl-mdsal-apidocs # REST APIë¥¼ í†µí•œ í”Œë¡œìš° ì¶”ê°€ curl -u admin:admin -H "Content-Type: application/json" -X PUT \ http://localhost:8181/restconf/config/opendaylight-inventory:nodes/node/openflow:1/flow-node-inventory:table/0/flow/1 \ -d '{ "flow": [ { "id": "1", "match": { "ethernet-match": { "ethernet-type": { "type": 2048 } }, "ipv4-destination": "192.168.1.100/32" }, "instructions": { "instruction": [ { "order": 0, "apply-actions": { "action": [ { "order": 0, "output-action": { "output-node-connector": "2" } } ] } } ] } } ] }' â˜ï¸ ë„¤íŠ¸ì›Œí¬ í•¨ìˆ˜ ê°€ìƒí™” (NFV) VNF (Virtual Network Function) êµ¬í˜„ # ê°€ìƒ ë¼ìš°í„° (VyOS) ë°°í¬ # Docker ì»¨í…Œì´ë„ˆë¡œ ë°°í¬ docker run -d --name vyos-router \ --privileged \ --cap-add=NET_ADMIN \ -v /lib/modules:/lib/modules:ro \ vyos/vyos:1.3 # ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì„¤ì • ip netns add router-ns ip link add veth0 type veth peer name veth1 ip link set veth1 netns router-ns ip netns exec router-ns ip addr add 10.0.1.1/24 dev veth1 ip netns exec router-ns ip link set veth1 up # ê°€ìƒ ë°©í™”ë²½ (iptables ê¸°ë°˜) #!/bin/bash # Virtual Firewall Function iptables -F iptables -P INPUT DROP iptables -P FORWARD DROP iptables -P OUTPUT ACCEPT # í—ˆìš© ê·œì¹™ iptables -A INPUT -i lo -j ACCEPT iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT iptables -A INPUT -p tcp --dport 22 -s 192.168.1.0/24 -j ACCEPT # í¬ì›Œë”© ê·œì¹™ iptables -A FORWARD -i eth0 -o eth1 -m state --state ESTABLISHED,RELATED -j ACCEPT iptables -A FORWARD -i eth1 -o eth0 -j ACCEPT # NAT ì„¤ì • iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE ì—£ì§€ ì»´í“¨íŒ… | Edge Computing ğŸ—ï¸ MEC (Multi-access Edge Computing) MEC í”Œë«í¼ êµ¬ì¡° # MEC êµ¬ì„±ìš”ì†Œ MEC Platform: - ì• í”Œë¦¬ì¼€ì´ì…˜ ë¼ì´í”„ì‚¬ì´í´ ê´€ë¦¬ - ì„œë¹„ìŠ¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ë° ë°œê²¬ - íŠ¸ë˜í”½ ë¼ìš°íŒ… MEC Apps: - ì‹¤ì‹œê°„ ë¹„ë””ì˜¤ ë¶„ì„ - AR/VR ì• í”Œë¦¬ì¼€ì´ì…˜ - IoT ë°ì´í„° ì²˜ë¦¬ # MEC ë°°í¬ ì‹œë‚˜ë¦¬ì˜¤ Corporate Edge: ê¸°ì—… ìº í¼ìŠ¤ Service Provider Edge: í†µì‹ ì‚¬ CO Access Edge: ê¸°ì§€êµ­, Wi-Fi AP Device Edge: CPE, ê²Œì´íŠ¸ì›¨ì´ Kubernetes ê¸°ë°˜ ì—£ì§€ ì»´í“¨íŒ… # Edge Node ì„¤ì • apiVersion: v1 kind: Node metadata: name: edge-node-01 labels: node-type: edge location: branch-office kubernetes.io/arch: arm64 # Edge ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ apiVersion: apps/v1 kind: Deployment metadata: name: video-analytics spec: replicas: 1 selector: matchLabels: app: video-analytics template: metadata: labels: app: video-analytics spec: nodeSelector: node-type: edge containers: - name: analytics image: video-analytics:latest resources: limits: memory: "1Gi" cpu: "500m" requests: memory: "512Mi" cpu: "250m" env: - name: CAMERA_URL value: "rtsp://192.168.1.100:554/stream" ë„¤íŠ¸ì›Œí¬ ìë™í™” | Network Automation ğŸ¤– Ansible ë„¤íŠ¸ì›Œí¬ ìë™í™” ë„¤íŠ¸ì›Œí¬ ì¸ë²¤í† ë¦¬ ì„¤ì • # inventory.yml all: children: routers: hosts: router01: ansible_host: 192.168.1.1 ansible_network_os: ios router02: ansible_host: 192.168.1.2 ansible_network_os: ios switches: hosts: switch01: ansible_host: 192.168.1.10 ansible_network_os: ios switch02: ansible_host: 192.168.1.11 ansible_network_os: ios vars: ansible_connection: network_cli ansible_user: admin ansible_ssh_pass: "" ansible_become: yes ansible_become_method: enable ansible_become_pass: "" VLAN ìë™ ë°°í¬ í”Œë ˆì´ë¶ # deploy-vlans.yml --- - name: Configure VLANs across switches hosts: switches gather_facts: no vars: vlans: - id: 10 name: SALES ports: [1, 2, 3, 4, 5] - id: 20 name: ENGINEERING ports: [6, 7, 8, 9, 10] - id: 30 name: GUEST ports: [11, 12] tasks: - name: Create VLANs ios_vlan: vlan_id: "" name: "" state: present loop: "" - name: Configure access ports ios_l2_interfaces: config: - name: "FastEthernet0/" access: vlan: "" with_subelements: - "" - ports - name: Configure trunk port ios_l2_interfaces: config: - name: FastEthernet0/24 trunk: allowed_vlans: "10,20,30" native_vlan: 1 ğŸ Python ë„¤íŠ¸ì›Œí¬ ìë™í™” NAPALMì„ ì´ìš©í•œ ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬ from napalm import get_network_driver import json # ë””ë°”ì´ìŠ¤ ì—°ê²° ì„¤ì • driver = get_network_driver('ios') device = driver('192.168.1.1', 'admin', 'password') try: # ë””ë°”ì´ìŠ¤ ì—°ê²° device.open() # ì¸í„°í˜ì´ìŠ¤ ì •ë³´ ìˆ˜ì§‘ interfaces = device.get_interfaces() print(json.dumps(interfaces, indent=2)) # ë¼ìš°íŒ… í…Œì´ë¸” í™•ì¸ routes = device.get_route_to('8.8.8.8') print(json.dumps(routes, indent=2)) # ì„¤ì • ë³€ê²½ (ACL ì¶”ê°€) config = """ ip access-list extended BLOCK_SOCIAL deny tcp any host 23.35.67.140 eq 80 permit ip any any """ # ì„¤ì • ë¡œë“œ (ì•„ì§ ì ìš©í•˜ì§€ ì•ŠìŒ) device.load_merge_candidate(config=config) # ì„¤ì • ì°¨ì´ í™•ì¸ diff = device.compare_config() if diff: print("Configuration diff:") print(diff) # ì‚¬ìš©ì í™•ì¸ í›„ ì ìš© confirm = input("Apply configuration? (y/n): ") if confirm.lower() == 'y': device.commit_config() print("Configuration applied successfully") else: device.discard_config() print("Configuration discarded") finally: device.close() Netmikoë¥¼ ì´ìš©í•œ ëŒ€ëŸ‰ ì„¤ì • from netmiko import ConnectHandler from concurrent.futures import ThreadPoolExecutor import threading # ë””ë°”ì´ìŠ¤ ë¦¬ìŠ¤íŠ¸ devices = [ { 'device_type': 'cisco_ios', 'host': '192.168.1.1', 'username': 'admin', 'password': 'password', 'hostname': 'Router01' }, { 'device_type': 'cisco_ios', 'host': '192.168.1.2', 'username': 'admin', 'password': 'password', 'hostname': 'Router02' } ] def configure_device(device): """ê°œë³„ ë””ë°”ì´ìŠ¤ ì„¤ì • í•¨ìˆ˜""" try: # SSH ì—°ê²° connection = ConnectHandler(**device) # NTP ì„œë²„ ì„¤ì • ntp_config = [ 'ntp server 192.168.1.100', 'ntp server 8.8.8.8', 'clock timezone KST 9 0' ] # ì„¤ì • ì ìš© output = connection.send_config_set(ntp_config) # SNMP ì„¤ì • snmp_config = [ 'snmp-server community public ro', 'snmp-server host 192.168.1.200 version 2c public' ] output += connection.send_config_set(snmp_config) # ì„¤ì • ì €ì¥ save_output = connection.save_config() connection.disconnect() print(f"âœ… {device['hostname']}: Configuration completed") return True except Exception as e: print(f"âŒ {device['hostname']}: Error - {str(e)}") return False # ë³‘ë ¬ ì‹¤í–‰ with ThreadPoolExecutor(max_workers=5) as executor: results = list(executor.map(configure_device, devices)) success_count = sum(results) print(f"\nì™„ë£Œ: {success_count}/{len(devices)} ë””ë°”ì´ìŠ¤") ğŸ“Š ë„¤íŠ¸ì›Œí¬ ëª¨ë‹ˆí„°ë§ ìë™í™” Prometheus + Grafana ëª¨ë‹ˆí„°ë§ # prometheus.yml global: scrape_interval: 15s scrape_configs: - job_name: 'snmp-devices' static_configs: - targets: - 192.168.1.1 # Router01 - 192.168.1.2 # Router02 - 192.168.1.10 # Switch01 metrics_path: /snmp params: module: [if_mib] relabel_configs: - source_labels: [__address__] target_label: __param_target - source_labels: [__param_target] target_label: instance - target_label: __address__ replacement: 192.168.1.100:9116 # SNMP Exporter - job_name: 'snmp-exporter' static_configs: - targets: ['192.168.1.100:9116'] ë„¤íŠ¸ì›Œí¬ ì¥ì•  ì•Œë¦¼ ìë™í™” import requests import smtplib from email.mime.text import MIMEText import time class NetworkMonitor: def __init__(self): self.devices = [ {'name': 'Router01', 'ip': '192.168.1.1'}, {'name': 'Switch01', 'ip': '192.168.1.10'}, {'name': 'AP01', 'ip': '192.168.1.20'} ] self.previous_status = {} def check_device(self, device): """SNMP ë˜ëŠ” PINGìœ¼ë¡œ ë””ë°”ì´ìŠ¤ ìƒíƒœ í™•ì¸""" import subprocess try: # PING í…ŒìŠ¤íŠ¸ result = subprocess.run( ['ping', '-c', '3', '-W', '3', device['ip']], capture_output=True, text=True ) if result.returncode == 0: return 'UP' else: return 'DOWN' except Exception as e: print(f"Error checking {device['name']}: {e}") return 'ERROR' def send_alert(self, device, status): """Slack ë˜ëŠ” ì´ë©”ì¼ë¡œ ì•Œë¦¼ ì „ì†¡""" # Slack ì•Œë¦¼ webhook_url = "https://hooks.slack.com/services/YOUR/WEBHOOK/URL" message = { "text": f"ğŸš¨ Network Alert: {device['name']} is {status}", "attachments": [ { "color": "danger" if status == 'DOWN' else "good", "fields": [ {"title": "Device", "value": device['name'], "short": True}, {"title": "IP", "value": device['ip'], "short": True}, {"title": "Status", "value": status, "short": True}, {"title": "Time", "value": time.strftime("%Y-%m-%d %H:%M:%S"), "short": True} ] } ] } try: response = requests.post(webhook_url, json=message) if response.status_code == 200: print(f"Alert sent for {device['name']}") except Exception as e: print(f"Failed to send alert: {e}") def monitor_loop(self): """ë©”ì¸ ëª¨ë‹ˆí„°ë§ ë£¨í”„""" while True: for device in self.devices: current_status = self.check_device(device) previous_status = self.previous_status.get(device['name'], 'UP') # ìƒíƒœ ë³€í™” ê°ì§€ if current_status != previous_status: print(f"{device['name']} status changed: {previous_status} -&gt; {current_status}") self.send_alert(device, current_status) self.previous_status[device['name']] = current_status time.sleep(60) # 1ë¶„ë§ˆë‹¤ ì²´í¬ if __name__ == "__main__": monitor = NetworkMonitor() monitor.monitor_loop() ë‹¤ìŒ í¸ ì˜ˆê³  ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆê³¼ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…ì˜ ê³ ê¸‰ ì£¼ì œë“¤ì„ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤: ì°¨ì„¸ëŒ€ ë°©í™”ë²½ê³¼ IDS/IPS ë„¤íŠ¸ì›Œí¬ í¬ë Œì‹ê³¼ ìœ„í˜‘ í—ŒíŒ… ì œë¡œ íŠ¸ëŸ¬ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ ì•„í‚¤í…ì²˜ ê³ ê¸‰ ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ í•´ê²° ê¸°ë²• ë¬´ì„  ë„¤íŠ¸ì›Œí‚¹ê³¼ ìµœì‹  ê¸°ìˆ ë“¤ì„ ë§ˆìŠ¤í„°í•˜ì…¨ë‚˜ìš”? ğŸŒâœ¨]]></summary></entry><entry><title type="html">ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ 2í¸ - SSH ê³ ê¸‰ ë³´ì•ˆê³¼ ë°©í™”ë²½ | Linux Security Guide Part 2 - Advanced SSH Security &amp;amp; Firewall</title><link href="https://leeyonghe.github.io/infra-blog/blog/2024/12/08/linux-security-guide-part2.html" rel="alternate" type="text/html" title="ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ 2í¸ - SSH ê³ ê¸‰ ë³´ì•ˆê³¼ ë°©í™”ë²½ | Linux Security Guide Part 2 - Advanced SSH Security &amp;amp; Firewall" /><published>2024-12-08T00:00:00+00:00</published><updated>2024-12-08T00:00:00+00:00</updated><id>https://leeyonghe.github.io/infra-blog/blog/2024/12/08/linux-security-guide-part2</id><content type="html" xml:base="https://leeyonghe.github.io/infra-blog/blog/2024/12/08/linux-security-guide-part2.html"><![CDATA[<p>SSH ë³´ì•ˆì„ í•œ ë‹¨ê³„ ë†’ì´ê³  ê°•ë ¥í•œ ë°©í™”ë²½ ì •ì±…ì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ì™„ë²½í•˜ê²Œ ë§ˆìŠ¤í„°í•´ë³´ê² ìŠµë‹ˆë‹¤. SSH í‚¤ ê´€ë¦¬ë¶€í„° ê³ ê¸‰ ë°©í™”ë²½ ì„¤ì •ê¹Œì§€ ì‹¤ë¬´ì—ì„œ ë°”ë¡œ í™œìš©í•  ìˆ˜ ìˆëŠ” ë‚´ìš©ìœ¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.</p>

<h2 id="ssh-ê³ ê¸‰-ë³´ì•ˆ-ì„¤ì •--advanced-ssh-security">SSH ê³ ê¸‰ ë³´ì•ˆ ì„¤ì • | Advanced SSH Security</h2>

<h3 id="-ssh-í‚¤-ê¸°ë°˜-ì¸ì¦-ì™„ë²½-êµ¬ì¶•">ğŸ”‘ SSH í‚¤ ê¸°ë°˜ ì¸ì¦ ì™„ë²½ êµ¬ì¶•</h3>

<h4 id="ê°•í™”ëœ-ssh-í‚¤-ìƒì„±-ë°-ê´€ë¦¬">ê°•í™”ëœ SSH í‚¤ ìƒì„± ë° ê´€ë¦¬</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ìµœì‹  ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•œ í‚¤ ìƒì„±</span>
<span class="c"># ED25519 (ê¶Œì¥ - ë¹ ë¥´ê³  ì•ˆì „)</span>
ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-b</span> 4096 <span class="nt">-C</span> <span class="s2">"admin@company.com-</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span><span class="s2">"</span> <span class="nt">-f</span> ~/.ssh/id_ed25519_admin

<span class="c"># RSA í‚¤ (í˜¸í™˜ì„±ì´ í•„ìš”í•œ ê²½ìš°)</span>
ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-b</span> 4096 <span class="nt">-C</span> <span class="s2">"admin@company.com-</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span><span class="s2">"</span> <span class="nt">-f</span> ~/.ssh/id_rsa_admin

<span class="c"># ECDSA í‚¤ (ëŒ€ì•ˆ)</span>
ssh-keygen <span class="nt">-t</span> ecdsa <span class="nt">-b</span> 521 <span class="nt">-C</span> <span class="s2">"admin@company.com-</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span><span class="s2">"</span> <span class="nt">-f</span> ~/.ssh/id_ecdsa_admin

<span class="c"># í‚¤ ìƒì„± ì‹œ ë³´ì•ˆ ì˜µì…˜</span>
ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-b</span> 4096 <span class="se">\</span>
    <span class="nt">-C</span> <span class="s2">"admin@company.com-</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">-f</span> ~/.ssh/id_ed25519_admin <span class="se">\</span>
    <span class="nt">-N</span> <span class="s2">"</span><span class="si">$(</span>openssl rand <span class="nt">-base64</span> 32<span class="si">)</span><span class="s2">"</span> <span class="se">\ </span> <span class="c"># ê°•ë ¥í•œ íŒ¨ìŠ¤í”„ë ˆì´ì¦ˆ ìë™ ìƒì„±</span>
    <span class="nt">-o</span> <span class="se">\ </span>                              <span class="c"># OpenSSH í˜•ì‹ ì‚¬ìš©</span>
    <span class="nt">-a</span> 100                            <span class="c"># KDF ë¼ìš´ë“œ ìˆ˜ ì¦ê°€</span>

<span class="c"># í‚¤ ê¶Œí•œ ì„¤ì • (ì¤‘ìš”!)</span>
<span class="nb">chmod </span>700 ~/.ssh
<span class="nb">chmod </span>600 ~/.ssh/id_<span class="k">*</span>
<span class="nb">chmod </span>644 ~/.ssh/id_<span class="k">*</span>.pub
<span class="nb">chmod </span>600 ~/.ssh/authorized_keys
<span class="nb">chmod </span>600 ~/.ssh/config

<span class="c"># í‚¤ í•‘ê±°í”„ë¦°íŠ¸ í™•ì¸</span>
ssh-keygen <span class="nt">-lf</span> ~/.ssh/id_ed25519_admin.pub
ssh-keygen <span class="nt">-E</span> sha256 <span class="nt">-lf</span> ~/.ssh/id_ed25519_admin.pub  <span class="c"># SHA256 í•´ì‹œ</span>

<span class="c"># í‚¤ ë§Œë£Œì¼ ì„¤ì • (OpenSSH 8.2+)</span>
ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-V</span> +365d <span class="nt">-C</span> <span class="s2">"expires-</span><span class="si">$(</span><span class="nb">date</span> <span class="nt">-d</span> <span class="s1">'+1 year'</span> +%Y%m%d<span class="si">)</span><span class="s2">"</span>
</code></pre></div></div>

<h4 id="ssh-í´ë¼ì´ì–¸íŠ¸-ì„¤ì •-ìµœì í™”">SSH í´ë¼ì´ì–¸íŠ¸ ì„¤ì • ìµœì í™”</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ~/.ssh/config - í´ë¼ì´ì–¸íŠ¸ ì„¤ì •</span>
<span class="c"># ê¸°ë³¸ ì„¤ì •</span>
Host <span class="k">*</span>
    <span class="c"># ë³´ì•ˆ ì„¤ì •</span>
    Protocol 2
    HashKnownHosts <span class="nb">yes
    </span>VisualHostKey <span class="nb">yes
    </span>StrictHostKeyChecking ask
    UserKnownHostsFile ~/.ssh/known_hosts
    
    <span class="c"># ì—°ê²° ì„¤ì •</span>
    ServerAliveInterval 60
    ServerAliveCountMax 3
    ConnectTimeout 10
    TCPKeepAlive no
    
    <span class="c"># ì•”í˜¸í™” ì„¤ì •</span>
    Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com
    KexAlgorithms curve25519-sha256@libssh.org,diffie-hellman-group16-sha512
    MACs hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com
    HostKeyAlgorithms ssh-ed25519,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521
    
    <span class="c"># ì¸ì¦ ì„¤ì •</span>
    PreferredAuthentications publickey,keyboard-interactive,password
    PubkeyAuthentication <span class="nb">yes
    </span>PasswordAuthentication no
    GSSAPIAuthentication no
    
    <span class="c"># í¬ì›Œë”© ì„¤ì • (ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”)</span>
    ForwardAgent no
    ForwardX11 no
    ForwardX11Trusted no

<span class="c"># ì„œë²„ë³„ ê°œë³„ ì„¤ì •</span>
Host production-server
    HostName 192.168.1.100
    Port 2222
    User admin
    IdentityFile ~/.ssh/id_ed25519_admin
    IdentitiesOnly <span class="nb">yes
    </span>RequestTTY <span class="nb">yes
    </span>RemoteForward 9000 localhost:9000
    
Host development-<span class="k">*</span>
    Port 22
    User developer
    IdentityFile ~/.ssh/id_ed25519_dev
    StrictHostKeyChecking no        <span class="c"># ê°œë°œ ì„œë²„ìš©</span>
    UserKnownHostsFile /dev/null
    LogLevel QUIET

Host bastion
    HostName bastion.company.com
    Port 2222
    User jumpuser
    IdentityFile ~/.ssh/id_ed25519_jump
    ControlMaster auto
    ControlPath ~/.ssh/control-%h-%p-%r
    ControlPersist 600

<span class="c"># ë² ìŠ¤ì²œ í˜¸ìŠ¤íŠ¸ë¥¼ í†µí•œ ì ‘ê·¼</span>
Host internal-<span class="k">*</span>
    ProxyJump bastion
    User admin
    IdentityFile ~/.ssh/id_ed25519_admin

<span class="c"># í‚¤ ì—ì´ì „íŠ¸ ì„¤ì •</span>
<span class="c"># ~/.bashrcì— ì¶”ê°€</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$SSH_AUTH_SOCK</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">eval</span> <span class="si">$(</span>ssh-agent <span class="nt">-s</span><span class="si">)</span>
    ssh-add ~/.ssh/id_ed25519_admin
    ssh-add ~/.ssh/id_ed25519_dev
<span class="k">fi</span>

<span class="c"># í‚¤ ë§Œë£Œ í™•ì¸ ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/check-ssh-keys.sh</span>
<span class="k">for </span>keyfile <span class="k">in</span> ~/.ssh/id_<span class="k">*</span><span class="p">;</span> <span class="k">do
    if</span> <span class="o">[[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$keyfile</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="s2">"</span><span class="nv">$keyfile</span><span class="s2">"</span> <span class="o">==</span> <span class="k">*</span>.pub <span class="o">]]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Checking </span><span class="nv">$keyfile</span><span class="s2">..."</span>
        ssh-keygen <span class="nt">-l</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$keyfile</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"  Invalid or encrypted key"</span>
    <span class="k">fi
done</span>
</code></pre></div></div>

<h4 id="ssh-certificate-authority-ca-êµ¬ì¶•">SSH Certificate Authority (CA) êµ¬ì¶•</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1. CA í‚¤ ìƒì„± (ë³´ì•ˆì´ ì¤‘ìš”í•œ ë³„ë„ ì‹œìŠ¤í…œì—ì„œ)</span>
ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-f</span> /etc/ssh/ca_key <span class="nt">-C</span> <span class="s2">"SSH-CA-</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span><span class="s2">"</span>
<span class="nb">chmod </span>600 /etc/ssh/ca_key
<span class="nb">chmod </span>644 /etc/ssh/ca_key.pub

<span class="c"># 2. ì‚¬ìš©ì ì¸ì¦ì„œ ë°œê¸‰</span>
<span class="c"># ë‹¨ê¸°ê°„ ìœ íš¨í•œ ì‚¬ìš©ì ì¸ì¦ì„œ (1ì£¼ì¼)</span>
ssh-keygen <span class="nt">-s</span> /etc/ssh/ca_key <span class="se">\</span>
    <span class="nt">-I</span> <span class="s2">"john-doe-</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">-n</span> john,admin <span class="se">\</span>
    <span class="nt">-V</span> +7d <span class="se">\</span>
    <span class="nt">-z</span> 1001 <span class="se">\</span>
    ~/.ssh/id_ed25519.pub

<span class="c"># í˜¸ìŠ¤íŠ¸ë³„ ì œí•œëœ ì¸ì¦ì„œ</span>
ssh-keygen <span class="nt">-s</span> /etc/ssh/ca_key <span class="se">\</span>
    <span class="nt">-I</span> <span class="s2">"backup-service"</span> <span class="se">\</span>
    <span class="nt">-n</span> backup <span class="se">\</span>
    <span class="nt">-V</span> +1d <span class="se">\</span>
    <span class="nt">-O</span> clear <span class="se">\</span>
    <span class="nt">-O</span> source-address<span class="o">=</span><span class="s2">"192.168.1.100/32"</span> <span class="se">\</span>
    <span class="nt">-O</span> force-command<span class="o">=</span><span class="s2">"/usr/local/bin/backup-script"</span> <span class="se">\</span>
    ~/.ssh/id_ed25519_backup.pub

<span class="c"># ê¶Œí•œ ì œí•œ ì¸ì¦ì„œ</span>
ssh-keygen <span class="nt">-s</span> /etc/ssh/ca_key <span class="se">\</span>
    <span class="nt">-I</span> <span class="s2">"readonly-access"</span> <span class="se">\</span>
    <span class="nt">-n</span> <span class="nb">readonly</span> <span class="se">\</span>
    <span class="nt">-V</span> +1h <span class="se">\</span>
    <span class="nt">-O</span> clear <span class="se">\</span>
    <span class="nt">-O</span> no-agent-forwarding <span class="se">\</span>
    <span class="nt">-O</span> no-port-forwarding <span class="se">\</span>
    <span class="nt">-O</span> no-pty <span class="se">\</span>
    <span class="nt">-O</span> no-user-rc <span class="se">\</span>
    ~/.ssh/id_ed25519_readonly.pub

<span class="c"># 3. ì„œë²„ ì„¤ì •ì—ì„œ CA ì‹ ë¢°</span>
<span class="c"># /etc/ssh/sshd_config</span>
TrustedUserCAKeys /etc/ssh/ca_key.pub
AuthorizedPrincipalsFile /etc/ssh/auth_principals/%u
PubkeyAuthentication <span class="nb">yes
</span>CertificateAuthentication <span class="nb">yes</span>

<span class="c"># 4. ì‚¬ìš©ìë³„ ì£¼ì²´(principal) ì„¤ì •</span>
<span class="c"># /etc/ssh/auth_principals/john</span>
john
admin
developer

<span class="c"># /etc/ssh/auth_principals/backup</span>
backup

<span class="c"># 5. í˜¸ìŠ¤íŠ¸ ì¸ì¦ì„œë„ êµ¬ì¶•</span>
<span class="c"># í˜¸ìŠ¤íŠ¸ í‚¤ì— ëŒ€í•œ ì¸ì¦ì„œ ë°œê¸‰</span>
ssh-keygen <span class="nt">-s</span> /etc/ssh/ca_key <span class="se">\</span>
    <span class="nt">-I</span> <span class="s2">"server1.company.com"</span> <span class="se">\</span>
    <span class="nt">-h</span> <span class="se">\</span>
    <span class="nt">-n</span> server1.company.com,server1,192.168.1.100 <span class="se">\</span>
    <span class="nt">-V</span> +365d <span class="se">\</span>
    /etc/ssh/ssh_host_ed25519_key.pub

<span class="c"># í´ë¼ì´ì–¸íŠ¸ì—ì„œ í˜¸ìŠ¤íŠ¸ CA ì‹ ë¢°</span>
<span class="c"># ~/.ssh/known_hostsì— ì¶”ê°€</span>
@cert-authority <span class="k">*</span>.company.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICAKeyFromCA...

<span class="c"># 6. ì¸ì¦ì„œ ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/ssh-cert-manager.sh</span>

<span class="nv">ACTION</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">USER</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">DAYS</span><span class="o">=</span><span class="k">${</span><span class="nv">3</span><span class="k">:-</span><span class="nv">7</span><span class="k">}</span>

<span class="k">case</span> <span class="nv">$ACTION</span> <span class="k">in</span>
    <span class="s2">"issue"</span><span class="p">)</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$USER</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> issue &lt;username&gt; [days]"</span>
            <span class="nb">exit </span>1
        <span class="k">fi
        
        </span><span class="nv">USER_KEY</span><span class="o">=</span><span class="s2">"/home/</span><span class="nv">$USER</span><span class="s2">/.ssh/id_ed25519.pub"</span>
        <span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$USER_KEY</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"User key not found: </span><span class="nv">$USER_KEY</span><span class="s2">"</span>
            <span class="nb">exit </span>1
        <span class="k">fi
        
        </span>ssh-keygen <span class="nt">-s</span> /etc/ssh/ca_key <span class="se">\</span>
            <span class="nt">-I</span> <span class="s2">"</span><span class="nv">$USER</span><span class="s2">-</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d-%H%M%S<span class="si">)</span><span class="s2">"</span> <span class="se">\</span>
            <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$USER</span><span class="s2">"</span> <span class="se">\</span>
            <span class="nt">-V</span> <span class="s2">"+</span><span class="k">${</span><span class="nv">DAYS</span><span class="k">}</span><span class="s2">d"</span> <span class="se">\</span>
            <span class="s2">"</span><span class="nv">$USER_KEY</span><span class="s2">"</span>
        
        <span class="nb">echo</span> <span class="s2">"Certificate issued for </span><span class="nv">$USER</span><span class="s2">, valid for </span><span class="nv">$DAYS</span><span class="s2"> days"</span>
        <span class="p">;;</span>
        
    <span class="s2">"revoke"</span><span class="p">)</span>
        <span class="c"># ì¸ì¦ì„œ íê¸° ëª©ë¡ ê´€ë¦¬</span>
        <span class="nv">CERT_SERIAL</span><span class="o">=</span><span class="si">$(</span>ssh-keygen <span class="nt">-L</span> <span class="nt">-f</span> <span class="s2">"/home/</span><span class="nv">$USER</span><span class="s2">/.ssh/id_ed25519-cert.pub"</span> | <span class="nb">grep </span>Serial | <span class="nb">awk</span> <span class="s1">'{print $2}'</span><span class="si">)</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$CERT_SERIAL</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /etc/ssh/revoked_keys
        <span class="nb">echo</span> <span class="s2">"Certificate revoked for </span><span class="nv">$USER</span><span class="s2">"</span>
        <span class="p">;;</span>
        
    <span class="s2">"list"</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Active certificates:"</span>
        <span class="k">for </span>cert <span class="k">in</span> /home/<span class="k">*</span>/.ssh/<span class="k">*</span><span class="nt">-cert</span>.pub<span class="p">;</span> <span class="k">do
            if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$cert</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
                </span><span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">basename</span> <span class="si">$(</span><span class="nb">dirname</span> <span class="nv">$cert</span><span class="si">))</span><span class="s2">: </span><span class="si">$(</span>ssh-keygen <span class="nt">-L</span> <span class="nt">-f</span> <span class="nv">$cert</span> | <span class="nb">grep </span>Valid<span class="si">)</span><span class="s2">"</span>
            <span class="k">fi
        done</span>
        <span class="p">;;</span>
        
    <span class="k">*</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> {issue|revoke|list} &lt;username&gt; [days]"</span>
        <span class="nb">exit </span>1
        <span class="p">;;</span>
<span class="k">esac</span>
</code></pre></div></div>

<h3 id="ï¸-ssh-ì„œë²„-ê³ ê¸‰-ë³´ì•ˆ-ì„¤ì •">ğŸ›¡ï¸ SSH ì„œë²„ ê³ ê¸‰ ë³´ì•ˆ ì„¤ì •</h3>

<h4 id="ê°•í™”ëœ-sshd_config-ì„¤ì •">ê°•í™”ëœ sshd_config ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/ssh/sshd_config - ìµœê³  ë³´ì•ˆ ìˆ˜ì¤€ ì„¤ì •</span>
<span class="c"># ê¸°ë³¸ ì„¤ì •</span>
Protocol 2
Port 2222                           <span class="c"># ê¸°ë³¸ í¬íŠ¸ ë³€ê²½</span>
AddressFamily inet                  <span class="c"># IPv4ë§Œ ì‚¬ìš© (í•„ìš”ì‹œ)</span>
ListenAddress 192.168.1.100        <span class="c"># íŠ¹ì • IPë§Œ ë°”ì¸ë”©</span>

<span class="c"># ì•”í˜¸í™” ë° í‚¤ êµí™˜</span>
Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr
MACs hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha2-256,hmac-sha2-512
KexAlgorithms curve25519-sha256@libssh.org,ecdh-sha2-nistp521,ecdh-sha2-nistp384,ecdh-sha2-nistp256,diffie-hellman-group16-sha512

<span class="c"># í˜¸ìŠ¤íŠ¸ í‚¤ ì„¤ì • (ì•½í•œ í‚¤ ì œê±°)</span>
HostKey /etc/ssh/ssh_host_ed25519_key
HostKey /etc/ssh/ssh_host_ecdsa_key
<span class="c"># RSA í‚¤ëŠ” 4096ë¹„íŠ¸ ì´ìƒë§Œ ì‚¬ìš©</span>
HostKey /etc/ssh/ssh_host_rsa_key

<span class="c"># ì¸ì¦ ì„¤ì •</span>
PubkeyAuthentication <span class="nb">yes
</span>AuthorizedKeysFile .ssh/authorized_keys
PasswordAuthentication no
PermitEmptyPasswords no
ChallengeResponseAuthentication no
GSSAPIAuthentication no
HostbasedAuthentication no
IgnoreUserKnownHosts <span class="nb">yes
</span>PermitRootLogin no

<span class="c"># ë¡œê·¸ì¸ ì œí•œ</span>
LoginGraceTime 30
MaxAuthTries 3
MaxSessions 3
MaxStartups 3:30:10
ClientAliveInterval 300
ClientAliveCountMax 2

<span class="c"># ì‚¬ìš©ì/ê·¸ë£¹ ì œí•œ</span>
AllowUsers admin developer
AllowGroups sshusers
DenyUsers guest anonymous backup
DenyGroups wheel nogroup

<span class="c"># ê¸°ëŠ¥ ì œí•œ</span>
X11Forwarding no
AllowTcpForwarding no
GatewayPorts no
PermitTunnel no
PermitUserEnvironment no
PermitUserRC no
PrintMotd <span class="nb">yes
</span>PrintLastLog <span class="nb">yes
</span>TCPKeepAlive no
Compression no                      <span class="c"># ì••ì¶• ë¹„í™œì„±í™” (ë³´ì•ˆ)</span>

<span class="c"># ë¡œê¹…</span>
SyslogFacility AUTH
LogLevel VERBOSE                    <span class="c"># ìƒì„¸ ë¡œê¹…</span>

<span class="c"># Chroot ì„¤ì • (SFTP ì „ìš© ì‚¬ìš©ì)</span>
Subsystem sftp /usr/lib/openssh/sftp-server

<span class="c"># ì¡°ê±´ë¶€ ì„¤ì •</span>
Match User sftpuser
    ChrootDirectory /var/sftp/%u
    ForceCommand internal-sftp
    AllowTcpForwarding no
    X11Forwarding no
    PermitTunnel no

Match Address 192.168.1.0/24
    PasswordAuthentication <span class="nb">yes
    </span>MaxAuthTries 5

Match Address 10.0.0.0/8
    AllowTcpForwarding <span class="nb">local
    </span>GatewayPorts no

Match Group developers
    AllowTcpForwarding <span class="nb">yes
    </span>PermitOpen localhost:3000 localhost:8080

<span class="c"># ì„¤ì • ê²€ì¦</span>
sshd <span class="nt">-t</span>
sshd <span class="nt">-T</span> | <span class="nb">grep</span> <span class="nt">-i</span> cipher          <span class="c"># ì•”í˜¸í™” ì„¤ì • í™•ì¸</span>
sshd <span class="nt">-T</span> | <span class="nb">grep</span> <span class="nt">-i</span> mac             <span class="c"># MAC ì„¤ì • í™•ì¸</span>
</code></pre></div></div>

<h4 id="ssh-ì ‘ê·¼-ì œì–´-ë°-ëª¨ë‹ˆí„°ë§">SSH ì ‘ê·¼ ì œì–´ ë° ëª¨ë‹ˆí„°ë§</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1. TCP Wrapper ì„¤ì •</span>
<span class="c"># /etc/hosts.allow</span>
sshd: 192.168.1.0/24 : ALLOW
sshd: 10.0.0.0/8 : ALLOW
sshd: ALL : spawn <span class="o">(</span>/usr/local/bin/log-ssh-attempt %a %d<span class="o">)</span> : DENY

<span class="c"># /etc/hosts.deny</span>
sshd: ALL

<span class="c"># 2. SSH ì ‘ê·¼ ë¡œê¹… ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/log-ssh-attempt</span>
<span class="nv">CLIENT_IP</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">DAEMON</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">TIMESTAMP</span><span class="o">=</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span>

<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$TIMESTAMP</span><span class="s2">: Blocked SSH attempt from </span><span class="nv">$CLIENT_IP</span><span class="s2"> to </span><span class="nv">$DAEMON</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /var/log/ssh-blocked.log

<span class="c"># ì§€ë¦¬ì  ìœ„ì¹˜ í™•ì¸ (ì„ íƒì‚¬í•­)</span>
<span class="c"># LOCATION=$(geoiplookup $CLIENT_IP 2&gt;/dev/null | cut -d: -f2)</span>
<span class="c"># echo "$TIMESTAMP: $CLIENT_IP ($LOCATION) blocked" &gt;&gt; /var/log/ssh-geo.log</span>

<span class="c"># 3. SSH ì„¸ì…˜ ëª¨ë‹ˆí„°ë§</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/ssh-monitor.sh</span>

<span class="c"># í™œì„± SSH ì„¸ì…˜ ëª¨ë‹ˆí„°ë§</span>
<span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do
    </span><span class="nv">ACTIVE_SESSIONS</span><span class="o">=</span><span class="si">$(</span><span class="nb">who</span> | <span class="nb">grep</span> <span class="nt">-c</span> <span class="s2">"pts/"</span><span class="si">)</span>
    <span class="nv">SSH_PROCESSES</span><span class="o">=</span><span class="si">$(</span>pgrep <span class="nt">-c</span> sshd<span class="si">)</span>
    
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$ACTIVE_SESSIONS</span> <span class="nt">-gt</span> 10 <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">: High SSH session count: </span><span class="nv">$ACTIVE_SESSIONS</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /var/log/ssh-monitor.log
        <span class="c"># ì•Œë¦¼ ë°œì†¡</span>
        <span class="nb">echo</span> <span class="s2">"High SSH session count detected: </span><span class="nv">$ACTIVE_SESSIONS</span><span class="s2"> active sessions"</span> | <span class="se">\</span>
        mail <span class="nt">-s</span> <span class="s2">"SSH Monitor Alert"</span> admin@company.com
    <span class="k">fi</span>
    
    <span class="c"># ì¥ì‹œê°„ ìœ ì§€ë˜ëŠ” ì„¸ì…˜ í™•ì¸</span>
    <span class="nb">who</span> | <span class="k">while </span><span class="nb">read </span>user <span class="nb">tty time </span>rest<span class="p">;</span> <span class="k">do</span>
        <span class="c"># 12ì‹œê°„ ì´ìƒ ìœ ì§€ëœ ì„¸ì…˜ í™•ì¸</span>
        <span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$time</span><span class="s2">"</span> &lt; <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span> <span class="nt">-d</span> <span class="s1">'12 hours ago'</span> <span class="s1">'+%H:%M'</span><span class="si">)</span><span class="s2">"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">: Long running session: </span><span class="nv">$user</span><span class="s2"> on </span><span class="nv">$tty</span><span class="s2"> since </span><span class="nv">$time</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /var/log/ssh-monitor.log
        <span class="k">fi
    done
    
    </span><span class="nb">sleep </span>60
<span class="k">done</span>

<span class="c"># 4. SSH í‚¤ ë¡œí…Œì´ì…˜ ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/ssh-key-rotation.sh</span>

<span class="c"># 90ì¼ë§ˆë‹¤ í˜¸ìŠ¤íŠ¸ í‚¤ ë¡œí…Œì´ì…˜</span>
<span class="nv">HOSTKEY_AGE</span><span class="o">=</span><span class="si">$(</span>find /etc/ssh/ssh_host_<span class="k">*</span>_key <span class="nt">-mtime</span> +90 2&gt;/dev/null | <span class="nb">wc</span> <span class="nt">-l</span><span class="si">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$HOSTKEY_AGE</span> <span class="nt">-gt</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">: Host keys are older than 90 days. Rotation recommended."</span> <span class="o">&gt;&gt;</span> /var/log/ssh-key-rotation.log
    
    <span class="c"># ë°±ì—…</span>
    <span class="nb">cp</span> <span class="nt">-r</span> /etc/ssh /etc/ssh.backup.<span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span>
    
    <span class="c"># ìƒˆ í‚¤ ìƒì„±</span>
    ssh-keygen <span class="nt">-A</span>
    
    <span class="c"># ì„œë¹„ìŠ¤ ì¬ì‹œì‘</span>
    systemctl restart sshd
    
    <span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">: Host keys rotated successfully"</span> <span class="o">&gt;&gt;</span> /var/log/ssh-key-rotation.log
<span class="k">fi</span>

<span class="c"># ì‚¬ìš©ì í‚¤ ë§Œë£Œ í™•ì¸</span>
<span class="k">for </span>user_home <span class="k">in</span> /home/<span class="k">*</span><span class="p">;</span> <span class="k">do
    </span><span class="nv">username</span><span class="o">=</span><span class="si">$(</span><span class="nb">basename</span> <span class="nv">$user_home</span><span class="si">)</span>
    <span class="nv">auth_keys</span><span class="o">=</span><span class="s2">"</span><span class="nv">$user_home</span><span class="s2">/.ssh/authorized_keys"</span>
    
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$auth_keys</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        while </span><span class="nb">read</span> <span class="nt">-r</span> key<span class="p">;</span> <span class="k">do
            if</span> <span class="o">[[</span> <span class="nv">$key</span> <span class="o">=</span>~ ^ssh- <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
                <span class="c"># í‚¤ ìƒì„±ì¼ í™•ì¸ (ì½”ë©˜íŠ¸ì—ì„œ ë‚ ì§œ ì¶”ì¶œ)</span>
                <span class="nv">key_date</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$key</span> | <span class="nb">grep</span> <span class="nt">-o</span> <span class="s1">'[0-9]\{8\}'</span> | <span class="nb">head</span> <span class="nt">-1</span><span class="si">)</span>
                <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$key_date</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
                    </span><span class="nv">key_age</span><span class="o">=</span><span class="k">$((</span> <span class="o">(</span><span class="si">$(</span><span class="nb">date</span> +%s<span class="si">)</span> <span class="o">-</span> <span class="si">$(</span><span class="nb">date</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$key_date</span><span class="s2">"</span> +%s<span class="si">)</span><span class="o">)</span> <span class="o">/</span> <span class="m">86400</span> <span class="k">))</span>
                    <span class="k">if</span> <span class="o">[</span> <span class="nv">$key_age</span> <span class="nt">-gt</span> 365 <span class="o">]</span><span class="p">;</span> <span class="k">then
                        </span><span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">: User </span><span class="nv">$username</span><span class="s2"> has key older than 1 year (</span><span class="nv">$key_age</span><span class="s2"> days)"</span> <span class="o">&gt;&gt;</span> /var/log/ssh-key-rotation.log
                    <span class="k">fi
                fi
            fi
        done</span> &lt; <span class="s2">"</span><span class="nv">$auth_keys</span><span class="s2">"</span>
    <span class="k">fi
done</span>
</code></pre></div></div>

<h3 id="-ë°©í™”ë²½-ë³´ì•ˆ-ì„¤ì •">ğŸ”¥ ë°©í™”ë²½ ë³´ì•ˆ ì„¤ì •</h3>

<h4 id="iptables-ê³ ê¸‰-ë³´ì•ˆ-ê·œì¹™">iptables ê³ ê¸‰ ë³´ì•ˆ ê·œì¹™</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/setup-iptables-advanced.sh</span>
<span class="c"># ê³ ê¸‰ iptables ë³´ì•ˆ ì„¤ì • ìŠ¤í¬ë¦½íŠ¸</span>

<span class="c"># ê¸°ì¡´ ê·œì¹™ ì´ˆê¸°í™”</span>
iptables <span class="nt">-F</span>
iptables <span class="nt">-X</span>
iptables <span class="nt">-t</span> nat <span class="nt">-F</span>
iptables <span class="nt">-t</span> nat <span class="nt">-X</span>
iptables <span class="nt">-t</span> mangle <span class="nt">-F</span>
iptables <span class="nt">-t</span> mangle <span class="nt">-X</span>
iptables <span class="nt">-t</span> raw <span class="nt">-F</span>
iptables <span class="nt">-t</span> raw <span class="nt">-X</span>

<span class="c"># ê¸°ë³¸ ì •ì±… ì„¤ì • (ëª¨ë“  íŠ¸ë˜í”½ ì°¨ë‹¨)</span>
iptables <span class="nt">-P</span> INPUT DROP
iptables <span class="nt">-P</span> FORWARD DROP
iptables <span class="nt">-P</span> OUTPUT DROP

<span class="c"># 1. ê¸°ë³¸ í—ˆìš© ê·œì¹™</span>
<span class="c"># Loopback ì¸í„°í˜ì´ìŠ¤ í—ˆìš©</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-i</span> lo <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-o</span> lo <span class="nt">-j</span> ACCEPT

<span class="c"># ê¸°ì¡´ ì—°ê²° ìœ ì§€</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED,RELATED <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> FORWARD <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED,RELATED <span class="nt">-j</span> ACCEPT

<span class="c"># 2. SSH ë³´ì•ˆ ê·œì¹™ (ê³ ê¸‰)</span>
<span class="c"># SSH ë¸Œë£¨íŠ¸í¬ìŠ¤ ë°©ì§€ (ë³µí•©ì  ì ‘ê·¼)</span>
iptables <span class="nt">-N</span> SSH_BRUTEFORCE
iptables <span class="nt">-A</span> SSH_BRUTEFORCE <span class="nt">-m</span> recent <span class="nt">--set</span> <span class="nt">--name</span> SSH_ATTACK
iptables <span class="nt">-A</span> SSH_BRUTEFORCE <span class="nt">-m</span> recent <span class="nt">--update</span> <span class="nt">--seconds</span> 3600 <span class="nt">--hitcount</span> 3 <span class="nt">--name</span> SSH_ATTACK <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"SSH Bruteforce: "</span>
iptables <span class="nt">-A</span> SSH_BRUTEFORCE <span class="nt">-m</span> recent <span class="nt">--update</span> <span class="nt">--seconds</span> 3600 <span class="nt">--hitcount</span> 3 <span class="nt">--name</span> SSH_ATTACK <span class="nt">-j</span> DROP
iptables <span class="nt">-A</span> SSH_BRUTEFORCE <span class="nt">-j</span> ACCEPT

<span class="c"># SSH ì ‘ê·¼ ì œí•œ</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 2222 <span class="nt">-s</span> 192.168.1.0/24 <span class="nt">-j</span> SSH_BRUTEFORCE
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 2222 <span class="nt">-s</span> 10.0.0.0/8 <span class="nt">-j</span> SSH_BRUTEFORCE
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 2222 <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"SSH Unauthorized: "</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 2222 <span class="nt">-j</span> DROP

<span class="c"># 3. ì›¹ ì„œë²„ ë³´ì•ˆ (ìˆëŠ” ê²½ìš°)</span>
<span class="c"># HTTP/HTTPS with rate limiting</span>
iptables <span class="nt">-N</span> WEB_RATE_LIMIT
iptables <span class="nt">-A</span> WEB_RATE_LIMIT <span class="nt">-m</span> limit <span class="nt">--limit</span> 25/minute <span class="nt">--limit-burst</span> 100 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> WEB_RATE_LIMIT <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"HTTP Rate Limit: "</span>
iptables <span class="nt">-A</span> WEB_RATE_LIMIT <span class="nt">-j</span> DROP

iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 80 <span class="nt">-j</span> WEB_RATE_LIMIT
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 443 <span class="nt">-j</span> WEB_RATE_LIMIT

<span class="c"># 4. DDoS ë°©ì§€ ê·œì¹™</span>
<span class="c"># SYN Flood ë°©ì§€</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--syn</span> <span class="nt">-m</span> limit <span class="nt">--limit</span> 1/second <span class="nt">--limit-burst</span> 3 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--syn</span> <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"SYN Flood: "</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--syn</span> <span class="nt">-j</span> DROP

<span class="c"># Ping Flood ë°©ì§€</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> icmp <span class="nt">--icmp-type</span> echo-request <span class="nt">-m</span> limit <span class="nt">--limit</span> 1/second <span class="nt">--limit-burst</span> 2 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> icmp <span class="nt">--icmp-type</span> echo-request <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"Ping Flood: "</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> icmp <span class="nt">--icmp-type</span> echo-request <span class="nt">-j</span> DROP

<span class="c"># Port Scan ë°©ì§€</span>
iptables <span class="nt">-N</span> PORT_SCAN
iptables <span class="nt">-A</span> PORT_SCAN <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> SYN,ACK,FIN,RST RST <span class="nt">-m</span> limit <span class="nt">--limit</span> 1/s <span class="nt">--limit-burst</span> 2 <span class="nt">-j</span> RETURN
iptables <span class="nt">-A</span> PORT_SCAN <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"Port Scan: "</span>
iptables <span class="nt">-A</span> PORT_SCAN <span class="nt">-j</span> DROP
iptables <span class="nt">-A</span> INPUT <span class="nt">-j</span> PORT_SCAN

<span class="c"># 5. ì•„ì›ƒë°”ìš´ë“œ íŠ¸ë˜í”½ ì œì–´</span>
<span class="c"># DNS í—ˆìš© (í•„ìˆ˜)</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> udp <span class="nt">--dport</span> 53 <span class="nt">-d</span> 8.8.8.8 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> udp <span class="nt">--dport</span> 53 <span class="nt">-d</span> 1.1.1.1 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 53 <span class="nt">-j</span> ACCEPT

<span class="c"># NTP í—ˆìš©</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> udp <span class="nt">--dport</span> 123 <span class="nt">-j</span> ACCEPT

<span class="c"># HTTP/HTTPS ì•„ì›ƒë°”ìš´ë“œ (ì—…ë°ì´íŠ¸ìš©)</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 80 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 443 <span class="nt">-j</span> ACCEPT

<span class="c"># SMTP ì•„ì›ƒë°”ìš´ë“œ (ì´ë©”ì¼)</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 587 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 25 <span class="nt">-j</span> ACCEPT

<span class="c"># SSH ì•„ì›ƒë°”ìš´ë“œ (ê´€ë¦¬ìš©)</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 22 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 2222 <span class="nt">-j</span> ACCEPT

<span class="c"># 6. ì§€ë¦¬ì  IP ì°¨ë‹¨ (GeoIP ì‚¬ìš©)</span>
<span class="c"># íŠ¹ì • êµ­ê°€ IP ì°¨ë‹¨ (ì˜ˆ: ëŸ¬ì‹œì•„, ì¤‘êµ­, ë¶í•œ)</span>
<span class="c"># iptables -A INPUT -m geoip --src-cc RU,CN,KP -j LOG --log-prefix "GeoIP Block: "</span>
<span class="c"># iptables -A INPUT -m geoip --src-cc RU,CN,KP -j DROP</span>

<span class="c"># 7. ì• í”Œë¦¬ì¼€ì´ì…˜ë³„ ë³´ì•ˆ ê·œì¹™</span>
<span class="c"># ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ì œí•œ (ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ë§Œ)</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 3306 <span class="nt">-s</span> 192.168.1.0/24 <span class="nt">-j</span> ACCEPT  <span class="c"># MySQL</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 5432 <span class="nt">-s</span> 192.168.1.0/24 <span class="nt">-j</span> ACCEPT  <span class="c"># PostgreSQL</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 3306 <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"MySQL Unauthorized: "</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 3306 <span class="nt">-j</span> DROP
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 5432 <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"PostgreSQL Unauthorized: "</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 5432 <span class="nt">-j</span> DROP

<span class="c"># 8. ì•…ì„± íŠ¸ë˜í”½ ì°¨ë‹¨</span>
<span class="c"># Invalid íŒ¨í‚· ì°¨ë‹¨</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> INVALID <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"Invalid Packet: "</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> INVALID <span class="nt">-j</span> DROP

<span class="c"># NULL ìŠ¤ìº” ì°¨ë‹¨</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> ALL NONE <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"NULL Scan: "</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> ALL NONE <span class="nt">-j</span> DROP

<span class="c"># XMAS ìŠ¤ìº” ì°¨ë‹¨</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> ALL ALL <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"XMAS Scan: "</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--tcp-flags</span> ALL ALL <span class="nt">-j</span> DROP

<span class="c"># 9. ë¡œê¹… ì„¤ì • (ìµœì¢… ë‹¨ê³„)</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-m</span> limit <span class="nt">--limit</span> 5/min <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"INPUT DROP: "</span> <span class="nt">--log-level</span> 7
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-m</span> limit <span class="nt">--limit</span> 5/min <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"OUTPUT DROP: "</span> <span class="nt">--log-level</span> 7

<span class="c"># 10. ì„¤ì • ì €ì¥</span>
iptables-save <span class="o">&gt;</span> /etc/iptables/rules.v4

<span class="c"># 11. ë¶€íŒ… ì‹œ ìë™ ë¡œë“œ ì„¤ì •</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/systemd/system/iptables-restore.service <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
[Unit]
Description=Restore iptables rules
After=network.target

[Service]
Type=oneshot
ExecStart=/sbin/iptables-restore /etc/iptables/rules.v4
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
</span><span class="no">EOF

</span>systemctl <span class="nb">enable </span>iptables-restore.service

<span class="nb">echo</span> <span class="s2">"Advanced iptables configuration completed!"</span>
<span class="nb">echo</span> <span class="s2">"Rules saved to /etc/iptables/rules.v4"</span>
<span class="nb">echo</span> <span class="s2">"Service enabled for boot: iptables-restore.service"</span>

<span class="c"># ê·œì¹™ í™•ì¸</span>
iptables <span class="nt">-L</span> <span class="nt">-n</span> <span class="nt">-v</span> <span class="nt">--line-numbers</span>
</code></pre></div></div>

<h4 id="ufw-ê³ ê¸‰-ì„¤ì •-ë°-ìë™í™”">UFW ê³ ê¸‰ ì„¤ì • ë° ìë™í™”</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/setup-ufw-advanced.sh</span>
<span class="c"># UFW ê³ ê¸‰ ë³´ì•ˆ ì„¤ì •</span>

<span class="c"># UFW ì´ˆê¸°í™” ë° ê¸°ë³¸ ì„¤ì •</span>
ufw <span class="nt">--force</span> reset
ufw default deny incoming
ufw default deny outgoing
ufw default deny forward

<span class="c"># ê¸°ë³¸ ì„œë¹„ìŠ¤ í—ˆìš©</span>
<span class="nb">echo</span> <span class="s2">"Setting up basic services..."</span>

<span class="c"># SSH (ë³´ì•ˆ í¬íŠ¸)</span>
ufw allow from 192.168.1.0/24 to any port 2222 comment <span class="s1">'SSH from LAN'</span>
ufw allow from 10.0.0.0/8 to any port 2222 comment <span class="s1">'SSH from VPN'</span>

<span class="c"># ì•„ì›ƒë°”ìš´ë“œ í•„ìˆ˜ ì„œë¹„ìŠ¤</span>
ufw allow out 53 comment <span class="s1">'DNS'</span>
ufw allow out 123 comment <span class="s1">'NTP'</span>
ufw allow out 80 comment <span class="s1">'HTTP'</span>
ufw allow out 443 comment <span class="s1">'HTTPS'</span>

<span class="c"># ë©”ì¼ ë°œì†¡</span>
ufw allow out 587 comment <span class="s1">'SMTP-TLS'</span>
ufw allow out 25 comment <span class="s1">'SMTP'</span>

<span class="c"># ì›¹ ì„œë²„ (ìˆëŠ” ê²½ìš°)</span>
<span class="c"># ufw allow 80 comment 'HTTP Server'</span>
<span class="c"># ufw allow 443 comment 'HTTPS Server'</span>

<span class="c"># ê³ ê¸‰ ê·œì¹™ ì„¤ì •</span>
<span class="nb">echo</span> <span class="s2">"Setting up advanced rules..."</span>

<span class="c"># 1. ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œíŒŒì¼ ìƒì„±</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/ufw/applications.d/custom-apps <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
[SSH-Custom]
title=SSH Custom Port
description=SSH on custom port 2222
ports=2222/tcp

[Database-Internal]
title=Database Internal Access
description=MySQL/PostgreSQL for internal network
ports=3306,5432/tcp

[Monitoring]
title=Monitoring Services
description=Prometheus, Grafana, etc.
ports=9090,3000,9100/tcp
</span><span class="no">EOF

</span>ufw app update SSH-Custom
ufw allow SSH-Custom

<span class="c"># 2. Rate limiting ì„¤ì •</span>
ufw limit ssh comment <span class="s1">'Rate limit SSH'</span>
ufw limit 80/tcp comment <span class="s1">'Rate limit HTTP'</span>
ufw limit 443/tcp comment <span class="s1">'Rate limit HTTPS'</span>

<span class="c"># 3. íŠ¹ì • IP ì°¨ë‹¨ (ì˜ˆì‹œ)</span>
<span class="c"># ì•Œë ¤ì§„ ì•…ì„± IP ì°¨ë‹¨</span>
<span class="nv">MALICIOUS_IPS</span><span class="o">=(</span>
    <span class="s2">"192.0.2.100"</span>
    <span class="s2">"203.0.113.50"</span>
<span class="o">)</span>

<span class="k">for </span>ip <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">MALICIOUS_IPS</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
    </span>ufw deny from <span class="s2">"</span><span class="nv">$ip</span><span class="s2">"</span> comment <span class="s2">"Known malicious IP"</span>
<span class="k">done</span>

<span class="c"># 4. ì§€ì—­ë³„ ì ‘ê·¼ ì œí•œ (ì˜ˆì‹œ)</span>
<span class="c"># ê´€ë¦¬ ì„œë¹„ìŠ¤ëŠ” êµ­ë‚´ IPë§Œ í—ˆìš©</span>
ufw allow from 220.0.0.0/8 to any port 22 comment <span class="s1">'Korea Telecom range'</span>
ufw allow from 121.0.0.0/8 to any port 22 comment <span class="s1">'SK Broadband range'</span>

<span class="c"># 5. ë¡œê¹… ì„¤ì •</span>
ufw logging on

<span class="c"># 6. UFW í™œì„±í™”</span>
ufw <span class="nt">--force</span> <span class="nb">enable</span>

<span class="c"># 7. ìƒíƒœ ì¶œë ¥</span>
ufw status verbose

<span class="c"># 8. UFW ë¡œê·¸ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /usr/local/bin/ufw-log-monitor.sh <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
#!/bin/bash
# UFW ë¡œê·¸ ëª¨ë‹ˆí„°ë§ ë° ë¶„ì„

UFW_LOG="/var/log/ufw.log"
ALERT_EMAIL="admin@company.com"

# ë¡œê·¸ íŒ¨í„´ ë¶„ì„
analyze_ufw_logs() {
    echo "=== UFW Log Analysis Report </span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="sh"> ==="
    
    # ìµœê·¼ 1ì‹œê°„ ë™ì•ˆì˜ ì°¨ë‹¨ëœ ì—°ê²°
    echo "Top blocked IPs (last hour):"
    grep "</span><span class="si">$(</span><span class="nb">date</span> <span class="nt">-d</span> <span class="s1">'1 hour ago'</span> <span class="s1">'+%b %d %H'</span><span class="si">)</span><span class="sh">" "</span><span class="nv">$UFW_LOG</span><span class="sh">" 2&gt;/dev/null | </span><span class="se">\</span><span class="sh">
    grep "BLOCK" | awk '{print </span><span class="si">$(</span>NF-1<span class="si">)</span><span class="sh">}' | cut -d= -f2 | </span><span class="se">\</span><span class="sh">
    sort | uniq -c | sort -nr | head -10
    
    echo ""
    
    # í¬íŠ¸ë³„ ê³µê²© í†µê³„
    echo "Top attacked ports (last hour):"
    grep "</span><span class="si">$(</span><span class="nb">date</span> <span class="nt">-d</span> <span class="s1">'1 hour ago'</span> <span class="s1">'+%b %d %H'</span><span class="si">)</span><span class="sh">" "</span><span class="nv">$UFW_LOG</span><span class="sh">" 2&gt;/dev/null | </span><span class="se">\</span><span class="sh">
    grep "BLOCK" | grep -o "DPT=[0-9]*" | cut -d= -f2 | </span><span class="se">\</span><span class="sh">
    sort | uniq -c | sort -nr | head -10
    
    echo ""
    
    # í”„ë¡œí† ì½œë³„ í†µê³„
    echo "Protocol statistics (last hour):"
    grep "</span><span class="si">$(</span><span class="nb">date</span> <span class="nt">-d</span> <span class="s1">'1 hour ago'</span> <span class="s1">'+%b %d %H'</span><span class="si">)</span><span class="sh">" "</span><span class="nv">$UFW_LOG</span><span class="sh">" 2&gt;/dev/null | </span><span class="se">\</span><span class="sh">
    grep "BLOCK" | grep -o "PROTO=[A-Z]*" | cut -d= -f2 | </span><span class="se">\</span><span class="sh">
    sort | uniq -c | sort -nr
    
    echo "=================================="
}

# ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
monitor_realtime() {
    tail -f "</span><span class="nv">$UFW_LOG</span><span class="sh">" | while read line; do
        if echo "</span><span class="nv">$line</span><span class="sh">" | grep -q "BLOCK"; then
            src_ip=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-o</span> <span class="s2">"SRC=[0-9.]*"</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="o">=</span> <span class="nt">-f2</span><span class="si">)</span><span class="sh">
            dst_port=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-o</span> <span class="s2">"DPT=[0-9]*"</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="o">=</span> <span class="nt">-f2</span><span class="si">)</span><span class="sh">
            
            # ë†’ì€ ë¹ˆë„ ê³µê²© ê°ì§€
            recent_blocks=</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-c</span> <span class="s2">"</span><span class="nv">$src_ip</span><span class="s2">"</span> &lt;<span class="o">(</span><span class="nb">tail</span> <span class="nt">-100</span> <span class="s2">"</span><span class="nv">$UFW_LOG</span><span class="s2">"</span><span class="o">)</span><span class="si">)</span><span class="sh">
            
            if [ "</span><span class="nv">$recent_blocks</span><span class="sh">" -gt 10 ]; then
                echo "</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="sh">: High frequency attack from </span><span class="nv">$src_ip</span><span class="sh"> (port </span><span class="nv">$dst_port</span><span class="sh">)"
                # ìë™ ì°¨ë‹¨ ê°•í™” (ì„ íƒì‚¬í•­)
                # ufw insert 1 deny from "</span><span class="nv">$src_ip</span><span class="sh">" comment "Auto-blocked: high frequency"
            fi
        fi
    done
}

case "</span><span class="nv">$1</span><span class="sh">" in
    "analyze")
        analyze_ufw_logs
        ;;
    "monitor")
        echo "Starting real-time UFW monitoring... (Ctrl+C to stop)"
        monitor_realtime
        ;;
    "report")
        analyze_ufw_logs | mail -s "UFW Security Report" "</span><span class="nv">$ALERT_EMAIL</span><span class="sh">"
        ;;
    *)
        echo "Usage: </span><span class="nv">$0</span><span class="sh"> {analyze|monitor|report}"
        exit 1
        ;;
esac
</span><span class="no">EOF

</span><span class="nb">chmod</span> +x /usr/local/bin/ufw-log-monitor.sh

<span class="c"># 9. ì •ê¸°ì ì¸ ë¡œê·¸ ë¶„ì„ ì„¤ì •</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/cron.hourly/ufw-analysis <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
#!/bin/bash
/usr/local/bin/ufw-log-monitor.sh analyze &gt;&gt; /var/log/ufw-analysis.log
</span><span class="no">EOF

</span><span class="nb">chmod</span> +x /etc/cron.hourly/ufw-analysis

<span class="nb">echo</span> <span class="s2">"UFW advanced configuration completed!"</span>
<span class="nb">echo</span> <span class="s2">"Monitor logs with: /usr/local/bin/ufw-log-monitor.sh monitor"</span>
<span class="nb">echo</span> <span class="s2">"View status with: ufw status verbose"</span>
</code></pre></div></div>

<h2 id="ë‹¤ìŒ-í¸-ì˜ˆê³ ">ë‹¤ìŒ í¸ ì˜ˆê³ </h2>

<p>ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” <strong>SELinux/AppArmorì™€ ì‹œìŠ¤í…œ í•˜ë“œë‹</strong>ì„ ìì„¸íˆ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤:</p>
<ul>
  <li>SELinux ì •ì±… ì‘ì„± ë° ê´€ë¦¬</li>
  <li>AppArmor í”„ë¡œíŒŒì¼ ì»¤ìŠ¤í„°ë§ˆì´ì§•</li>
  <li>ì»¤ë„ ë³´ì•ˆ ë§¤ê°œë³€ìˆ˜ ìµœì í™”</li>
  <li>íŒŒì¼ ì‹œìŠ¤í…œ ë³´ì•ˆ ê°•í™”</li>
</ul>

<p>SSHì™€ ë°©í™”ë²½ ë³´ì•ˆì„ ì™„ë²½í•˜ê²Œ ë§ˆìŠ¤í„°í•˜ì…¨ë‚˜ìš”? ğŸ”ğŸ›¡ï¸</p>]]></content><author><name>DevOps Engineer</name></author><category term="Security" /><category term="Linux" /><category term="ssh" /><category term="firewall" /><category term="iptables" /><category term="ufw" /><category term="ssh-keys" /><category term="port-forwarding" /><summary type="html"><![CDATA[SSH ë³´ì•ˆì„ í•œ ë‹¨ê³„ ë†’ì´ê³  ê°•ë ¥í•œ ë°©í™”ë²½ ì •ì±…ì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ì™„ë²½í•˜ê²Œ ë§ˆìŠ¤í„°í•´ë³´ê² ìŠµë‹ˆë‹¤. SSH í‚¤ ê´€ë¦¬ë¶€í„° ê³ ê¸‰ ë°©í™”ë²½ ì„¤ì •ê¹Œì§€ ì‹¤ë¬´ì—ì„œ ë°”ë¡œ í™œìš©í•  ìˆ˜ ìˆëŠ” ë‚´ìš©ìœ¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤. SSH ê³ ê¸‰ ë³´ì•ˆ ì„¤ì • | Advanced SSH Security ğŸ”‘ SSH í‚¤ ê¸°ë°˜ ì¸ì¦ ì™„ë²½ êµ¬ì¶• ê°•í™”ëœ SSH í‚¤ ìƒì„± ë° ê´€ë¦¬ # ìµœì‹  ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•œ í‚¤ ìƒì„± # ED25519 (ê¶Œì¥ - ë¹ ë¥´ê³  ì•ˆì „) ssh-keygen -t ed25519 -b 4096 -C "admin@company.com-$(date +%Y%m%d)" -f ~/.ssh/id_ed25519_admin # RSA í‚¤ (í˜¸í™˜ì„±ì´ í•„ìš”í•œ ê²½ìš°) ssh-keygen -t rsa -b 4096 -C "admin@company.com-$(date +%Y%m%d)" -f ~/.ssh/id_rsa_admin # ECDSA í‚¤ (ëŒ€ì•ˆ) ssh-keygen -t ecdsa -b 521 -C "admin@company.com-$(date +%Y%m%d)" -f ~/.ssh/id_ecdsa_admin # í‚¤ ìƒì„± ì‹œ ë³´ì•ˆ ì˜µì…˜ ssh-keygen -t ed25519 -b 4096 \ -C "admin@company.com-$(date +%Y%m%d)" \ -f ~/.ssh/id_ed25519_admin \ -N "$(openssl rand -base64 32)" \ # ê°•ë ¥í•œ íŒ¨ìŠ¤í”„ë ˆì´ì¦ˆ ìë™ ìƒì„± -o \ # OpenSSH í˜•ì‹ ì‚¬ìš© -a 100 # KDF ë¼ìš´ë“œ ìˆ˜ ì¦ê°€ # í‚¤ ê¶Œí•œ ì„¤ì • (ì¤‘ìš”!) chmod 700 ~/.ssh chmod 600 ~/.ssh/id_* chmod 644 ~/.ssh/id_*.pub chmod 600 ~/.ssh/authorized_keys chmod 600 ~/.ssh/config # í‚¤ í•‘ê±°í”„ë¦°íŠ¸ í™•ì¸ ssh-keygen -lf ~/.ssh/id_ed25519_admin.pub ssh-keygen -E sha256 -lf ~/.ssh/id_ed25519_admin.pub # SHA256 í•´ì‹œ # í‚¤ ë§Œë£Œì¼ ì„¤ì • (OpenSSH 8.2+) ssh-keygen -t ed25519 -V +365d -C "expires-$(date -d '+1 year' +%Y%m%d)" SSH í´ë¼ì´ì–¸íŠ¸ ì„¤ì • ìµœì í™” # ~/.ssh/config - í´ë¼ì´ì–¸íŠ¸ ì„¤ì • # ê¸°ë³¸ ì„¤ì • Host * # ë³´ì•ˆ ì„¤ì • Protocol 2 HashKnownHosts yes VisualHostKey yes StrictHostKeyChecking ask UserKnownHostsFile ~/.ssh/known_hosts # ì—°ê²° ì„¤ì • ServerAliveInterval 60 ServerAliveCountMax 3 ConnectTimeout 10 TCPKeepAlive no # ì•”í˜¸í™” ì„¤ì • Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com KexAlgorithms curve25519-sha256@libssh.org,diffie-hellman-group16-sha512 MACs hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com HostKeyAlgorithms ssh-ed25519,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521 # ì¸ì¦ ì„¤ì • PreferredAuthentications publickey,keyboard-interactive,password PubkeyAuthentication yes PasswordAuthentication no GSSAPIAuthentication no # í¬ì›Œë”© ì„¤ì • (ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”) ForwardAgent no ForwardX11 no ForwardX11Trusted no # ì„œë²„ë³„ ê°œë³„ ì„¤ì • Host production-server HostName 192.168.1.100 Port 2222 User admin IdentityFile ~/.ssh/id_ed25519_admin IdentitiesOnly yes RequestTTY yes RemoteForward 9000 localhost:9000 Host development-* Port 22 User developer IdentityFile ~/.ssh/id_ed25519_dev StrictHostKeyChecking no # ê°œë°œ ì„œë²„ìš© UserKnownHostsFile /dev/null LogLevel QUIET Host bastion HostName bastion.company.com Port 2222 User jumpuser IdentityFile ~/.ssh/id_ed25519_jump ControlMaster auto ControlPath ~/.ssh/control-%h-%p-%r ControlPersist 600 # ë² ìŠ¤ì²œ í˜¸ìŠ¤íŠ¸ë¥¼ í†µí•œ ì ‘ê·¼ Host internal-* ProxyJump bastion User admin IdentityFile ~/.ssh/id_ed25519_admin # í‚¤ ì—ì´ì „íŠ¸ ì„¤ì • # ~/.bashrcì— ì¶”ê°€ if [ -z "$SSH_AUTH_SOCK" ]; then eval $(ssh-agent -s) ssh-add ~/.ssh/id_ed25519_admin ssh-add ~/.ssh/id_ed25519_dev fi # í‚¤ ë§Œë£Œ í™•ì¸ ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # /usr/local/bin/check-ssh-keys.sh for keyfile in ~/.ssh/id_*; do if [[ -f "$keyfile" &amp;&amp; ! "$keyfile" == *.pub ]]; then echo "Checking $keyfile..." ssh-keygen -l -f "$keyfile" 2&gt;/dev/null || echo " Invalid or encrypted key" fi done SSH Certificate Authority (CA) êµ¬ì¶• # 1. CA í‚¤ ìƒì„± (ë³´ì•ˆì´ ì¤‘ìš”í•œ ë³„ë„ ì‹œìŠ¤í…œì—ì„œ) ssh-keygen -t ed25519 -f /etc/ssh/ca_key -C "SSH-CA-$(date +%Y%m%d)" chmod 600 /etc/ssh/ca_key chmod 644 /etc/ssh/ca_key.pub # 2. ì‚¬ìš©ì ì¸ì¦ì„œ ë°œê¸‰ # ë‹¨ê¸°ê°„ ìœ íš¨í•œ ì‚¬ìš©ì ì¸ì¦ì„œ (1ì£¼ì¼) ssh-keygen -s /etc/ssh/ca_key \ -I "john-doe-$(date +%Y%m%d)" \ -n john,admin \ -V +7d \ -z 1001 \ ~/.ssh/id_ed25519.pub # í˜¸ìŠ¤íŠ¸ë³„ ì œí•œëœ ì¸ì¦ì„œ ssh-keygen -s /etc/ssh/ca_key \ -I "backup-service" \ -n backup \ -V +1d \ -O clear \ -O source-address="192.168.1.100/32" \ -O force-command="/usr/local/bin/backup-script" \ ~/.ssh/id_ed25519_backup.pub # ê¶Œí•œ ì œí•œ ì¸ì¦ì„œ ssh-keygen -s /etc/ssh/ca_key \ -I "readonly-access" \ -n readonly \ -V +1h \ -O clear \ -O no-agent-forwarding \ -O no-port-forwarding \ -O no-pty \ -O no-user-rc \ ~/.ssh/id_ed25519_readonly.pub # 3. ì„œë²„ ì„¤ì •ì—ì„œ CA ì‹ ë¢° # /etc/ssh/sshd_config TrustedUserCAKeys /etc/ssh/ca_key.pub AuthorizedPrincipalsFile /etc/ssh/auth_principals/%u PubkeyAuthentication yes CertificateAuthentication yes # 4. ì‚¬ìš©ìë³„ ì£¼ì²´(principal) ì„¤ì • # /etc/ssh/auth_principals/john john admin developer # /etc/ssh/auth_principals/backup backup # 5. í˜¸ìŠ¤íŠ¸ ì¸ì¦ì„œë„ êµ¬ì¶• # í˜¸ìŠ¤íŠ¸ í‚¤ì— ëŒ€í•œ ì¸ì¦ì„œ ë°œê¸‰ ssh-keygen -s /etc/ssh/ca_key \ -I "server1.company.com" \ -h \ -n server1.company.com,server1,192.168.1.100 \ -V +365d \ /etc/ssh/ssh_host_ed25519_key.pub # í´ë¼ì´ì–¸íŠ¸ì—ì„œ í˜¸ìŠ¤íŠ¸ CA ì‹ ë¢° # ~/.ssh/known_hostsì— ì¶”ê°€ @cert-authority *.company.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICAKeyFromCA... # 6. ì¸ì¦ì„œ ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # /usr/local/bin/ssh-cert-manager.sh ACTION=$1 USER=$2 DAYS=${3:-7} case $ACTION in "issue") if [ -z "$USER" ]; then echo "Usage: $0 issue &lt;username&gt; [days]" exit 1 fi USER_KEY="/home/$USER/.ssh/id_ed25519.pub" if [ ! -f "$USER_KEY" ]; then echo "User key not found: $USER_KEY" exit 1 fi ssh-keygen -s /etc/ssh/ca_key \ -I "$USER-$(date +%Y%m%d-%H%M%S)" \ -n "$USER" \ -V "+${DAYS}d" \ "$USER_KEY" echo "Certificate issued for $USER, valid for $DAYS days" ;; "revoke") # ì¸ì¦ì„œ íê¸° ëª©ë¡ ê´€ë¦¬ CERT_SERIAL=$(ssh-keygen -L -f "/home/$USER/.ssh/id_ed25519-cert.pub" | grep Serial | awk '{print $2}') echo "$CERT_SERIAL" &gt;&gt; /etc/ssh/revoked_keys echo "Certificate revoked for $USER" ;; "list") echo "Active certificates:" for cert in /home/*/.ssh/*-cert.pub; do if [ -f "$cert" ]; then echo "$(basename $(dirname $cert)): $(ssh-keygen -L -f $cert | grep Valid)" fi done ;; *) echo "Usage: $0 {issue|revoke|list} &lt;username&gt; [days]" exit 1 ;; esac ğŸ›¡ï¸ SSH ì„œë²„ ê³ ê¸‰ ë³´ì•ˆ ì„¤ì • ê°•í™”ëœ sshd_config ì„¤ì • # /etc/ssh/sshd_config - ìµœê³  ë³´ì•ˆ ìˆ˜ì¤€ ì„¤ì • # ê¸°ë³¸ ì„¤ì • Protocol 2 Port 2222 # ê¸°ë³¸ í¬íŠ¸ ë³€ê²½ AddressFamily inet # IPv4ë§Œ ì‚¬ìš© (í•„ìš”ì‹œ) ListenAddress 192.168.1.100 # íŠ¹ì • IPë§Œ ë°”ì¸ë”© # ì•”í˜¸í™” ë° í‚¤ êµí™˜ Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr MACs hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha2-256,hmac-sha2-512 KexAlgorithms curve25519-sha256@libssh.org,ecdh-sha2-nistp521,ecdh-sha2-nistp384,ecdh-sha2-nistp256,diffie-hellman-group16-sha512 # í˜¸ìŠ¤íŠ¸ í‚¤ ì„¤ì • (ì•½í•œ í‚¤ ì œê±°) HostKey /etc/ssh/ssh_host_ed25519_key HostKey /etc/ssh/ssh_host_ecdsa_key # RSA í‚¤ëŠ” 4096ë¹„íŠ¸ ì´ìƒë§Œ ì‚¬ìš© HostKey /etc/ssh/ssh_host_rsa_key # ì¸ì¦ ì„¤ì • PubkeyAuthentication yes AuthorizedKeysFile .ssh/authorized_keys PasswordAuthentication no PermitEmptyPasswords no ChallengeResponseAuthentication no GSSAPIAuthentication no HostbasedAuthentication no IgnoreUserKnownHosts yes PermitRootLogin no # ë¡œê·¸ì¸ ì œí•œ LoginGraceTime 30 MaxAuthTries 3 MaxSessions 3 MaxStartups 3:30:10 ClientAliveInterval 300 ClientAliveCountMax 2 # ì‚¬ìš©ì/ê·¸ë£¹ ì œí•œ AllowUsers admin developer AllowGroups sshusers DenyUsers guest anonymous backup DenyGroups wheel nogroup # ê¸°ëŠ¥ ì œí•œ X11Forwarding no AllowTcpForwarding no GatewayPorts no PermitTunnel no PermitUserEnvironment no PermitUserRC no PrintMotd yes PrintLastLog yes TCPKeepAlive no Compression no # ì••ì¶• ë¹„í™œì„±í™” (ë³´ì•ˆ) # ë¡œê¹… SyslogFacility AUTH LogLevel VERBOSE # ìƒì„¸ ë¡œê¹… # Chroot ì„¤ì • (SFTP ì „ìš© ì‚¬ìš©ì) Subsystem sftp /usr/lib/openssh/sftp-server # ì¡°ê±´ë¶€ ì„¤ì • Match User sftpuser ChrootDirectory /var/sftp/%u ForceCommand internal-sftp AllowTcpForwarding no X11Forwarding no PermitTunnel no Match Address 192.168.1.0/24 PasswordAuthentication yes MaxAuthTries 5 Match Address 10.0.0.0/8 AllowTcpForwarding local GatewayPorts no Match Group developers AllowTcpForwarding yes PermitOpen localhost:3000 localhost:8080 # ì„¤ì • ê²€ì¦ sshd -t sshd -T | grep -i cipher # ì•”í˜¸í™” ì„¤ì • í™•ì¸ sshd -T | grep -i mac # MAC ì„¤ì • í™•ì¸ SSH ì ‘ê·¼ ì œì–´ ë° ëª¨ë‹ˆí„°ë§ # 1. TCP Wrapper ì„¤ì • # /etc/hosts.allow sshd: 192.168.1.0/24 : ALLOW sshd: 10.0.0.0/8 : ALLOW sshd: ALL : spawn (/usr/local/bin/log-ssh-attempt %a %d) : DENY # /etc/hosts.deny sshd: ALL # 2. SSH ì ‘ê·¼ ë¡œê¹… ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # /usr/local/bin/log-ssh-attempt CLIENT_IP=$1 DAEMON=$2 TIMESTAMP=$(date) echo "$TIMESTAMP: Blocked SSH attempt from $CLIENT_IP to $DAEMON" &gt;&gt; /var/log/ssh-blocked.log # ì§€ë¦¬ì  ìœ„ì¹˜ í™•ì¸ (ì„ íƒì‚¬í•­) # LOCATION=$(geoiplookup $CLIENT_IP 2&gt;/dev/null | cut -d: -f2) # echo "$TIMESTAMP: $CLIENT_IP ($LOCATION) blocked" &gt;&gt; /var/log/ssh-geo.log # 3. SSH ì„¸ì…˜ ëª¨ë‹ˆí„°ë§ #!/bin/bash # /usr/local/bin/ssh-monitor.sh # í™œì„± SSH ì„¸ì…˜ ëª¨ë‹ˆí„°ë§ while true; do ACTIVE_SESSIONS=$(who | grep -c "pts/") SSH_PROCESSES=$(pgrep -c sshd) if [ $ACTIVE_SESSIONS -gt 10 ]; then echo "$(date): High SSH session count: $ACTIVE_SESSIONS" &gt;&gt; /var/log/ssh-monitor.log # ì•Œë¦¼ ë°œì†¡ echo "High SSH session count detected: $ACTIVE_SESSIONS active sessions" | \ mail -s "SSH Monitor Alert" admin@company.com fi # ì¥ì‹œê°„ ìœ ì§€ë˜ëŠ” ì„¸ì…˜ í™•ì¸ who | while read user tty time rest; do # 12ì‹œê°„ ì´ìƒ ìœ ì§€ëœ ì„¸ì…˜ í™•ì¸ if [[ "$time" &lt; "$(date -d '12 hours ago' '+%H:%M')" ]]; then echo "$(date): Long running session: $user on $tty since $time" &gt;&gt; /var/log/ssh-monitor.log fi done sleep 60 done # 4. SSH í‚¤ ë¡œí…Œì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # /usr/local/bin/ssh-key-rotation.sh # 90ì¼ë§ˆë‹¤ í˜¸ìŠ¤íŠ¸ í‚¤ ë¡œí…Œì´ì…˜ HOSTKEY_AGE=$(find /etc/ssh/ssh_host_*_key -mtime +90 2&gt;/dev/null | wc -l) if [ $HOSTKEY_AGE -gt 0 ]; then echo "$(date): Host keys are older than 90 days. Rotation recommended." &gt;&gt; /var/log/ssh-key-rotation.log # ë°±ì—… cp -r /etc/ssh /etc/ssh.backup.$(date +%Y%m%d) # ìƒˆ í‚¤ ìƒì„± ssh-keygen -A # ì„œë¹„ìŠ¤ ì¬ì‹œì‘ systemctl restart sshd echo "$(date): Host keys rotated successfully" &gt;&gt; /var/log/ssh-key-rotation.log fi # ì‚¬ìš©ì í‚¤ ë§Œë£Œ í™•ì¸ for user_home in /home/*; do username=$(basename $user_home) auth_keys="$user_home/.ssh/authorized_keys" if [ -f "$auth_keys" ]; then while read -r key; do if [[ $key =~ ^ssh- ]]; then # í‚¤ ìƒì„±ì¼ í™•ì¸ (ì½”ë©˜íŠ¸ì—ì„œ ë‚ ì§œ ì¶”ì¶œ) key_date=$(echo $key | grep -o '[0-9]\{8\}' | head -1) if [ -n "$key_date" ]; then key_age=$(( ($(date +%s) - $(date -d "$key_date" +%s)) / 86400 )) if [ $key_age -gt 365 ]; then echo "$(date): User $username has key older than 1 year ($key_age days)" &gt;&gt; /var/log/ssh-key-rotation.log fi fi fi done &lt; "$auth_keys" fi done ğŸ”¥ ë°©í™”ë²½ ë³´ì•ˆ ì„¤ì • iptables ê³ ê¸‰ ë³´ì•ˆ ê·œì¹™ #!/bin/bash # /usr/local/bin/setup-iptables-advanced.sh # ê³ ê¸‰ iptables ë³´ì•ˆ ì„¤ì • ìŠ¤í¬ë¦½íŠ¸ # ê¸°ì¡´ ê·œì¹™ ì´ˆê¸°í™” iptables -F iptables -X iptables -t nat -F iptables -t nat -X iptables -t mangle -F iptables -t mangle -X iptables -t raw -F iptables -t raw -X # ê¸°ë³¸ ì •ì±… ì„¤ì • (ëª¨ë“  íŠ¸ë˜í”½ ì°¨ë‹¨) iptables -P INPUT DROP iptables -P FORWARD DROP iptables -P OUTPUT DROP # 1. ê¸°ë³¸ í—ˆìš© ê·œì¹™ # Loopback ì¸í„°í˜ì´ìŠ¤ í—ˆìš© iptables -A INPUT -i lo -j ACCEPT iptables -A OUTPUT -o lo -j ACCEPT # ê¸°ì¡´ ì—°ê²° ìœ ì§€ iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT iptables -A OUTPUT -m conntrack --ctstate ESTABLISHED -j ACCEPT iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT # 2. SSH ë³´ì•ˆ ê·œì¹™ (ê³ ê¸‰) # SSH ë¸Œë£¨íŠ¸í¬ìŠ¤ ë°©ì§€ (ë³µí•©ì  ì ‘ê·¼) iptables -N SSH_BRUTEFORCE iptables -A SSH_BRUTEFORCE -m recent --set --name SSH_ATTACK iptables -A SSH_BRUTEFORCE -m recent --update --seconds 3600 --hitcount 3 --name SSH_ATTACK -j LOG --log-prefix "SSH Bruteforce: " iptables -A SSH_BRUTEFORCE -m recent --update --seconds 3600 --hitcount 3 --name SSH_ATTACK -j DROP iptables -A SSH_BRUTEFORCE -j ACCEPT # SSH ì ‘ê·¼ ì œí•œ iptables -A INPUT -p tcp --dport 2222 -s 192.168.1.0/24 -j SSH_BRUTEFORCE iptables -A INPUT -p tcp --dport 2222 -s 10.0.0.0/8 -j SSH_BRUTEFORCE iptables -A INPUT -p tcp --dport 2222 -j LOG --log-prefix "SSH Unauthorized: " iptables -A INPUT -p tcp --dport 2222 -j DROP # 3. ì›¹ ì„œë²„ ë³´ì•ˆ (ìˆëŠ” ê²½ìš°) # HTTP/HTTPS with rate limiting iptables -N WEB_RATE_LIMIT iptables -A WEB_RATE_LIMIT -m limit --limit 25/minute --limit-burst 100 -j ACCEPT iptables -A WEB_RATE_LIMIT -j LOG --log-prefix "HTTP Rate Limit: " iptables -A WEB_RATE_LIMIT -j DROP iptables -A INPUT -p tcp --dport 80 -j WEB_RATE_LIMIT iptables -A INPUT -p tcp --dport 443 -j WEB_RATE_LIMIT # 4. DDoS ë°©ì§€ ê·œì¹™ # SYN Flood ë°©ì§€ iptables -A INPUT -p tcp --syn -m limit --limit 1/second --limit-burst 3 -j ACCEPT iptables -A INPUT -p tcp --syn -j LOG --log-prefix "SYN Flood: " iptables -A INPUT -p tcp --syn -j DROP # Ping Flood ë°©ì§€ iptables -A INPUT -p icmp --icmp-type echo-request -m limit --limit 1/second --limit-burst 2 -j ACCEPT iptables -A INPUT -p icmp --icmp-type echo-request -j LOG --log-prefix "Ping Flood: " iptables -A INPUT -p icmp --icmp-type echo-request -j DROP # Port Scan ë°©ì§€ iptables -N PORT_SCAN iptables -A PORT_SCAN -p tcp --tcp-flags SYN,ACK,FIN,RST RST -m limit --limit 1/s --limit-burst 2 -j RETURN iptables -A PORT_SCAN -j LOG --log-prefix "Port Scan: " iptables -A PORT_SCAN -j DROP iptables -A INPUT -j PORT_SCAN # 5. ì•„ì›ƒë°”ìš´ë“œ íŠ¸ë˜í”½ ì œì–´ # DNS í—ˆìš© (í•„ìˆ˜) iptables -A OUTPUT -p udp --dport 53 -d 8.8.8.8 -j ACCEPT iptables -A OUTPUT -p udp --dport 53 -d 1.1.1.1 -j ACCEPT iptables -A OUTPUT -p tcp --dport 53 -j ACCEPT # NTP í—ˆìš© iptables -A OUTPUT -p udp --dport 123 -j ACCEPT # HTTP/HTTPS ì•„ì›ƒë°”ìš´ë“œ (ì—…ë°ì´íŠ¸ìš©) iptables -A OUTPUT -p tcp --dport 80 -j ACCEPT iptables -A OUTPUT -p tcp --dport 443 -j ACCEPT # SMTP ì•„ì›ƒë°”ìš´ë“œ (ì´ë©”ì¼) iptables -A OUTPUT -p tcp --dport 587 -j ACCEPT iptables -A OUTPUT -p tcp --dport 25 -j ACCEPT # SSH ì•„ì›ƒë°”ìš´ë“œ (ê´€ë¦¬ìš©) iptables -A OUTPUT -p tcp --dport 22 -j ACCEPT iptables -A OUTPUT -p tcp --dport 2222 -j ACCEPT # 6. ì§€ë¦¬ì  IP ì°¨ë‹¨ (GeoIP ì‚¬ìš©) # íŠ¹ì • êµ­ê°€ IP ì°¨ë‹¨ (ì˜ˆ: ëŸ¬ì‹œì•„, ì¤‘êµ­, ë¶í•œ) # iptables -A INPUT -m geoip --src-cc RU,CN,KP -j LOG --log-prefix "GeoIP Block: " # iptables -A INPUT -m geoip --src-cc RU,CN,KP -j DROP # 7. ì• í”Œë¦¬ì¼€ì´ì…˜ë³„ ë³´ì•ˆ ê·œì¹™ # ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ì œí•œ (ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ë§Œ) iptables -A INPUT -p tcp --dport 3306 -s 192.168.1.0/24 -j ACCEPT # MySQL iptables -A INPUT -p tcp --dport 5432 -s 192.168.1.0/24 -j ACCEPT # PostgreSQL iptables -A INPUT -p tcp --dport 3306 -j LOG --log-prefix "MySQL Unauthorized: " iptables -A INPUT -p tcp --dport 3306 -j DROP iptables -A INPUT -p tcp --dport 5432 -j LOG --log-prefix "PostgreSQL Unauthorized: " iptables -A INPUT -p tcp --dport 5432 -j DROP # 8. ì•…ì„± íŠ¸ë˜í”½ ì°¨ë‹¨ # Invalid íŒ¨í‚· ì°¨ë‹¨ iptables -A INPUT -m conntrack --ctstate INVALID -j LOG --log-prefix "Invalid Packet: " iptables -A INPUT -m conntrack --ctstate INVALID -j DROP # NULL ìŠ¤ìº” ì°¨ë‹¨ iptables -A INPUT -p tcp --tcp-flags ALL NONE -j LOG --log-prefix "NULL Scan: " iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP # XMAS ìŠ¤ìº” ì°¨ë‹¨ iptables -A INPUT -p tcp --tcp-flags ALL ALL -j LOG --log-prefix "XMAS Scan: " iptables -A INPUT -p tcp --tcp-flags ALL ALL -j DROP # 9. ë¡œê¹… ì„¤ì • (ìµœì¢… ë‹¨ê³„) iptables -A INPUT -m limit --limit 5/min -j LOG --log-prefix "INPUT DROP: " --log-level 7 iptables -A OUTPUT -m limit --limit 5/min -j LOG --log-prefix "OUTPUT DROP: " --log-level 7 # 10. ì„¤ì • ì €ì¥ iptables-save &gt; /etc/iptables/rules.v4 # 11. ë¶€íŒ… ì‹œ ìë™ ë¡œë“œ ì„¤ì • cat &gt; /etc/systemd/system/iptables-restore.service &lt;&lt; 'EOF' [Unit] Description=Restore iptables rules After=network.target [Service] Type=oneshot ExecStart=/sbin/iptables-restore /etc/iptables/rules.v4 RemainAfterExit=yes [Install] WantedBy=multi-user.target EOF systemctl enable iptables-restore.service echo "Advanced iptables configuration completed!" echo "Rules saved to /etc/iptables/rules.v4" echo "Service enabled for boot: iptables-restore.service" # ê·œì¹™ í™•ì¸ iptables -L -n -v --line-numbers UFW ê³ ê¸‰ ì„¤ì • ë° ìë™í™” #!/bin/bash # /usr/local/bin/setup-ufw-advanced.sh # UFW ê³ ê¸‰ ë³´ì•ˆ ì„¤ì • # UFW ì´ˆê¸°í™” ë° ê¸°ë³¸ ì„¤ì • ufw --force reset ufw default deny incoming ufw default deny outgoing ufw default deny forward # ê¸°ë³¸ ì„œë¹„ìŠ¤ í—ˆìš© echo "Setting up basic services..." # SSH (ë³´ì•ˆ í¬íŠ¸) ufw allow from 192.168.1.0/24 to any port 2222 comment 'SSH from LAN' ufw allow from 10.0.0.0/8 to any port 2222 comment 'SSH from VPN' # ì•„ì›ƒë°”ìš´ë“œ í•„ìˆ˜ ì„œë¹„ìŠ¤ ufw allow out 53 comment 'DNS' ufw allow out 123 comment 'NTP' ufw allow out 80 comment 'HTTP' ufw allow out 443 comment 'HTTPS' # ë©”ì¼ ë°œì†¡ ufw allow out 587 comment 'SMTP-TLS' ufw allow out 25 comment 'SMTP' # ì›¹ ì„œë²„ (ìˆëŠ” ê²½ìš°) # ufw allow 80 comment 'HTTP Server' # ufw allow 443 comment 'HTTPS Server' # ê³ ê¸‰ ê·œì¹™ ì„¤ì • echo "Setting up advanced rules..." # 1. ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œíŒŒì¼ ìƒì„± cat &gt; /etc/ufw/applications.d/custom-apps &lt;&lt; 'EOF' [SSH-Custom] title=SSH Custom Port description=SSH on custom port 2222 ports=2222/tcp [Database-Internal] title=Database Internal Access description=MySQL/PostgreSQL for internal network ports=3306,5432/tcp [Monitoring] title=Monitoring Services description=Prometheus, Grafana, etc. ports=9090,3000,9100/tcp EOF ufw app update SSH-Custom ufw allow SSH-Custom # 2. Rate limiting ì„¤ì • ufw limit ssh comment 'Rate limit SSH' ufw limit 80/tcp comment 'Rate limit HTTP' ufw limit 443/tcp comment 'Rate limit HTTPS' # 3. íŠ¹ì • IP ì°¨ë‹¨ (ì˜ˆì‹œ) # ì•Œë ¤ì§„ ì•…ì„± IP ì°¨ë‹¨ MALICIOUS_IPS=( "192.0.2.100" "203.0.113.50" ) for ip in "${MALICIOUS_IPS[@]}"; do ufw deny from "$ip" comment "Known malicious IP" done # 4. ì§€ì—­ë³„ ì ‘ê·¼ ì œí•œ (ì˜ˆì‹œ) # ê´€ë¦¬ ì„œë¹„ìŠ¤ëŠ” êµ­ë‚´ IPë§Œ í—ˆìš© ufw allow from 220.0.0.0/8 to any port 22 comment 'Korea Telecom range' ufw allow from 121.0.0.0/8 to any port 22 comment 'SK Broadband range' # 5. ë¡œê¹… ì„¤ì • ufw logging on # 6. UFW í™œì„±í™” ufw --force enable # 7. ìƒíƒœ ì¶œë ¥ ufw status verbose # 8. UFW ë¡œê·¸ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± cat &gt; /usr/local/bin/ufw-log-monitor.sh &lt;&lt; 'EOF' #!/bin/bash # UFW ë¡œê·¸ ëª¨ë‹ˆí„°ë§ ë° ë¶„ì„ UFW_LOG="/var/log/ufw.log" ALERT_EMAIL="admin@company.com" # ë¡œê·¸ íŒ¨í„´ ë¶„ì„ analyze_ufw_logs() { echo "=== UFW Log Analysis Report $(date) ===" # ìµœê·¼ 1ì‹œê°„ ë™ì•ˆì˜ ì°¨ë‹¨ëœ ì—°ê²° echo "Top blocked IPs (last hour):" grep "$(date -d '1 hour ago' '+%b %d %H')" "$UFW_LOG" 2&gt;/dev/null | \ grep "BLOCK" | awk '{print $(NF-1)}' | cut -d= -f2 | \ sort | uniq -c | sort -nr | head -10 echo "" # í¬íŠ¸ë³„ ê³µê²© í†µê³„ echo "Top attacked ports (last hour):" grep "$(date -d '1 hour ago' '+%b %d %H')" "$UFW_LOG" 2&gt;/dev/null | \ grep "BLOCK" | grep -o "DPT=[0-9]*" | cut -d= -f2 | \ sort | uniq -c | sort -nr | head -10 echo "" # í”„ë¡œí† ì½œë³„ í†µê³„ echo "Protocol statistics (last hour):" grep "$(date -d '1 hour ago' '+%b %d %H')" "$UFW_LOG" 2&gt;/dev/null | \ grep "BLOCK" | grep -o "PROTO=[A-Z]*" | cut -d= -f2 | \ sort | uniq -c | sort -nr echo "==================================" } # ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ monitor_realtime() { tail -f "$UFW_LOG" | while read line; do if echo "$line" | grep -q "BLOCK"; then src_ip=$(echo "$line" | grep -o "SRC=[0-9.]*" | cut -d= -f2) dst_port=$(echo "$line" | grep -o "DPT=[0-9]*" | cut -d= -f2) # ë†’ì€ ë¹ˆë„ ê³µê²© ê°ì§€ recent_blocks=$(grep -c "$src_ip" &lt;(tail -100 "$UFW_LOG")) if [ "$recent_blocks" -gt 10 ]; then echo "$(date): High frequency attack from $src_ip (port $dst_port)" # ìë™ ì°¨ë‹¨ ê°•í™” (ì„ íƒì‚¬í•­) # ufw insert 1 deny from "$src_ip" comment "Auto-blocked: high frequency" fi fi done } case "$1" in "analyze") analyze_ufw_logs ;; "monitor") echo "Starting real-time UFW monitoring... (Ctrl+C to stop)" monitor_realtime ;; "report") analyze_ufw_logs | mail -s "UFW Security Report" "$ALERT_EMAIL" ;; *) echo "Usage: $0 {analyze|monitor|report}" exit 1 ;; esac EOF chmod +x /usr/local/bin/ufw-log-monitor.sh # 9. ì •ê¸°ì ì¸ ë¡œê·¸ ë¶„ì„ ì„¤ì • cat &gt; /etc/cron.hourly/ufw-analysis &lt;&lt; 'EOF' #!/bin/bash /usr/local/bin/ufw-log-monitor.sh analyze &gt;&gt; /var/log/ufw-analysis.log EOF chmod +x /etc/cron.hourly/ufw-analysis echo "UFW advanced configuration completed!" echo "Monitor logs with: /usr/local/bin/ufw-log-monitor.sh monitor" echo "View status with: ufw status verbose" ë‹¤ìŒ í¸ ì˜ˆê³  ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” SELinux/AppArmorì™€ ì‹œìŠ¤í…œ í•˜ë“œë‹ì„ ìì„¸íˆ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤: SELinux ì •ì±… ì‘ì„± ë° ê´€ë¦¬ AppArmor í”„ë¡œíŒŒì¼ ì»¤ìŠ¤í„°ë§ˆì´ì§• ì»¤ë„ ë³´ì•ˆ ë§¤ê°œë³€ìˆ˜ ìµœì í™” íŒŒì¼ ì‹œìŠ¤í…œ ë³´ì•ˆ ê°•í™” SSHì™€ ë°©í™”ë²½ ë³´ì•ˆì„ ì™„ë²½í•˜ê²Œ ë§ˆìŠ¤í„°í•˜ì…¨ë‚˜ìš”? ğŸ”ğŸ›¡ï¸]]></summary></entry><entry><title type="html">ë°°í¬ ì „ëµ ì™„ì „ ê°€ì´ë“œ | Complete Deployment Strategies Guide</title><link href="https://leeyonghe.github.io/infra-blog/blog/2024/11/04/deployment-strategies-guide.html" rel="alternate" type="text/html" title="ë°°í¬ ì „ëµ ì™„ì „ ê°€ì´ë“œ | Complete Deployment Strategies Guide" /><published>2024-11-04T01:00:00+00:00</published><updated>2024-11-04T01:00:00+00:00</updated><id>https://leeyonghe.github.io/infra-blog/blog/2024/11/04/deployment-strategies-guide</id><content type="html" xml:base="https://leeyonghe.github.io/infra-blog/blog/2024/11/04/deployment-strategies-guide.html"><![CDATA[<p>í˜„ëŒ€ì ì¸ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì—ì„œ ë°°í¬ëŠ” ë‹¨ìˆœíˆ ì½”ë“œë¥¼ ì„œë²„ì— ì˜¬ë¦¬ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤. ì•ˆì •ì ì´ê³  ì˜ˆì¸¡ ê°€ëŠ¥í•œ ë°°í¬ ì „ëµì„ í†µí•´ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ì„ ìµœì†Œí™”í•˜ê³  ì‚¬ìš©ì ê²½í—˜ì„ ë³´ì¥í•˜ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤.</p>

<h2 id="3-1-ë°°í¬--deployment">3-1 ë°°í¬ | Deployment</h2>

<h3 id="3-1-1-ë°°í¬-ìë™í™”--deployment-automation">3-1-1 ë°°í¬ ìë™í™” | Deployment Automation</h3>

<p>ë°°í¬ ìë™í™”ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ë¦´ë¦¬ìŠ¤ ê³¼ì •ì„ ì²´ê³„í™”í•˜ê³  ì¸ê°„ì˜ ì‹¤ìˆ˜ë¥¼ ìµœì†Œí™”í•˜ì—¬ ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ ìš´ì˜ì„ ë³´ì¥í•©ë‹ˆë‹¤.</p>

<h4 id="-ë°°í¬-ìë™í™”ì˜-í•µì‹¬-ê°œë…">ğŸš€ ë°°í¬ ìë™í™”ì˜ í•µì‹¬ ê°œë…</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë°°í¬ ìë™í™” êµ¬ì„± ìš”ì†Œ</span>
1. ì†ŒìŠ¤ ì½”ë“œ ê´€ë¦¬ <span class="o">(</span>SCM<span class="o">)</span>
   - Git, SVN
   - ë¸Œëœì¹˜ ì „ëµ <span class="o">(</span>Git Flow, GitHub Flow<span class="o">)</span>

2. ë¹Œë“œ ìë™í™”
   - ì»´íŒŒì¼, íŒ¨í‚¤ì§•
   - í…ŒìŠ¤íŠ¸ ì‹¤í–‰
   - ì•„í‹°íŒ©íŠ¸ ìƒì„±

3. ë°°í¬ íŒŒì´í”„ë¼ì¸
   - ë‹¨ê³„ë³„ ë°°í¬ <span class="o">(</span>Dev â†’ Staging â†’ Production<span class="o">)</span>
   - ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤
   - ë¡¤ë°± ë©”ì»¤ë‹ˆì¦˜

4. ì¸í”„ë¼ ìë™í™”
   - IaC <span class="o">(</span>Infrastructure as Code<span class="o">)</span>
   - ì»¨í…Œì´ë„ˆí™”
   - ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
</code></pre></div></div>

<h4 id="cicd-íŒŒì´í”„ë¼ì¸-ì„¤ê³„">CI/CD íŒŒì´í”„ë¼ì¸ ì„¤ê³„</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># .gitlab-ci.yml - GitLab CI/CD íŒŒì´í”„ë¼ì¸</span>
<span class="na">stages</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">build</span>
  <span class="pi">-</span> <span class="s">test</span>
  <span class="pi">-</span> <span class="s">security</span>
  <span class="pi">-</span> <span class="s">deploy-staging</span>
  <span class="pi">-</span> <span class="s">deploy-production</span>

<span class="na">variables</span><span class="pi">:</span>
  <span class="na">DOCKER_DRIVER</span><span class="pi">:</span> <span class="s">overlay2</span>
  <span class="na">DOCKER_HOST</span><span class="pi">:</span> <span class="s">tcp://docker:2376</span>
  <span class="na">DOCKER_TLS_CERTDIR</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/certs"</span>

<span class="na">before_script</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">echo "Pipeline started at $(date)"</span>
  <span class="pi">-</span> <span class="s">docker info</span>

<span class="c1"># ë¹Œë“œ ë‹¨ê³„</span>
<span class="na">build</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">build</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">node:16-alpine</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">npm ci --only=production</span>
    <span class="pi">-</span> <span class="s">npm run build</span>
    <span class="pi">-</span> <span class="s">docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA .</span>
    <span class="pi">-</span> <span class="s">docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA</span>
  <span class="na">artifacts</span><span class="pi">:</span>
    <span class="na">paths</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">dist/</span>
    <span class="na">expire_in</span><span class="pi">:</span> <span class="s">1 hour</span>
  <span class="na">only</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">main</span>
    <span class="pi">-</span> <span class="s">develop</span>

<span class="c1"># í…ŒìŠ¤íŠ¸ ë‹¨ê³„</span>
<span class="na">unit-test</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">node:16-alpine</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">npm ci</span>
    <span class="pi">-</span> <span class="s">npm run test:unit</span>
    <span class="pi">-</span> <span class="s">npm run test:coverage</span>
  <span class="na">artifacts</span><span class="pi">:</span>
    <span class="na">reports</span><span class="pi">:</span>
      <span class="na">junit</span><span class="pi">:</span> <span class="s">junit.xml</span>
      <span class="na">coverage_report</span><span class="pi">:</span>
        <span class="na">coverage_format</span><span class="pi">:</span> <span class="s">cobertura</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">coverage/cobertura-coverage.xml</span>
  <span class="na">coverage</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/Lines\s*:\s*(\d+\.\d+)%/'</span>

<span class="na">integration-test</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span>
  <span class="na">services</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">postgres:13</span>
    <span class="pi">-</span> <span class="s">redis:6</span>
  <span class="na">variables</span><span class="pi">:</span>
    <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">testdb</span>
    <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">test</span>
    <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">test</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">npm run test:integration</span>
  <span class="na">only</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">main</span>

<span class="c1"># ë³´ì•ˆ ìŠ¤ìº”</span>
<span class="na">security-scan</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">security</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">owasp/zap2docker-stable</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">zap-baseline.py -t http://localhost:3000 -J zap-report.json</span>
    <span class="pi">-</span> <span class="s">npm audit --audit-level high</span>
  <span class="na">artifacts</span><span class="pi">:</span>
    <span class="na">reports</span><span class="pi">:</span>
      <span class="na">sast</span><span class="pi">:</span> <span class="s">zap-report.json</span>
  <span class="na">allow_failure</span><span class="pi">:</span> <span class="kc">true</span>

<span class="c1"># ìŠ¤í…Œì´ì§• ë°°í¬</span>
<span class="na">deploy-staging</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy-staging</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">alpine/helm:3.8.0</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">helm upgrade --install myapp-staging ./helm-chart</span>
      <span class="s">--namespace staging</span>
      <span class="s">--set image.tag=$CI_COMMIT_SHA</span>
      <span class="s">--set ingress.host=staging.myapp.com</span>
      <span class="s">--wait</span>
  <span class="na">environment</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">staging</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s">https://staging.myapp.com</span>
  <span class="na">only</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">develop</span>

<span class="c1"># í”„ë¡œë•ì…˜ ë°°í¬ (ìˆ˜ë™ ìŠ¹ì¸ í•„ìš”)</span>
<span class="na">deploy-production</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy-production</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">alpine/helm:3.8.0</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">helm upgrade --install myapp-prod ./helm-chart</span>
      <span class="s">--namespace production</span>
      <span class="s">--set image.tag=$CI_COMMIT_SHA</span>
      <span class="s">--set ingress.host=myapp.com</span>
      <span class="s">--set replicas=3</span>
      <span class="s">--wait</span>
  <span class="na">environment</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">production</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s">https://myapp.com</span>
  <span class="na">when</span><span class="pi">:</span> <span class="s">manual</span>
  <span class="na">only</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">main</span>
</code></pre></div></div>

<h4 id="jenkins-íŒŒì´í”„ë¼ì¸-êµ¬ì„±">Jenkins íŒŒì´í”„ë¼ì¸ êµ¬ì„±</h4>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Jenkinsfile - Jenkins ì„ ì–¸ì  íŒŒì´í”„ë¼ì¸</span>
<span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="n">any</span>
    
    <span class="n">environment</span> <span class="o">{</span>
        <span class="n">DOCKER_REGISTRY</span> <span class="o">=</span> <span class="s1">'your-registry.com'</span>
        <span class="n">APP_NAME</span> <span class="o">=</span> <span class="s1">'myapp'</span>
        <span class="n">KUBECONFIG</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">(</span><span class="s1">'kubeconfig-prod'</span><span class="o">)</span>
    <span class="o">}</span>
    
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Checkout'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">checkout</span> <span class="n">scm</span>
                <span class="n">script</span> <span class="o">{</span>
                    <span class="n">env</span><span class="o">.</span><span class="na">GIT_COMMIT_SHORT</span> <span class="o">=</span> <span class="n">sh</span><span class="o">(</span>
                        <span class="nl">script:</span> <span class="s1">'git rev-parse --short HEAD'</span><span class="o">,</span>
                        <span class="nl">returnStdout:</span> <span class="kc">true</span>
                    <span class="o">).</span><span class="na">trim</span><span class="o">()</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Build &amp; Test'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">parallel</span> <span class="o">{</span>
                <span class="n">stage</span><span class="o">(</span><span class="s1">'Unit Tests'</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">steps</span> <span class="o">{</span>
                        <span class="n">sh</span> <span class="s1">'npm ci'</span>
                        <span class="n">sh</span> <span class="s1">'npm run test:unit'</span>
                    <span class="o">}</span>
                    <span class="n">post</span> <span class="o">{</span>
                        <span class="n">always</span> <span class="o">{</span>
                            <span class="n">publishTestResults</span> <span class="nl">testResultsPattern:</span> <span class="s1">'test-results.xml'</span>
                            <span class="n">publishCoverage</span> <span class="nl">adapters:</span> <span class="o">[</span>
                                <span class="n">coberturaAdapter</span><span class="o">(</span><span class="s1">'coverage/cobertura-coverage.xml'</span><span class="o">)</span>
                            <span class="o">]</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                
                <span class="n">stage</span><span class="o">(</span><span class="s1">'Security Scan'</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">steps</span> <span class="o">{</span>
                        <span class="n">sh</span> <span class="s1">'npm audit'</span>
                        <span class="n">sh</span> <span class="s1">'docker run --rm -v $(pwd):/app clair-scanner --ip $(hostname -i) myapp:latest'</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Build Docker Image'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">script</span> <span class="o">{</span>
                    <span class="kt">def</span> <span class="n">image</span> <span class="o">=</span> <span class="n">docker</span><span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="s2">"${DOCKER_REGISTRY}/${APP_NAME}:${env.GIT_COMMIT_SHORT}"</span><span class="o">)</span>
                    <span class="n">docker</span><span class="o">.</span><span class="na">withRegistry</span><span class="o">(</span><span class="s2">"https://${DOCKER_REGISTRY}"</span><span class="o">,</span> <span class="s1">'docker-registry-credentials'</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">image</span><span class="o">.</span><span class="na">push</span><span class="o">()</span>
                        <span class="n">image</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="s1">'latest'</span><span class="o">)</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Deploy to Staging'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">sh</span> <span class="s2">"""
                    helm upgrade --install ${APP_NAME}-staging ./helm-chart \\
                        --namespace staging \\
                        --set image.tag=${env.GIT_COMMIT_SHORT} \\
                        --wait --timeout=600s
                """</span>
            <span class="o">}</span>
        <span class="o">}</span>
        
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Integration Tests'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">sh</span> <span class="s1">'npm run test:integration -- --env=staging'</span>
            <span class="o">}</span>
        <span class="o">}</span>
        
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Deploy to Production'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">when</span> <span class="o">{</span>
                <span class="n">branch</span> <span class="s1">'main'</span>
            <span class="o">}</span>
            <span class="n">input</span> <span class="o">{</span>
                <span class="n">message</span> <span class="s2">"Deploy to production?"</span>
                <span class="n">ok</span> <span class="s2">"Deploy"</span>
                <span class="n">parameters</span> <span class="o">{</span>
                    <span class="n">choice</span><span class="o">(</span><span class="nl">name:</span> <span class="s1">'DEPLOYMENT_STRATEGY'</span><span class="o">,</span> <span class="nl">choices:</span> <span class="o">[</span><span class="s1">'rolling'</span><span class="o">,</span> <span class="s1">'blue-green'</span><span class="o">,</span> <span class="s1">'canary'</span><span class="o">])</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">script</span> <span class="o">{</span>
                    <span class="k">switch</span><span class="o">(</span><span class="n">params</span><span class="o">.</span><span class="na">DEPLOYMENT_STRATEGY</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">case</span> <span class="s1">'blue-green'</span><span class="o">:</span>
                            <span class="n">sh</span> <span class="s1">'./scripts/blue-green-deploy.sh ${env.GIT_COMMIT_SHORT}'</span>
                            <span class="k">break</span>
                        <span class="k">case</span> <span class="s1">'canary'</span><span class="o">:</span>
                            <span class="n">sh</span> <span class="s1">'./scripts/canary-deploy.sh ${env.GIT_COMMIT_SHORT}'</span>
                            <span class="k">break</span>
                        <span class="nl">default:</span>
                            <span class="n">sh</span> <span class="s2">"""
                                helm upgrade --install ${APP_NAME}-prod ./helm-chart \\
                                    --namespace production \\
                                    --set image.tag=${env.GIT_COMMIT_SHORT} \\
                                    --wait --timeout=600s
                            """</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
    <span class="n">post</span> <span class="o">{</span>
        <span class="n">failure</span> <span class="o">{</span>
            <span class="n">script</span> <span class="o">{</span>
                <span class="n">slackSend</span><span class="o">(</span>
                    <span class="nl">channel:</span> <span class="s1">'#deployments'</span><span class="o">,</span>
                    <span class="nl">color:</span> <span class="s1">'danger'</span><span class="o">,</span>
                    <span class="nl">message:</span> <span class="s2">"âŒ Deployment failed: ${env.JOB_NAME} ${env.BUILD_NUMBER}"</span>
                <span class="o">)</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">success</span> <span class="o">{</span>
            <span class="n">script</span> <span class="o">{</span>
                <span class="n">slackSend</span><span class="o">(</span>
                    <span class="nl">channel:</span> <span class="s1">'#deployments'</span><span class="o">,</span>
                    <span class="nl">color:</span> <span class="s1">'good'</span><span class="o">,</span>
                    <span class="nl">message:</span> <span class="s2">"âœ… Deployment successful: ${env.JOB_NAME} ${env.BUILD_NUMBER}"</span>
                <span class="o">)</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="3-1-2-ë°°í¬-ìë™í™”-ë„êµ¬-ì„ íƒ--deployment-automation-tools">3-1-2 ë°°í¬ ìë™í™” ë„êµ¬ ì„ íƒ | Deployment Automation Tools</h3>

<h4 id="ï¸-ë„êµ¬-ë¹„êµ-ë§¤íŠ¸ë¦­ìŠ¤">ğŸ› ï¸ ë„êµ¬ ë¹„êµ ë§¤íŠ¸ë¦­ìŠ¤</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># CI/CD í”Œë«í¼ ë¹„êµ</span>
                GitLab CI    Jenkins     GitHub Actions    Azure DevOps    AWS CodePipeline
ì„¤ì • ë³µì¡ë„        ë‚®ìŒ        ì¤‘ê°„           ë‚®ìŒ            ì¤‘ê°„              ë†’ìŒ
í´ë¼ìš°ë“œ í†µí•©      ìš°ìˆ˜        ë³´í†µ           ìš°ìˆ˜            ìš°ìˆ˜              ìš°ìˆ˜  
ì˜¨í”„ë ˆë¯¸ìŠ¤ ì§€ì›    ìš°ìˆ˜        ìš°ìˆ˜           ì œí•œì           ìš°ìˆ˜              ë¶ˆê°€
ë¹„ìš©              ë¬´ë£Œ/ìœ ë£Œ    ì˜¤í”ˆì†ŒìŠ¤       ë¬´ë£Œ/ìœ ë£Œ        ìœ ë£Œ              ì‚¬ìš©ëŸ‰ê¸°ë°˜
í™•ì¥ì„±            ìš°ìˆ˜        ìš°ìˆ˜           ìš°ìˆ˜            ìš°ìˆ˜              ìš°ìˆ˜
ì»¤ë®¤ë‹ˆí‹° ì§€ì›      ìš°ìˆ˜        ìµœê³            ìš°ìˆ˜            ë³´í†µ              ë³´í†µ

<span class="c"># ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜</span>
                Kubernetes   Docker Swarm   OpenShift      Nomad           ECS/Fargate
í•™ìŠµ ê³¡ì„           ê°€íŒŒë¦„       ì™„ë§Œ          ì¤‘ê°„           ì™„ë§Œ             ì™„ë§Œ
ê¸°ëŠ¥ í’ë¶€í•¨        ìµœê³         ê¸°ë³¸           ìš°ìˆ˜           ê¸°ë³¸             ê¸°ë³¸
í´ë¼ìš°ë“œ ì§€ì›      ìš°ìˆ˜        ë³´í†µ           ìš°ìˆ˜           ë³´í†µ             AWSì „ìš©
ì»¤ë®¤ë‹ˆí‹°          ìµœê³         ê°ì†Œ           ë³´í†µ           ì„±ì¥             AWSìƒíƒœê³„
</code></pre></div></div>

<h4 id="github-actions-ì›Œí¬í”Œë¡œìš°">GitHub Actions ì›Œí¬í”Œë¡œìš°</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># .github/workflows/deploy.yml</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Deploy Application</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">main</span><span class="pi">,</span> <span class="nv">develop</span><span class="pi">]</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">main</span><span class="pi">]</span>

<span class="na">env</span><span class="pi">:</span>
  <span class="na">REGISTRY</span><span class="pi">:</span> <span class="s">ghcr.io</span>
  <span class="na">IMAGE_NAME</span><span class="pi">:</span> <span class="s">$</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">test</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="na">node-version</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">16.x</span><span class="pi">,</span> <span class="nv">18.x</span><span class="pi">]</span>
    
    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v3</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup Node.js $</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-node@v3</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">node-version</span><span class="pi">:</span> <span class="s">$</span>
        <span class="na">cache</span><span class="pi">:</span> <span class="s1">'</span><span class="s">npm'</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install dependencies</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">npm ci</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run tests</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">npm run test:unit</span>
        <span class="s">npm run test:integration</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Upload coverage reports</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">codecov/codecov-action@v3</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">file</span><span class="pi">:</span> <span class="s">./coverage/lcov.info</span>

  <span class="na">build</span><span class="pi">:</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="s">test</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">outputs</span><span class="pi">:</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">$</span>
      <span class="na">digest</span><span class="pi">:</span> <span class="s">$</span>
    
    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout repository</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v3</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup Docker Buildx</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/setup-buildx-action@v2</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Log in to Container Registry</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/login-action@v2</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">registry</span><span class="pi">:</span> <span class="s">$</span>
        <span class="na">username</span><span class="pi">:</span> <span class="s">$</span>
        <span class="na">password</span><span class="pi">:</span> <span class="s">$</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Extract metadata</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">meta</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/metadata-action@v4</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">images</span><span class="pi">:</span> <span class="s">$/$</span>
        <span class="na">tags</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">type=ref,event=branch</span>
          <span class="s">type=ref,event=pr</span>
          <span class="s">type=sha,prefix=-</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and push Docker image</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">build</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/build-push-action@v4</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
        <span class="na">push</span><span class="pi">:</span> <span class="kc">true</span>
        <span class="na">tags</span><span class="pi">:</span> <span class="s">$</span>
        <span class="na">labels</span><span class="pi">:</span> <span class="s">$</span>
        <span class="na">cache-from</span><span class="pi">:</span> <span class="s">type=gha</span>
        <span class="na">cache-to</span><span class="pi">:</span> <span class="s">type=gha,mode=max</span>

  <span class="na">deploy-staging</span><span class="pi">:</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">github.ref == 'refs/heads/develop'</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="s">build</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">environment</span><span class="pi">:</span> <span class="s">staging</span>
    
    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy to staging</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">azure/k8s-deploy@v1</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">manifests</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">k8s/staging/deployment.yaml</span>
          <span class="s">k8s/staging/service.yaml</span>
        <span class="na">images</span><span class="pi">:</span> <span class="s">$@$</span>
        <span class="na">namespace</span><span class="pi">:</span> <span class="s">staging</span>

  <span class="na">deploy-production</span><span class="pi">:</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">github.ref == 'refs/heads/main'</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="s">build</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">environment</span><span class="pi">:</span> <span class="s">production</span>
    
    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy to production</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">azure/k8s-deploy@v1</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">manifests</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">k8s/production/deployment.yaml</span>
          <span class="s">k8s/production/service.yaml</span>
        <span class="na">images</span><span class="pi">:</span> <span class="s">$@$</span>
        <span class="na">namespace</span><span class="pi">:</span> <span class="s">production</span>
        <span class="na">strategy</span><span class="pi">:</span> <span class="s">blue-green</span>
</code></pre></div></div>

<h4 id="argocd-gitops-ì›Œí¬í”Œë¡œìš°">ArgoCD GitOps ì›Œí¬í”Œë¡œìš°</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># argocd-app.yaml - ArgoCD Application ì •ì˜</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">argoproj.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Application</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">myapp-production</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">argocd</span>
  <span class="na">finalizers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">resources-finalizer.argocd.argoproj.io</span>

<span class="na">spec</span><span class="pi">:</span>
  <span class="na">project</span><span class="pi">:</span> <span class="s">default</span>
  
  <span class="na">source</span><span class="pi">:</span>
    <span class="na">repoURL</span><span class="pi">:</span> <span class="s">https://github.com/company/myapp-k8s-manifests</span>
    <span class="na">targetRevision</span><span class="pi">:</span> <span class="s">HEAD</span>
    <span class="na">path</span><span class="pi">:</span> <span class="s">overlays/production</span>
    
  <span class="na">destination</span><span class="pi">:</span>
    <span class="na">server</span><span class="pi">:</span> <span class="s">https://kubernetes.default.svc</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">production</span>
    
  <span class="na">syncPolicy</span><span class="pi">:</span>
    <span class="na">automated</span><span class="pi">:</span>
      <span class="na">prune</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="na">selfHeal</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="na">allowEmpty</span><span class="pi">:</span> <span class="kc">false</span>
    <span class="na">syncOptions</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">CreateNamespace=true</span>
      <span class="pi">-</span> <span class="s">PrunePropagationPolicy=foreground</span>
      <span class="pi">-</span> <span class="s">PruneLast=true</span>
      
  <span class="na">revisionHistoryLimit</span><span class="pi">:</span> <span class="m">10</span>
  
  <span class="c1"># Health checks</span>
  <span class="na">ignoreDifferences</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">group</span><span class="pi">:</span> <span class="s">apps</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
    <span class="na">jsonPointers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">/spec/replicas</span>

<span class="nn">---</span>
<span class="c1"># kustomization.yaml - Kustomize ì„¤ì •</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kustomize.config.k8s.io/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Kustomization</span>

<span class="na">namespace</span><span class="pi">:</span> <span class="s">production</span>

<span class="na">resources</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">../../base</span>

<span class="na">patchesStrategicMerge</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">deployment-patch.yaml</span>
<span class="pi">-</span> <span class="s">service-patch.yaml</span>

<span class="na">images</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">myapp</span>
  <span class="na">newTag</span><span class="pi">:</span> <span class="s">v1.2.3</span>

<span class="na">replicas</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">myapp-deployment</span>
  <span class="na">count</span><span class="pi">:</span> <span class="m">3</span>

<span class="na">configMapGenerator</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">myapp-config</span>
  <span class="na">files</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">config/production.yaml</span>

<span class="na">secretGenerator</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">myapp-secrets</span>
  <span class="na">files</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">secrets/database.env</span>
</code></pre></div></div>

<h2 id="3-2-ë°°í¬-ì „ëµ--deployment-strategies">3-2 ë°°í¬ ì „ëµ | Deployment Strategies</h2>

<h3 id="3-2-1-ê°€ì¥-ê°„ë‹¨í•œ-ë°°í¬--recreate-deployment">3-2-1 ê°€ì¥ ê°„ë‹¨í•œ ë°°í¬ | Recreate Deployment</h3>

<p>Recreate ë°°í¬ëŠ” ê¸°ì¡´ ë²„ì „ì„ ì™„ì „íˆ ì¤‘ë‹¨í•œ í›„ ìƒˆ ë²„ì „ì„ ì‹œì‘í•˜ëŠ” ê°€ì¥ ë‹¨ìˆœí•œ ë°°í¬ ë°©ì‹ì…ë‹ˆë‹¤.</p>

<h4 id="-recreate-ë°°í¬-íŠ¹ì§•">ğŸ“‹ Recreate ë°°í¬ íŠ¹ì§•</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì¥ì </span>
- êµ¬í˜„ì´ ê°„ë‹¨í•¨
- ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ì´ ì ìŒ
- ë²„ì „ ê°„ ì¶©ëŒ ì—†ìŒ
- ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ì— ìœ ë¦¬

<span class="c"># ë‹¨ì   </span>
- ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ì‹œê°„ ë°œìƒ
- ì‚¬ìš©ì ê²½í—˜ ì €í•˜
- ë¡¤ë°± ì‹œê°„ì´ ê¹€
</code></pre></div></div>

<h4 id="kubernetes-recreate-ë°°í¬">Kubernetes Recreate ë°°í¬</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># recreate-deployment.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">myapp-recreate</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">default</span>

<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">3</span>
  <span class="na">strategy</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">Recreate</span>  <span class="c1"># Recreate ì „ëµ ì‚¬ìš©</span>
    
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">myapp</span>
      
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">myapp</span>
        <span class="na">version</span><span class="pi">:</span> <span class="s">v2.0.0</span>
        
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">myapp</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">myapp:v2.0.0</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
        
        <span class="c1"># í—¬ìŠ¤ì²´í¬ ì„¤ì •</span>
        <span class="na">livenessProbe</span><span class="pi">:</span>
          <span class="na">httpGet</span><span class="pi">:</span>
            <span class="na">path</span><span class="pi">:</span> <span class="s">/health</span>
            <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
          <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">30</span>
          <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
          
        <span class="na">readinessProbe</span><span class="pi">:</span>
          <span class="na">httpGet</span><span class="pi">:</span>
            <span class="na">path</span><span class="pi">:</span> <span class="s">/ready</span>
            <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
          <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">5</span>
          <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">5</span>
          
        <span class="na">resources</span><span class="pi">:</span>
          <span class="na">requests</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">256Mi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">250m"</span>
          <span class="na">limits</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">512Mi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">500m"</span>
</code></pre></div></div>

<h4 id="recreate-ë°°í¬-ìŠ¤í¬ë¦½íŠ¸">Recreate ë°°í¬ ìŠ¤í¬ë¦½íŠ¸</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># recreate-deploy.sh</span>

<span class="nb">set</span> <span class="nt">-e</span>

<span class="nv">APP_NAME</span><span class="o">=</span><span class="s2">"myapp"</span>
<span class="nv">NEW_VERSION</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
<span class="nv">NAMESPACE</span><span class="o">=</span><span class="s2">"production"</span>

<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$NEW_VERSION</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> &lt;new-version&gt;"</span>
    <span class="nb">exit </span>1
<span class="k">fi

</span><span class="nb">echo</span> <span class="s2">"=== Recreate Deployment Started ==="</span>
<span class="nb">echo</span> <span class="s2">"App: </span><span class="nv">$APP_NAME</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"New Version: </span><span class="nv">$NEW_VERSION</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Namespace: </span><span class="nv">$NAMESPACE</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Time: </span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">"</span>

<span class="c"># 1. í˜„ì¬ ë°°í¬ ìƒíƒœ í™•ì¸</span>
<span class="nb">echo</span> <span class="s2">"Current deployment status:"</span>
kubectl get deployment <span class="nv">$APP_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span>

<span class="c"># 2. í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ í™•ì¸</span>
<span class="nb">echo</span> <span class="s2">"Checking current health status..."</span>
kubectl get pods <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span><span class="nv">$APP_NAME</span>

<span class="c"># 3. íŠ¸ë˜í”½ ì¤‘ë‹¨ (ë¡œë“œë°¸ëŸ°ì„œì—ì„œ ì œê±°)</span>
<span class="nb">echo</span> <span class="s2">"Removing from load balancer..."</span>
kubectl patch service <span class="nv">$APP_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nt">-p</span> <span class="s1">'{"spec":{"selector":{"app":"maintenance"}}}'</span>

<span class="c"># 4. ê¸°ì¡´ íŒŒë“œ ì¢…ë£Œ ëŒ€ê¸°</span>
<span class="nb">echo</span> <span class="s2">"Stopping existing pods..."</span>
kubectl delete pods <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span><span class="nv">$APP_NAME</span> <span class="nt">--grace-period</span><span class="o">=</span>30

<span class="c"># 5. ìƒˆ ë²„ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸</span>
<span class="nb">echo</span> <span class="s2">"Updating to new version: </span><span class="nv">$NEW_VERSION</span><span class="s2">"</span>
kubectl <span class="nb">set </span>image deployment/<span class="nv">$APP_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nv">container</span><span class="o">=</span><span class="nv">$APP_NAME</span>:<span class="nv">$NEW_VERSION</span>

<span class="c"># 6. ë°°í¬ ì™„ë£Œ ëŒ€ê¸°</span>
<span class="nb">echo</span> <span class="s2">"Waiting for deployment to complete..."</span>
kubectl rollout status deployment/<span class="nv">$APP_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nt">--timeout</span><span class="o">=</span>300s

<span class="c"># 7. í—¬ìŠ¤ì²´í¬ í™•ì¸</span>
<span class="nb">echo</span> <span class="s2">"Performing health checks..."</span>
<span class="nb">sleep </span>30

<span class="nv">READY_REPLICAS</span><span class="o">=</span><span class="si">$(</span>kubectl get deployment <span class="nv">$APP_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.status.readyReplicas}'</span><span class="si">)</span>
<span class="nv">DESIRED_REPLICAS</span><span class="o">=</span><span class="si">$(</span>kubectl get deployment <span class="nv">$APP_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.spec.replicas}'</span><span class="si">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$READY_REPLICAS</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$DESIRED_REPLICAS</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"Health check passed: </span><span class="nv">$READY_REPLICAS</span><span class="s2">/</span><span class="nv">$DESIRED_REPLICAS</span><span class="s2"> pods ready"</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"Health check failed: </span><span class="nv">$READY_REPLICAS</span><span class="s2">/</span><span class="nv">$DESIRED_REPLICAS</span><span class="s2"> pods ready"</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c"># 8. íŠ¸ë˜í”½ ë³µì›</span>
<span class="nb">echo</span> <span class="s2">"Restoring traffic..."</span>
kubectl patch service <span class="nv">$APP_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nt">-p</span> <span class="s1">'{"spec":{"selector":{"app":"'</span><span class="nv">$APP_NAME</span><span class="s1">'"}}}'</span>

<span class="nb">echo</span> <span class="s2">"=== Recreate Deployment Completed Successfully ==="</span>
</code></pre></div></div>

<h3 id="3-2-2-ë¡¤ë§-ì—…ë°ì´íŠ¸--rolling-update">3-2-2 ë¡¤ë§ ì—…ë°ì´íŠ¸ | Rolling Update</h3>

<p>ë¡¤ë§ ì—…ë°ì´íŠ¸ëŠ” ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ì—†ì´ ì ì§„ì ìœ¼ë¡œ ìƒˆ ë²„ì „ì„ ë°°í¬í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.</p>

<h4 id="-ë¡¤ë§-ì—…ë°ì´íŠ¸-ì›ë¦¬">ğŸ”„ ë¡¤ë§ ì—…ë°ì´íŠ¸ ì›ë¦¬</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># rolling-update-deployment.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">myapp-rolling</span>

<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">6</span>
  <span class="na">strategy</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">RollingUpdate</span>
    <span class="na">rollingUpdate</span><span class="pi">:</span>
      <span class="na">maxUnavailable</span><span class="pi">:</span> <span class="m">1</span>      <span class="c1"># ìµœëŒ€ 1ê°œ íŒŒë“œ ì¤‘ë‹¨ í—ˆìš©</span>
      <span class="na">maxSurge</span><span class="pi">:</span> <span class="m">2</span>           <span class="c1"># ìµœëŒ€ 2ê°œ ì¶”ê°€ íŒŒë“œ ìƒì„± í—ˆìš©</span>
      
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">myapp</span>
      
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">myapp</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">myapp</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">myapp:v2.1.0</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
        
        <span class="c1"># ì ì§„ì  ì¢…ë£Œë¥¼ ìœ„í•œ ì„¤ì •</span>
        <span class="na">lifecycle</span><span class="pi">:</span>
          <span class="na">preStop</span><span class="pi">:</span>
            <span class="na">exec</span><span class="pi">:</span>
              <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">/bin/sh"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-c"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">sleep</span><span class="nv"> </span><span class="s">15"</span><span class="pi">]</span>
              
        <span class="c1"># ë¹ ë¥¸ ì‹œì‘ì„ ìœ„í•œ í—¬ìŠ¤ì²´í¬</span>
        <span class="na">readinessProbe</span><span class="pi">:</span>
          <span class="na">httpGet</span><span class="pi">:</span>
            <span class="na">path</span><span class="pi">:</span> <span class="s">/ready</span>
            <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
          <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">2</span>
          <span class="na">timeoutSeconds</span><span class="pi">:</span> <span class="m">1</span>
          <span class="na">successThreshold</span><span class="pi">:</span> <span class="m">1</span>
          <span class="na">failureThreshold</span><span class="pi">:</span> <span class="m">3</span>
          
        <span class="na">livenessProbe</span><span class="pi">:</span>
          <span class="na">httpGet</span><span class="pi">:</span>
            <span class="na">path</span><span class="pi">:</span> <span class="s">/health</span>  
            <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
          <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">30</span>
          <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
</code></pre></div></div>

<h4 id="ê³ ê¸‰-ë¡¤ë§-ì—…ë°ì´íŠ¸-ìŠ¤í¬ë¦½íŠ¸">ê³ ê¸‰ ë¡¤ë§ ì—…ë°ì´íŠ¸ ìŠ¤í¬ë¦½íŠ¸</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># advanced-rolling-update.sh</span>

<span class="nb">set</span> <span class="nt">-e</span>

<span class="nv">APP_NAME</span><span class="o">=</span><span class="s2">"myapp"</span>
<span class="nv">NEW_VERSION</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
<span class="nv">NAMESPACE</span><span class="o">=</span><span class="s2">"production"</span>
<span class="nv">MAX_ROLLBACK_REVISION</span><span class="o">=</span>5

<span class="c"># ì»¬ëŸ¬ ì¶œë ¥ì„ ìœ„í•œ í•¨ìˆ˜</span>
<span class="nv">RED</span><span class="o">=</span><span class="s1">'\033[0;31m'</span>
<span class="nv">GREEN</span><span class="o">=</span><span class="s1">'\033[0;32m'</span>
<span class="nv">YELLOW</span><span class="o">=</span><span class="s1">'\033[1;33m'</span>
<span class="nv">NC</span><span class="o">=</span><span class="s1">'\033[0m'</span> <span class="c"># No Color</span>

log<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="k">${</span><span class="nv">GREEN</span><span class="k">}</span><span class="s2">[</span><span class="si">$(</span><span class="nb">date</span> +<span class="s1">'%Y-%m-%d %H:%M:%S'</span><span class="si">)</span><span class="s2">]</span><span class="k">${</span><span class="nv">NC</span><span class="k">}</span><span class="s2"> </span><span class="nv">$1</span><span class="s2">"</span>
<span class="o">}</span>

warn<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="k">${</span><span class="nv">YELLOW</span><span class="k">}</span><span class="s2">[WARNING]</span><span class="k">${</span><span class="nv">NC</span><span class="k">}</span><span class="s2"> </span><span class="nv">$1</span><span class="s2">"</span>
<span class="o">}</span>

error<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="k">${</span><span class="nv">RED</span><span class="k">}</span><span class="s2">[ERROR]</span><span class="k">${</span><span class="nv">NC</span><span class="k">}</span><span class="s2"> </span><span class="nv">$1</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># ì‚¬ì „ ì ê²€</span>
pre_deployment_checks<span class="o">()</span> <span class="o">{</span>
    log <span class="s2">"Performing pre-deployment checks..."</span>
    
    <span class="c"># 1. ìƒˆ ì´ë¯¸ì§€ ì¡´ì¬ í™•ì¸</span>
    <span class="k">if</span> <span class="o">!</span> docker pull <span class="nv">$APP_NAME</span>:<span class="nv">$NEW_VERSION</span> <span class="o">&gt;</span> /dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
        </span>error <span class="s2">"Image </span><span class="nv">$APP_NAME</span><span class="s2">:</span><span class="nv">$NEW_VERSION</span><span class="s2"> not found"</span>
        <span class="nb">exit </span>1
    <span class="k">fi</span>
    
    <span class="c"># 2. í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸</span>
    <span class="k">if</span> <span class="o">!</span> kubectl cluster-info <span class="o">&gt;</span> /dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
        </span>error <span class="s2">"Cannot connect to Kubernetes cluster"</span>
        <span class="nb">exit </span>1
    <span class="k">fi</span>
    
    <span class="c"># 3. ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì¡´ì¬ í™•ì¸</span>
    <span class="k">if</span> <span class="o">!</span> kubectl get namespace <span class="nv">$NAMESPACE</span> <span class="o">&gt;</span> /dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
        </span>error <span class="s2">"Namespace </span><span class="nv">$NAMESPACE</span><span class="s2"> does not exist"</span>
        <span class="nb">exit </span>1
    <span class="k">fi</span>
    
    <span class="c"># 4. í˜„ì¬ ë°°í¬ ìƒíƒœ í™•ì¸</span>
    <span class="nv">CURRENT_REPLICAS</span><span class="o">=</span><span class="si">$(</span>kubectl get deployment <span class="nv">$APP_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.status.readyReplicas}'</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"0"</span><span class="si">)</span>
    <span class="nv">DESIRED_REPLICAS</span><span class="o">=</span><span class="si">$(</span>kubectl get deployment <span class="nv">$APP_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.spec.replicas}'</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"0"</span><span class="si">)</span>
    
    <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$CURRENT_REPLICAS</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"</span><span class="nv">$DESIRED_REPLICAS</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>warn <span class="s2">"Current deployment is not healthy: </span><span class="nv">$CURRENT_REPLICAS</span><span class="s2">/</span><span class="nv">$DESIRED_REPLICAS</span><span class="s2"> pods ready"</span>
        <span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"Continue anyway? (y/N): "</span> <span class="nt">-n</span> 1 <span class="nt">-r</span>
        <span class="nb">echo
        </span><span class="k">if</span> <span class="o">[[</span> <span class="o">!</span> <span class="nv">$REPLY</span> <span class="o">=</span>~ ^[Yy]<span class="nv">$ </span><span class="o">]]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">exit </span>1
        <span class="k">fi
    fi
    
    </span>log <span class="s2">"Pre-deployment checks completed successfully"</span>
<span class="o">}</span>

<span class="c"># ë°°í¬ ì‹¤í–‰</span>
perform_rolling_update<span class="o">()</span> <span class="o">{</span>
    log <span class="s2">"Starting rolling update to version </span><span class="nv">$NEW_VERSION</span><span class="s2">"</span>
    
    <span class="c"># í˜„ì¬ ì´ë¯¸ì§€ íƒœê·¸ ì €ì¥ (ë¡¤ë°±ìš©)</span>
    <span class="nv">CURRENT_IMAGE</span><span class="o">=</span><span class="si">$(</span>kubectl get deployment <span class="nv">$APP_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.spec.template.spec.containers[0].image}'</span><span class="si">)</span>
    
    <span class="c"># ë°°í¬ íˆìŠ¤í† ë¦¬ ê¸°ë¡</span>
    kubectl annotate deployment <span class="nv">$APP_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="se">\</span>
        deployment.kubernetes.io/revision-history<span class="o">=</span><span class="s2">"Previous: </span><span class="nv">$CURRENT_IMAGE</span><span class="s2">, New: </span><span class="nv">$APP_NAME</span><span class="s2">:</span><span class="nv">$NEW_VERSION</span><span class="s2">, Time: </span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">"</span>
    
    <span class="c"># ìƒˆ ë²„ì „ ë°°í¬</span>
    kubectl <span class="nb">set </span>image deployment/<span class="nv">$APP_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nv">$APP_NAME</span><span class="o">=</span><span class="nv">$APP_NAME</span>:<span class="nv">$NEW_VERSION</span>
    
    <span class="c"># ë°°í¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§</span>
    log <span class="s2">"Monitoring rollout progress..."</span>
    
    <span class="c"># íƒ€ì„ì•„ì›ƒê³¼ í•¨ê»˜ ë¡¤ì•„ì›ƒ ìƒíƒœ í™•ì¸</span>
    <span class="k">if </span><span class="nb">timeout </span>600 kubectl rollout status deployment/<span class="nv">$APP_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span><span class="p">;</span> <span class="k">then
        </span>log <span class="s2">"Rolling update completed successfully"</span>
    <span class="k">else
        </span>error <span class="s2">"Rolling update timed out"</span>
        <span class="k">return </span>1
    <span class="k">fi</span>
<span class="o">}</span>

<span class="c"># ë°°í¬ í›„ ê²€ì¦</span>
post_deployment_validation<span class="o">()</span> <span class="o">{</span>
    log <span class="s2">"Performing post-deployment validation..."</span>
    
    <span class="c"># 1. íŒŒë“œ ìƒíƒœ í™•ì¸</span>
    <span class="nb">sleep </span>30
    
    <span class="nv">READY_REPLICAS</span><span class="o">=</span><span class="si">$(</span>kubectl get deployment <span class="nv">$APP_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.status.readyReplicas}'</span><span class="si">)</span>
    <span class="nv">DESIRED_REPLICAS</span><span class="o">=</span><span class="si">$(</span>kubectl get deployment <span class="nv">$APP_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.spec.replicas}'</span><span class="si">)</span>
    
    <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$READY_REPLICAS</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"</span><span class="nv">$DESIRED_REPLICAS</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>error <span class="s2">"Pod readiness check failed: </span><span class="nv">$READY_REPLICAS</span><span class="s2">/</span><span class="nv">$DESIRED_REPLICAS</span><span class="s2">"</span>
        <span class="k">return </span>1
    <span class="k">fi</span>
    
    <span class="c"># 2. ì• í”Œë¦¬ì¼€ì´ì…˜ í—¬ìŠ¤ì²´í¬</span>
    <span class="nv">SERVICE_IP</span><span class="o">=</span><span class="si">$(</span>kubectl get service <span class="nv">$APP_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.spec.clusterIP}'</span><span class="si">)</span>
    
    <span class="k">for </span>i <span class="k">in</span> <span class="o">{</span>1..10<span class="o">}</span><span class="p">;</span> <span class="k">do
        if </span>curl <span class="nt">-f</span> <span class="nt">-s</span> http://<span class="nv">$SERVICE_IP</span>:8080/health <span class="o">&gt;</span> /dev/null<span class="p">;</span> <span class="k">then
            </span>log <span class="s2">"Application health check passed"</span>
            <span class="nb">break
        </span><span class="k">else
            </span>warn <span class="s2">"Health check attempt </span><span class="nv">$i</span><span class="s2"> failed, retrying..."</span>
            <span class="nb">sleep </span>5
        <span class="k">fi
        
        if</span> <span class="o">[</span> <span class="nv">$i</span> <span class="nt">-eq</span> 10 <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span>error <span class="s2">"Application health check failed after 10 attempts"</span>
            <span class="k">return </span>1
        <span class="k">fi
    done</span>
    
    <span class="c"># 3. ë©”ëª¨ë¦¬ ë° CPU ì‚¬ìš©ë¥  í™•ì¸</span>
    log <span class="s2">"Checking resource usage..."</span>
    kubectl top pods <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span><span class="nv">$APP_NAME</span>
    
    log <span class="s2">"Post-deployment validation completed successfully"</span>
<span class="o">}</span>

<span class="c"># ë¡¤ë°± í•¨ìˆ˜</span>
rollback_deployment<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local </span><span class="nv">rollback_reason</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
    
    error <span class="s2">"Rolling back deployment due to: </span><span class="nv">$rollback_reason</span><span class="s2">"</span>
    
    kubectl rollout undo deployment/<span class="nv">$APP_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span>
    
    log <span class="s2">"Waiting for rollback to complete..."</span>
    kubectl rollout status deployment/<span class="nv">$APP_NAME</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nt">--timeout</span><span class="o">=</span>300s
    
    error <span class="s2">"Rollback completed"</span>
<span class="o">}</span>

<span class="c"># ë©”ì¸ ì‹¤í–‰ ë¡œì§</span>
main<span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$NEW_VERSION</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> &lt;new-version&gt;"</span>
        <span class="nb">exit </span>1
    <span class="k">fi
    
    </span>log <span class="s2">"=== Rolling Update Started ==="</span>
    log <span class="s2">"App: </span><span class="nv">$APP_NAME</span><span class="s2">"</span>
    log <span class="s2">"New Version: </span><span class="nv">$NEW_VERSION</span><span class="s2">"</span>
    log <span class="s2">"Namespace: </span><span class="nv">$NAMESPACE</span><span class="s2">"</span>
    
    <span class="c"># ë‹¨ê³„ë³„ ì‹¤í–‰</span>
    <span class="k">if</span> <span class="o">!</span> pre_deployment_checks<span class="p">;</span> <span class="k">then
        </span>error <span class="s2">"Pre-deployment checks failed"</span>
        <span class="nb">exit </span>1
    <span class="k">fi
    
    if</span> <span class="o">!</span> perform_rolling_update<span class="p">;</span> <span class="k">then
        </span>rollback_deployment <span class="s2">"Rolling update failed"</span>
        <span class="nb">exit </span>1
    <span class="k">fi
    
    if</span> <span class="o">!</span> post_deployment_validation<span class="p">;</span> <span class="k">then
        </span>rollback_deployment <span class="s2">"Post-deployment validation failed"</span>
        <span class="nb">exit </span>1
    <span class="k">fi
    
    </span>log <span class="s2">"=== Rolling Update Completed Successfully ==="</span>
<span class="o">}</span>

main <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
</code></pre></div></div>

<h3 id="3-2-3-ë¸”ë£¨ê·¸ë¦°-ë°°í¬--blue-green-deployment">3-2-3 ë¸”ë£¨ê·¸ë¦° ë°°í¬ | Blue-Green Deployment</h3>

<p>ë¸”ë£¨ê·¸ë¦° ë°°í¬ëŠ” ë‘ ê°œì˜ ë™ì¼í•œ í™˜ê²½ì„ ìš´ì˜í•˜ì—¬ ë¬´ì¤‘ë‹¨ ë°°í¬ì™€ ì¦‰ì‹œ ë¡¤ë°±ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ì „ëµì…ë‹ˆë‹¤.</p>

<h4 id="-ë¸”ë£¨ê·¸ë¦°-ë°°í¬-ê°œë…">ğŸ”µğŸŸ¢ ë¸”ë£¨ê·¸ë¦° ë°°í¬ ê°œë…</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë¸”ë£¨ê·¸ë¦° ë°°í¬ í™˜ê²½ êµ¬ì„±</span>
Production Traffic â†’ Load Balancer â†’ Blue Environment <span class="o">(</span>í˜„ì¬ ë²„ì „<span class="o">)</span>
                                  â†’ Green Environment <span class="o">(</span>ìƒˆ ë²„ì „, ëŒ€ê¸°<span class="o">)</span>

<span class="c"># ë°°í¬ ê³¼ì •</span>
1. Green í™˜ê²½ì— ìƒˆ ë²„ì „ ë°°í¬
2. Green í™˜ê²½ í…ŒìŠ¤íŠ¸ ë° ê²€ì¦  
3. ë¡œë“œë°¸ëŸ°ì„œ íŠ¸ë˜í”½ì„ Blue â†’ Greenìœ¼ë¡œ ì „í™˜
4. Blue í™˜ê²½ì„ ìƒˆë¡œìš´ Greenìœ¼ë¡œ ì¤€ë¹„
</code></pre></div></div>

<h4 id="kubernetes-ë¸”ë£¨ê·¸ë¦°-ë°°í¬">Kubernetes ë¸”ë£¨ê·¸ë¦° ë°°í¬</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># blue-green-service.yaml - íŠ¸ë˜í”½ ë¼ìš°íŒ… ì„œë¹„ìŠ¤</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">myapp-service</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">production</span>

<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">myapp</span>
    <span class="na">version</span><span class="pi">:</span> <span class="s">blue</span>    <span class="c1"># blue ë˜ëŠ” greenìœ¼ë¡œ ì „í™˜</span>
  <span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">http</span>
    <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8080</span>
    <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">LoadBalancer</span>

<span class="nn">---</span>
<span class="c1"># blue-deployment.yaml - Blue í™˜ê²½</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">myapp-blue</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">production</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">myapp</span>
    <span class="na">version</span><span class="pi">:</span> <span class="s">blue</span>

<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">3</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">myapp</span>
      <span class="na">version</span><span class="pi">:</span> <span class="s">blue</span>
      
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">myapp</span>
        <span class="na">version</span><span class="pi">:</span> <span class="s">blue</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">myapp</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">myapp:v1.0.0</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
        <span class="na">resources</span><span class="pi">:</span>
          <span class="na">requests</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">256Mi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">250m"</span>
          <span class="na">limits</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">512Mi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">500m"</span>

<span class="nn">---</span>
<span class="c1"># green-deployment.yaml - Green í™˜ê²½</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>  
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">myapp-green</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">production</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">myapp</span>
    <span class="na">version</span><span class="pi">:</span> <span class="s">green</span>

<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">3</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">myapp</span>
      <span class="na">version</span><span class="pi">:</span> <span class="s">green</span>
      
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">myapp</span>
        <span class="na">version</span><span class="pi">:</span> <span class="s">green</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">myapp</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">myapp:v2.0.0</span>  <span class="c1"># ìƒˆ ë²„ì „</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
        <span class="na">resources</span><span class="pi">:</span>
          <span class="na">requests</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">256Mi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">250m"</span>
          <span class="na">limits</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">512Mi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">500m"</span>
</code></pre></div></div>

<h3 id="3-2-4-ì¹´ë‚˜ë¦¬-ë°°í¬--canary-deployment">3-2-4 ì¹´ë‚˜ë¦¬ ë°°í¬ | Canary Deployment</h3>

<p>ì¹´ë‚˜ë¦¬ ë°°í¬ëŠ” ìƒˆ ë²„ì „ì„ ì¼ë¶€ íŠ¸ë˜í”½ì—ë§Œ ì ì§„ì ìœ¼ë¡œ ë…¸ì¶œí•˜ì—¬ ë¦¬ìŠ¤í¬ë¥¼ ìµœì†Œí™”í•˜ëŠ” ë°°í¬ ì „ëµì…ë‹ˆë‹¤.</p>

<h4 id="-ì¹´ë‚˜ë¦¬-ë°°í¬-êµ¬í˜„">ğŸ¤ ì¹´ë‚˜ë¦¬ ë°°í¬ êµ¬í˜„</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># canary-istio.yaml - Istioë¥¼ ì´ìš©í•œ ì¹´ë‚˜ë¦¬ ë°°í¬</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.istio.io/v1alpha3</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">VirtualService</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">myapp-canary</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">production</span>

<span class="na">spec</span><span class="pi">:</span>
  <span class="na">hosts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">myapp.company.com</span>
  
  <span class="na">http</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">match</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">headers</span><span class="pi">:</span>
        <span class="na">canary</span><span class="pi">:</span>
          <span class="na">exact</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
    <span class="na">route</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">destination</span><span class="pi">:</span>
        <span class="na">host</span><span class="pi">:</span> <span class="s">myapp-service</span>
        <span class="na">subset</span><span class="pi">:</span> <span class="s">v2</span>
      <span class="na">weight</span><span class="pi">:</span> <span class="m">100</span>
      
  <span class="pi">-</span> <span class="na">route</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">destination</span><span class="pi">:</span>
        <span class="na">host</span><span class="pi">:</span> <span class="s">myapp-service</span>
        <span class="na">subset</span><span class="pi">:</span> <span class="s">v1</span>
      <span class="na">weight</span><span class="pi">:</span> <span class="m">90</span>    <span class="c1"># 90% ê¸°ì¡´ ë²„ì „</span>
    <span class="pi">-</span> <span class="na">destination</span><span class="pi">:</span>
        <span class="na">host</span><span class="pi">:</span> <span class="s">myapp-service</span>  
        <span class="na">subset</span><span class="pi">:</span> <span class="s">v2</span>
      <span class="na">weight</span><span class="pi">:</span> <span class="m">10</span>    <span class="c1"># 10% ìƒˆ ë²„ì „</span>

<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.istio.io/v1alpha3</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">DestinationRule</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">myapp-destination</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">production</span>

<span class="na">spec</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span> <span class="s">myapp-service</span>
  <span class="na">subsets</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">v1</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">version</span><span class="pi">:</span> <span class="s">v1.0.0</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">v2</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">version</span><span class="pi">:</span> <span class="s">v2.0.0</span>
</code></pre></div></div>

<h4 id="ì ì§„ì -ì¹´ë‚˜ë¦¬-ë°°í¬-ìŠ¤í¬ë¦½íŠ¸">ì ì§„ì  ì¹´ë‚˜ë¦¬ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># progressive-canary.sh</span>

<span class="nb">set</span> <span class="nt">-e</span>

<span class="nv">APP_NAME</span><span class="o">=</span><span class="s2">"myapp"</span>
<span class="nv">NEW_VERSION</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
<span class="nv">NAMESPACE</span><span class="o">=</span><span class="s2">"production"</span>

<span class="c"># íŠ¸ë˜í”½ ë¶„ë°° ë‹¨ê³„ (%)</span>
<span class="nv">CANARY_STAGES</span><span class="o">=(</span>5 10 25 50 75 100<span class="o">)</span>

log<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">"[</span><span class="si">$(</span><span class="nb">date</span> +<span class="s1">'%Y-%m-%d %H:%M:%S'</span><span class="si">)</span><span class="s2">] </span><span class="nv">$1</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í•¨ìˆ˜</span>
collect_metrics<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local </span><span class="nv">version</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nb">local </span><span class="nv">duration</span><span class="o">=</span><span class="nv">$2</span>
    
    log <span class="s2">"Collecting metrics for version </span><span class="nv">$version</span><span class="s2"> over </span><span class="nv">$duration</span><span class="s2"> seconds"</span>
    
    <span class="c"># Prometheus ë©”íŠ¸ë¦­ ì¿¼ë¦¬</span>
    <span class="nb">local </span><span class="nv">error_rate</span><span class="o">=</span><span class="si">$(</span>curl <span class="nt">-s</span> <span class="s2">"http://prometheus:9090/api/v1/query"</span> <span class="se">\</span>
        <span class="nt">--data-urlencode</span> <span class="s2">"query=rate(http_requests_total{version=</span><span class="se">\"</span><span class="nv">$version</span><span class="se">\"</span><span class="s2">,status=~</span><span class="se">\"</span><span class="s2">5..</span><span class="se">\"</span><span class="s2">}[</span><span class="k">${</span><span class="nv">duration</span><span class="k">}</span><span class="s2">s]) / rate(http_requests_total{version=</span><span class="se">\"</span><span class="nv">$version</span><span class="se">\"</span><span class="s2">}[</span><span class="k">${</span><span class="nv">duration</span><span class="k">}</span><span class="s2">s]) * 100"</span><span class="si">)</span>
    
    <span class="nb">local </span><span class="nv">response_time</span><span class="o">=</span><span class="si">$(</span>curl <span class="nt">-s</span> <span class="s2">"http://prometheus:9090/api/v1/query"</span> <span class="se">\</span>
        <span class="nt">--data-urlencode</span> <span class="s2">"query=histogram_quantile(0.95, rate(http_request_duration_seconds_bucket{version=</span><span class="se">\"</span><span class="nv">$version</span><span class="se">\"</span><span class="s2">}[</span><span class="k">${</span><span class="nv">duration</span><span class="k">}</span><span class="s2">s]))"</span><span class="si">)</span>
    
    <span class="nb">local </span><span class="nv">cpu_usage</span><span class="o">=</span><span class="si">$(</span>curl <span class="nt">-s</span> <span class="s2">"http://prometheus:9090/api/v1/query"</span> <span class="se">\</span>
        <span class="nt">--data-urlencode</span> <span class="s2">"query=avg(rate(container_cpu_usage_seconds_total{pod=~</span><span class="se">\"</span><span class="nv">$APP_NAME</span><span class="s2">-.*</span><span class="se">\"</span><span class="s2">,container=</span><span class="se">\"</span><span class="nv">$APP_NAME</span><span class="se">\"</span><span class="s2">}[</span><span class="k">${</span><span class="nv">duration</span><span class="k">}</span><span class="s2">s])) by (version)"</span><span class="si">)</span>
    
    <span class="c"># JSON íŒŒì‹± (jq í•„ìš”)</span>
    <span class="nb">local </span><span class="nv">error_rate_value</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$error_rate</span> | jq <span class="nt">-r</span> <span class="s1">'.data.result[0].value[1] // "0"'</span><span class="si">)</span>
    <span class="nb">local </span><span class="nv">response_time_value</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$response_time</span> | jq <span class="nt">-r</span> <span class="s1">'.data.result[0].value[1] // "0"'</span><span class="si">)</span>
    <span class="nb">local </span><span class="nv">cpu_usage_value</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$cpu_usage</span> | jq <span class="nt">-r</span> <span class="s1">'.data.result[0].value[1] // "0"'</span><span class="si">)</span>
    
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$error_rate_value</span><span class="s2">,</span><span class="nv">$response_time_value</span><span class="s2">,</span><span class="nv">$cpu_usage_value</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># SLI/SLO ì²´í¬</span>
check_slo<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local </span><span class="nv">metrics</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nb">local </span><span class="nv">version</span><span class="o">=</span><span class="nv">$2</span>
    
    <span class="nv">IFS</span><span class="o">=</span><span class="s1">','</span> <span class="nb">read</span> <span class="nt">-r</span> error_rate response_time cpu_usage <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$metrics</span><span class="s2">"</span>
    
    log <span class="s2">"SLO Check for </span><span class="nv">$version</span><span class="s2"> - Error Rate: </span><span class="nv">$error_rate</span><span class="s2">%, Response Time: </span><span class="k">${</span><span class="nv">response_time</span><span class="k">}</span><span class="s2">s, CPU: </span><span class="nv">$cpu_usage</span><span class="s2">"</span>
    
    <span class="c"># SLO ì„ê³„ê°’</span>
    <span class="nb">local </span><span class="nv">max_error_rate</span><span class="o">=</span>1.0
    <span class="nb">local </span><span class="nv">max_response_time</span><span class="o">=</span>0.5
    <span class="nb">local </span><span class="nv">max_cpu_usage</span><span class="o">=</span>0.8
    
    <span class="k">if</span> <span class="o">((</span> <span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$error_rate</span><span class="s2"> &gt; </span><span class="nv">$max_error_rate</span><span class="s2">"</span> | bc <span class="nt">-l</span><span class="si">)</span> <span class="o">))</span><span class="p">;</span> <span class="k">then
        </span>log <span class="s2">"âŒ Error rate SLO violated: </span><span class="nv">$error_rate</span><span class="s2">% &gt; </span><span class="nv">$max_error_rate</span><span class="s2">%"</span>
        <span class="k">return </span>1
    <span class="k">fi
    
    if</span> <span class="o">((</span> <span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$response_time</span><span class="s2"> &gt; </span><span class="nv">$max_response_time</span><span class="s2">"</span> | bc <span class="nt">-l</span><span class="si">)</span> <span class="o">))</span><span class="p">;</span> <span class="k">then
        </span>log <span class="s2">"âŒ Response time SLO violated: </span><span class="k">${</span><span class="nv">response_time</span><span class="k">}</span><span class="s2">s &gt; </span><span class="k">${</span><span class="nv">max_response_time</span><span class="k">}</span><span class="s2">s"</span>
        <span class="k">return </span>1
    <span class="k">fi
    
    if</span> <span class="o">((</span> <span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$cpu_usage</span><span class="s2"> &gt; </span><span class="nv">$max_cpu_usage</span><span class="s2">"</span> | bc <span class="nt">-l</span><span class="si">)</span> <span class="o">))</span><span class="p">;</span> <span class="k">then
        </span>log <span class="s2">"âŒ CPU usage SLO violated: </span><span class="nv">$cpu_usage</span><span class="s2"> &gt; </span><span class="nv">$max_cpu_usage</span><span class="s2">"</span>
        <span class="k">return </span>1
    <span class="k">fi
    
    </span>log <span class="s2">"âœ… All SLOs passed for version </span><span class="nv">$version</span><span class="s2">"</span>
    <span class="k">return </span>0
<span class="o">}</span>

<span class="c"># íŠ¸ë˜í”½ ê°€ì¤‘ì¹˜ ì—…ë°ì´íŠ¸</span>
update_traffic_weight<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local </span><span class="nv">canary_weight</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nb">local </span><span class="nv">stable_weight</span><span class="o">=</span><span class="k">$((</span><span class="m">100</span> <span class="o">-</span> canary_weight<span class="k">))</span>
    
    log <span class="s2">"Updating traffic weights - Stable: </span><span class="nv">$stable_weight</span><span class="s2">%, Canary: </span><span class="nv">$canary_weight</span><span class="s2">%"</span>
    
    kubectl patch virtualservice <span class="nv">$APP_NAME</span><span class="nt">-canary</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nt">--type</span><span class="o">=</span><span class="s1">'json'</span> <span class="nt">-p</span><span class="o">=</span><span class="s2">"[
        {</span><span class="se">\"</span><span class="s2">op</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">replace</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">path</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">/spec/http/1/route/0/weight</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">value</span><span class="se">\"</span><span class="s2">: </span><span class="nv">$stable_weight</span><span class="s2">},
        {</span><span class="se">\"</span><span class="s2">op</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">replace</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">path</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">/spec/http/1/route/1/weight</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">value</span><span class="se">\"</span><span class="s2">: </span><span class="nv">$canary_weight</span><span class="s2">}
    ]"</span>
<span class="o">}</span>

<span class="c"># ì¹´ë‚˜ë¦¬ ë°°í¬ ì‹¤í–‰</span>
perform_canary_deployment<span class="o">()</span> <span class="o">{</span>
    log <span class="s2">"Starting canary deployment for version </span><span class="nv">$NEW_VERSION</span><span class="s2">"</span>
    
    <span class="c"># 1. ì¹´ë‚˜ë¦¬ ë²„ì „ ë°°í¬ (0% íŠ¸ë˜í”½)</span>
    kubectl <span class="nb">set </span>image deployment/<span class="nv">$APP_NAME</span><span class="nt">-canary</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nv">$APP_NAME</span><span class="o">=</span><span class="nv">$APP_NAME</span>:<span class="nv">$NEW_VERSION</span>
    kubectl rollout status deployment/<span class="nv">$APP_NAME</span><span class="nt">-canary</span> <span class="nt">-n</span> <span class="nv">$NAMESPACE</span> <span class="nt">--timeout</span><span class="o">=</span>300s
    
    <span class="c"># 2. ë‹¨ê³„ë³„ íŠ¸ë˜í”½ ì¦ê°€</span>
    <span class="k">for </span>stage <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">CANARY_STAGES</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
        </span>log <span class="s2">"=== Canary Stage: </span><span class="nv">$stage</span><span class="s2">% traffic ==="</span>
        
        <span class="c"># íŠ¸ë˜í”½ ê°€ì¤‘ì¹˜ ì—…ë°ì´íŠ¸</span>
        update_traffic_weight <span class="nv">$stage</span>
        
        <span class="c"># ì•ˆì •í™” ëŒ€ê¸°</span>
        log <span class="s2">"Waiting for traffic stabilization..."</span>
        <span class="nb">sleep </span>60
        
        <span class="c"># ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ë¶„ì„ (5ë¶„ê°„)</span>
        <span class="nb">local </span><span class="nv">canary_metrics</span><span class="o">=</span><span class="si">$(</span>collect_metrics <span class="s2">"v</span><span class="nv">$NEW_VERSION</span><span class="s2">"</span> 300<span class="si">)</span>
        <span class="nb">local </span><span class="nv">stable_metrics</span><span class="o">=</span><span class="si">$(</span>collect_metrics <span class="s2">"v</span><span class="si">$(</span>get_current_version<span class="si">)</span><span class="s2">"</span> 300<span class="si">)</span>
        
        <span class="c"># SLO ì²´í¬</span>
        <span class="k">if</span> <span class="o">!</span> check_slo <span class="s2">"</span><span class="nv">$canary_metrics</span><span class="s2">"</span> <span class="s2">"canary"</span><span class="p">;</span> <span class="k">then
            </span>log <span class="s2">"âŒ Canary version failed SLO check, rolling back..."</span>
            rollback_canary
            <span class="k">return </span>1
        <span class="k">fi</span>
        
        <span class="c"># ë¹„êµ ë¶„ì„</span>
        log <span class="s2">"Comparing canary vs stable metrics..."</span>
        <span class="k">if</span> <span class="o">!</span> compare_versions <span class="s2">"</span><span class="nv">$canary_metrics</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$stable_metrics</span><span class="s2">"</span><span class="p">;</span> <span class="k">then
            </span>log <span class="s2">"âŒ Canary version performance degraded, rolling back..."</span>
            rollback_canary  
            <span class="k">return </span>1
        <span class="k">fi
        
        </span>log <span class="s2">"âœ… Stage </span><span class="nv">$stage</span><span class="s2">% completed successfully"</span>
        
        <span class="c"># ë§ˆì§€ë§‰ ë‹¨ê³„ê°€ ì•„ë‹ˆë©´ ëŒ€ê¸°</span>
        <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$stage</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"100"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span>log <span class="s2">"Waiting before next stage..."</span>
            <span class="nb">sleep </span>300  <span class="c"># 5ë¶„ ëŒ€ê¸°</span>
        <span class="k">fi
    done
    
    </span>log <span class="s2">"ğŸ‰ Canary deployment completed successfully"</span>
<span class="o">}</span>

<span class="c"># ë¡¤ë°± í•¨ìˆ˜</span>
rollback_canary<span class="o">()</span> <span class="o">{</span>
    log <span class="s2">"Rolling back canary deployment..."</span>
    update_traffic_weight 0
    log <span class="s2">"Traffic rolled back to stable version"</span>
<span class="o">}</span>

main<span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$NEW_VERSION</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> &lt;new-version&gt;"</span>
        <span class="nb">exit </span>1
    <span class="k">fi
    
    </span>log <span class="s2">"=== Progressive Canary Deployment Started ==="</span>
    log <span class="s2">"App: </span><span class="nv">$APP_NAME</span><span class="s2">, New Version: </span><span class="nv">$NEW_VERSION</span><span class="s2">"</span>
    
    <span class="k">if</span> <span class="o">!</span> perform_canary_deployment<span class="p">;</span> <span class="k">then
        </span>log <span class="s2">"âŒ Canary deployment failed"</span>
        <span class="nb">exit </span>1
    <span class="k">fi
    
    </span>log <span class="s2">"=== Canary Deployment Completed Successfully ==="</span>
<span class="o">}</span>

main <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
</code></pre></div></div>

<h2 id="ì‹¤ìŠµ-aws-ec2-ê¸°ë°˜ì˜-ë¸”ë£¨ê·¸ë¦°-ë°°í¬">ì‹¤ìŠµ: AWS EC2 ê¸°ë°˜ì˜ ë¸”ë£¨ê·¸ë¦° ë°°í¬</h2>

<h3 id="ï¸-aws-ì¸í”„ë¼-êµ¬ì„±">ğŸ—ï¸ AWS ì¸í”„ë¼ êµ¬ì„±</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1. VPC ë° ì„œë¸Œë„· ìƒì„±</span>
aws ec2 create-vpc <span class="nt">--cidr-block</span> 10.0.0.0/16 <span class="nt">--tag-specifications</span> <span class="s1">'ResourceType=vpc,Tags=[{Key=Name,Value=BlueGreen-VPC}]'</span>

<span class="nv">VPC_ID</span><span class="o">=</span><span class="si">$(</span>aws ec2 describe-vpcs <span class="nt">--filters</span> <span class="s2">"Name=tag:Name,Values=BlueGreen-VPC"</span> <span class="nt">--query</span> <span class="s1">'Vpcs[0].VpcId'</span> <span class="nt">--output</span> text<span class="si">)</span>

<span class="c"># í¼ë¸”ë¦­ ì„œë¸Œë„· ìƒì„± (2ê°œ AZ)</span>
aws ec2 create-subnet <span class="nt">--vpc-id</span> <span class="nv">$VPC_ID</span> <span class="nt">--cidr-block</span> 10.0.1.0/24 <span class="nt">--availability-zone</span> us-west-2a <span class="nt">--tag-specifications</span> <span class="s1">'ResourceType=subnet,Tags=[{Key=Name,Value=Public-Subnet-1}]'</span>

aws ec2 create-subnet <span class="nt">--vpc-id</span> <span class="nv">$VPC_ID</span> <span class="nt">--cidr-block</span> 10.0.2.0/24 <span class="nt">--availability-zone</span> us-west-2b <span class="nt">--tag-specifications</span> <span class="s1">'ResourceType=subnet,Tags=[{Key=Name,Value=Public-Subnet-2}]'</span>

<span class="c"># í”„ë¼ì´ë¹— ì„œë¸Œë„· ìƒì„± (2ê°œ AZ)</span>
aws ec2 create-subnet <span class="nt">--vpc-id</span> <span class="nv">$VPC_ID</span> <span class="nt">--cidr-block</span> 10.0.11.0/24 <span class="nt">--availability-zone</span> us-west-2a <span class="nt">--tag-specifications</span> <span class="s1">'ResourceType=subnet,Tags=[{Key=Name,Value=Private-Subnet-1}]'</span>

aws ec2 create-subnet <span class="nt">--vpc-id</span> <span class="nv">$VPC_ID</span> <span class="nt">--cidr-block</span> 10.0.12.0/24 <span class="nt">--availability-zone</span> us-west-2b <span class="nt">--tag-specifications</span> <span class="s1">'ResourceType=subnet,Tags=[{Key=Name,Value=Private-Subnet-2}]'</span>

<span class="c"># ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ ìƒì„± ë° ì—°ê²°</span>
aws ec2 create-internet-gateway <span class="nt">--tag-specifications</span> <span class="s1">'ResourceType=internet-gateway,Tags=[{Key=Name,Value=BlueGreen-IGW}]'</span>

<span class="nv">IGW_ID</span><span class="o">=</span><span class="si">$(</span>aws ec2 describe-internet-gateways <span class="nt">--filters</span> <span class="s2">"Name=tag:Name,Values=BlueGreen-IGW"</span> <span class="nt">--query</span> <span class="s1">'InternetGateways[0].InternetGatewayId'</span> <span class="nt">--output</span> text<span class="si">)</span>

aws ec2 attach-internet-gateway <span class="nt">--vpc-id</span> <span class="nv">$VPC_ID</span> <span class="nt">--internet-gateway-id</span> <span class="nv">$IGW_ID</span>
</code></pre></div></div>

<h4 id="application-load-balancer-êµ¬ì„±">Application Load Balancer êµ¬ì„±</h4>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"LoadBalancerName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"myapp-bluegreen-alb"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Scheme"</span><span class="p">:</span><span class="w"> </span><span class="s2">"internet-facing"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"IpAddressType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ipv4"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Subnets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"subnet-12345678"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"subnet-87654321"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"SecurityGroups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"sg-12345678"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"Tags"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Name"</span><span class="p">,</span><span class="w"> 
      </span><span class="nl">"Value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MyApp-BlueGreen-ALB"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Environment"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Production"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="ë¸”ë£¨ê·¸ë¦°-ë°°í¬-ìë™í™”-ìŠ¤í¬ë¦½íŠ¸">ë¸”ë£¨ê·¸ë¦° ë°°í¬ ìë™í™” ìŠ¤í¬ë¦½íŠ¸</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># aws-bluegreen-deploy.sh</span>

<span class="nb">set</span> <span class="nt">-e</span>

<span class="c"># ì„¤ì • ë³€ìˆ˜</span>
<span class="nv">APP_NAME</span><span class="o">=</span><span class="s2">"myapp"</span>
<span class="nv">NEW_VERSION</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
<span class="nv">AWS_REGION</span><span class="o">=</span><span class="s2">"us-west-2"</span>
<span class="nv">VPC_ID</span><span class="o">=</span><span class="s2">"vpc-12345678"</span>
<span class="nv">ALB_ARN</span><span class="o">=</span><span class="s2">"arn:aws:elasticloadbalancing:us-west-2:123456789012:loadbalancer/app/myapp-alb/1234567890123456"</span>
<span class="nv">BLUE_TG_ARN</span><span class="o">=</span><span class="s2">"arn:aws:elasticloadbalancing:us-west-2:123456789012:targetgroup/myapp-blue/1234567890123456"</span>
<span class="nv">GREEN_TG_ARN</span><span class="o">=</span><span class="s2">"arn:aws:elasticloadbalancing:us-west-2:123456789012:targetgroup/myapp-green/1234567890123456"</span>
<span class="nv">LISTENER_ARN</span><span class="o">=</span><span class="s2">"arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/app/myapp-alb/1234567890123456/1234567890123456"</span>

<span class="c"># í˜„ì¬ í™œì„± í™˜ê²½ í™•ì¸</span>
get_active_environment<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local </span><span class="nv">listener_rules</span><span class="o">=</span><span class="si">$(</span>aws elbv2 describe-rules <span class="nt">--listener-arn</span> <span class="nv">$LISTENER_ARN</span> <span class="nt">--region</span> <span class="nv">$AWS_REGION</span><span class="si">)</span>
    <span class="nb">local </span><span class="nv">active_target_group</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$listener_rules</span> | jq <span class="nt">-r</span> <span class="s1">'.Rules[] | select(.Priority == "100") | .Actions[0].TargetGroupArn'</span><span class="si">)</span>
    
    <span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$active_target_group</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"</span><span class="nv">$BLUE_TG_ARN</span><span class="s2">"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"blue"</span>
    <span class="k">else
        </span><span class="nb">echo</span> <span class="s2">"green"</span>  
    <span class="k">fi</span>
<span class="o">}</span>

<span class="c"># Auto Scaling Groupì— ìƒˆ Launch Template ì ìš©</span>
update_asg_launch_template<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local </span><span class="nv">environment</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nb">local </span><span class="nv">new_ami</span><span class="o">=</span><span class="nv">$2</span>
    
    <span class="nb">local </span><span class="nv">asg_name</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">APP_NAME</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">environment</span><span class="k">}</span><span class="s2">-asg"</span>
    <span class="nb">local </span><span class="nv">lt_name</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">APP_NAME</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">environment</span><span class="k">}</span><span class="s2">-lt"</span>
    
    <span class="c"># ìƒˆ Launch Template ë²„ì „ ìƒì„±</span>
    aws ec2 create-launch-template-version <span class="se">\</span>
        <span class="nt">--launch-template-name</span> <span class="nv">$lt_name</span> <span class="se">\</span>
        <span class="nt">--source-version</span> <span class="s1">'$Latest'</span> <span class="se">\</span>
        <span class="nt">--launch-template-data</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">ImageId</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="nv">$new_ami</span><span class="se">\"</span><span class="s2">}"</span> <span class="se">\</span>
        <span class="nt">--region</span> <span class="nv">$AWS_REGION</span>
    
    <span class="c"># ASGì— ìƒˆ Launch Template ë²„ì „ ì ìš©</span>
    <span class="nb">local </span><span class="nv">latest_version</span><span class="o">=</span><span class="si">$(</span>aws ec2 describe-launch-template-versions <span class="se">\</span>
        <span class="nt">--launch-template-name</span> <span class="nv">$lt_name</span> <span class="se">\</span>
        <span class="nt">--region</span> <span class="nv">$AWS_REGION</span> <span class="se">\</span>
        <span class="nt">--query</span> <span class="s1">'LaunchTemplateVersions[0].VersionNumber'</span> <span class="se">\</span>
        <span class="nt">--output</span> text<span class="si">)</span>
    
    aws autoscaling update-auto-scaling-group <span class="se">\</span>
        <span class="nt">--auto-scaling-group-name</span> <span class="nv">$asg_name</span> <span class="se">\</span>
        <span class="nt">--launch-template</span> <span class="nv">LaunchTemplateName</span><span class="o">=</span><span class="nv">$lt_name</span>,Version<span class="o">=</span><span class="nv">$latest_version</span> <span class="se">\</span>
        <span class="nt">--region</span> <span class="nv">$AWS_REGION</span>
    
    log <span class="s2">"Updated ASG </span><span class="nv">$asg_name</span><span class="s2"> with Launch Template version </span><span class="nv">$latest_version</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># ì¸ìŠ¤í„´ìŠ¤ êµì²´ (Rolling Replacement)</span>
perform_instance_refresh<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local </span><span class="nv">environment</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nb">local </span><span class="nv">asg_name</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">APP_NAME</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">environment</span><span class="k">}</span><span class="s2">-asg"</span>
    
    log <span class="s2">"Starting instance refresh for </span><span class="nv">$asg_name</span><span class="s2">"</span>
    
    <span class="nb">local </span><span class="nv">refresh_id</span><span class="o">=</span><span class="si">$(</span>aws autoscaling start-instance-refresh <span class="se">\</span>
        <span class="nt">--auto-scaling-group-name</span> <span class="nv">$asg_name</span> <span class="se">\</span>
        <span class="nt">--preferences</span> <span class="s1">'{
            "InstanceWarmup": 300,
            "MinHealthyPercentage": 50,
            "CheckpointPercentages": [20, 50, 100],
            "CheckpointDelay": 600
        }'</span> <span class="se">\</span>
        <span class="nt">--region</span> <span class="nv">$AWS_REGION</span> <span class="se">\</span>
        <span class="nt">--query</span> <span class="s1">'InstanceRefreshId'</span> <span class="se">\</span>
        <span class="nt">--output</span> text<span class="si">)</span>
    
    log <span class="s2">"Instance refresh started with ID: </span><span class="nv">$refresh_id</span><span class="s2">"</span>
    
    <span class="c"># ì¸ìŠ¤í„´ìŠ¤ êµì²´ ì™„ë£Œ ëŒ€ê¸°</span>
    <span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do
        </span><span class="nb">local </span><span class="nv">status</span><span class="o">=</span><span class="si">$(</span>aws autoscaling describe-instance-refreshes <span class="se">\</span>
            <span class="nt">--auto-scaling-group-name</span> <span class="nv">$asg_name</span> <span class="se">\</span>
            <span class="nt">--instance-refresh-ids</span> <span class="nv">$refresh_id</span> <span class="se">\</span>
            <span class="nt">--region</span> <span class="nv">$AWS_REGION</span> <span class="se">\</span>
            <span class="nt">--query</span> <span class="s1">'InstanceRefreshes[0].Status'</span> <span class="se">\</span>
            <span class="nt">--output</span> text<span class="si">)</span>
        
        log <span class="s2">"Instance refresh status: </span><span class="nv">$status</span><span class="s2">"</span>
        
        <span class="k">case</span> <span class="nv">$status</span> <span class="k">in</span>
            <span class="s2">"Successful"</span><span class="p">)</span>
                log <span class="s2">"âœ… Instance refresh completed successfully"</span>
                <span class="nb">break</span>
                <span class="p">;;</span>
            <span class="s2">"Failed"</span><span class="p">|</span><span class="s2">"Cancelled"</span><span class="p">)</span>
                error <span class="s2">"âŒ Instance refresh failed with status: </span><span class="nv">$status</span><span class="s2">"</span>
                <span class="k">return </span>1
                <span class="p">;;</span>
            <span class="s2">"InProgress"</span><span class="p">|</span><span class="s2">"Pending"</span><span class="p">)</span>
                log <span class="s2">"Instance refresh in progress, waiting..."</span>
                <span class="nb">sleep </span>60
                <span class="p">;;</span>
        <span class="k">esac</span>
    <span class="k">done</span>
<span class="o">}</span>

<span class="c"># í—¬ìŠ¤ì²´í¬ ìˆ˜í–‰</span>
health_check_environment<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local </span><span class="nv">environment</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nb">local </span>target_group_arn
    
    <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$environment</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"blue"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">target_group_arn</span><span class="o">=</span><span class="nv">$BLUE_TG_ARN</span>
    <span class="k">else
        </span><span class="nv">target_group_arn</span><span class="o">=</span><span class="nv">$GREEN_TG_ARN</span>
    <span class="k">fi
    
    </span>log <span class="s2">"Performing health check for </span><span class="nv">$environment</span><span class="s2"> environment"</span>
    
    <span class="nb">local </span><span class="nv">max_attempts</span><span class="o">=</span>30
    <span class="nb">local </span><span class="nv">attempt</span><span class="o">=</span>1
    
    <span class="k">while</span> <span class="o">[</span> <span class="nv">$attempt</span> <span class="nt">-le</span> <span class="nv">$max_attempts</span> <span class="o">]</span><span class="p">;</span> <span class="k">do
        </span><span class="nb">local </span><span class="nv">healthy_targets</span><span class="o">=</span><span class="si">$(</span>aws elbv2 describe-target-health <span class="se">\</span>
            <span class="nt">--target-group-arn</span> <span class="nv">$target_group_arn</span> <span class="se">\</span>
            <span class="nt">--region</span> <span class="nv">$AWS_REGION</span> <span class="se">\</span>
            <span class="nt">--query</span> <span class="s1">'TargetHealthDescriptions[?TargetHealth.State==`healthy`] | length(@)'</span><span class="si">)</span>
        
        <span class="nb">local </span><span class="nv">total_targets</span><span class="o">=</span><span class="si">$(</span>aws elbv2 describe-target-health <span class="se">\</span>
            <span class="nt">--target-group-arn</span> <span class="nv">$target_group_arn</span> <span class="se">\</span>
            <span class="nt">--region</span> <span class="nv">$AWS_REGION</span> <span class="se">\</span>
            <span class="nt">--query</span> <span class="s1">'TargetHealthDescriptions | length(@)'</span><span class="si">)</span>
        
        log <span class="s2">"Health check attempt </span><span class="nv">$attempt</span><span class="s2">: </span><span class="nv">$healthy_targets</span><span class="s2">/</span><span class="nv">$total_targets</span><span class="s2"> targets healthy"</span>
        
        <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$healthy_targets</span><span class="s2">"</span> <span class="nt">-gt</span> 0 <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$healthy_targets</span><span class="s2">"</span> <span class="nt">-eq</span> <span class="s2">"</span><span class="nv">$total_targets</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span>log <span class="s2">"âœ… All targets are healthy in </span><span class="nv">$environment</span><span class="s2"> environment"</span>
            <span class="k">return </span>0
        <span class="k">fi
        
        </span><span class="nb">sleep </span>30
        <span class="o">((</span>attempt++<span class="o">))</span>
    <span class="k">done
    
    </span>error <span class="s2">"âŒ Health check failed for </span><span class="nv">$environment</span><span class="s2"> environment after </span><span class="nv">$max_attempts</span><span class="s2"> attempts"</span>
    <span class="k">return </span>1
<span class="o">}</span>

<span class="c"># íŠ¸ë˜í”½ ì „í™˜</span>
switch_traffic<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local </span><span class="nv">target_environment</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nb">local </span>target_group_arn
    
    <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$target_environment</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"blue"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">target_group_arn</span><span class="o">=</span><span class="nv">$BLUE_TG_ARN</span>
    <span class="k">else
        </span><span class="nv">target_group_arn</span><span class="o">=</span><span class="nv">$GREEN_TG_ARN</span>
    <span class="k">fi
    
    </span>log <span class="s2">"Switching traffic to </span><span class="nv">$target_environment</span><span class="s2"> environment"</span>
    
    aws elbv2 modify-rule <span class="se">\</span>
        <span class="nt">--rule-arn</span> <span class="si">$(</span>aws elbv2 describe-rules <span class="nt">--listener-arn</span> <span class="nv">$LISTENER_ARN</span> <span class="nt">--region</span> <span class="nv">$AWS_REGION</span> <span class="nt">--query</span> <span class="s1">'Rules[?Priority==`100`].RuleArn'</span> <span class="nt">--output</span> text<span class="si">)</span> <span class="se">\</span>
        <span class="nt">--actions</span> <span class="nv">Type</span><span class="o">=</span>forward,TargetGroupArn<span class="o">=</span><span class="nv">$target_group_arn</span> <span class="se">\</span>
        <span class="nt">--region</span> <span class="nv">$AWS_REGION</span>
    
    log <span class="s2">"âœ… Traffic switched to </span><span class="nv">$target_environment</span><span class="s2"> environment"</span>
<span class="o">}</span>

<span class="c"># ë°°í¬ ê²€ì¦</span>
validate_deployment<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local </span><span class="nv">environment</span><span class="o">=</span><span class="nv">$1</span>
    
    log <span class="s2">"Validating deployment in </span><span class="nv">$environment</span><span class="s2"> environment"</span>
    
    <span class="c"># ALB DNS ì´ë¦„ ê°€ì ¸ì˜¤ê¸°</span>
    <span class="nb">local </span><span class="nv">alb_dns</span><span class="o">=</span><span class="si">$(</span>aws elbv2 describe-load-balancers <span class="se">\</span>
        <span class="nt">--load-balancer-arns</span> <span class="nv">$ALB_ARN</span> <span class="se">\</span>
        <span class="nt">--region</span> <span class="nv">$AWS_REGION</span> <span class="se">\</span>
        <span class="nt">--query</span> <span class="s1">'LoadBalancers[0].DNSName'</span> <span class="se">\</span>
        <span class="nt">--output</span> text<span class="si">)</span>
    
    <span class="c"># ì• í”Œë¦¬ì¼€ì´ì…˜ ë²„ì „ í™•ì¸</span>
    <span class="nb">local </span><span class="nv">app_version</span><span class="o">=</span><span class="si">$(</span>curl <span class="nt">-s</span> <span class="nt">-f</span> http://<span class="nv">$alb_dns</span>/version 2&gt;/dev/null <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"unknown"</span><span class="si">)</span>
    
    <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$app_version</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$NEW_VERSION</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>log <span class="s2">"âœ… Application version validated: </span><span class="nv">$app_version</span><span class="s2">"</span>
    <span class="k">else
        </span>error <span class="s2">"âŒ Version mismatch. Expected: </span><span class="nv">$NEW_VERSION</span><span class="s2">, Got: </span><span class="nv">$app_version</span><span class="s2">"</span>
        <span class="k">return </span>1
    <span class="k">fi</span>
    
    <span class="c"># ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</span>
    <span class="nb">local </span><span class="nv">health_status</span><span class="o">=</span><span class="si">$(</span>curl <span class="nt">-s</span> <span class="nt">-o</span> /dev/null <span class="nt">-w</span> <span class="s2">"%{http_code}"</span> http://<span class="nv">$alb_dns</span>/health<span class="si">)</span>
    
    <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$health_status</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"200"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>log <span class="s2">"âœ… Application health check passed"</span>
    <span class="k">else
        </span>error <span class="s2">"âŒ Application health check failed. Status code: </span><span class="nv">$health_status</span><span class="s2">"</span>
        <span class="k">return </span>1
    <span class="k">fi
    
    </span>log <span class="s2">"âœ… Deployment validation completed successfully"</span>
<span class="o">}</span>

<span class="c"># ë¡¤ë°± ìˆ˜í–‰</span>
rollback_deployment<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local </span><span class="nv">current_environment</span><span class="o">=</span><span class="si">$(</span>get_active_environment<span class="si">)</span>
    <span class="nb">local </span>rollback_environment
    
    <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$current_environment</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"blue"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">rollback_environment</span><span class="o">=</span><span class="s2">"green"</span>
    <span class="k">else
        </span><span class="nv">rollback_environment</span><span class="o">=</span><span class="s2">"blue"</span>
    <span class="k">fi
    
    </span>log <span class="s2">"Rolling back from </span><span class="nv">$current_environment</span><span class="s2"> to </span><span class="nv">$rollback_environment</span><span class="s2">"</span>
    
    switch_traffic <span class="nv">$rollback_environment</span>
    
    log <span class="s2">"âœ… Rollback completed"</span>
<span class="o">}</span>

<span class="c"># ë©”ì¸ ë°°í¬ ë¡œì§</span>
main<span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$NEW_VERSION</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> &lt;new-version&gt;"</span>
        <span class="nb">exit </span>1
    <span class="k">fi
    
    </span>log <span class="s2">"=== AWS EC2 Blue-Green Deployment Started ==="</span>
    log <span class="s2">"Application: </span><span class="nv">$APP_NAME</span><span class="s2">"</span>
    log <span class="s2">"New Version: </span><span class="nv">$NEW_VERSION</span><span class="s2">"</span>
    log <span class="s2">"Region: </span><span class="nv">$AWS_REGION</span><span class="s2">"</span>
    
    <span class="c"># 1. í˜„ì¬ í™œì„± í™˜ê²½ í™•ì¸</span>
    <span class="nb">local </span><span class="nv">active_env</span><span class="o">=</span><span class="si">$(</span>get_active_environment<span class="si">)</span>
    <span class="nb">local </span>inactive_env
    
    <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$active_env</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"blue"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">inactive_env</span><span class="o">=</span><span class="s2">"green"</span>
    <span class="k">else
        </span><span class="nv">inactive_env</span><span class="o">=</span><span class="s2">"blue"</span>
    <span class="k">fi
    
    </span>log <span class="s2">"Current active environment: </span><span class="nv">$active_env</span><span class="s2">"</span>
    log <span class="s2">"Deploying to inactive environment: </span><span class="nv">$inactive_env</span><span class="s2">"</span>
    
    <span class="c"># 2. ìƒˆ AMI ID ê°€ì ¸ì˜¤ê¸° (ì´ë¯¸ ë¹Œë“œëœ AMI ì‚¬ìš©)</span>
    <span class="nb">local </span><span class="nv">new_ami</span><span class="o">=</span><span class="si">$(</span>aws ec2 describe-images <span class="se">\</span>
        <span class="nt">--filters</span> <span class="s2">"Name=tag:Version,Values=</span><span class="nv">$NEW_VERSION</span><span class="s2">"</span> <span class="s2">"Name=tag:Application,Values=</span><span class="nv">$APP_NAME</span><span class="s2">"</span> <span class="se">\</span>
        <span class="nt">--region</span> <span class="nv">$AWS_REGION</span> <span class="se">\</span>
        <span class="nt">--query</span> <span class="s1">'Images[0].ImageId'</span> <span class="se">\</span>
        <span class="nt">--output</span> text<span class="si">)</span>
    
    <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$new_ami</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"None"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$new_ami</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>error <span class="s2">"âŒ AMI for version </span><span class="nv">$NEW_VERSION</span><span class="s2"> not found"</span>
        <span class="nb">exit </span>1
    <span class="k">fi
    
    </span>log <span class="s2">"Using AMI: </span><span class="nv">$new_ami</span><span class="s2"> for version </span><span class="nv">$NEW_VERSION</span><span class="s2">"</span>
    
    <span class="c"># 3. ë¹„í™œì„± í™˜ê²½ì— ìƒˆ ë²„ì „ ë°°í¬</span>
    <span class="k">if</span> <span class="o">!</span> update_asg_launch_template <span class="nv">$inactive_env</span> <span class="nv">$new_ami</span><span class="p">;</span> <span class="k">then
        </span>error <span class="s2">"âŒ Failed to update launch template"</span>
        <span class="nb">exit </span>1
    <span class="k">fi
    
    if</span> <span class="o">!</span> perform_instance_refresh <span class="nv">$inactive_env</span><span class="p">;</span> <span class="k">then
        </span>error <span class="s2">"âŒ Failed to refresh instances"</span>
        <span class="nb">exit </span>1
    <span class="k">fi</span>
    
    <span class="c"># 4. ë¹„í™œì„± í™˜ê²½ í—¬ìŠ¤ì²´í¬</span>
    <span class="k">if</span> <span class="o">!</span> health_check_environment <span class="nv">$inactive_env</span><span class="p">;</span> <span class="k">then
        </span>error <span class="s2">"âŒ Health check failed for </span><span class="nv">$inactive_env</span><span class="s2"> environment"</span>
        <span class="nb">exit </span>1
    <span class="k">fi</span>
    
    <span class="c"># 5. íŠ¸ë˜í”½ ì „í™˜</span>
    <span class="k">if</span> <span class="o">!</span> switch_traffic <span class="nv">$inactive_env</span><span class="p">;</span> <span class="k">then
        </span>error <span class="s2">"âŒ Failed to switch traffic"</span>
        rollback_deployment
        <span class="nb">exit </span>1
    <span class="k">fi</span>
    
    <span class="c"># 6. ë°°í¬ ê²€ì¦</span>
    <span class="nb">sleep </span>60  <span class="c"># íŠ¸ë˜í”½ ì•ˆì •í™” ëŒ€ê¸°</span>
    
    <span class="k">if</span> <span class="o">!</span> validate_deployment <span class="nv">$inactive_env</span><span class="p">;</span> <span class="k">then
        </span>error <span class="s2">"âŒ Deployment validation failed"</span>
        rollback_deployment
        <span class="nb">exit </span>1
    <span class="k">fi
    
    </span>log <span class="s2">"ğŸ‰ Blue-Green deployment completed successfully!"</span>
    log <span class="s2">"New active environment: </span><span class="nv">$inactive_env</span><span class="s2">"</span>
    log <span class="s2">"Previous environment (</span><span class="nv">$active_env</span><span class="s2">) is now inactive and ready for next deployment"</span>
<span class="o">}</span>

<span class="c"># ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜</span>
log<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">"[</span><span class="si">$(</span><span class="nb">date</span> +<span class="s1">'%Y-%m-%d %H:%M:%S'</span><span class="si">)</span><span class="s2">] </span><span class="nv">$1</span><span class="s2">"</span>
<span class="o">}</span>

error<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">"[</span><span class="si">$(</span><span class="nb">date</span> +<span class="s1">'%Y-%m-%d %H:%M:%S'</span><span class="si">)</span><span class="s2">] ERROR: </span><span class="nv">$1</span><span class="s2">"</span> <span class="o">&gt;</span>&amp;2
<span class="o">}</span>

<span class="c"># ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰</span>
main <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
</code></pre></div></div>

<h2 id="ì •ë¦¬-ë°-ëª¨ë²”-ì‚¬ë¡€">ì •ë¦¬ ë° ëª¨ë²” ì‚¬ë¡€</h2>

<h3 id="-ë°°í¬-ì „ëµ-ì„ íƒ-ê°€ì´ë“œ">ğŸ“Š ë°°í¬ ì „ëµ ì„ íƒ ê°€ì´ë“œ</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë°°í¬ ì „ëµ ì„ íƒ ë§¤íŠ¸ë¦­ìŠ¤</span>
ìƒí™©                     | ê¶Œì¥ ì „ëµ        | ì´ìœ 
<span class="o">====================</span>|<span class="o">===============</span>|<span class="o">==============================</span>
ê°œë°œ/í…ŒìŠ¤íŠ¸ í™˜ê²½         | Recreate      | ë‹¨ìˆœí•¨, ë¦¬ì†ŒìŠ¤ ì ˆì•½
ìŠ¤í…Œì´ì§€ í™˜ê²½           | Rolling       | í”„ë¡œë•ì…˜ê³¼ ìœ ì‚¬í•œ í™˜ê²½
í”„ë¡œë•ì…˜ <span class="o">(</span>ìœ„í—˜ ë†’ìŒ<span class="o">)</span>     | Blue-Green    | ì¦‰ì‹œ ë¡¤ë°±, ì™„ì „í•œ ê²€ì¦
í”„ë¡œë•ì…˜ <span class="o">(</span>ìœ„í—˜ ë³´í†µ<span class="o">)</span>     | Canary        | ì ì§„ì  ê²€ì¦, ë¦¬ìŠ¤í¬ ë¶„ì‚°
í”„ë¡œë•ì…˜ <span class="o">(</span>ìœ„í—˜ ë‚®ìŒ<span class="o">)</span>     | Rolling       | íš¨ìœ¨ì , ë¦¬ì†ŒìŠ¤ ìµœì í™”
ë ˆê±°ì‹œ ì‹œìŠ¤í…œ           | Blue-Green    | ì•ˆì „ì„± ìš°ì„ 
ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤          | Canary        | ì„œë¹„ìŠ¤ë³„ ë…ë¦½ ë°°í¬
</code></pre></div></div>

<h3 id="-ëª¨ë²”-ì‚¬ë¡€">ğŸ”§ ëª¨ë²” ì‚¬ë¡€</h3>

<h4 id="1-ë°°í¬-ì¤€ë¹„">1. ë°°í¬ ì¤€ë¹„</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸</span>
âœ… ë°±ì—… ì™„ë£Œ
âœ… ë¡¤ë°± ê³„íš ìˆ˜ë¦½
âœ… ëª¨ë‹ˆí„°ë§ ì¤€ë¹„
âœ… íŒ€ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜
âœ… í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
âœ… ì„¤ì • ê²€ì¦
</code></pre></div></div>

<h4 id="2-ëª¨ë‹ˆí„°ë§-ë°-ì•ŒëŒ">2. ëª¨ë‹ˆí„°ë§ ë° ì•ŒëŒ</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í•µì‹¬ ë©”íŠ¸ë¦­</span>
- ì—ëŸ¬ìœ¨ <span class="o">(</span>&lt; 1%<span class="o">)</span>
- ì‘ë‹µ ì‹œê°„ <span class="o">(</span>&lt; 500ms<span class="o">)</span>
- ì²˜ë¦¬ëŸ‰ <span class="o">(</span>baseline ëŒ€ë¹„<span class="o">)</span>
- ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ë¥  <span class="o">(</span>&lt; 80%<span class="o">)</span>
- ê°€ìš©ì„± <span class="o">(&gt;</span> 99.9%<span class="o">)</span>
</code></pre></div></div>

<h4 id="3-ìë™í™”-ì›ì¹™">3. ìë™í™” ì›ì¹™</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ëª¨ë“  ê²ƒì„ ìë™í™”</span>
1. ë¹Œë“œ í”„ë¡œì„¸ìŠ¤
2. í…ŒìŠ¤íŠ¸ ì‹¤í–‰
3. ë°°í¬ í”„ë¡œì„¸ìŠ¤
4. í—¬ìŠ¤ì²´í¬
5. ë¡¤ë°± ì ˆì°¨
6. ì•Œë¦¼ ë° ë¡œê¹…
</code></pre></div></div>

<p>í˜„ëŒ€ì ì¸ ë°°í¬ ì „ëµì„ ë§ˆìŠ¤í„°í•˜ì…¨ë‚˜ìš”? ì•ˆì •ì ì´ê³  íš¨ìœ¨ì ì¸ ë°°í¬ë¡œ ì„œë¹„ìŠ¤ í’ˆì§ˆì„ í•œ ë‹¨ê³„ ë†’ì—¬ë³´ì„¸ìš”! ğŸš€</p>]]></content><author><name>DevOps Engineer</name></author><category term="DevOps" /><category term="Deployment" /><category term="deployment" /><category term="ci-cd" /><category term="blue-green" /><category term="canary" /><category term="rolling-update" /><category term="kubernetes" /><category term="aws" /><category term="automation" /><summary type="html"><![CDATA[í˜„ëŒ€ì ì¸ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì—ì„œ ë°°í¬ëŠ” ë‹¨ìˆœíˆ ì½”ë“œë¥¼ ì„œë²„ì— ì˜¬ë¦¬ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤. ì•ˆì •ì ì´ê³  ì˜ˆì¸¡ ê°€ëŠ¥í•œ ë°°í¬ ì „ëµì„ í†µí•´ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ì„ ìµœì†Œí™”í•˜ê³  ì‚¬ìš©ì ê²½í—˜ì„ ë³´ì¥í•˜ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤. 3-1 ë°°í¬ | Deployment 3-1-1 ë°°í¬ ìë™í™” | Deployment Automation ë°°í¬ ìë™í™”ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ë¦´ë¦¬ìŠ¤ ê³¼ì •ì„ ì²´ê³„í™”í•˜ê³  ì¸ê°„ì˜ ì‹¤ìˆ˜ë¥¼ ìµœì†Œí™”í•˜ì—¬ ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ ìš´ì˜ì„ ë³´ì¥í•©ë‹ˆë‹¤. ğŸš€ ë°°í¬ ìë™í™”ì˜ í•µì‹¬ ê°œë… # ë°°í¬ ìë™í™” êµ¬ì„± ìš”ì†Œ 1. ì†ŒìŠ¤ ì½”ë“œ ê´€ë¦¬ (SCM) - Git, SVN - ë¸Œëœì¹˜ ì „ëµ (Git Flow, GitHub Flow) 2. ë¹Œë“œ ìë™í™” - ì»´íŒŒì¼, íŒ¨í‚¤ì§• - í…ŒìŠ¤íŠ¸ ì‹¤í–‰ - ì•„í‹°íŒ©íŠ¸ ìƒì„± 3. ë°°í¬ íŒŒì´í”„ë¼ì¸ - ë‹¨ê³„ë³„ ë°°í¬ (Dev â†’ Staging â†’ Production) - ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤ - ë¡¤ë°± ë©”ì»¤ë‹ˆì¦˜ 4. ì¸í”„ë¼ ìë™í™” - IaC (Infrastructure as Code) - ì»¨í…Œì´ë„ˆí™” - ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ CI/CD íŒŒì´í”„ë¼ì¸ ì„¤ê³„ # .gitlab-ci.yml - GitLab CI/CD íŒŒì´í”„ë¼ì¸ stages: - build - test - security - deploy-staging - deploy-production variables: DOCKER_DRIVER: overlay2 DOCKER_HOST: tcp://docker:2376 DOCKER_TLS_CERTDIR: "/certs" before_script: - echo "Pipeline started at $(date)" - docker info # ë¹Œë“œ ë‹¨ê³„ build: stage: build image: node:16-alpine script: - npm ci --only=production - npm run build - docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA . - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA artifacts: paths: - dist/ expire_in: 1 hour only: - main - develop # í…ŒìŠ¤íŠ¸ ë‹¨ê³„ unit-test: stage: test image: node:16-alpine script: - npm ci - npm run test:unit - npm run test:coverage artifacts: reports: junit: junit.xml coverage_report: coverage_format: cobertura path: coverage/cobertura-coverage.xml coverage: '/Lines\s*:\s*(\d+\.\d+)%/' integration-test: stage: test services: - postgres:13 - redis:6 variables: POSTGRES_DB: testdb POSTGRES_USER: test POSTGRES_PASSWORD: test script: - npm run test:integration only: - main # ë³´ì•ˆ ìŠ¤ìº” security-scan: stage: security image: owasp/zap2docker-stable script: - zap-baseline.py -t http://localhost:3000 -J zap-report.json - npm audit --audit-level high artifacts: reports: sast: zap-report.json allow_failure: true # ìŠ¤í…Œì´ì§• ë°°í¬ deploy-staging: stage: deploy-staging image: alpine/helm:3.8.0 script: - helm upgrade --install myapp-staging ./helm-chart --namespace staging --set image.tag=$CI_COMMIT_SHA --set ingress.host=staging.myapp.com --wait environment: name: staging url: https://staging.myapp.com only: - develop # í”„ë¡œë•ì…˜ ë°°í¬ (ìˆ˜ë™ ìŠ¹ì¸ í•„ìš”) deploy-production: stage: deploy-production image: alpine/helm:3.8.0 script: - helm upgrade --install myapp-prod ./helm-chart --namespace production --set image.tag=$CI_COMMIT_SHA --set ingress.host=myapp.com --set replicas=3 --wait environment: name: production url: https://myapp.com when: manual only: - main Jenkins íŒŒì´í”„ë¼ì¸ êµ¬ì„± // Jenkinsfile - Jenkins ì„ ì–¸ì  íŒŒì´í”„ë¼ì¸ pipeline { agent any environment { DOCKER_REGISTRY = 'your-registry.com' APP_NAME = 'myapp' KUBECONFIG = credentials('kubeconfig-prod') } stages { stage('Checkout') { steps { checkout scm script { env.GIT_COMMIT_SHORT = sh( script: 'git rev-parse --short HEAD', returnStdout: true ).trim() } } } stage('Build &amp; Test') { parallel { stage('Unit Tests') { steps { sh 'npm ci' sh 'npm run test:unit' } post { always { publishTestResults testResultsPattern: 'test-results.xml' publishCoverage adapters: [ coberturaAdapter('coverage/cobertura-coverage.xml') ] } } } stage('Security Scan') { steps { sh 'npm audit' sh 'docker run --rm -v $(pwd):/app clair-scanner --ip $(hostname -i) myapp:latest' } } } } stage('Build Docker Image') { steps { script { def image = docker.build("${DOCKER_REGISTRY}/${APP_NAME}:${env.GIT_COMMIT_SHORT}") docker.withRegistry("https://${DOCKER_REGISTRY}", 'docker-registry-credentials') { image.push() image.push('latest') } } } } stage('Deploy to Staging') { steps { sh """ helm upgrade --install ${APP_NAME}-staging ./helm-chart \\ --namespace staging \\ --set image.tag=${env.GIT_COMMIT_SHORT} \\ --wait --timeout=600s """ } } stage('Integration Tests') { steps { sh 'npm run test:integration -- --env=staging' } } stage('Deploy to Production') { when { branch 'main' } input { message "Deploy to production?" ok "Deploy" parameters { choice(name: 'DEPLOYMENT_STRATEGY', choices: ['rolling', 'blue-green', 'canary']) } } steps { script { switch(params.DEPLOYMENT_STRATEGY) { case 'blue-green': sh './scripts/blue-green-deploy.sh ${env.GIT_COMMIT_SHORT}' break case 'canary': sh './scripts/canary-deploy.sh ${env.GIT_COMMIT_SHORT}' break default: sh """ helm upgrade --install ${APP_NAME}-prod ./helm-chart \\ --namespace production \\ --set image.tag=${env.GIT_COMMIT_SHORT} \\ --wait --timeout=600s """ } } } } } post { failure { script { slackSend( channel: '#deployments', color: 'danger', message: "âŒ Deployment failed: ${env.JOB_NAME} ${env.BUILD_NUMBER}" ) } } success { script { slackSend( channel: '#deployments', color: 'good', message: "âœ… Deployment successful: ${env.JOB_NAME} ${env.BUILD_NUMBER}" ) } } } } 3-1-2 ë°°í¬ ìë™í™” ë„êµ¬ ì„ íƒ | Deployment Automation Tools ğŸ› ï¸ ë„êµ¬ ë¹„êµ ë§¤íŠ¸ë¦­ìŠ¤ # CI/CD í”Œë«í¼ ë¹„êµ GitLab CI Jenkins GitHub Actions Azure DevOps AWS CodePipeline ì„¤ì • ë³µì¡ë„ ë‚®ìŒ ì¤‘ê°„ ë‚®ìŒ ì¤‘ê°„ ë†’ìŒ í´ë¼ìš°ë“œ í†µí•© ìš°ìˆ˜ ë³´í†µ ìš°ìˆ˜ ìš°ìˆ˜ ìš°ìˆ˜ ì˜¨í”„ë ˆë¯¸ìŠ¤ ì§€ì› ìš°ìˆ˜ ìš°ìˆ˜ ì œí•œì  ìš°ìˆ˜ ë¶ˆê°€ ë¹„ìš© ë¬´ë£Œ/ìœ ë£Œ ì˜¤í”ˆì†ŒìŠ¤ ë¬´ë£Œ/ìœ ë£Œ ìœ ë£Œ ì‚¬ìš©ëŸ‰ê¸°ë°˜ í™•ì¥ì„± ìš°ìˆ˜ ìš°ìˆ˜ ìš°ìˆ˜ ìš°ìˆ˜ ìš°ìˆ˜ ì»¤ë®¤ë‹ˆí‹° ì§€ì› ìš°ìˆ˜ ìµœê³  ìš°ìˆ˜ ë³´í†µ ë³´í†µ # ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ Kubernetes Docker Swarm OpenShift Nomad ECS/Fargate í•™ìŠµ ê³¡ì„  ê°€íŒŒë¦„ ì™„ë§Œ ì¤‘ê°„ ì™„ë§Œ ì™„ë§Œ ê¸°ëŠ¥ í’ë¶€í•¨ ìµœê³  ê¸°ë³¸ ìš°ìˆ˜ ê¸°ë³¸ ê¸°ë³¸ í´ë¼ìš°ë“œ ì§€ì› ìš°ìˆ˜ ë³´í†µ ìš°ìˆ˜ ë³´í†µ AWSì „ìš© ì»¤ë®¤ë‹ˆí‹° ìµœê³  ê°ì†Œ ë³´í†µ ì„±ì¥ AWSìƒíƒœê³„ GitHub Actions ì›Œí¬í”Œë¡œìš° # .github/workflows/deploy.yml name: Deploy Application on: push: branches: [main, develop] pull_request: branches: [main] env: REGISTRY: ghcr.io IMAGE_NAME: $ jobs: test: runs-on: ubuntu-latest strategy: matrix: node-version: [16.x, 18.x] steps: - uses: actions/checkout@v3 - name: Setup Node.js $ uses: actions/setup-node@v3 with: node-version: $ cache: 'npm' - name: Install dependencies run: npm ci - name: Run tests run: | npm run test:unit npm run test:integration - name: Upload coverage reports uses: codecov/codecov-action@v3 with: file: ./coverage/lcov.info build: needs: test runs-on: ubuntu-latest outputs: image: $ digest: $ steps: - name: Checkout repository uses: actions/checkout@v3 - name: Setup Docker Buildx uses: docker/setup-buildx-action@v2 - name: Log in to Container Registry uses: docker/login-action@v2 with: registry: $ username: $ password: $ - name: Extract metadata id: meta uses: docker/metadata-action@v4 with: images: $/$ tags: | type=ref,event=branch type=ref,event=pr type=sha,prefix=- - name: Build and push Docker image id: build uses: docker/build-push-action@v4 with: context: . push: true tags: $ labels: $ cache-from: type=gha cache-to: type=gha,mode=max deploy-staging: if: github.ref == 'refs/heads/develop' needs: build runs-on: ubuntu-latest environment: staging steps: - name: Deploy to staging uses: azure/k8s-deploy@v1 with: manifests: | k8s/staging/deployment.yaml k8s/staging/service.yaml images: $@$ namespace: staging deploy-production: if: github.ref == 'refs/heads/main' needs: build runs-on: ubuntu-latest environment: production steps: - name: Deploy to production uses: azure/k8s-deploy@v1 with: manifests: | k8s/production/deployment.yaml k8s/production/service.yaml images: $@$ namespace: production strategy: blue-green ArgoCD GitOps ì›Œí¬í”Œë¡œìš° # argocd-app.yaml - ArgoCD Application ì •ì˜ apiVersion: argoproj.io/v1alpha1 kind: Application metadata: name: myapp-production namespace: argocd finalizers: - resources-finalizer.argocd.argoproj.io spec: project: default source: repoURL: https://github.com/company/myapp-k8s-manifests targetRevision: HEAD path: overlays/production destination: server: https://kubernetes.default.svc namespace: production syncPolicy: automated: prune: true selfHeal: true allowEmpty: false syncOptions: - CreateNamespace=true - PrunePropagationPolicy=foreground - PruneLast=true revisionHistoryLimit: 10 # Health checks ignoreDifferences: - group: apps kind: Deployment jsonPointers: - /spec/replicas --- # kustomization.yaml - Kustomize ì„¤ì • apiVersion: kustomize.config.k8s.io/v1beta1 kind: Kustomization namespace: production resources: - ../../base patchesStrategicMerge: - deployment-patch.yaml - service-patch.yaml images: - name: myapp newTag: v1.2.3 replicas: - name: myapp-deployment count: 3 configMapGenerator: - name: myapp-config files: - config/production.yaml secretGenerator: - name: myapp-secrets files: - secrets/database.env 3-2 ë°°í¬ ì „ëµ | Deployment Strategies 3-2-1 ê°€ì¥ ê°„ë‹¨í•œ ë°°í¬ | Recreate Deployment Recreate ë°°í¬ëŠ” ê¸°ì¡´ ë²„ì „ì„ ì™„ì „íˆ ì¤‘ë‹¨í•œ í›„ ìƒˆ ë²„ì „ì„ ì‹œì‘í•˜ëŠ” ê°€ì¥ ë‹¨ìˆœí•œ ë°°í¬ ë°©ì‹ì…ë‹ˆë‹¤. ğŸ“‹ Recreate ë°°í¬ íŠ¹ì§• # ì¥ì  - êµ¬í˜„ì´ ê°„ë‹¨í•¨ - ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ì´ ì ìŒ - ë²„ì „ ê°„ ì¶©ëŒ ì—†ìŒ - ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ì— ìœ ë¦¬ # ë‹¨ì  - ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ì‹œê°„ ë°œìƒ - ì‚¬ìš©ì ê²½í—˜ ì €í•˜ - ë¡¤ë°± ì‹œê°„ì´ ê¹€ Kubernetes Recreate ë°°í¬ # recreate-deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: myapp-recreate namespace: default spec: replicas: 3 strategy: type: Recreate # Recreate ì „ëµ ì‚¬ìš© selector: matchLabels: app: myapp template: metadata: labels: app: myapp version: v2.0.0 spec: containers: - name: myapp image: myapp:v2.0.0 ports: - containerPort: 8080 # í—¬ìŠ¤ì²´í¬ ì„¤ì • livenessProbe: httpGet: path: /health port: 8080 initialDelaySeconds: 30 periodSeconds: 10 readinessProbe: httpGet: path: /ready port: 8080 initialDelaySeconds: 5 periodSeconds: 5 resources: requests: memory: "256Mi" cpu: "250m" limits: memory: "512Mi" cpu: "500m" Recreate ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # recreate-deploy.sh set -e APP_NAME="myapp" NEW_VERSION="$1" NAMESPACE="production" if [ -z "$NEW_VERSION" ]; then echo "Usage: $0 &lt;new-version&gt;" exit 1 fi echo "=== Recreate Deployment Started ===" echo "App: $APP_NAME" echo "New Version: $NEW_VERSION" echo "Namespace: $NAMESPACE" echo "Time: $(date)" # 1. í˜„ì¬ ë°°í¬ ìƒíƒœ í™•ì¸ echo "Current deployment status:" kubectl get deployment $APP_NAME -n $NAMESPACE # 2. í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ í™•ì¸ echo "Checking current health status..." kubectl get pods -n $NAMESPACE -l app=$APP_NAME # 3. íŠ¸ë˜í”½ ì¤‘ë‹¨ (ë¡œë“œë°¸ëŸ°ì„œì—ì„œ ì œê±°) echo "Removing from load balancer..." kubectl patch service $APP_NAME -n $NAMESPACE -p '{"spec":{"selector":{"app":"maintenance"}}}' # 4. ê¸°ì¡´ íŒŒë“œ ì¢…ë£Œ ëŒ€ê¸° echo "Stopping existing pods..." kubectl delete pods -n $NAMESPACE -l app=$APP_NAME --grace-period=30 # 5. ìƒˆ ë²„ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸ echo "Updating to new version: $NEW_VERSION" kubectl set image deployment/$APP_NAME -n $NAMESPACE container=$APP_NAME:$NEW_VERSION # 6. ë°°í¬ ì™„ë£Œ ëŒ€ê¸° echo "Waiting for deployment to complete..." kubectl rollout status deployment/$APP_NAME -n $NAMESPACE --timeout=300s # 7. í—¬ìŠ¤ì²´í¬ í™•ì¸ echo "Performing health checks..." sleep 30 READY_REPLICAS=$(kubectl get deployment $APP_NAME -n $NAMESPACE -o jsonpath='{.status.readyReplicas}') DESIRED_REPLICAS=$(kubectl get deployment $APP_NAME -n $NAMESPACE -o jsonpath='{.spec.replicas}') if [ "$READY_REPLICAS" = "$DESIRED_REPLICAS" ]; then echo "Health check passed: $READY_REPLICAS/$DESIRED_REPLICAS pods ready" else echo "Health check failed: $READY_REPLICAS/$DESIRED_REPLICAS pods ready" exit 1 fi # 8. íŠ¸ë˜í”½ ë³µì› echo "Restoring traffic..." kubectl patch service $APP_NAME -n $NAMESPACE -p '{"spec":{"selector":{"app":"'$APP_NAME'"}}}' echo "=== Recreate Deployment Completed Successfully ===" 3-2-2 ë¡¤ë§ ì—…ë°ì´íŠ¸ | Rolling Update ë¡¤ë§ ì—…ë°ì´íŠ¸ëŠ” ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ì—†ì´ ì ì§„ì ìœ¼ë¡œ ìƒˆ ë²„ì „ì„ ë°°í¬í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ğŸ”„ ë¡¤ë§ ì—…ë°ì´íŠ¸ ì›ë¦¬ # rolling-update-deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: myapp-rolling spec: replicas: 6 strategy: type: RollingUpdate rollingUpdate: maxUnavailable: 1 # ìµœëŒ€ 1ê°œ íŒŒë“œ ì¤‘ë‹¨ í—ˆìš© maxSurge: 2 # ìµœëŒ€ 2ê°œ ì¶”ê°€ íŒŒë“œ ìƒì„± í—ˆìš© selector: matchLabels: app: myapp template: metadata: labels: app: myapp spec: containers: - name: myapp image: myapp:v2.1.0 ports: - containerPort: 8080 # ì ì§„ì  ì¢…ë£Œë¥¼ ìœ„í•œ ì„¤ì • lifecycle: preStop: exec: command: ["/bin/sh", "-c", "sleep 15"] # ë¹ ë¥¸ ì‹œì‘ì„ ìœ„í•œ í—¬ìŠ¤ì²´í¬ readinessProbe: httpGet: path: /ready port: 8080 initialDelaySeconds: 10 periodSeconds: 2 timeoutSeconds: 1 successThreshold: 1 failureThreshold: 3 livenessProbe: httpGet: path: /health port: 8080 initialDelaySeconds: 30 periodSeconds: 10 ê³ ê¸‰ ë¡¤ë§ ì—…ë°ì´íŠ¸ ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # advanced-rolling-update.sh set -e APP_NAME="myapp" NEW_VERSION="$1" NAMESPACE="production" MAX_ROLLBACK_REVISION=5 # ì»¬ëŸ¬ ì¶œë ¥ì„ ìœ„í•œ í•¨ìˆ˜ RED='\033[0;31m' GREEN='\033[0;32m' YELLOW='\033[1;33m' NC='\033[0m' # No Color log() { echo -e "${GREEN}[$(date +'%Y-%m-%d %H:%M:%S')]${NC} $1" } warn() { echo -e "${YELLOW}[WARNING]${NC} $1" } error() { echo -e "${RED}[ERROR]${NC} $1" } # ì‚¬ì „ ì ê²€ pre_deployment_checks() { log "Performing pre-deployment checks..." # 1. ìƒˆ ì´ë¯¸ì§€ ì¡´ì¬ í™•ì¸ if ! docker pull $APP_NAME:$NEW_VERSION &gt; /dev/null 2&gt;&amp;1; then error "Image $APP_NAME:$NEW_VERSION not found" exit 1 fi # 2. í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸ if ! kubectl cluster-info &gt; /dev/null 2&gt;&amp;1; then error "Cannot connect to Kubernetes cluster" exit 1 fi # 3. ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì¡´ì¬ í™•ì¸ if ! kubectl get namespace $NAMESPACE &gt; /dev/null 2&gt;&amp;1; then error "Namespace $NAMESPACE does not exist" exit 1 fi # 4. í˜„ì¬ ë°°í¬ ìƒíƒœ í™•ì¸ CURRENT_REPLICAS=$(kubectl get deployment $APP_NAME -n $NAMESPACE -o jsonpath='{.status.readyReplicas}' 2&gt;/dev/null || echo "0") DESIRED_REPLICAS=$(kubectl get deployment $APP_NAME -n $NAMESPACE -o jsonpath='{.spec.replicas}' 2&gt;/dev/null || echo "0") if [ "$CURRENT_REPLICAS" != "$DESIRED_REPLICAS" ]; then warn "Current deployment is not healthy: $CURRENT_REPLICAS/$DESIRED_REPLICAS pods ready" read -p "Continue anyway? (y/N): " -n 1 -r echo if [[ ! $REPLY =~ ^[Yy]$ ]]; then exit 1 fi fi log "Pre-deployment checks completed successfully" } # ë°°í¬ ì‹¤í–‰ perform_rolling_update() { log "Starting rolling update to version $NEW_VERSION" # í˜„ì¬ ì´ë¯¸ì§€ íƒœê·¸ ì €ì¥ (ë¡¤ë°±ìš©) CURRENT_IMAGE=$(kubectl get deployment $APP_NAME -n $NAMESPACE -o jsonpath='{.spec.template.spec.containers[0].image}') # ë°°í¬ íˆìŠ¤í† ë¦¬ ê¸°ë¡ kubectl annotate deployment $APP_NAME -n $NAMESPACE \ deployment.kubernetes.io/revision-history="Previous: $CURRENT_IMAGE, New: $APP_NAME:$NEW_VERSION, Time: $(date)" # ìƒˆ ë²„ì „ ë°°í¬ kubectl set image deployment/$APP_NAME -n $NAMESPACE $APP_NAME=$APP_NAME:$NEW_VERSION # ë°°í¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§ log "Monitoring rollout progress..." # íƒ€ì„ì•„ì›ƒê³¼ í•¨ê»˜ ë¡¤ì•„ì›ƒ ìƒíƒœ í™•ì¸ if timeout 600 kubectl rollout status deployment/$APP_NAME -n $NAMESPACE; then log "Rolling update completed successfully" else error "Rolling update timed out" return 1 fi } # ë°°í¬ í›„ ê²€ì¦ post_deployment_validation() { log "Performing post-deployment validation..." # 1. íŒŒë“œ ìƒíƒœ í™•ì¸ sleep 30 READY_REPLICAS=$(kubectl get deployment $APP_NAME -n $NAMESPACE -o jsonpath='{.status.readyReplicas}') DESIRED_REPLICAS=$(kubectl get deployment $APP_NAME -n $NAMESPACE -o jsonpath='{.spec.replicas}') if [ "$READY_REPLICAS" != "$DESIRED_REPLICAS" ]; then error "Pod readiness check failed: $READY_REPLICAS/$DESIRED_REPLICAS" return 1 fi # 2. ì• í”Œë¦¬ì¼€ì´ì…˜ í—¬ìŠ¤ì²´í¬ SERVICE_IP=$(kubectl get service $APP_NAME -n $NAMESPACE -o jsonpath='{.spec.clusterIP}') for i in {1..10}; do if curl -f -s http://$SERVICE_IP:8080/health &gt; /dev/null; then log "Application health check passed" break else warn "Health check attempt $i failed, retrying..." sleep 5 fi if [ $i -eq 10 ]; then error "Application health check failed after 10 attempts" return 1 fi done # 3. ë©”ëª¨ë¦¬ ë° CPU ì‚¬ìš©ë¥  í™•ì¸ log "Checking resource usage..." kubectl top pods -n $NAMESPACE -l app=$APP_NAME log "Post-deployment validation completed successfully" } # ë¡¤ë°± í•¨ìˆ˜ rollback_deployment() { local rollback_reason="$1" error "Rolling back deployment due to: $rollback_reason" kubectl rollout undo deployment/$APP_NAME -n $NAMESPACE log "Waiting for rollback to complete..." kubectl rollout status deployment/$APP_NAME -n $NAMESPACE --timeout=300s error "Rollback completed" } # ë©”ì¸ ì‹¤í–‰ ë¡œì§ main() { if [ -z "$NEW_VERSION" ]; then echo "Usage: $0 &lt;new-version&gt;" exit 1 fi log "=== Rolling Update Started ===" log "App: $APP_NAME" log "New Version: $NEW_VERSION" log "Namespace: $NAMESPACE" # ë‹¨ê³„ë³„ ì‹¤í–‰ if ! pre_deployment_checks; then error "Pre-deployment checks failed" exit 1 fi if ! perform_rolling_update; then rollback_deployment "Rolling update failed" exit 1 fi if ! post_deployment_validation; then rollback_deployment "Post-deployment validation failed" exit 1 fi log "=== Rolling Update Completed Successfully ===" } main "$@" 3-2-3 ë¸”ë£¨ê·¸ë¦° ë°°í¬ | Blue-Green Deployment ë¸”ë£¨ê·¸ë¦° ë°°í¬ëŠ” ë‘ ê°œì˜ ë™ì¼í•œ í™˜ê²½ì„ ìš´ì˜í•˜ì—¬ ë¬´ì¤‘ë‹¨ ë°°í¬ì™€ ì¦‰ì‹œ ë¡¤ë°±ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ì „ëµì…ë‹ˆë‹¤. ğŸ”µğŸŸ¢ ë¸”ë£¨ê·¸ë¦° ë°°í¬ ê°œë… # ë¸”ë£¨ê·¸ë¦° ë°°í¬ í™˜ê²½ êµ¬ì„± Production Traffic â†’ Load Balancer â†’ Blue Environment (í˜„ì¬ ë²„ì „) â†’ Green Environment (ìƒˆ ë²„ì „, ëŒ€ê¸°) # ë°°í¬ ê³¼ì • 1. Green í™˜ê²½ì— ìƒˆ ë²„ì „ ë°°í¬ 2. Green í™˜ê²½ í…ŒìŠ¤íŠ¸ ë° ê²€ì¦ 3. ë¡œë“œë°¸ëŸ°ì„œ íŠ¸ë˜í”½ì„ Blue â†’ Greenìœ¼ë¡œ ì „í™˜ 4. Blue í™˜ê²½ì„ ìƒˆë¡œìš´ Greenìœ¼ë¡œ ì¤€ë¹„ Kubernetes ë¸”ë£¨ê·¸ë¦° ë°°í¬ # blue-green-service.yaml - íŠ¸ë˜í”½ ë¼ìš°íŒ… ì„œë¹„ìŠ¤ apiVersion: v1 kind: Service metadata: name: myapp-service namespace: production spec: selector: app: myapp version: blue # blue ë˜ëŠ” greenìœ¼ë¡œ ì „í™˜ ports: - name: http port: 80 targetPort: 8080 protocol: TCP type: LoadBalancer --- # blue-deployment.yaml - Blue í™˜ê²½ apiVersion: apps/v1 kind: Deployment metadata: name: myapp-blue namespace: production labels: app: myapp version: blue spec: replicas: 3 selector: matchLabels: app: myapp version: blue template: metadata: labels: app: myapp version: blue spec: containers: - name: myapp image: myapp:v1.0.0 ports: - containerPort: 8080 resources: requests: memory: "256Mi" cpu: "250m" limits: memory: "512Mi" cpu: "500m" --- # green-deployment.yaml - Green í™˜ê²½ apiVersion: apps/v1 kind: Deployment metadata: name: myapp-green namespace: production labels: app: myapp version: green spec: replicas: 3 selector: matchLabels: app: myapp version: green template: metadata: labels: app: myapp version: green spec: containers: - name: myapp image: myapp:v2.0.0 # ìƒˆ ë²„ì „ ports: - containerPort: 8080 resources: requests: memory: "256Mi" cpu: "250m" limits: memory: "512Mi" cpu: "500m" 3-2-4 ì¹´ë‚˜ë¦¬ ë°°í¬ | Canary Deployment ì¹´ë‚˜ë¦¬ ë°°í¬ëŠ” ìƒˆ ë²„ì „ì„ ì¼ë¶€ íŠ¸ë˜í”½ì—ë§Œ ì ì§„ì ìœ¼ë¡œ ë…¸ì¶œí•˜ì—¬ ë¦¬ìŠ¤í¬ë¥¼ ìµœì†Œí™”í•˜ëŠ” ë°°í¬ ì „ëµì…ë‹ˆë‹¤. ğŸ¤ ì¹´ë‚˜ë¦¬ ë°°í¬ êµ¬í˜„ # canary-istio.yaml - Istioë¥¼ ì´ìš©í•œ ì¹´ë‚˜ë¦¬ ë°°í¬ apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: myapp-canary namespace: production spec: hosts: - myapp.company.com http: - match: - headers: canary: exact: "true" route: - destination: host: myapp-service subset: v2 weight: 100 - route: - destination: host: myapp-service subset: v1 weight: 90 # 90% ê¸°ì¡´ ë²„ì „ - destination: host: myapp-service subset: v2 weight: 10 # 10% ìƒˆ ë²„ì „ --- apiVersion: networking.istio.io/v1alpha3 kind: DestinationRule metadata: name: myapp-destination namespace: production spec: host: myapp-service subsets: - name: v1 labels: version: v1.0.0 - name: v2 labels: version: v2.0.0 ì ì§„ì  ì¹´ë‚˜ë¦¬ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # progressive-canary.sh set -e APP_NAME="myapp" NEW_VERSION="$1" NAMESPACE="production" # íŠ¸ë˜í”½ ë¶„ë°° ë‹¨ê³„ (%) CANARY_STAGES=(5 10 25 50 75 100) log() { echo "[$(date +'%Y-%m-%d %H:%M:%S')] $1" } # ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í•¨ìˆ˜ collect_metrics() { local version=$1 local duration=$2 log "Collecting metrics for version $version over $duration seconds" # Prometheus ë©”íŠ¸ë¦­ ì¿¼ë¦¬ local error_rate=$(curl -s "http://prometheus:9090/api/v1/query" \ --data-urlencode "query=rate(http_requests_total{version=\"$version\",status=~\"5..\"}[${duration}s]) / rate(http_requests_total{version=\"$version\"}[${duration}s]) * 100") local response_time=$(curl -s "http://prometheus:9090/api/v1/query" \ --data-urlencode "query=histogram_quantile(0.95, rate(http_request_duration_seconds_bucket{version=\"$version\"}[${duration}s]))") local cpu_usage=$(curl -s "http://prometheus:9090/api/v1/query" \ --data-urlencode "query=avg(rate(container_cpu_usage_seconds_total{pod=~\"$APP_NAME-.*\",container=\"$APP_NAME\"}[${duration}s])) by (version)") # JSON íŒŒì‹± (jq í•„ìš”) local error_rate_value=$(echo $error_rate | jq -r '.data.result[0].value[1] // "0"') local response_time_value=$(echo $response_time | jq -r '.data.result[0].value[1] // "0"') local cpu_usage_value=$(echo $cpu_usage | jq -r '.data.result[0].value[1] // "0"') echo "$error_rate_value,$response_time_value,$cpu_usage_value" } # SLI/SLO ì²´í¬ check_slo() { local metrics=$1 local version=$2 IFS=',' read -r error_rate response_time cpu_usage &lt;&lt;&lt; "$metrics" log "SLO Check for $version - Error Rate: $error_rate%, Response Time: ${response_time}s, CPU: $cpu_usage" # SLO ì„ê³„ê°’ local max_error_rate=1.0 local max_response_time=0.5 local max_cpu_usage=0.8 if (( $(echo "$error_rate &gt; $max_error_rate" | bc -l) )); then log "âŒ Error rate SLO violated: $error_rate% &gt; $max_error_rate%" return 1 fi if (( $(echo "$response_time &gt; $max_response_time" | bc -l) )); then log "âŒ Response time SLO violated: ${response_time}s &gt; ${max_response_time}s" return 1 fi if (( $(echo "$cpu_usage &gt; $max_cpu_usage" | bc -l) )); then log "âŒ CPU usage SLO violated: $cpu_usage &gt; $max_cpu_usage" return 1 fi log "âœ… All SLOs passed for version $version" return 0 } # íŠ¸ë˜í”½ ê°€ì¤‘ì¹˜ ì—…ë°ì´íŠ¸ update_traffic_weight() { local canary_weight=$1 local stable_weight=$((100 - canary_weight)) log "Updating traffic weights - Stable: $stable_weight%, Canary: $canary_weight%" kubectl patch virtualservice $APP_NAME-canary -n $NAMESPACE --type='json' -p="[ {\"op\": \"replace\", \"path\": \"/spec/http/1/route/0/weight\", \"value\": $stable_weight}, {\"op\": \"replace\", \"path\": \"/spec/http/1/route/1/weight\", \"value\": $canary_weight} ]" } # ì¹´ë‚˜ë¦¬ ë°°í¬ ì‹¤í–‰ perform_canary_deployment() { log "Starting canary deployment for version $NEW_VERSION" # 1. ì¹´ë‚˜ë¦¬ ë²„ì „ ë°°í¬ (0% íŠ¸ë˜í”½) kubectl set image deployment/$APP_NAME-canary -n $NAMESPACE $APP_NAME=$APP_NAME:$NEW_VERSION kubectl rollout status deployment/$APP_NAME-canary -n $NAMESPACE --timeout=300s # 2. ë‹¨ê³„ë³„ íŠ¸ë˜í”½ ì¦ê°€ for stage in "${CANARY_STAGES[@]}"; do log "=== Canary Stage: $stage% traffic ===" # íŠ¸ë˜í”½ ê°€ì¤‘ì¹˜ ì—…ë°ì´íŠ¸ update_traffic_weight $stage # ì•ˆì •í™” ëŒ€ê¸° log "Waiting for traffic stabilization..." sleep 60 # ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ë¶„ì„ (5ë¶„ê°„) local canary_metrics=$(collect_metrics "v$NEW_VERSION" 300) local stable_metrics=$(collect_metrics "v$(get_current_version)" 300) # SLO ì²´í¬ if ! check_slo "$canary_metrics" "canary"; then log "âŒ Canary version failed SLO check, rolling back..." rollback_canary return 1 fi # ë¹„êµ ë¶„ì„ log "Comparing canary vs stable metrics..." if ! compare_versions "$canary_metrics" "$stable_metrics"; then log "âŒ Canary version performance degraded, rolling back..." rollback_canary return 1 fi log "âœ… Stage $stage% completed successfully" # ë§ˆì§€ë§‰ ë‹¨ê³„ê°€ ì•„ë‹ˆë©´ ëŒ€ê¸° if [ "$stage" != "100" ]; then log "Waiting before next stage..." sleep 300 # 5ë¶„ ëŒ€ê¸° fi done log "ğŸ‰ Canary deployment completed successfully" } # ë¡¤ë°± í•¨ìˆ˜ rollback_canary() { log "Rolling back canary deployment..." update_traffic_weight 0 log "Traffic rolled back to stable version" } main() { if [ -z "$NEW_VERSION" ]; then echo "Usage: $0 &lt;new-version&gt;" exit 1 fi log "=== Progressive Canary Deployment Started ===" log "App: $APP_NAME, New Version: $NEW_VERSION" if ! perform_canary_deployment; then log "âŒ Canary deployment failed" exit 1 fi log "=== Canary Deployment Completed Successfully ===" } main "$@" ì‹¤ìŠµ: AWS EC2 ê¸°ë°˜ì˜ ë¸”ë£¨ê·¸ë¦° ë°°í¬ ğŸ—ï¸ AWS ì¸í”„ë¼ êµ¬ì„± # 1. VPC ë° ì„œë¸Œë„· ìƒì„± aws ec2 create-vpc --cidr-block 10.0.0.0/16 --tag-specifications 'ResourceType=vpc,Tags=[{Key=Name,Value=BlueGreen-VPC}]' VPC_ID=$(aws ec2 describe-vpcs --filters "Name=tag:Name,Values=BlueGreen-VPC" --query 'Vpcs[0].VpcId' --output text) # í¼ë¸”ë¦­ ì„œë¸Œë„· ìƒì„± (2ê°œ AZ) aws ec2 create-subnet --vpc-id $VPC_ID --cidr-block 10.0.1.0/24 --availability-zone us-west-2a --tag-specifications 'ResourceType=subnet,Tags=[{Key=Name,Value=Public-Subnet-1}]' aws ec2 create-subnet --vpc-id $VPC_ID --cidr-block 10.0.2.0/24 --availability-zone us-west-2b --tag-specifications 'ResourceType=subnet,Tags=[{Key=Name,Value=Public-Subnet-2}]' # í”„ë¼ì´ë¹— ì„œë¸Œë„· ìƒì„± (2ê°œ AZ) aws ec2 create-subnet --vpc-id $VPC_ID --cidr-block 10.0.11.0/24 --availability-zone us-west-2a --tag-specifications 'ResourceType=subnet,Tags=[{Key=Name,Value=Private-Subnet-1}]' aws ec2 create-subnet --vpc-id $VPC_ID --cidr-block 10.0.12.0/24 --availability-zone us-west-2b --tag-specifications 'ResourceType=subnet,Tags=[{Key=Name,Value=Private-Subnet-2}]' # ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ ìƒì„± ë° ì—°ê²° aws ec2 create-internet-gateway --tag-specifications 'ResourceType=internet-gateway,Tags=[{Key=Name,Value=BlueGreen-IGW}]' IGW_ID=$(aws ec2 describe-internet-gateways --filters "Name=tag:Name,Values=BlueGreen-IGW" --query 'InternetGateways[0].InternetGatewayId' --output text) aws ec2 attach-internet-gateway --vpc-id $VPC_ID --internet-gateway-id $IGW_ID Application Load Balancer êµ¬ì„± { "LoadBalancerName": "myapp-bluegreen-alb", "Scheme": "internet-facing", "Type": "application", "IpAddressType": "ipv4", "Subnets": [ "subnet-12345678", "subnet-87654321" ], "SecurityGroups": [ "sg-12345678" ], "Tags": [ { "Key": "Name", "Value": "MyApp-BlueGreen-ALB" }, { "Key": "Environment", "Value": "Production" } ] } ë¸”ë£¨ê·¸ë¦° ë°°í¬ ìë™í™” ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # aws-bluegreen-deploy.sh set -e # ì„¤ì • ë³€ìˆ˜ APP_NAME="myapp" NEW_VERSION="$1" AWS_REGION="us-west-2" VPC_ID="vpc-12345678" ALB_ARN="arn:aws:elasticloadbalancing:us-west-2:123456789012:loadbalancer/app/myapp-alb/1234567890123456" BLUE_TG_ARN="arn:aws:elasticloadbalancing:us-west-2:123456789012:targetgroup/myapp-blue/1234567890123456" GREEN_TG_ARN="arn:aws:elasticloadbalancing:us-west-2:123456789012:targetgroup/myapp-green/1234567890123456" LISTENER_ARN="arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/app/myapp-alb/1234567890123456/1234567890123456" # í˜„ì¬ í™œì„± í™˜ê²½ í™•ì¸ get_active_environment() { local listener_rules=$(aws elbv2 describe-rules --listener-arn $LISTENER_ARN --region $AWS_REGION) local active_target_group=$(echo $listener_rules | jq -r '.Rules[] | select(.Priority == "100") | .Actions[0].TargetGroupArn') if [[ "$active_target_group" == "$BLUE_TG_ARN" ]]; then echo "blue" else echo "green" fi } # Auto Scaling Groupì— ìƒˆ Launch Template ì ìš© update_asg_launch_template() { local environment=$1 local new_ami=$2 local asg_name="${APP_NAME}-${environment}-asg" local lt_name="${APP_NAME}-${environment}-lt" # ìƒˆ Launch Template ë²„ì „ ìƒì„± aws ec2 create-launch-template-version \ --launch-template-name $lt_name \ --source-version '$Latest' \ --launch-template-data "{\"ImageId\":\"$new_ami\"}" \ --region $AWS_REGION # ASGì— ìƒˆ Launch Template ë²„ì „ ì ìš© local latest_version=$(aws ec2 describe-launch-template-versions \ --launch-template-name $lt_name \ --region $AWS_REGION \ --query 'LaunchTemplateVersions[0].VersionNumber' \ --output text) aws autoscaling update-auto-scaling-group \ --auto-scaling-group-name $asg_name \ --launch-template LaunchTemplateName=$lt_name,Version=$latest_version \ --region $AWS_REGION log "Updated ASG $asg_name with Launch Template version $latest_version" } # ì¸ìŠ¤í„´ìŠ¤ êµì²´ (Rolling Replacement) perform_instance_refresh() { local environment=$1 local asg_name="${APP_NAME}-${environment}-asg" log "Starting instance refresh for $asg_name" local refresh_id=$(aws autoscaling start-instance-refresh \ --auto-scaling-group-name $asg_name \ --preferences '{ "InstanceWarmup": 300, "MinHealthyPercentage": 50, "CheckpointPercentages": [20, 50, 100], "CheckpointDelay": 600 }' \ --region $AWS_REGION \ --query 'InstanceRefreshId' \ --output text) log "Instance refresh started with ID: $refresh_id" # ì¸ìŠ¤í„´ìŠ¤ êµì²´ ì™„ë£Œ ëŒ€ê¸° while true; do local status=$(aws autoscaling describe-instance-refreshes \ --auto-scaling-group-name $asg_name \ --instance-refresh-ids $refresh_id \ --region $AWS_REGION \ --query 'InstanceRefreshes[0].Status' \ --output text) log "Instance refresh status: $status" case $status in "Successful") log "âœ… Instance refresh completed successfully" break ;; "Failed"|"Cancelled") error "âŒ Instance refresh failed with status: $status" return 1 ;; "InProgress"|"Pending") log "Instance refresh in progress, waiting..." sleep 60 ;; esac done } # í—¬ìŠ¤ì²´í¬ ìˆ˜í–‰ health_check_environment() { local environment=$1 local target_group_arn if [ "$environment" = "blue" ]; then target_group_arn=$BLUE_TG_ARN else target_group_arn=$GREEN_TG_ARN fi log "Performing health check for $environment environment" local max_attempts=30 local attempt=1 while [ $attempt -le $max_attempts ]; do local healthy_targets=$(aws elbv2 describe-target-health \ --target-group-arn $target_group_arn \ --region $AWS_REGION \ --query 'TargetHealthDescriptions[?TargetHealth.State==`healthy`] | length(@)') local total_targets=$(aws elbv2 describe-target-health \ --target-group-arn $target_group_arn \ --region $AWS_REGION \ --query 'TargetHealthDescriptions | length(@)') log "Health check attempt $attempt: $healthy_targets/$total_targets targets healthy" if [ "$healthy_targets" -gt 0 ] &amp;&amp; [ "$healthy_targets" -eq "$total_targets" ]; then log "âœ… All targets are healthy in $environment environment" return 0 fi sleep 30 ((attempt++)) done error "âŒ Health check failed for $environment environment after $max_attempts attempts" return 1 } # íŠ¸ë˜í”½ ì „í™˜ switch_traffic() { local target_environment=$1 local target_group_arn if [ "$target_environment" = "blue" ]; then target_group_arn=$BLUE_TG_ARN else target_group_arn=$GREEN_TG_ARN fi log "Switching traffic to $target_environment environment" aws elbv2 modify-rule \ --rule-arn $(aws elbv2 describe-rules --listener-arn $LISTENER_ARN --region $AWS_REGION --query 'Rules[?Priority==`100`].RuleArn' --output text) \ --actions Type=forward,TargetGroupArn=$target_group_arn \ --region $AWS_REGION log "âœ… Traffic switched to $target_environment environment" } # ë°°í¬ ê²€ì¦ validate_deployment() { local environment=$1 log "Validating deployment in $environment environment" # ALB DNS ì´ë¦„ ê°€ì ¸ì˜¤ê¸° local alb_dns=$(aws elbv2 describe-load-balancers \ --load-balancer-arns $ALB_ARN \ --region $AWS_REGION \ --query 'LoadBalancers[0].DNSName' \ --output text) # ì• í”Œë¦¬ì¼€ì´ì…˜ ë²„ì „ í™•ì¸ local app_version=$(curl -s -f http://$alb_dns/version 2&gt;/dev/null || echo "unknown") if [ "$app_version" = "$NEW_VERSION" ]; then log "âœ… Application version validated: $app_version" else error "âŒ Version mismatch. Expected: $NEW_VERSION, Got: $app_version" return 1 fi # ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ local health_status=$(curl -s -o /dev/null -w "%{http_code}" http://$alb_dns/health) if [ "$health_status" = "200" ]; then log "âœ… Application health check passed" else error "âŒ Application health check failed. Status code: $health_status" return 1 fi log "âœ… Deployment validation completed successfully" } # ë¡¤ë°± ìˆ˜í–‰ rollback_deployment() { local current_environment=$(get_active_environment) local rollback_environment if [ "$current_environment" = "blue" ]; then rollback_environment="green" else rollback_environment="blue" fi log "Rolling back from $current_environment to $rollback_environment" switch_traffic $rollback_environment log "âœ… Rollback completed" } # ë©”ì¸ ë°°í¬ ë¡œì§ main() { if [ -z "$NEW_VERSION" ]; then echo "Usage: $0 &lt;new-version&gt;" exit 1 fi log "=== AWS EC2 Blue-Green Deployment Started ===" log "Application: $APP_NAME" log "New Version: $NEW_VERSION" log "Region: $AWS_REGION" # 1. í˜„ì¬ í™œì„± í™˜ê²½ í™•ì¸ local active_env=$(get_active_environment) local inactive_env if [ "$active_env" = "blue" ]; then inactive_env="green" else inactive_env="blue" fi log "Current active environment: $active_env" log "Deploying to inactive environment: $inactive_env" # 2. ìƒˆ AMI ID ê°€ì ¸ì˜¤ê¸° (ì´ë¯¸ ë¹Œë“œëœ AMI ì‚¬ìš©) local new_ami=$(aws ec2 describe-images \ --filters "Name=tag:Version,Values=$NEW_VERSION" "Name=tag:Application,Values=$APP_NAME" \ --region $AWS_REGION \ --query 'Images[0].ImageId' \ --output text) if [ "$new_ami" = "None" ] || [ -z "$new_ami" ]; then error "âŒ AMI for version $NEW_VERSION not found" exit 1 fi log "Using AMI: $new_ami for version $NEW_VERSION" # 3. ë¹„í™œì„± í™˜ê²½ì— ìƒˆ ë²„ì „ ë°°í¬ if ! update_asg_launch_template $inactive_env $new_ami; then error "âŒ Failed to update launch template" exit 1 fi if ! perform_instance_refresh $inactive_env; then error "âŒ Failed to refresh instances" exit 1 fi # 4. ë¹„í™œì„± í™˜ê²½ í—¬ìŠ¤ì²´í¬ if ! health_check_environment $inactive_env; then error "âŒ Health check failed for $inactive_env environment" exit 1 fi # 5. íŠ¸ë˜í”½ ì „í™˜ if ! switch_traffic $inactive_env; then error "âŒ Failed to switch traffic" rollback_deployment exit 1 fi # 6. ë°°í¬ ê²€ì¦ sleep 60 # íŠ¸ë˜í”½ ì•ˆì •í™” ëŒ€ê¸° if ! validate_deployment $inactive_env; then error "âŒ Deployment validation failed" rollback_deployment exit 1 fi log "ğŸ‰ Blue-Green deployment completed successfully!" log "New active environment: $inactive_env" log "Previous environment ($active_env) is now inactive and ready for next deployment" } # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ log() { echo "[$(date +'%Y-%m-%d %H:%M:%S')] $1" } error() { echo "[$(date +'%Y-%m-%d %H:%M:%S')] ERROR: $1" &gt;&amp;2 } # ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ main "$@" ì •ë¦¬ ë° ëª¨ë²” ì‚¬ë¡€ ğŸ“Š ë°°í¬ ì „ëµ ì„ íƒ ê°€ì´ë“œ # ë°°í¬ ì „ëµ ì„ íƒ ë§¤íŠ¸ë¦­ìŠ¤ ìƒí™© | ê¶Œì¥ ì „ëµ | ì´ìœ  ====================|===============|============================== ê°œë°œ/í…ŒìŠ¤íŠ¸ í™˜ê²½ | Recreate | ë‹¨ìˆœí•¨, ë¦¬ì†ŒìŠ¤ ì ˆì•½ ìŠ¤í…Œì´ì§€ í™˜ê²½ | Rolling | í”„ë¡œë•ì…˜ê³¼ ìœ ì‚¬í•œ í™˜ê²½ í”„ë¡œë•ì…˜ (ìœ„í—˜ ë†’ìŒ) | Blue-Green | ì¦‰ì‹œ ë¡¤ë°±, ì™„ì „í•œ ê²€ì¦ í”„ë¡œë•ì…˜ (ìœ„í—˜ ë³´í†µ) | Canary | ì ì§„ì  ê²€ì¦, ë¦¬ìŠ¤í¬ ë¶„ì‚° í”„ë¡œë•ì…˜ (ìœ„í—˜ ë‚®ìŒ) | Rolling | íš¨ìœ¨ì , ë¦¬ì†ŒìŠ¤ ìµœì í™” ë ˆê±°ì‹œ ì‹œìŠ¤í…œ | Blue-Green | ì•ˆì „ì„± ìš°ì„  ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ | Canary | ì„œë¹„ìŠ¤ë³„ ë…ë¦½ ë°°í¬ ğŸ”§ ëª¨ë²” ì‚¬ë¡€ 1. ë°°í¬ ì¤€ë¹„ # ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸ âœ… ë°±ì—… ì™„ë£Œ âœ… ë¡¤ë°± ê³„íš ìˆ˜ë¦½ âœ… ëª¨ë‹ˆí„°ë§ ì¤€ë¹„ âœ… íŒ€ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ âœ… í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„ âœ… ì„¤ì • ê²€ì¦ 2. ëª¨ë‹ˆí„°ë§ ë° ì•ŒëŒ # í•µì‹¬ ë©”íŠ¸ë¦­ - ì—ëŸ¬ìœ¨ (&lt; 1%) - ì‘ë‹µ ì‹œê°„ (&lt; 500ms) - ì²˜ë¦¬ëŸ‰ (baseline ëŒ€ë¹„) - ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ë¥  (&lt; 80%) - ê°€ìš©ì„± (&gt; 99.9%) 3. ìë™í™” ì›ì¹™ # ëª¨ë“  ê²ƒì„ ìë™í™” 1. ë¹Œë“œ í”„ë¡œì„¸ìŠ¤ 2. í…ŒìŠ¤íŠ¸ ì‹¤í–‰ 3. ë°°í¬ í”„ë¡œì„¸ìŠ¤ 4. í—¬ìŠ¤ì²´í¬ 5. ë¡¤ë°± ì ˆì°¨ 6. ì•Œë¦¼ ë° ë¡œê¹… í˜„ëŒ€ì ì¸ ë°°í¬ ì „ëµì„ ë§ˆìŠ¤í„°í•˜ì…¨ë‚˜ìš”? ì•ˆì •ì ì´ê³  íš¨ìœ¨ì ì¸ ë°°í¬ë¡œ ì„œë¹„ìŠ¤ í’ˆì§ˆì„ í•œ ë‹¨ê³„ ë†’ì—¬ë³´ì„¸ìš”! ğŸš€]]></summary></entry><entry><title type="html">ë„¤íŠ¸ì›Œí‚¹ ì™„ì „ ê°€ì´ë“œ 3í¸ - ë¼ìš°íŒ…ê³¼ ìŠ¤ìœ„ì¹­ ì‹¬í™” | Complete Network Guide Part 3 - Advanced Routing &amp;amp; Switching</title><link href="https://leeyonghe.github.io/infra-blog/blog/2024/11/03/networking-guide-part3.html" rel="alternate" type="text/html" title="ë„¤íŠ¸ì›Œí‚¹ ì™„ì „ ê°€ì´ë“œ 3í¸ - ë¼ìš°íŒ…ê³¼ ìŠ¤ìœ„ì¹­ ì‹¬í™” | Complete Network Guide Part 3 - Advanced Routing &amp;amp; Switching" /><published>2024-11-03T02:00:00+00:00</published><updated>2024-11-03T02:00:00+00:00</updated><id>https://leeyonghe.github.io/infra-blog/blog/2024/11/03/networking-guide-part3</id><content type="html" xml:base="https://leeyonghe.github.io/infra-blog/blog/2024/11/03/networking-guide-part3.html"><![CDATA[<p>ë„¤íŠ¸ì›Œí¬ì˜ í•µì‹¬ì¸ ë¼ìš°íŒ…ê³¼ ìŠ¤ìœ„ì¹­ ê¸°ìˆ ì„ ì‹¬í™” í•™ìŠµí•˜ì—¬ ëŒ€ê·œëª¨ ë„¤íŠ¸ì›Œí¬ ìš´ì˜ ëŠ¥ë ¥ì„ ê°–ì¶°ë³´ê² ìŠµë‹ˆë‹¤.</p>

<h2 id="ë¼ìš°íŒ…-í”„ë¡œí† ì½œ--routing-protocols">ë¼ìš°íŒ… í”„ë¡œí† ì½œ | Routing Protocols</h2>

<h3 id="ï¸-ë¼ìš°íŒ…-ê¸°ë³¸-ê°œë…">ğŸ—ºï¸ ë¼ìš°íŒ… ê¸°ë³¸ ê°œë…</h3>

<p>ë¼ìš°íŒ…ì€ íŒ¨í‚·ì´ ëª©ì ì§€ê¹Œì§€ ê°€ëŠ” ìµœì ì˜ ê²½ë¡œë¥¼ ì°¾ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë¼ìš°íŒ… í…Œì´ë¸” êµ¬ì„± ìš”ì†Œ</span>
ëª©ì ì§€ ë„¤íŠ¸ì›Œí¬ | ì„œë¸Œë„· ë§ˆìŠ¤í¬ | ê²Œì´íŠ¸ì›¨ì´ | ì¸í„°í˜ì´ìŠ¤ | ë©”íŠ¸ë¦­
192.168.1.0    | /24          | ì§ì ‘ì—°ê²°    | eth0      | 0
10.0.0.0       | /8           | 192.168.1.1| eth0      | 1
0.0.0.0        | /0           | 192.168.1.1| eth0      | 1 <span class="o">(</span>ê¸°ë³¸ê²½ë¡œ<span class="o">)</span>
</code></pre></div></div>

<h3 id="-ë¼ìš°íŒ…-í”„ë¡œí† ì½œ-ë¶„ë¥˜">ğŸ“Š ë¼ìš°íŒ… í”„ë¡œí† ì½œ ë¶„ë¥˜</h3>

<h4 id="distance-vector-vs-link-state">Distance Vector vs Link State</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Distance Vector (ê±°ë¦¬ ë²¡í„°):
- RIP (Routing Information Protocol)
- ë²¨ë§Œ-í¬ë“œ ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš©
- í™‰ ì¹´ìš´íŠ¸ ê¸°ë°˜ ë©”íŠ¸ë¦­
- ë‹¨ìˆœí•˜ì§€ë§Œ ìˆ˜ë ´ ì†ë„ ëŠë¦¼

Link State (ë§í¬ ìƒíƒœ):  
- OSPF (Open Shortest Path First)
- ë‹¤ìµìŠ¤íŠ¸ë¼ ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš©
- ëŒ€ì—­í­ ê¸°ë°˜ ë©”íŠ¸ë¦­
- ë¹ ë¥¸ ìˆ˜ë ´, í™•ì¥ì„± ì¢‹ìŒ
</code></pre></div></div>

<h4 id="igp-vs-egp">IGP vs EGP</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>IGP (Interior Gateway Protocol):
- ê°™ì€ ììœ¨ ì‹œìŠ¤í…œ(AS) ë‚´ë¶€
- RIP, OSPF, EIGRP

EGP (Exterior Gateway Protocol):
- ì„œë¡œ ë‹¤ë¥¸ AS ê°„
- BGP (Border Gateway Protocol)
</code></pre></div></div>

<h3 id="-rip-routing-information-protocol">ğŸ”„ RIP (Routing Information Protocol)</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Cisco ë¼ìš°í„° RIP ì„¤ì •</span>
Router<span class="o">(</span>config<span class="o">)</span><span class="c"># router rip</span>
Router<span class="o">(</span>config-router<span class="o">)</span><span class="c"># version 2</span>
Router<span class="o">(</span>config-router<span class="o">)</span><span class="c"># network 192.168.1.0</span>
Router<span class="o">(</span>config-router<span class="o">)</span><span class="c"># network 10.0.0.0</span>
Router<span class="o">(</span>config-router<span class="o">)</span><span class="c"># no auto-summary</span>
Router<span class="o">(</span>config-router<span class="o">)</span><span class="c"># passive-interface fastethernet 0/0</span>

<span class="c"># Linux Quagga/FRR RIP ì„¤ì •</span>
router rip
 version 2
 network 192.168.1.0/24
 network 10.0.0.0/8
 redistribute connected
 redistribute static

<span class="c"># RIP ì •ë³´ í™•ì¸</span>
show ip route rip
show ip rip database
debug ip rip
</code></pre></div></div>

<h4 id="ripì˜-íŠ¹ì§•ê³¼-í•œê³„">RIPì˜ íŠ¹ì§•ê³¼ í•œê³„</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ì¥ì :
- êµ¬ì„±ì´ ê°„ë‹¨í•¨
- ì†Œê·œëª¨ ë„¤íŠ¸ì›Œí¬ì— ì í•©
- í‘œì¤€ í”„ë¡œí† ì½œ

ë‹¨ì :
- í™‰ ì¹´ìš´íŠ¸ ì œí•œ (15í™‰)
- ëŠë¦° ìˆ˜ë ´ ì†ë„
- ëŒ€ì—­í­ ê³ ë ¤í•˜ì§€ ì•ŠìŒ
- ë£¨í”„ ë°©ì§€ ë©”ì»¤ë‹ˆì¦˜ ì œí•œì 
</code></pre></div></div>

<h3 id="-ospf-open-shortest-path-first">ğŸŒ OSPF (Open Shortest Path First)</h3>

<p>OSPFëŠ” ëŒ€ê·œëª¨ ë„¤íŠ¸ì›Œí¬ì—ì„œ ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ë§í¬ ìƒíƒœ ë¼ìš°íŒ… í”„ë¡œí† ì½œì…ë‹ˆë‹¤.</p>

<h4 id="ospf-ê¸°ë³¸-ê°œë…">OSPF ê¸°ë³¸ ê°œë…</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># OSPF ìš©ì–´</span>
Area: ë¼ìš°í„°ë“¤ì˜ ë…¼ë¦¬ì  ê·¸ë£¹
ABR <span class="o">(</span>Area Border Router<span class="o">)</span>: Area ê²½ê³„ ë¼ìš°í„°
ASBR <span class="o">(</span>Autonomous System Boundary Router<span class="o">)</span>: AS ê²½ê³„ ë¼ìš°í„°  
DR <span class="o">(</span>Designated Router<span class="o">)</span>: ëŒ€í‘œ ë¼ìš°í„°
BDR <span class="o">(</span>Backup Designated Router<span class="o">)</span>: ë°±ì—… ëŒ€í‘œ ë¼ìš°í„°

<span class="c"># LSA (Link State Advertisement) ìœ í˜•</span>
LSA Type 1: Router LSA <span class="o">(</span>ë¼ìš°í„° ì •ë³´<span class="o">)</span>
LSA Type 2: Network LSA <span class="o">(</span>ë„¤íŠ¸ì›Œí¬ ì •ë³´<span class="o">)</span>
LSA Type 3: Summary LSA <span class="o">(</span>Area ê°„ ìš”ì•½<span class="o">)</span>
LSA Type 4: ASBR Summary LSA
LSA Type 5: External LSA <span class="o">(</span>ì™¸ë¶€ ë¼ìš°íŠ¸<span class="o">)</span>
</code></pre></div></div>

<h4 id="ospf-ì„¤ì •-ì‹¤ìŠµ">OSPF ì„¤ì • ì‹¤ìŠµ</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Cisco ë¼ìš°í„° OSPF ì„¤ì •</span>
Router<span class="o">(</span>config<span class="o">)</span><span class="c"># router ospf 1</span>
Router<span class="o">(</span>config-router<span class="o">)</span><span class="c"># router-id 1.1.1.1</span>
Router<span class="o">(</span>config-router<span class="o">)</span><span class="c"># network 192.168.1.0 0.0.0.255 area 0</span>
Router<span class="o">(</span>config-router<span class="o">)</span><span class="c"># network 10.0.0.0 0.255.255.255 area 1</span>
Router<span class="o">(</span>config-router<span class="o">)</span><span class="c"># area 1 stub</span>

<span class="c"># ì¸í„°í˜ì´ìŠ¤ë³„ OSPF ì„¤ì •</span>
Router<span class="o">(</span>config<span class="o">)</span><span class="c"># interface fastethernet 0/0</span>
Router<span class="o">(</span>config-if<span class="o">)</span><span class="c"># ip ospf cost 100</span>
Router<span class="o">(</span>config-if<span class="o">)</span><span class="c"># ip ospf priority 255</span>
Router<span class="o">(</span>config-if<span class="o">)</span><span class="c"># ip ospf hello-interval 5</span>
Router<span class="o">(</span>config-if<span class="o">)</span><span class="c"># ip ospf dead-interval 20</span>

<span class="c"># Linux FRR OSPF ì„¤ì •</span>
router ospf
 ospf router-id 1.1.1.1
 network 192.168.1.0/24 area 0.0.0.0
 network 10.0.0.0/8 area 0.0.0.1
 area 0.0.0.1 stub

<span class="c"># OSPF ì •ë³´ í™•ì¸</span>
show ip ospf neighbor
show ip ospf database  
show ip ospf interface
show ip route ospf
</code></pre></div></div>

<h4 id="ospf-area-ì„¤ê³„">OSPF Area ì„¤ê³„</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Multi-Area OSPF ì„¤ê³„ ì˜ˆì‹œ</span>
Area 0 <span class="o">(</span>Backbone<span class="o">)</span>: 10.0.0.0/24
â”œâ”€â”€ Area 1 <span class="o">(</span>Sales<span class="o">)</span>: 10.1.0.0/16
â”œâ”€â”€ Area 2 <span class="o">(</span>Engineering<span class="o">)</span>: 10.2.0.0/16  
â””â”€â”€ Area 3 <span class="o">(</span>Guest<span class="o">)</span>: 10.3.0.0/16

<span class="c"># Area ìœ í˜•</span>
Standard Area: ëª¨ë“  LSA í—ˆìš©
Stub Area: Type 5 LSA ì°¨ë‹¨, ê¸°ë³¸ ê²½ë¡œ ì£¼ì…
Totally Stub: Type 3,4,5 LSA ì°¨ë‹¨
NSSA: Type 5 LSAë¥¼ Type 7ë¡œ ë³€í™˜
</code></pre></div></div>

<h3 id="-bgp-border-gateway-protocol">ğŸŒ BGP (Border Gateway Protocol)</h3>

<p>BGPëŠ” ì¸í„°ë„·ì˜ ë¼ìš°íŒ…ì„ ë‹´ë‹¹í•˜ëŠ” ê²½ë¡œ ë²¡í„° í”„ë¡œí† ì½œì…ë‹ˆë‹¤.</p>

<h4 id="bgp-ê¸°ë³¸-ê°œë…">BGP ê¸°ë³¸ ê°œë…</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># BGP ì†ì„±</span>
AS-Path: AS ë²ˆí˜¸ ê²½ë¡œ
Next-Hop: ë‹¤ìŒ í™‰ ì£¼ì†Œ  
Local Preference: ë¡œì»¬ ìš°ì„ ìˆœìœ„ <span class="o">(</span>ë†’ì„ìˆ˜ë¡ ì„ í˜¸<span class="o">)</span>
MED: Multi-Exit Discriminator <span class="o">(</span>ë‚®ì„ìˆ˜ë¡ ì„ í˜¸<span class="o">)</span>
Origin: ê²½ë¡œ ë°œìƒì§€ <span class="o">(</span>IGP <span class="o">&gt;</span> EGP <span class="o">&gt;</span> Incomplete<span class="o">)</span>
Community: ë¼ìš°íŒ… ì •ì±… íƒœê·¸
</code></pre></div></div>

<h4 id="bgp-ì„¤ì •-ì˜ˆì‹œ">BGP ì„¤ì • ì˜ˆì‹œ</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Cisco ë¼ìš°í„° BGP ì„¤ì •</span>
Router<span class="o">(</span>config<span class="o">)</span><span class="c"># router bgp 65001</span>
Router<span class="o">(</span>config-router<span class="o">)</span><span class="c"># bgp router-id 1.1.1.1</span>
Router<span class="o">(</span>config-router<span class="o">)</span><span class="c"># neighbor 203.0.113.1 remote-as 65002</span>
Router<span class="o">(</span>config-router<span class="o">)</span><span class="c"># neighbor 203.0.113.1 description "ISP-A Connection"</span>
Router<span class="o">(</span>config-router<span class="o">)</span><span class="c"># network 192.168.0.0 mask 255.255.0.0</span>
Router<span class="o">(</span>config-router<span class="o">)</span><span class="c"># aggregate-address 192.168.0.0 255.255.0.0 summary-only</span>

<span class="c"># BGP ê²½ë¡œ ì •ì±… ì„¤ì •</span>
Router<span class="o">(</span>config<span class="o">)</span><span class="c"># ip prefix-list ALLOW-CUSTOMERS seq 10 permit 192.168.0.0/16 le 24</span>
Router<span class="o">(</span>config<span class="o">)</span><span class="c"># route-map CUSTOMER-IN permit 10</span>
Router<span class="o">(</span>config-route-map<span class="o">)</span><span class="c"># match ip address prefix-list ALLOW-CUSTOMERS</span>
Router<span class="o">(</span>config-route-map<span class="o">)</span><span class="c"># set local-preference 200</span>

Router<span class="o">(</span>config<span class="o">)</span><span class="c"># router bgp 65001  </span>
Router<span class="o">(</span>config-router<span class="o">)</span><span class="c"># neighbor 203.0.113.1 route-map CUSTOMER-IN in</span>

<span class="c"># Linux FRR BGP ì„¤ì •</span>
router bgp 65001
 bgp router-id 1.1.1.1
 neighbor 203.0.113.1 remote-as 65002
 neighbor 203.0.113.1 description ISP-A
 address-family ipv4 unicast
  network 192.168.0.0/16
  neighbor 203.0.113.1 activate
</code></pre></div></div>

<h2 id="ìŠ¤ìœ„ì¹­-ê¸°ìˆ --switching-technology">ìŠ¤ìœ„ì¹­ ê¸°ìˆ  | Switching Technology</h2>

<h3 id="-ì´ë”ë„·-ìŠ¤ìœ„ì¹­-ê¸°ë³¸">ğŸ”Œ ì´ë”ë„· ìŠ¤ìœ„ì¹­ ê¸°ë³¸</h3>

<h4 id="mac-ì£¼ì†Œ-í•™ìŠµ-ê³¼ì •">MAC ì£¼ì†Œ í•™ìŠµ ê³¼ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1ë‹¨ê³„: MAC ì£¼ì†Œ í…Œì´ë¸”ì´ ë¹„ì–´ìˆìŒ</span>
Switch# show mac address-table
          Mac Address Table
<span class="nt">-------------------------------------------</span>
Vlan    Mac Address       Type        Ports
<span class="nt">----</span>    <span class="nt">-----------</span>       <span class="nt">--------</span>    <span class="nt">-----</span>

<span class="c"># 2ë‹¨ê³„: PC-A(00:11:22:33:44:AA)ì—ì„œ PC-Bë¡œ í”„ë ˆì„ ì „ì†¡</span>
<span class="c"># ìŠ¤ìœ„ì¹˜ê°€ í¬íŠ¸ 1ì—ì„œ ìˆ˜ì‹ , MAC ì£¼ì†Œ í•™ìŠµ</span>

<span class="c"># 3ë‹¨ê³„: MAC ì£¼ì†Œ í…Œì´ë¸” ì—…ë°ì´íŠ¸  </span>
Switch# show mac address-table
          Mac Address Table
<span class="nt">-------------------------------------------</span>
Vlan    Mac Address       Type        Ports
<span class="nt">----</span>    <span class="nt">-----------</span>       <span class="nt">--------</span>    <span class="nt">-----</span>
   1    0011.2233.44aa    DYNAMIC     Fa0/1

<span class="c"># 4ë‹¨ê³„: ëª©ì ì§€ MAC ì£¼ì†Œë¥¼ ëª¨ë¥´ë¯€ë¡œ í”ŒëŸ¬ë”©</span>
<span class="c"># 5ë‹¨ê³„: PC-Bê°€ ì‘ë‹µí•˜ë©´ í¬íŠ¸ 2ì—ì„œ í•™ìŠµ</span>
</code></pre></div></div>

<h4 id="ìŠ¤ìœ„ì¹˜-í¬íŠ¸-ì„¤ì •">ìŠ¤ìœ„ì¹˜ í¬íŠ¸ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì•¡ì„¸ìŠ¤ í¬íŠ¸ ì„¤ì • (ë‹¨ì¼ VLAN)</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># interface fastethernet 0/1</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># switchport mode access</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># switchport access vlan 10</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># switchport port-security</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># switchport port-security maximum 2</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># switchport port-security violation shutdown</span>

<span class="c"># íŠ¸ë í¬ í¬íŠ¸ ì„¤ì • (ë‹¤ì¤‘ VLAN)</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># interface fastethernet 0/24</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># switchport mode trunk</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># switchport trunk encapsulation dot1q</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># switchport trunk allowed vlan 10,20,30</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># switchport trunk native vlan 1</span>
</code></pre></div></div>

<h3 id="ï¸-vlan-virtual-local-area-network">ğŸ·ï¸ VLAN (Virtual Local Area Network)</h3>

<p>VLANì€ ë¬¼ë¦¬ì  ìœ„ì¹˜ì™€ ê´€ê³„ì—†ì´ ë…¼ë¦¬ì ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ë¥¼ ë¶„í• í•˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤.</p>

<h4 id="vlan-ì„¤ì •-ë°-ê´€ë¦¬">VLAN ì„¤ì • ë° ê´€ë¦¬</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># VLAN ìƒì„±</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># vlan 10</span>
Switch<span class="o">(</span>config-vlan<span class="o">)</span><span class="c"># name SALES</span>
Switch<span class="o">(</span>config-vlan<span class="o">)</span><span class="c"># vlan 20  </span>
Switch<span class="o">(</span>config-vlan<span class="o">)</span><span class="c"># name ENGINEERING</span>
Switch<span class="o">(</span>config-vlan<span class="o">)</span><span class="c"># vlan 30</span>
Switch<span class="o">(</span>config-vlan<span class="o">)</span><span class="c"># name GUEST</span>

<span class="c"># VLAN ì •ë³´ í™•ì¸</span>
Switch# show vlan brief
VLAN Name                             Status    Ports
<span class="nt">----</span> <span class="nt">--------------------------------</span> <span class="nt">---------</span> <span class="nt">-------------------------------</span>
1    default                          active    Fa0/5, Fa0/6, Fa0/7, Fa0/8
10   SALES                           active    Fa0/1, Fa0/2
20   ENGINEERING                     active    Fa0/3, Fa0/4  
30   GUEST                           active    
999  UNUSED                          active    

<span class="c"># ë™ì  VLAN í• ë‹¹ (VMPS)</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># vmps server 192.168.1.100</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># interface range fastethernet 0/1-20</span>
Switch<span class="o">(</span>config-if-range<span class="o">)</span><span class="c"># switchport mode dynamic desirable</span>
</code></pre></div></div>

<h4 id="inter-vlan-ë¼ìš°íŒ…">Inter-VLAN ë¼ìš°íŒ…</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë¼ìš°í„°ì˜ ì„œë¸Œì¸í„°í˜ì´ìŠ¤ ì„¤ì • (Router-on-a-Stick)</span>
Router<span class="o">(</span>config<span class="o">)</span><span class="c"># interface fastethernet 0/0</span>
Router<span class="o">(</span>config-if<span class="o">)</span><span class="c"># no shutdown</span>
Router<span class="o">(</span>config-if<span class="o">)</span><span class="c"># interface fastethernet 0/0.10</span>
Router<span class="o">(</span>config-subif<span class="o">)</span><span class="c"># encapsulation dot1Q 10</span>
Router<span class="o">(</span>config-subif<span class="o">)</span><span class="c"># ip address 192.168.10.1 255.255.255.0</span>
Router<span class="o">(</span>config-subif<span class="o">)</span><span class="c"># interface fastethernet 0/0.20</span>
Router<span class="o">(</span>config-subif<span class="o">)</span><span class="c"># encapsulation dot1Q 20  </span>
Router<span class="o">(</span>config-subif<span class="o">)</span><span class="c"># ip address 192.168.20.1 255.255.255.0</span>

<span class="c"># SVI (Switched Virtual Interface) ì„¤ì •</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># ip routing</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># interface vlan 10</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># ip address 192.168.10.1 255.255.255.0</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># no shutdown</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># interface vlan 20</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># ip address 192.168.20.1 255.255.255.0</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># no shutdown</span>
</code></pre></div></div>

<h3 id="-stp-spanning-tree-protocol">ğŸŒ³ STP (Spanning Tree Protocol)</h3>

<p>STPëŠ” ìŠ¤ìœ„ì¹˜ ë„¤íŠ¸ì›Œí¬ì—ì„œ ë£¨í”„ë¥¼ ë°©ì§€í•˜ê³  ì´ì¤‘í™”ë¥¼ ì œê³µí•˜ëŠ” í”„ë¡œí† ì½œì…ë‹ˆë‹¤.</p>

<h4 id="stp-ê¸°ë³¸-ê°œë…">STP ê¸°ë³¸ ê°œë…</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># STP í¬íŠ¸ ìƒíƒœ</span>
Disabled: í¬íŠ¸ ë¹„í™œì„±í™”
Blocking: ë°ì´í„° ì „ì†¡ ì°¨ë‹¨, BPDU ìˆ˜ì‹ ë§Œ
Listening: BPDU ì†¡ìˆ˜ì‹ , MAC ì£¼ì†Œ í•™ìŠµí•˜ì§€ ì•ŠìŒ
Learning: MAC ì£¼ì†Œ í•™ìŠµ, ë°ì´í„° ì „ì†¡í•˜ì§€ ì•ŠìŒ  
Forwarding: ì •ìƒ ë°ì´í„° ì „ì†¡

<span class="c"># STP í¬íŠ¸ ì—­í• </span>
Root Port: ë£¨íŠ¸ ë¸Œë¦¬ì§€ë¡œ ê°€ëŠ” ìµœë‹¨ ê²½ë¡œ
Designated Port: ì„¸ê·¸ë¨¼íŠ¸ì˜ ëŒ€í‘œ í¬íŠ¸
Alternate Port: ë£¨íŠ¸ í¬íŠ¸ì˜ ë°±ì—…
Backup Port: ê°™ì€ ìŠ¤ìœ„ì¹˜ì˜ ë‹¤ë¥¸ í¬íŠ¸ ë°±ì—…
</code></pre></div></div>

<h4 id="stp-ì„¤ì •-ë°-ìµœì í™”">STP ì„¤ì • ë° ìµœì í™”</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë£¨íŠ¸ ë¸Œë¦¬ì§€ ì„¤ì •</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># spanning-tree vlan 1 root primary</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># spanning-tree vlan 1 priority 4096</span>

<span class="c"># í¬íŠ¸ ìš°ì„ ìˆœìœ„ ë° ë¹„ìš© ì„¤ì •</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># interface fastethernet 0/1  </span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># spanning-tree vlan 1 port-priority 128</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># spanning-tree vlan 1 cost 19</span>

<span class="c"># RSTP (Rapid Spanning Tree) ì„¤ì •</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># spanning-tree mode rapid-pvst</span>

<span class="c"># í¬íŠ¸ ìµœì í™”</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># interface range fastethernet 0/1-20</span>
Switch<span class="o">(</span>config-if-range<span class="o">)</span><span class="c"># spanning-tree portfast</span>
Switch<span class="o">(</span>config-if-range<span class="o">)</span><span class="c"># spanning-tree bpduguard enable</span>

<span class="c"># STP ì •ë³´ í™•ì¸</span>
Switch# show spanning-tree
Switch# show spanning-tree vlan 1
Switch# show spanning-tree interface fastethernet 0/1
</code></pre></div></div>

<h4 id="mst-multiple-spanning-tree">MST (Multiple Spanning Tree)</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># MST ì„¤ì •</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># spanning-tree mode mst</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># spanning-tree mst configuration</span>
Switch<span class="o">(</span>config-mst<span class="o">)</span><span class="c"># name COMPANY  </span>
Switch<span class="o">(</span>config-mst<span class="o">)</span><span class="c"># revision 1</span>
Switch<span class="o">(</span>config-mst<span class="o">)</span><span class="c"># instance 1 vlan 10,20</span>
Switch<span class="o">(</span>config-mst<span class="o">)</span><span class="c"># instance 2 vlan 30,40</span>
Switch<span class="o">(</span>config-mst<span class="o">)</span><span class="c"># exit</span>

<span class="c"># MST ë£¨íŠ¸ ì„¤ì •</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># spanning-tree mst 1 root primary</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># spanning-tree mst 2 root secondary</span>
</code></pre></div></div>

<h2 id="ê³ ê¸‰-ë„¤íŠ¸ì›Œí‚¹-ê¸°ìˆ --advanced-networking">ê³ ê¸‰ ë„¤íŠ¸ì›Œí‚¹ ê¸°ìˆ  | Advanced Networking</h2>

<h3 id="-link-aggregation-etherchannel">ğŸ”— Link Aggregation (EtherChannel)</h3>

<p>ì—¬ëŸ¬ ë¬¼ë¦¬ì  ë§í¬ë¥¼ ë…¼ë¦¬ì ìœ¼ë¡œ ë¬¶ì–´ ëŒ€ì—­í­ì„ ì¦ê°€ì‹œí‚¤ê³  ì´ì¤‘í™”ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># LACP (Link Aggregation Control Protocol) ì„¤ì •</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># interface range fastethernet 0/1-2</span>
Switch<span class="o">(</span>config-if-range<span class="o">)</span><span class="c"># channel-group 1 mode active</span>
Switch<span class="o">(</span>config-if-range<span class="o">)</span><span class="c"># exit</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># interface port-channel 1</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># switchport mode trunk</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># switchport trunk allowed vlan 10,20,30</span>

<span class="c"># PAgP (Port Aggregation Protocol) ì„¤ì •  </span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># interface range fastethernet 0/3-4</span>
Switch<span class="o">(</span>config-if-range<span class="o">)</span><span class="c"># channel-group 2 mode desirable</span>

<span class="c"># ì •ì  EtherChannel ì„¤ì •</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># interface range fastethernet 0/5-6  </span>
Switch<span class="o">(</span>config-if-range<span class="o">)</span><span class="c"># channel-group 3 mode on</span>

<span class="c"># EtherChannel í™•ì¸</span>
Switch# show etherchannel summary
Switch# show etherchannel port-channel
</code></pre></div></div>

<h3 id="-vxlan-virtual-extensible-lan">ğŸŒ VXLAN (Virtual Extensible LAN)</h3>

<p>í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ L2 ì˜¤ë²„ë ˆì´ ë„¤íŠ¸ì›Œí¬ë¥¼ êµ¬í˜„í•˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Linuxì—ì„œ VXLAN ì„¤ì •</span>
<span class="c"># VXLAN ì¸í„°í˜ì´ìŠ¤ ìƒì„±</span>
ip <span class="nb">link </span>add vxlan10 <span class="nb">type </span>vxlan <span class="nb">id </span>10 remote 192.168.1.2 <span class="nb">local </span>192.168.1.1 dev eth0 dstport 4789

<span class="c"># VXLANì„ ë¸Œë¦¬ì§€ì— ì—°ê²°</span>
ip <span class="nb">link </span>add br0 <span class="nb">type </span>bridge
ip <span class="nb">link set </span>vxlan10 master br0
ip <span class="nb">link set </span>eth1 master br0

<span class="c"># ì¸í„°í˜ì´ìŠ¤ í™œì„±í™”</span>
ip <span class="nb">link set </span>vxlan10 up
ip <span class="nb">link set </span>br0 up

<span class="c"># ë©€í‹°ìºìŠ¤íŠ¸ VXLAN</span>
ip <span class="nb">link </span>add vxlan20 <span class="nb">type </span>vxlan <span class="nb">id </span>20 group 239.1.1.1 dev eth0 dstport 4789

<span class="c"># VXLAN ì •ë³´ í™•ì¸</span>
bridge fdb show dev vxlan10
ip <span class="nt">-d</span> <span class="nb">link </span>show vxlan10
</code></pre></div></div>

<h3 id="ï¸-ë¡œë“œ-ë°¸ëŸ°ì‹±">âš–ï¸ ë¡œë“œ ë°¸ëŸ°ì‹±</h3>

<h4 id="haproxy-ì„¤ì •">HAProxy ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># HAProxy ì„¤ì • íŒŒì¼ (/etc/haproxy/haproxy.cfg)</span>
global
    daemon
    maxconn 4096
    log 127.0.0.1:514 local0

defaults
    mode http
    <span class="nb">timeout </span>connect 5000ms
    <span class="nb">timeout </span>client 50000ms
    <span class="nb">timeout </span>server 50000ms
    option httplog

frontend web_frontend
    <span class="nb">bind</span> <span class="k">*</span>:80
    <span class="nb">bind</span> <span class="k">*</span>:443 ssl crt /etc/ssl/certs/website.pem
    redirect scheme https <span class="k">if</span> <span class="o">!{</span> ssl_fc <span class="o">}</span>
    default_backend web_servers

backend web_servers
    balance roundrobin
    option httpchk GET /health
    server web1 192.168.1.10:80 check
    server web2 192.168.1.11:80 check
    server web3 192.168.1.12:80 check backup

<span class="c"># í†µê³„ í˜ì´ì§€</span>
listen stats
    <span class="nb">bind</span> <span class="k">*</span>:8080
    stats <span class="nb">enable
    </span>stats uri /stats
    stats refresh 30s
</code></pre></div></div>

<h4 id="nginx-ë¡œë“œ-ë°¸ëŸ°ì‹±">NGINX ë¡œë“œ ë°¸ëŸ°ì‹±</h4>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># /etc/nginx/nginx.conf</span>
<span class="k">upstream</span> <span class="s">backend</span> <span class="p">{</span>
    <span class="kn">least_conn</span><span class="p">;</span>  <span class="c1"># ë¡œë“œ ë°¸ëŸ°ì‹± ë°©ë²•</span>
    <span class="kn">server</span> <span class="nf">192.168.1.10</span><span class="p">:</span><span class="mi">80</span> <span class="s">max_fails=3</span> <span class="s">fail_timeout=30s</span><span class="p">;</span>
    <span class="kn">server</span> <span class="nf">192.168.1.11</span><span class="p">:</span><span class="mi">80</span> <span class="s">max_fails=3</span> <span class="s">fail_timeout=30s</span><span class="p">;</span>
    <span class="kn">server</span> <span class="nf">192.168.1.12</span><span class="p">:</span><span class="mi">80</span> <span class="s">backup</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">location</span> <span class="n">/</span> <span class="p">{</span>
        <span class="kn">proxy_pass</span> <span class="s">http://backend</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
        
        <span class="c1"># í—¬ìŠ¤ ì²´í¬</span>
        <span class="kn">proxy_connect_timeout</span> <span class="s">1s</span><span class="p">;</span>
        <span class="kn">proxy_send_timeout</span> <span class="s">1s</span><span class="p">;</span>
        <span class="kn">proxy_read_timeout</span> <span class="s">1s</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="-ë„¤íŠ¸ì›Œí¬-ë³´ì•ˆ-ì‹¬í™”">ğŸ” ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ ì‹¬í™”</h3>

<h4 id="í¬íŠ¸-ë³´ì•ˆ-port-security">í¬íŠ¸ ë³´ì•ˆ (Port Security)</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># MAC ì£¼ì†Œ ê¸°ë°˜ í¬íŠ¸ ë³´ì•ˆ</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># interface fastethernet 0/1</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># switchport port-security</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># switchport port-security maximum 2</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># switchport port-security mac-address sticky</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># switchport port-security violation restrict</span>

<span class="c"># 802.1X ì¸ì¦ ì„¤ì •</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># aaa new-model</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># aaa authentication dot1x default group radius</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># dot1x system-auth-control</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c"># interface fastethernet 0/1</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># authentication port-control auto</span>
Switch<span class="o">(</span>config-if<span class="o">)</span><span class="c"># dot1x pae authenticator</span>
</code></pre></div></div>

<h4 id="acl-access-control-list-ì‹¬í™”">ACL (Access Control List) ì‹¬í™”</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í™•ì¥ ACL</span>
Router<span class="o">(</span>config<span class="o">)</span><span class="c"># ip access-list extended BLOCK_SOCIAL</span>
Router<span class="o">(</span>config-ext-nacl<span class="o">)</span><span class="c"># deny tcp any host 23.35.67.140 eq 80</span>
Router<span class="o">(</span>config-ext-nacl<span class="o">)</span><span class="c"># deny tcp any host 23.35.67.141 eq 443  </span>
Router<span class="o">(</span>config-ext-nacl<span class="o">)</span><span class="c"># permit ip any any</span>
Router<span class="o">(</span>config-ext-nacl<span class="o">)</span><span class="c"># exit</span>
Router<span class="o">(</span>config<span class="o">)</span><span class="c"># interface fastethernet 0/1</span>
Router<span class="o">(</span>config-if<span class="o">)</span><span class="c"># ip access-group BLOCK_SOCIAL out</span>

<span class="c"># ì‹œê°„ ê¸°ë°˜ ACL</span>
Router<span class="o">(</span>config<span class="o">)</span><span class="c"># time-range WORK_HOURS</span>
Router<span class="o">(</span>config-time-range<span class="o">)</span><span class="c"># periodic weekdays 09:00 to 18:00</span>
Router<span class="o">(</span>config<span class="o">)</span><span class="c"># ip access-list extended TIME_BASED</span>
Router<span class="o">(</span>config-ext-nacl<span class="o">)</span><span class="c"># permit tcp 192.168.1.0 0.0.0.255 any eq 80 time-range WORK_HOURS</span>
Router<span class="o">(</span>config-ext-nacl<span class="o">)</span><span class="c"># deny tcp 192.168.1.0 0.0.0.255 any eq 80</span>

<span class="c"># ë°˜ì‚¬í˜• ACL (Reflexive ACL)</span>
Router<span class="o">(</span>config<span class="o">)</span><span class="c"># ip access-list extended OUTBOUND</span>
Router<span class="o">(</span>config-ext-nacl<span class="o">)</span><span class="c"># permit tcp 192.168.1.0 0.0.0.255 any reflect TCP_TRAFFIC</span>
Router<span class="o">(</span>config-ext-nacl<span class="o">)</span><span class="c"># permit icmp 192.168.1.0 0.0.0.255 any reflect ICMP_TRAFFIC</span>

Router<span class="o">(</span>config<span class="o">)</span><span class="c"># ip access-list extended INBOUND  </span>
Router<span class="o">(</span>config-ext-nacl<span class="o">)</span><span class="c"># evaluate TCP_TRAFFIC</span>
Router<span class="o">(</span>config-ext-nacl<span class="o">)</span><span class="c"># evaluate ICMP_TRAFFIC</span>
Router<span class="o">(</span>config-ext-nacl<span class="o">)</span><span class="c"># deny ip any any</span>
</code></pre></div></div>

<h2 id="ë„¤íŠ¸ì›Œí¬-ëª¨ë‹ˆí„°ë§-ë°-ë¬¸ì œ-í•´ê²°--network-monitoring--troubleshooting">ë„¤íŠ¸ì›Œí¬ ëª¨ë‹ˆí„°ë§ ë° ë¬¸ì œ í•´ê²° | Network Monitoring &amp; Troubleshooting</h2>

<h3 id="-snmp-simple-network-management-protocol">ğŸ“Š SNMP (Simple Network Management Protocol)</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># SNMP v3 ì„¤ì • (Cisco)</span>
Router<span class="o">(</span>config<span class="o">)</span><span class="c"># snmp-server view READONLY iso included</span>
Router<span class="o">(</span>config<span class="o">)</span><span class="c"># snmp-server group ADMIN v3 auth read READONLY  </span>
Router<span class="o">(</span>config<span class="o">)</span><span class="c"># snmp-server user admin ADMIN v3 auth sha password123 priv aes 128 password456</span>
Router<span class="o">(</span>config<span class="o">)</span><span class="c"># snmp-server host 192.168.1.100 version 3 auth admin</span>

<span class="c"># Linux SNMP í´ë¼ì´ì–¸íŠ¸</span>
<span class="c"># OIDë¥¼ ì´ìš©í•œ ì •ë³´ ì¡°íšŒ</span>
snmpwalk <span class="nt">-v3</span> <span class="nt">-u</span> admin <span class="nt">-a</span> SHA <span class="nt">-A</span> password123 <span class="nt">-x</span> AES <span class="nt">-X</span> password456 <span class="nt">-l</span> authPriv 192.168.1.1 1.3.6.1.2.1.1

<span class="c"># ì¸í„°í˜ì´ìŠ¤ í†µê³„ ì¡°íšŒ</span>
snmpwalk <span class="nt">-v3</span> <span class="nt">-u</span> admin <span class="nt">-a</span> SHA <span class="nt">-A</span> password123 <span class="nt">-x</span> AES <span class="nt">-X</span> password456 <span class="nt">-l</span> authPriv 192.168.1.1 1.3.6.1.2.1.2.2.1.10
</code></pre></div></div>

<h3 id="-ë„¤íŠ¸ì›Œí¬-ë¶„ì„-ë„êµ¬">ğŸ” ë„¤íŠ¸ì›Œí¬ ë¶„ì„ ë„êµ¬</h3>

<h4 id="wireshark-ê³ ê¸‰-í•„í„°">Wireshark ê³ ê¸‰ í•„í„°</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í”„ë¡œí† ì½œë³„ í•„í„°</span>
tcp.port <span class="o">==</span> 80                    <span class="c"># HTTP íŠ¸ë˜í”½</span>
tcp.flags.syn <span class="o">==</span> 1 and tcp.flags.ack <span class="o">==</span> 0  <span class="c"># TCP SYN íŒ¨í‚·</span>
icmp.type <span class="o">==</span> 8                    <span class="c"># ICMP Echo Request</span>
dns.qry.name contains <span class="s2">"google"</span>    <span class="c"># DNS ì¿¼ë¦¬</span>

<span class="c"># ë„¤íŠ¸ì›Œí¬ë³„ í•„í„°</span>
ip.src <span class="o">==</span> 192.168.1.0/24          <span class="c"># ì†ŒìŠ¤ ë„¤íŠ¸ì›Œí¬</span>
ip.dst <span class="o">==</span> 10.0.0.0/8             <span class="c"># ëª©ì ì§€ ë„¤íŠ¸ì›Œí¬</span>
eth.addr <span class="o">==</span> 00:11:22:33:44:55     <span class="c"># MAC ì£¼ì†Œ</span>

<span class="c"># ì„±ëŠ¥ ë¶„ì„</span>
tcp.analysis.retransmission       <span class="c"># TCP ì¬ì „ì†¡</span>
tcp.analysis.duplicate_ack        <span class="c"># ì¤‘ë³µ ACK</span>
tcp.analysis.zero_window          <span class="c"># ì œë¡œ ìœˆë„ìš°</span>
</code></pre></div></div>

<h4 id="ë„¤íŠ¸ì›Œí¬-ì„±ëŠ¥-ì¸¡ì •">ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ ì¸¡ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ëŒ€ì—­í­ ì¸¡ì • (iperf3)</span>
<span class="c"># ì„œë²„ ëª¨ë“œ</span>
iperf3 <span class="nt">-s</span> <span class="nt">-p</span> 5201

<span class="c"># í´ë¼ì´ì–¸íŠ¸ ëª¨ë“œ  </span>
iperf3 <span class="nt">-c</span> 192.168.1.100 <span class="nt">-p</span> 5201 <span class="nt">-t</span> 60 <span class="nt">-P</span> 4

<span class="c"># UDP ì¸¡ì •</span>
iperf3 <span class="nt">-c</span> 192.168.1.100 <span class="nt">-u</span> <span class="nt">-b</span> 100M

<span class="c"># ì§€ì—° ì‹œê°„ ì¸¡ì • (hping3)</span>
hping3 <span class="nt">-S</span> <span class="nt">-p</span> 80 <span class="nt">-c</span> 10 google.com
hping3 <span class="nt">-1</span> <span class="nt">-c</span> 100 <span class="nt">-i</span> u1000 192.168.1.1  <span class="c"># ë§ˆì´í¬ë¡œì´ˆ ê°„ê²©</span>

<span class="c"># MTU ê²½ë¡œ ë°œê²¬</span>
tracepath google.com
ping <span class="nt">-M</span> <span class="k">do</span> <span class="nt">-s</span> 1472 google.com
</code></pre></div></div>

<h2 id="2-3-iac-infrastructure-as-code--ì½”ë“œí˜•-ì¸í”„ë¼">2-3 IaC (Infrastructure as Code) | ì½”ë“œí˜• ì¸í”„ë¼</h2>

<h3 id="2-3-1-iac-ì¢…ë¥˜--types-of-iac">2-3-1 IaC ì¢…ë¥˜ | Types of IaC</h3>

<p>IaCëŠ” ì¸í”„ë¼ë¥¼ ì½”ë“œë¡œ ì •ì˜í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë°©ë²•ë¡ ìœ¼ë¡œ, ë„¤íŠ¸ì›Œí¬ ì¸í”„ë¼ êµ¬ì¶•ê³¼ ê´€ë¦¬ë¥¼ ìë™í™”í•©ë‹ˆë‹¤.</p>

<h4 id="ï¸-ì£¼ìš”-iac-ë„êµ¬-ë¶„ë¥˜">ğŸ› ï¸ ì£¼ìš” IaC ë„êµ¬ ë¶„ë¥˜</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì„ ì–¸ì  vs ëª…ë ¹ì </span>
ì„ ì–¸ì  <span class="o">(</span>Declarative<span class="o">)</span>:
- Terraform, CloudFormation, Ansible <span class="o">(</span>ì¼ë¶€<span class="o">)</span>
- ìµœì¢… ìƒíƒœë¥¼ ì •ì˜
- ë” ì•ˆì •ì ì´ê³  ì˜ˆì¸¡ ê°€ëŠ¥

ëª…ë ¹ì  <span class="o">(</span>Imperative<span class="o">)</span>:  
- Shell Scripts, Python Scripts
- ì‹¤í–‰ ë‹¨ê³„ë¥¼ ì •ì˜
- ë” ìœ ì—°í•˜ì§€ë§Œ ë³µì¡í•¨

<span class="c"># ì—ì´ì „íŠ¸ ê¸°ë°˜ vs ì—ì´ì „íŠ¸ë¦¬ìŠ¤</span>
ì—ì´ì „íŠ¸ ê¸°ë°˜:
- Puppet, Chef
- ëŒ€ìƒ ì‹œìŠ¤í…œì— ì—ì´ì „íŠ¸ ì„¤ì¹˜ í•„ìš”
- ì§€ì†ì ì¸ ìƒíƒœ ê´€ë¦¬

ì—ì´ì „íŠ¸ë¦¬ìŠ¤:
- Ansible, Terraform
- SSH/WinRM ë“±ì„ í†µí•œ ì›ê²© ì‹¤í–‰
- ì„¤ì¹˜ ë¶€ë‹´ ì—†ìŒ
</code></pre></div></div>

<h4 id="terraform">Terraform</h4>
<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Provider ì„¤ì •</span>
<span class="nx">terraform</span> <span class="p">{</span>
  <span class="nx">required_version</span> <span class="o">=</span> <span class="s2">"&gt;= 1.0"</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">aws</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">source</span>  <span class="o">=</span> <span class="s2">"hashicorp/aws"</span>
      <span class="nx">version</span> <span class="o">=</span> <span class="s2">"~&gt; 5.0"</span>
    <span class="p">}</span>
    <span class="nx">cisco</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">source</span>  <span class="o">=</span> <span class="s2">"CiscoDevNet/aci"</span>
      <span class="nx">version</span> <span class="o">=</span> <span class="s2">"~&gt; 2.0"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># ë³€ìˆ˜ ì •ì˜</span>
<span class="nx">variable</span> <span class="s2">"vpc_cidr"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"CIDR block for VPC"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">string</span>
  <span class="nx">default</span>     <span class="o">=</span> <span class="s2">"10.0.0.0/16"</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"environment"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"Environment name"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">string</span>
  <span class="nx">default</span>     <span class="o">=</span> <span class="s2">"production"</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="ansible">Ansible</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ë„¤íŠ¸ì›Œí¬ ì¥ë¹„ ì¸ë²¤í† ë¦¬ (/etc/ansible/hosts)</span>
<span class="pi">[</span><span class="nv">switches</span><span class="pi">]</span>
<span class="s">switch1 ansible_host=192.168.1.10 ansible_network_os=ios</span>
<span class="s">switch2 ansible_host=192.168.1.11 ansible_network_os=ios</span>

<span class="pi">[</span><span class="nv">routers</span><span class="pi">]</span>  
<span class="s">router1 ansible_host=192.168.1.1 ansible_network_os=ios</span>
<span class="s">router2 ansible_host=192.168.1.2 ansible_network_os=ios</span>

<span class="pi">[</span><span class="nv">network</span><span class="pi">:</span><span class="nv">children</span><span class="pi">]</span>
<span class="s">switches</span>
<span class="s">routers</span>

<span class="pi">[</span><span class="nv">network</span><span class="pi">:</span><span class="nv">vars</span><span class="pi">]</span>
<span class="s">ansible_user=admin</span>
<span class="s">ansible_password=password</span>
<span class="s">ansible_connection=network_cli</span>
<span class="s">ansible_become=yes</span>
<span class="s">ansible_become_method=enable</span>
</code></pre></div></div>

<h4 id="cloudformation-aws">CloudFormation (AWS)</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># AWS ë„¤íŠ¸ì›Œí¬ ì¸í”„ë¼ í…œí”Œë¦¿</span>
<span class="na">AWSTemplateFormatVersion</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2010-09-09'</span>
<span class="na">Description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Network</span><span class="nv"> </span><span class="s">Infrastructure</span><span class="nv"> </span><span class="s">Template'</span>

<span class="na">Parameters</span><span class="pi">:</span>
  <span class="na">EnvironmentName</span><span class="pi">:</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s">Environment name prefix</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">String</span>
    <span class="na">Default</span><span class="pi">:</span> <span class="s">Production</span>

<span class="na">Resources</span><span class="pi">:</span>
  <span class="na">VPC</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::VPC</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">CidrBlock</span><span class="pi">:</span> <span class="s">10.0.0.0/16</span>
      <span class="na">EnableDnsHostnames</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="na">EnableDnsSupport</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="na">Tags</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">Key</span><span class="pi">:</span> <span class="s">Name</span>
          <span class="na">Value</span><span class="pi">:</span> <span class="kt">!Sub</span> <span class="s">${EnvironmentName}-VPC</span>
</code></pre></div></div>

<h4 id="pulumi">Pulumi</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Pythonì„ ì´ìš©í•œ IaC
</span><span class="kn">import</span> <span class="n">pulumi</span>
<span class="kn">import</span> <span class="n">pulumi_aws</span> <span class="k">as</span> <span class="n">aws</span>

<span class="c1"># VPC ìƒì„±
</span><span class="n">vpc</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">ec2</span><span class="p">.</span><span class="nc">Vpc</span><span class="p">(</span><span class="sh">"</span><span class="s">main-vpc</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">cidr_block</span><span class="o">=</span><span class="sh">"</span><span class="s">10.0.0.0/16</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">enable_dns_hostnames</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">enable_dns_support</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">tags</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">main-vpc</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">Environment</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">production</span><span class="sh">"</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># ì„œë¸Œë„· ìƒì„±
</span><span class="n">public_subnet</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">ec2</span><span class="p">.</span><span class="nc">Subnet</span><span class="p">(</span><span class="sh">"</span><span class="s">public-subnet</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">vpc_id</span><span class="o">=</span><span class="n">vpc</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
    <span class="n">cidr_block</span><span class="o">=</span><span class="sh">"</span><span class="s">10.0.1.0/24</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">availability_zone</span><span class="o">=</span><span class="sh">"</span><span class="s">us-west-2a</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">map_public_ip_on_launch</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">tags</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">public-subnet</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">Type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Public</span><span class="sh">"</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<h4 id="cdk-cloud-development-kit">CDK (Cloud Development Kit)</h4>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// TypeScriptë¥¼ ì´ìš©í•œ AWS CDK</span>
<span class="k">import</span> <span class="o">*</span> <span class="kd">as </span><span class="nx">cdk</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">aws-cdk-lib</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="o">*</span> <span class="kd">as </span><span class="nx">ec2</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">aws-cdk-lib/aws-ec2</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nc">NetworkStack</span> <span class="kd">extends</span> <span class="nc">cdk</span><span class="p">.</span><span class="nx">Stack</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">scope</span><span class="p">:</span> <span class="nx">cdk</span><span class="p">.</span><span class="nx">App</span><span class="p">,</span> <span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">props</span><span class="p">?:</span> <span class="nx">cdk</span><span class="p">.</span><span class="nx">StackProps</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">props</span><span class="p">);</span>

    <span class="c1">// VPC ìƒì„±</span>
    <span class="kd">const</span> <span class="nx">vpc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ec2</span><span class="p">.</span><span class="nc">Vpc</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="dl">'</span><span class="s1">MainVpc</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">maxAzs</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="na">cidr</span><span class="p">:</span> <span class="dl">'</span><span class="s1">10.0.0.0/16</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">subnetConfiguration</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="na">cidrMask</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
          <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Public</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">subnetType</span><span class="p">:</span> <span class="nx">ec2</span><span class="p">.</span><span class="nx">SubnetType</span><span class="p">.</span><span class="nx">PUBLIC</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="na">cidrMask</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
          <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Private</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">subnetType</span><span class="p">:</span> <span class="nx">ec2</span><span class="p">.</span><span class="nx">SubnetType</span><span class="p">.</span><span class="nx">PRIVATE_WITH_EGRESS</span><span class="p">,</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="2-3-2-í…Œë¼í¼ìœ¼ë¡œ-í™˜ê²½-êµ¬ì„±--environment-setup-with-terraform">2-3-2 í…Œë¼í¼ìœ¼ë¡œ í™˜ê²½ êµ¬ì„± | Environment Setup with Terraform</h3>

<p>Terraformì„ ì‚¬ìš©í•˜ì—¬ ì™„ì „í•œ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì„ êµ¬ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<h4 id="ï¸-í”„ë¡œì íŠ¸-êµ¬ì¡°-ì„¤ê³„">ğŸ—ï¸ í”„ë¡œì íŠ¸ êµ¬ì¡° ì„¤ê³„</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë””ë ‰í† ë¦¬ êµ¬ì¡°</span>
terraform-network/
â”œâ”€â”€ environments/
â”‚   â”œâ”€â”€ dev/
â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â”œâ”€â”€ variables.tf
â”‚   â”‚   â””â”€â”€ terraform.tfvars
â”‚   â”œâ”€â”€ staging/
â”‚   â””â”€â”€ production/
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ vpc/
â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â”œâ”€â”€ variables.tf
â”‚   â”‚   â””â”€â”€ outputs.tf
â”‚   â”œâ”€â”€ security-groups/
â”‚   â””â”€â”€ load-balancer/
â”œâ”€â”€ global/
â”‚   â””â”€â”€ iam/
â””â”€â”€ shared/
    â””â”€â”€ data.tf
</code></pre></div></div>

<h4 id="vpc-ëª¨ë“ˆ-êµ¬í˜„">VPC ëª¨ë“ˆ êµ¬í˜„</h4>
<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># modules/vpc/main.tf</span>
<span class="nx">resource</span> <span class="s2">"aws_vpc"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">cidr_block</span>           <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">cidr_block</span>
  <span class="nx">enable_dns_hostnames</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">enable_dns_hostnames</span>
  <span class="nx">enable_dns_support</span>   <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">enable_dns_support</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.name_prefix}-vpc"</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="c1"># ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´</span>
<span class="nx">resource</span> <span class="s2">"aws_internet_gateway"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span> <span class="o">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.name_prefix}-igw"</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="c1"># ê°€ìš© ì˜ì—­ë³„ í¼ë¸”ë¦­ ì„œë¸Œë„·</span>
<span class="nx">resource</span> <span class="s2">"aws_subnet"</span> <span class="s2">"public"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="o">=</span> <span class="nx">length</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">public_subnets</span><span class="p">)</span>

  <span class="nx">vpc_id</span>                  <span class="o">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">cidr_block</span>              <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">public_subnets</span><span class="p">[</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="p">]</span>
  <span class="nx">availability_zone</span>       <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">availability_zones</span><span class="p">[</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="p">]</span>
  <span class="nx">map_public_ip_on_launch</span> <span class="o">=</span> <span class="kc">true</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.name_prefix}-public-${count.index + 1}"</span>
    <span class="nx">Type</span> <span class="o">=</span> <span class="s2">"Public"</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="c1"># í”„ë¼ì´ë¹— ì„œë¸Œë„·</span>
<span class="nx">resource</span> <span class="s2">"aws_subnet"</span> <span class="s2">"private"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="o">=</span> <span class="nx">length</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">private_subnets</span><span class="p">)</span>

  <span class="nx">vpc_id</span>            <span class="o">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">cidr_block</span>        <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">private_subnets</span><span class="p">[</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="p">]</span>
  <span class="nx">availability_zone</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">availability_zones</span><span class="p">[</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="p">]</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.name_prefix}-private-${count.index + 1}"</span>
    <span class="nx">Type</span> <span class="o">=</span> <span class="s2">"Private"</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="c1"># NAT ê²Œì´íŠ¸ì›¨ì´ë¥¼ ìœ„í•œ EIP</span>
<span class="nx">resource</span> <span class="s2">"aws_eip"</span> <span class="s2">"nat"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">enable_nat_gateway</span> <span class="o">?</span> <span class="nx">length</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">public_subnets</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span>

  <span class="nx">domain</span> <span class="o">=</span> <span class="s2">"vpc"</span>
  <span class="nx">depends_on</span> <span class="o">=</span> <span class="p">[</span><span class="nx">aws_internet_gateway</span><span class="p">.</span><span class="nx">main</span><span class="p">]</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.name_prefix}-nat-eip-${count.index + 1}"</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="c1"># NAT ê²Œì´íŠ¸ì›¨ì´</span>
<span class="nx">resource</span> <span class="s2">"aws_nat_gateway"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">enable_nat_gateway</span> <span class="o">?</span> <span class="nx">length</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">public_subnets</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span>

  <span class="nx">allocation_id</span> <span class="o">=</span> <span class="nx">aws_eip</span><span class="p">.</span><span class="nx">nat</span><span class="p">[</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="p">].</span><span class="nx">id</span>
  <span class="nx">subnet_id</span>     <span class="o">=</span> <span class="nx">aws_subnet</span><span class="p">.</span><span class="nx">public</span><span class="p">[</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="p">].</span><span class="nx">id</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.name_prefix}-nat-gw-${count.index + 1}"</span>
  <span class="p">})</span>

  <span class="nx">depends_on</span> <span class="o">=</span> <span class="p">[</span><span class="nx">aws_internet_gateway</span><span class="p">.</span><span class="nx">main</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># í¼ë¸”ë¦­ ë¼ìš°íŠ¸ í…Œì´ë¸”</span>
<span class="nx">resource</span> <span class="s2">"aws_route_table"</span> <span class="s2">"public"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span> <span class="o">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>

  <span class="nx">route</span> <span class="p">{</span>
    <span class="nx">cidr_block</span> <span class="o">=</span> <span class="s2">"0.0.0.0/0"</span>
    <span class="nx">gateway_id</span> <span class="o">=</span> <span class="nx">aws_internet_gateway</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="p">}</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.name_prefix}-public-rt"</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="c1"># í”„ë¼ì´ë¹— ë¼ìš°íŠ¸ í…Œì´ë¸”</span>
<span class="nx">resource</span> <span class="s2">"aws_route_table"</span> <span class="s2">"private"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">enable_nat_gateway</span> <span class="o">?</span> <span class="nx">length</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">private_subnets</span><span class="p">)</span> <span class="o">:</span> <span class="mi">1</span>

  <span class="nx">vpc_id</span> <span class="o">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>

  <span class="nx">dynamic</span> <span class="s2">"route"</span> <span class="p">{</span>
    <span class="nx">for_each</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">enable_nat_gateway</span> <span class="o">?</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="p">[]</span>
    <span class="nx">content</span> <span class="p">{</span>
      <span class="nx">cidr_block</span>     <span class="o">=</span> <span class="s2">"0.0.0.0/0"</span>
      <span class="nx">nat_gateway_id</span> <span class="o">=</span> <span class="nx">aws_nat_gateway</span><span class="p">.</span><span class="nx">main</span><span class="p">[</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="p">].</span><span class="nx">id</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.name_prefix}-private-rt-${count.index + 1}"</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="c1"># ë¼ìš°íŠ¸ í…Œì´ë¸” ì—°ê²°</span>
<span class="nx">resource</span> <span class="s2">"aws_route_table_association"</span> <span class="s2">"public"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="o">=</span> <span class="nx">length</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">public_subnets</span><span class="p">)</span>

  <span class="nx">subnet_id</span>      <span class="o">=</span> <span class="nx">aws_subnet</span><span class="p">.</span><span class="nx">public</span><span class="p">[</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="p">].</span><span class="nx">id</span>
  <span class="nx">route_table_id</span> <span class="o">=</span> <span class="nx">aws_route_table</span><span class="p">.</span><span class="nx">public</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_route_table_association"</span> <span class="s2">"private"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="o">=</span> <span class="nx">length</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">private_subnets</span><span class="p">)</span>

  <span class="nx">subnet_id</span>      <span class="o">=</span> <span class="nx">aws_subnet</span><span class="p">.</span><span class="nx">private</span><span class="p">[</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="p">].</span><span class="nx">id</span>
  <span class="nx">route_table_id</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">enable_nat_gateway</span> <span class="o">?</span> <span class="nx">aws_route_table</span><span class="p">.</span><span class="nx">private</span><span class="p">[</span><span class="nx">count</span><span class="p">.</span><span class="nx">index</span><span class="p">].</span><span class="nx">id</span> <span class="o">:</span> <span class="nx">aws_route_table</span><span class="p">.</span><span class="nx">private</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="vpc-ëª¨ë“ˆ-ë³€ìˆ˜">VPC ëª¨ë“ˆ ë³€ìˆ˜</h4>
<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># modules/vpc/variables.tf</span>
<span class="nx">variable</span> <span class="s2">"name_prefix"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"Name prefix for all resources"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">string</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"cidr_block"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"CIDR block for the VPC"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">string</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"public_subnets"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"List of public subnet CIDR blocks"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"private_subnets"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"List of private subnet CIDR blocks"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"availability_zones"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"List of availability zones"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"enable_nat_gateway"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"Enable NAT Gateway for private subnets"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">bool</span>
  <span class="nx">default</span>     <span class="o">=</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"enable_dns_hostnames"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"Enable DNS hostnames in the VPC"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">bool</span>
  <span class="nx">default</span>     <span class="o">=</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"enable_dns_support"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"Enable DNS support in the VPC"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">bool</span>
  <span class="nx">default</span>     <span class="o">=</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"tags"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"Tags to apply to all resources"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">map</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
  <span class="nx">default</span>     <span class="o">=</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="vpc-ëª¨ë“ˆ-ì¶œë ¥">VPC ëª¨ë“ˆ ì¶œë ¥</h4>
<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># modules/vpc/outputs.tf</span>
<span class="nx">output</span> <span class="s2">"vpc_id"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"ID of the VPC"</span>
  <span class="nx">value</span>       <span class="o">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>

<span class="nx">output</span> <span class="s2">"vpc_cidr_block"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"CIDR block of the VPC"</span>
  <span class="nx">value</span>       <span class="o">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">cidr_block</span>
<span class="p">}</span>

<span class="nx">output</span> <span class="s2">"public_subnet_ids"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"IDs of the public subnets"</span>
  <span class="nx">value</span>       <span class="o">=</span> <span class="nx">aws_subnet</span><span class="p">.</span><span class="nx">public</span><span class="p">[*].</span><span class="nx">id</span>
<span class="p">}</span>

<span class="nx">output</span> <span class="s2">"private_subnet_ids"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"IDs of the private subnets"</span>
  <span class="nx">value</span>       <span class="o">=</span> <span class="nx">aws_subnet</span><span class="p">.</span><span class="nx">private</span><span class="p">[*].</span><span class="nx">id</span>
<span class="p">}</span>

<span class="nx">output</span> <span class="s2">"internet_gateway_id"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"ID of the Internet Gateway"</span>
  <span class="nx">value</span>       <span class="o">=</span> <span class="nx">aws_internet_gateway</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>

<span class="nx">output</span> <span class="s2">"nat_gateway_ids"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"IDs of the NAT Gateways"</span>
  <span class="nx">value</span>       <span class="o">=</span> <span class="nx">aws_nat_gateway</span><span class="p">.</span><span class="nx">main</span><span class="p">[*].</span><span class="nx">id</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="ë³´ì•ˆ-ê·¸ë£¹-ëª¨ë“ˆ">ë³´ì•ˆ ê·¸ë£¹ ëª¨ë“ˆ</h4>
<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># modules/security-groups/main.tf</span>
<span class="c1"># ì›¹ ì„œë²„ ë³´ì•ˆ ê·¸ë£¹</span>
<span class="nx">resource</span> <span class="s2">"aws_security_group"</span> <span class="s2">"web"</span> <span class="p">{</span>
  <span class="nx">name_prefix</span> <span class="o">=</span> <span class="s2">"${var.name_prefix}-web-"</span>
  <span class="nx">vpc_id</span>      <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">vpc_id</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"Security group for web servers"</span>

  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">description</span> <span class="o">=</span> <span class="s2">"HTTP"</span>
    <span class="nx">from_port</span>   <span class="o">=</span> <span class="mi">80</span>
    <span class="nx">to_port</span>     <span class="o">=</span> <span class="mi">80</span>
    <span class="nx">protocol</span>    <span class="o">=</span> <span class="s2">"tcp"</span>
    <span class="nx">cidr_blocks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="p">}</span>

  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">description</span> <span class="o">=</span> <span class="s2">"HTTPS"</span>
    <span class="nx">from_port</span>   <span class="o">=</span> <span class="mi">443</span>
    <span class="nx">to_port</span>     <span class="o">=</span> <span class="mi">443</span>
    <span class="nx">protocol</span>    <span class="o">=</span> <span class="s2">"tcp"</span>
    <span class="nx">cidr_blocks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="p">}</span>

  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">description</span>     <span class="o">=</span> <span class="s2">"SSH from management"</span>
    <span class="nx">from_port</span>       <span class="o">=</span> <span class="mi">22</span>
    <span class="nx">to_port</span>         <span class="o">=</span> <span class="mi">22</span>
    <span class="nx">protocol</span>        <span class="o">=</span> <span class="s2">"tcp"</span>
    <span class="nx">security_groups</span> <span class="o">=</span> <span class="p">[</span><span class="nx">aws_security_group</span><span class="p">.</span><span class="nx">management</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span>
  <span class="p">}</span>

  <span class="nx">egress</span> <span class="p">{</span>
    <span class="nx">from_port</span>   <span class="o">=</span> <span class="mi">0</span>
    <span class="nx">to_port</span>     <span class="o">=</span> <span class="mi">0</span>
    <span class="nx">protocol</span>    <span class="o">=</span> <span class="s2">"-1"</span>
    <span class="nx">cidr_blocks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="p">}</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.name_prefix}-web-sg"</span>
  <span class="p">})</span>

  <span class="nx">lifecycle</span> <span class="p">{</span>
    <span class="nx">create_before_destroy</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># ë°ì´í„°ë² ì´ìŠ¤ ë³´ì•ˆ ê·¸ë£¹</span>
<span class="nx">resource</span> <span class="s2">"aws_security_group"</span> <span class="s2">"database"</span> <span class="p">{</span>
  <span class="nx">name_prefix</span> <span class="o">=</span> <span class="s2">"${var.name_prefix}-db-"</span>
  <span class="nx">vpc_id</span>      <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">vpc_id</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"Security group for database servers"</span>

  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">description</span>     <span class="o">=</span> <span class="s2">"MySQL/MariaDB"</span>
    <span class="nx">from_port</span>       <span class="o">=</span> <span class="mi">3306</span>
    <span class="nx">to_port</span>         <span class="o">=</span> <span class="mi">3306</span>
    <span class="nx">protocol</span>        <span class="o">=</span> <span class="s2">"tcp"</span>
    <span class="nx">security_groups</span> <span class="o">=</span> <span class="p">[</span><span class="nx">aws_security_group</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span>
  <span class="p">}</span>

  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">description</span>     <span class="o">=</span> <span class="s2">"PostgreSQL"</span>
    <span class="nx">from_port</span>       <span class="o">=</span> <span class="mi">5432</span>
    <span class="nx">to_port</span>         <span class="o">=</span> <span class="mi">5432</span>
    <span class="nx">protocol</span>        <span class="o">=</span> <span class="s2">"tcp"</span>
    <span class="nx">security_groups</span> <span class="o">=</span> <span class="p">[</span><span class="nx">aws_security_group</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span>
  <span class="p">}</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.name_prefix}-db-sg"</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="c1"># ê´€ë¦¬ ë³´ì•ˆ ê·¸ë£¹</span>
<span class="nx">resource</span> <span class="s2">"aws_security_group"</span> <span class="s2">"management"</span> <span class="p">{</span>
  <span class="nx">name_prefix</span> <span class="o">=</span> <span class="s2">"${var.name_prefix}-mgmt-"</span>
  <span class="nx">vpc_id</span>      <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">vpc_id</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"Security group for management access"</span>

  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">description</span> <span class="o">=</span> <span class="s2">"SSH"</span>
    <span class="nx">from_port</span>   <span class="o">=</span> <span class="mi">22</span>
    <span class="nx">to_port</span>     <span class="o">=</span> <span class="mi">22</span>
    <span class="nx">protocol</span>    <span class="o">=</span> <span class="s2">"tcp"</span>
    <span class="nx">cidr_blocks</span> <span class="o">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">management_cidr_blocks</span>
  <span class="p">}</span>

  <span class="nx">ingress</span> <span class="p">{</span>
    <span class="nx">description</span> <span class="o">=</span> <span class="s2">"RDP"</span>
    <span class="nx">from_port</span>   <span class="o">=</span> <span class="mi">3389</span>
    <span class="nx">to_port</span>     <span class="o">=</span> <span class="mi">3389</span>
    <span class="nx">protocol</span>    <span class="o">=</span> <span class="s2">"tcp"</span>
    <span class="nx">cidr_blocks</span> <span class="o">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">management_cidr_blocks</span>
  <span class="p">}</span>

  <span class="nx">egress</span> <span class="p">{</span>
    <span class="nx">from_port</span>   <span class="o">=</span> <span class="mi">0</span>
    <span class="nx">to_port</span>     <span class="o">=</span> <span class="mi">0</span>
    <span class="nx">protocol</span>    <span class="o">=</span> <span class="s2">"-1"</span>
    <span class="nx">cidr_blocks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
  <span class="p">}</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.name_prefix}-mgmt-sg"</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="ë©”ì¸-í™˜ê²½-ì„¤ì •">ë©”ì¸ í™˜ê²½ ì„¤ì •</h4>
<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># environments/production/main.tf</span>
<span class="nx">terraform</span> <span class="p">{</span>
  <span class="nx">required_version</span> <span class="o">=</span> <span class="s2">"&gt;= 1.0"</span>
  
  <span class="nx">backend</span> <span class="s2">"s3"</span> <span class="p">{</span>
    <span class="nx">bucket</span>         <span class="o">=</span> <span class="s2">"company-terraform-state"</span>
    <span class="nx">key</span>            <span class="o">=</span> <span class="s2">"network/production/terraform.tfstate"</span>
    <span class="nx">region</span>         <span class="o">=</span> <span class="s2">"us-west-2"</span>
    <span class="nx">encrypt</span>        <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">dynamodb_table</span> <span class="o">=</span> <span class="s2">"terraform-locks"</span>
  <span class="p">}</span>

  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">aws</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">source</span>  <span class="o">=</span> <span class="s2">"hashicorp/aws"</span>
      <span class="nx">version</span> <span class="o">=</span> <span class="s2">"~&gt; 5.0"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">aws_region</span>
  
  <span class="nx">default_tags</span> <span class="p">{</span>
    <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">Environment</span>   <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">environment</span>
      <span class="nx">Project</span>       <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">project_name</span>
      <span class="nx">ManagedBy</span>     <span class="o">=</span> <span class="s2">"Terraform"</span>
      <span class="nx">CreatedBy</span>     <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">created_by</span>
      <span class="nx">CostCenter</span>    <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">cost_center</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># ë°ì´í„° ì†ŒìŠ¤</span>
<span class="nx">data</span> <span class="s2">"aws_availability_zones"</span> <span class="s2">"available"</span> <span class="p">{</span>
  <span class="nx">state</span> <span class="o">=</span> <span class="s2">"available"</span>
<span class="p">}</span>

<span class="c1"># VPC ëª¨ë“ˆ í˜¸ì¶œ</span>
<span class="nx">module</span> <span class="s2">"vpc"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="o">=</span> <span class="s2">"../../modules/vpc"</span>

  <span class="nx">name_prefix</span>        <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">name_prefix</span>
  <span class="nx">cidr_block</span>         <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">vpc_cidr</span>
  <span class="nx">public_subnets</span>     <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">public_subnet_cidrs</span>
  <span class="nx">private_subnets</span>    <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">private_subnet_cidrs</span>
  <span class="nx">availability_zones</span> <span class="o">=</span> <span class="nx">slice</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">aws_availability_zones</span><span class="p">.</span><span class="nx">available</span><span class="p">.</span><span class="nx">names</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
  <span class="nx">enable_nat_gateway</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">enable_nat_gateway</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="nx">local</span><span class="p">.</span><span class="nx">common_tags</span>
<span class="p">}</span>

<span class="c1"># ë³´ì•ˆ ê·¸ë£¹ ëª¨ë“ˆ í˜¸ì¶œ</span>
<span class="nx">module</span> <span class="s2">"security_groups"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="o">=</span> <span class="s2">"../../modules/security-groups"</span>

  <span class="nx">name_prefix</span>             <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">name_prefix</span>
  <span class="nx">vpc_id</span>                  <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">vpc</span><span class="p">.</span><span class="nx">vpc_id</span>
  <span class="nx">management_cidr_blocks</span>  <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">management_cidr_blocks</span>

  <span class="nx">tags</span> <span class="o">=</span> <span class="nx">local</span><span class="p">.</span><span class="nx">common_tags</span>
<span class="p">}</span>

<span class="c1"># ë¡œì»¬ ê°’</span>
<span class="nx">locals</span> <span class="p">{</span>
  <span class="nx">common_tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">Environment</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">environment</span>
    <span class="nx">Project</span>     <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">project_name</span>
    <span class="nx">ManagedBy</span>   <span class="o">=</span> <span class="s2">"Terraform"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="í™˜ê²½ë³„-ë³€ìˆ˜-íŒŒì¼">í™˜ê²½ë³„ ë³€ìˆ˜ íŒŒì¼</h4>
<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># environments/production/variables.tf</span>
<span class="nx">variable</span> <span class="s2">"aws_region"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"AWS region"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">string</span>
  <span class="nx">default</span>     <span class="o">=</span> <span class="s2">"us-west-2"</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"environment"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"Environment name"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">string</span>
  <span class="nx">default</span>     <span class="o">=</span> <span class="s2">"production"</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"project_name"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"Project name"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">string</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"name_prefix"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"Name prefix for resources"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">string</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"vpc_cidr"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"CIDR block for VPC"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">string</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"public_subnet_cidrs"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"CIDR blocks for public subnets"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"private_subnet_cidrs"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"CIDR blocks for private subnets"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"enable_nat_gateway"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"Enable NAT Gateway"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">bool</span>
  <span class="nx">default</span>     <span class="o">=</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"management_cidr_blocks"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"CIDR blocks allowed for management access"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"created_by"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"Creator of the infrastructure"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">string</span>
<span class="p">}</span>

<span class="nx">variable</span> <span class="s2">"cost_center"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"Cost center for billing"</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="nx">string</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="terraform-ì‹¤í–‰-ê°’">Terraform ì‹¤í–‰ ê°’</h4>
<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># environments/production/terraform.tfvars</span>
<span class="nx">project_name</span> <span class="o">=</span> <span class="s2">"company-web-app"</span>
<span class="nx">name_prefix</span>  <span class="o">=</span> <span class="s2">"prod-webapp"</span>

<span class="nx">vpc_cidr</span> <span class="o">=</span> <span class="s2">"10.0.0.0/16"</span>

<span class="nx">public_subnet_cidrs</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s2">"10.0.1.0/24"</span><span class="p">,</span>
  <span class="s2">"10.0.2.0/24"</span><span class="p">,</span> 
  <span class="s2">"10.0.3.0/24"</span>
<span class="p">]</span>

<span class="nx">private_subnet_cidrs</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s2">"10.0.11.0/24"</span><span class="p">,</span>
  <span class="s2">"10.0.12.0/24"</span><span class="p">,</span>
  <span class="s2">"10.0.13.0/24"</span>
<span class="p">]</span>

<span class="nx">enable_nat_gateway</span> <span class="o">=</span> <span class="kc">true</span>

<span class="nx">management_cidr_blocks</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s2">"203.0.113.0/24"</span><span class="p">,</span>  <span class="c1"># íšŒì‚¬ ì‚¬ë¬´ì‹¤</span>
  <span class="s2">"198.51.100.0/24"</span>  <span class="c1"># VPN ë„¤íŠ¸ì›Œí¬</span>
<span class="p">]</span>

<span class="nx">created_by</span>   <span class="o">=</span> <span class="s2">"devops-team"</span>
<span class="nx">cost_center</span>  <span class="o">=</span> <span class="s2">"engineering"</span>
</code></pre></div></div>

<h4 id="terraform-ì‹¤í–‰-ë°-ê´€ë¦¬">Terraform ì‹¤í–‰ ë° ê´€ë¦¬</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì´ˆê¸°í™”</span>
terraform init

<span class="c"># ê³„íš í™•ì¸  </span>
terraform plan <span class="nt">-var-file</span><span class="o">=</span><span class="s2">"terraform.tfvars"</span>

<span class="c"># ì ìš©</span>
terraform apply <span class="nt">-var-file</span><span class="o">=</span><span class="s2">"terraform.tfvars"</span>

<span class="c"># ìƒíƒœ í™•ì¸</span>
terraform show
terraform state list

<span class="c"># ë¦¬ì†ŒìŠ¤ í™•ì¸</span>
terraform state show module.vpc.aws_vpc.main

<span class="c"># ì¶œë ¥ ê°’ í™•ì¸</span>
terraform output

<span class="c"># ë¦¬ì†ŒìŠ¤ ì‚­ì œ</span>
terraform destroy <span class="nt">-var-file</span><span class="o">=</span><span class="s2">"terraform.tfvars"</span>

<span class="c"># ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ê´€ë¦¬</span>
terraform workspace new staging
terraform workspace <span class="k">select </span>production
terraform workspace list
</code></pre></div></div>

<h4 id="ê³ ê¸‰-terraform-ê¸°ëŠ¥">ê³ ê¸‰ Terraform ê¸°ëŠ¥</h4>
<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì¡°ê±´ë¶€ ë¦¬ì†ŒìŠ¤ ìƒì„±</span>
<span class="nx">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"web"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">environment</span> <span class="o">==</span> <span class="s2">"production"</span> <span class="o">?</span> <span class="mi">3</span> <span class="o">:</span> <span class="mi">1</span>
  
  <span class="nx">ami</span>           <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">aws_ami</span><span class="p">.</span><span class="nx">amazon_linux</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">instance_type</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">environment</span> <span class="o">==</span> <span class="s2">"production"</span> <span class="o">?</span> <span class="s2">"t3.medium"</span> <span class="o">:</span> <span class="s2">"t3.micro"</span>
  
  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${var.name_prefix}-web-${count.index + 1}"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># ë™ì  ë¸”ë¡</span>
<span class="nx">resource</span> <span class="s2">"aws_security_group"</span> <span class="s2">"web"</span> <span class="p">{</span>
  <span class="nx">name_prefix</span> <span class="o">=</span> <span class="s2">"${var.name_prefix}-web-"</span>
  <span class="nx">vpc_id</span>      <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">vpc_id</span>

  <span class="nx">dynamic</span> <span class="s2">"ingress"</span> <span class="p">{</span>
    <span class="nx">for_each</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">ingress_rules</span>
    <span class="nx">content</span> <span class="p">{</span>
      <span class="nx">from_port</span>   <span class="o">=</span> <span class="nx">ingress</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">from_port</span>
      <span class="nx">to_port</span>     <span class="o">=</span> <span class="nx">ingress</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">to_port</span>
      <span class="nx">protocol</span>    <span class="o">=</span> <span class="nx">ingress</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">protocol</span>
      <span class="nx">cidr_blocks</span> <span class="o">=</span> <span class="nx">ingress</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">cidr_blocks</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># ë°ì´í„° ì†ŒìŠ¤ í™œìš©</span>
<span class="nx">data</span> <span class="s2">"aws_ami"</span> <span class="s2">"amazon_linux"</span> <span class="p">{</span>
  <span class="nx">most_recent</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="nx">owners</span>      <span class="o">=</span> <span class="p">[</span><span class="s2">"amazon"</span><span class="p">]</span>

  <span class="nx">filter</span> <span class="p">{</span>
    <span class="nx">name</span>   <span class="o">=</span> <span class="s2">"name"</span>
    <span class="nx">values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"amzn2-ami-hvm-*-x86_64-gp2"</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># ì›ê²© ìƒíƒœ ì°¸ì¡°</span>
<span class="nx">data</span> <span class="s2">"terraform_remote_state"</span> <span class="s2">"vpc"</span> <span class="p">{</span>
  <span class="nx">backend</span> <span class="o">=</span> <span class="s2">"s3"</span>
  <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">bucket</span> <span class="o">=</span> <span class="s2">"company-terraform-state"</span>
    <span class="nx">key</span>    <span class="o">=</span> <span class="s2">"network/production/terraform.tfstate"</span>
    <span class="nx">region</span> <span class="o">=</span> <span class="s2">"us-west-2"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="2-4-ë‹¨ì¼-ì¥ì• -ì§€ì -ì œê±°--eliminating-single-points-of-failure">2-4 ë‹¨ì¼ ì¥ì•  ì§€ì  ì œê±° | Eliminating Single Points of Failure</h2>

<h3 id="2-4-1-spof-ì°¾ê¸°--identifying-spof">2-4-1 SPOF ì°¾ê¸° | Identifying SPOF</h3>

<p>ë‹¨ì¼ ì¥ì•  ì§€ì (SPOF)ì€ ì‹œìŠ¤í…œì˜ í•œ êµ¬ì„± ìš”ì†Œê°€ ì‹¤íŒ¨í•  ë•Œ ì „ì²´ ì‹œìŠ¤í…œì´ ì‘ë™ì„ ë©ˆì¶”ê²Œ ë˜ëŠ” ì§€ì ì„ ë§í•©ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì¸í”„ë¼ì—ì„œ SPOFë¥¼ ì‹ë³„í•˜ê³  ì œê±°í•˜ëŠ” ê²ƒì€ ê³ ê°€ìš©ì„± í™•ë³´ì˜ í•µì‹¬ì…ë‹ˆë‹¤.</p>

<h4 id="-spof-ì‹ë³„-ë°©ë²•ë¡ ">ğŸ” SPOF ì‹ë³„ ë°©ë²•ë¡ </h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># SPOF ë¶„ì„ ì²´í¬ë¦¬ìŠ¤íŠ¸</span>
1. ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€ ë¶„ì„
   - ë‹¨ì¼ ì—°ê²°ì  í™•ì¸
   - ë°±ì—… ê²½ë¡œ ì¡´ì¬ ì—¬ë¶€
   - ëŒ€ì—­í­ ë³‘ëª© ì§€ì 

2. í•˜ë“œì›¨ì–´ êµ¬ì„± ìš”ì†Œ ì ê²€
   - ë‹¨ì¼ ìŠ¤ìœ„ì¹˜/ë¼ìš°í„° ì˜ì¡´ì„±
   - ì „ì› ê³µê¸‰ ì¥ì¹˜
   - ì¼€ì´ë¸”ë§ ê²½ë¡œ

3. ì„œë¹„ìŠ¤ ì˜ì¡´ì„± ë¶„ì„
   - DNS ì„œë²„
   - DHCP ì„œë²„  
   - ì¸ì¦ ì„œë²„ <span class="o">(</span>RADIUS/LDAP<span class="o">)</span>

4. ì™¸ë¶€ ì—°ê²° ê²€í† 
   - ISP ì—°ê²°
   - WAN íšŒì„ 
   - í´ë¼ìš°ë“œ ì—°ê²°
</code></pre></div></div>

<h4 id="ë„¤íŠ¸ì›Œí¬-í† í´ë¡œì§€-spof-ë¶„ì„">ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€ SPOF ë¶„ì„</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í˜„ì¬ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸</span>
<span class="c"># Linux í™˜ê²½ì—ì„œ ë„¤íŠ¸ì›Œí¬ ê²½ë¡œ ë¶„ì„</span>
ip route show table main
traceroute <span class="nt">-n</span> 8.8.8.8
mtr <span class="nt">--report</span> <span class="nt">--report-cycles</span><span class="o">=</span>100 google.com

<span class="c"># ë¼ìš°íŒ… í…Œì´ë¸” ë¶„ì„</span>
netstat <span class="nt">-rn</span>
route <span class="nt">-n</span>

<span class="c"># ì¸í„°í˜ì´ìŠ¤ ìƒíƒœ í™•ì¸</span>
ip <span class="nb">link </span>show
ip addr show
ethtool eth0  <span class="c"># ë§í¬ ìƒíƒœ, ì†ë„ í™•ì¸</span>

<span class="c"># Cisco ì¥ë¹„ì—ì„œ SPOF ë¶„ì„</span>
show ip route
show interface summary  
show spanning-tree root
show etherchannel summary
show redundancy

<span class="c"># ëŒ€ì—­í­ ì‚¬ìš©ë¥  ëª¨ë‹ˆí„°ë§</span>
show interface fastethernet 0/1 | include rate
show processes cpu sorted
show memory summary
</code></pre></div></div>

<h4 id="ì¼ë°˜ì ì¸-ë„¤íŠ¸ì›Œí¬-spof-íŒ¨í„´">ì¼ë°˜ì ì¸ ë„¤íŠ¸ì›Œí¬ SPOF íŒ¨í„´</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1. ë‹¨ì¼ ì—…ë§í¬ (Single Uplink)</span>
ë¬¸ì œ: í•˜ë‚˜ì˜ ì—…ìŠ¤íŠ¸ë¦¼ ì—°ê²°ë§Œ ì¡´ì¬
ì˜í–¥: í•´ë‹¹ ì—°ê²° ì‹¤íŒ¨ ì‹œ ì „ì²´ ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ
í•´ê²°: ì´ì¤‘ ì—…ë§í¬ + ë¡œë“œë°¸ëŸ°ì‹±

<span class="c"># 2. ë‹¨ì¼ ì½”ì–´ ìŠ¤ìœ„ì¹˜ (Single Core Switch)  </span>
ë¬¸ì œ: ëª¨ë“  ì•¡ì„¸ìŠ¤ ìŠ¤ìœ„ì¹˜ê°€ í•˜ë‚˜ì˜ ì½”ì–´ì— ì—°ê²°
ì˜í–¥: ì½”ì–´ ìŠ¤ìœ„ì¹˜ ì‹¤íŒ¨ ì‹œ ì „ì²´ ë„¤íŠ¸ì›Œí¬ ë§ˆë¹„
í•´ê²°: ì´ì¤‘ ì½”ì–´ ìŠ¤ìœ„ì¹˜ + HSRP/VRRP

<span class="c"># 3. ë‹¨ì¼ VLAN (Single VLAN)</span>
ë¬¸ì œ: ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë„ë©”ì¸ ê³¼ë¶€í•˜
ì˜í–¥: ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ ì €í•˜, ì¥ì•  ì „íŒŒ
í•´ê²°: VLAN ë¶„í•  + Inter-VLAN ë¼ìš°íŒ…

<span class="c"># 4. ë‹¨ì¼ ISP (Single ISP)</span>
ë¬¸ì œ: í•˜ë‚˜ì˜ ì¸í„°ë„· ì„œë¹„ìŠ¤ ì œê³µì—…ì²´
ì˜í–¥: ISP ì¥ì•  ì‹œ ì¸í„°ë„· ì—°ê²° ë¶ˆê°€
í•´ê²°: ë©€í‹° ISP + BGP ë¼ìš°íŒ…
</code></pre></div></div>

<h4 id="spof-íƒì§€-ë„êµ¬ì™€-ìŠ¤í¬ë¦½íŠ¸">SPOF íƒì§€ ë„êµ¬ì™€ ìŠ¤í¬ë¦½íŠ¸</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
# spof_detector.py - ë„¤íŠ¸ì›Œí¬ SPOF íƒì§€ ë„êµ¬
</span>
<span class="kn">import</span> <span class="n">subprocess</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">sys</span>
<span class="kn">from</span> <span class="n">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">import</span> <span class="n">networkx</span> <span class="k">as</span> <span class="n">nx</span>

<span class="k">class</span> <span class="nc">SPOFDetector</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">network_graph</span> <span class="o">=</span> <span class="n">nx</span><span class="p">.</span><span class="nc">Graph</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">links</span> <span class="o">=</span> <span class="p">{}</span>
        
    <span class="k">def</span> <span class="nf">scan_network_topology</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">network_range</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€ ìŠ¤ìº”</span><span class="sh">"""</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Scanning network range: </span><span class="si">{</span><span class="n">network_range</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># SNMPì„ í†µí•œ ë„¤íŠ¸ì›Œí¬ ë””ìŠ¤ì»¤ë²„ë¦¬
</span>        <span class="n">devices</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">discover_devices</span><span class="p">(</span><span class="n">network_range</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">analyze_device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">identify_spof</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">discover_devices</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">network_range</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">SNMPë¥¼ í†µí•œ ë„¤íŠ¸ì›Œí¬ ì¥ë¹„ ë°œê²¬</span><span class="sh">"""</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">nmap -sn </span><span class="si">{</span><span class="n">network_range</span><span class="si">}</span><span class="sh">"</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="nf">split</span><span class="p">(),</span> <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="n">devices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">):</span>
            <span class="k">if</span> <span class="sh">'</span><span class="s">Nmap scan report</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">ip</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="nf">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">devices</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">devices</span>
    
    <span class="k">def</span> <span class="nf">analyze_device</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">device_ip</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ê°œë³„ ì¥ë¹„ ë¶„ì„</span><span class="sh">"""</span>
        <span class="n">device_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">ip</span><span class="sh">'</span><span class="p">:</span> <span class="n">device_ip</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">detect_device_type</span><span class="p">(</span><span class="n">device_ip</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">interfaces</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_interfaces</span><span class="p">(</span><span class="n">device_ip</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">neighbors</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_neighbors</span><span class="p">(</span><span class="n">device_ip</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">redundancy</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">check_redundancy</span><span class="p">(</span><span class="n">device_ip</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">devices</span><span class="p">[</span><span class="n">device_ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_info</span>
        <span class="n">self</span><span class="p">.</span><span class="n">network_graph</span><span class="p">.</span><span class="nf">add_node</span><span class="p">(</span><span class="n">device_ip</span><span class="p">,</span> <span class="o">**</span><span class="n">device_info</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">detect_device_type</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">device_ip</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì¥ë¹„ ìœ í˜• ê°ì§€ (ë¼ìš°í„°/ìŠ¤ìœ„ì¹˜/ë°©í™”ë²½)</span><span class="sh">"""</span>
        <span class="c1"># SNMP OIDë¥¼ í†µí•œ ì¥ë¹„ ìœ í˜• í™•ì¸
</span>        <span class="n">snmp_cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">snmpget -v2c -c public </span><span class="si">{</span><span class="n">device_ip</span><span class="si">}</span><span class="s"> 1.3.6.1.2.1.1.1.0</span><span class="sh">"</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">snmp_cmd</span><span class="p">.</span><span class="nf">split</span><span class="p">(),</span> <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="sh">'</span><span class="s">cisco</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">result</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="nf">lower</span><span class="p">():</span>
            <span class="k">if</span> <span class="sh">'</span><span class="s">router</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">result</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="nf">lower</span><span class="p">():</span>
                <span class="k">return</span> <span class="sh">'</span><span class="s">router</span><span class="sh">'</span>
            <span class="k">elif</span> <span class="sh">'</span><span class="s">switch</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">result</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="nf">lower</span><span class="p">():</span>
                <span class="k">return</span> <span class="sh">'</span><span class="s">switch</span><span class="sh">'</span>
        
        <span class="k">return</span> <span class="sh">'</span><span class="s">unknown</span><span class="sh">'</span>
    
    <span class="k">def</span> <span class="nf">get_interfaces</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">device_ip</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì¸í„°í˜ì´ìŠ¤ ì •ë³´ ìˆ˜ì§‘</span><span class="sh">"""</span>
        <span class="c1"># SNMPë¥¼ í†µí•œ ì¸í„°í˜ì´ìŠ¤ ìƒíƒœ í™•ì¸
</span>        <span class="n">interfaces</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># ì¸í„°í˜ì´ìŠ¤ ì´ë¦„ (1.3.6.1.2.1.2.2.1.2)
</span>        <span class="c1"># ì¸í„°í˜ì´ìŠ¤ ìƒíƒœ (1.3.6.1.2.1.2.2.1.8)
</span>        <span class="c1"># ì¸í„°í˜ì´ìŠ¤ ì†ë„ (1.3.6.1.2.1.2.2.1.5)
</span>        
        <span class="k">return</span> <span class="n">interfaces</span>
    
    <span class="k">def</span> <span class="nf">get_neighbors</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">device_ip</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì¸ì ‘ ì¥ë¹„ ì •ë³´ ìˆ˜ì§‘ (CDP/LLDP)</span><span class="sh">"""</span>
        <span class="n">neighbors</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># CDP ì •ë³´ ìˆ˜ì§‘ (1.3.6.1.4.1.9.9.23.1.2.1.1.6)
</span>        <span class="c1"># LLDP ì •ë³´ ìˆ˜ì§‘ (1.0.8802.1.1.2.1.4.1.1.9)
</span>        
        <span class="k">return</span> <span class="n">neighbors</span>
    
    <span class="k">def</span> <span class="nf">check_redundancy</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">device_ip</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì´ì¤‘í™” êµ¬ì„± í™•ì¸</span><span class="sh">"""</span>
        <span class="n">redundancy_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">power_supplies</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">check_power_supplies</span><span class="p">(</span><span class="n">device_ip</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">uplinks</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">check_uplinks</span><span class="p">(</span><span class="n">device_ip</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">protocols</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">check_redundancy_protocols</span><span class="p">(</span><span class="n">device_ip</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">redundancy_info</span>
    
    <span class="k">def</span> <span class="nf">identify_spof</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">SPOF ì‹ë³„</span><span class="sh">"""</span>
        <span class="n">spof_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># 1. ì—°ê²°ì„± ë¶„ì„ - ë‹¨ì¼ ì—°ê²°ì  ì°¾ê¸°
</span>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">network_graph</span><span class="p">.</span><span class="nf">nodes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">network_graph</span><span class="p">.</span><span class="nf">degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">spof_list</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">single_connection</span><span class="sh">'</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">device</span><span class="sh">'</span><span class="p">:</span> <span class="n">node</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">risk</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">description</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">Device </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s"> has only one connection</span><span class="sh">'</span>
                <span class="p">})</span>
        
        <span class="c1"># 2. ë¸Œë¦¬ì§€ í¬ì¸íŠ¸ ë¶„ì„
</span>        <span class="n">bridges</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">nx</span><span class="p">.</span><span class="nf">bridges</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">network_graph</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">bridge</span> <span class="ow">in</span> <span class="n">bridges</span><span class="p">:</span>
            <span class="n">spof_list</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">bridge_link</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">link</span><span class="sh">'</span><span class="p">:</span> <span class="n">bridge</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">risk</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">critical</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">description</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">Link between </span><span class="si">{</span><span class="n">bridge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s"> and </span><span class="si">{</span><span class="n">bridge</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s"> is critical</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="c1"># 3. ì ˆë‹¨ì  ë¶„ì„ (Articulation Points)
</span>        <span class="n">articulation_points</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">nx</span><span class="p">.</span><span class="nf">articulation_points</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">network_graph</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">articulation_points</span><span class="p">:</span>
            <span class="n">spof_list</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">articulation_point</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">device</span><span class="sh">'</span><span class="p">:</span> <span class="n">point</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">risk</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">critical</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">description</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">Device </span><span class="si">{</span><span class="n">point</span><span class="si">}</span><span class="s"> is a critical junction point</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">spof_list</span>
    
    <span class="k">def</span> <span class="nf">generate_report</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spof_list</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">SPOF ë¶„ì„ ë³´ê³ ì„œ ìƒì„±</span><span class="sh">"""</span>
        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">subprocess</span><span class="p">.</span><span class="nf">run</span><span class="p">([</span><span class="sh">'</span><span class="s">date</span><span class="sh">'</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">stdout</span><span class="p">.</span><span class="nf">strip</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">total_devices</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">devices</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">total_spof_issues</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">spof_list</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">critical_issues</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">([</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">spof_list</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="sh">'</span><span class="s">risk</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">critical</span><span class="sh">'</span><span class="p">]),</span>
            <span class="sh">'</span><span class="s">high_issues</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">([</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">spof_list</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="sh">'</span><span class="s">risk</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">]),</span>
            <span class="sh">'</span><span class="s">spof_details</span><span class="sh">'</span><span class="p">:</span> <span class="n">spof_list</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">generate_recommendations</span><span class="p">(</span><span class="n">spof_list</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">report</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Usage: python3 spof_detector.py &lt;network_range&gt;</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Example: python3 spof_detector.py 192.168.1.0/24</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">network_range</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">detector</span> <span class="o">=</span> <span class="nc">SPOFDetector</span><span class="p">()</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Starting SPOF detection...</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">spof_list</span> <span class="o">=</span> <span class="n">detector</span><span class="p">.</span><span class="nf">scan_network_topology</span><span class="p">(</span><span class="n">network_range</span><span class="p">)</span>
    
    <span class="n">report</span> <span class="o">=</span> <span class="n">detector</span><span class="p">.</span><span class="nf">generate_report</span><span class="p">(</span><span class="n">spof_list</span><span class="p">)</span>
    
    <span class="c1"># JSON í˜•íƒœë¡œ ê²°ê³¼ ì¶œë ¥
</span>    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># ìš”ì•½ ì¶œë ¥
</span>    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== SPOF Detection Summary ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Total devices scanned: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="sh">'</span><span class="s">total_devices</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">SPOF issues found: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="sh">'</span><span class="s">total_spof_issues</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Critical issues: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="sh">'</span><span class="s">critical_issues</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">High risk issues: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="sh">'</span><span class="s">high_issues</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</code></pre></div></div>

<h4 id="ansibleì„-ì´ìš©í•œ-spof-ì ê²€-ìë™í™”">Ansibleì„ ì´ìš©í•œ SPOF ì ê²€ ìë™í™”</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="c1"># spof_check.yml - SPOF ì ê²€ í”Œë ˆì´ë¶</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Network SPOF Assessment</span>
  <span class="na">hosts</span><span class="pi">:</span> <span class="s">network_devices</span>
  <span class="na">gather_facts</span><span class="pi">:</span> <span class="s">no</span>
  <span class="na">vars</span><span class="pi">:</span>
    <span class="na">spof_report</span><span class="pi">:</span> <span class="pi">[]</span>
    
  <span class="na">tasks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Check device redundancy status</span>
      <span class="na">ios_command</span><span class="pi">:</span>
        <span class="na">commands</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">show redundancy</span>
          <span class="pi">-</span> <span class="s">show environment power</span>
          <span class="pi">-</span> <span class="s">show interface summary</span>
          <span class="pi">-</span> <span class="s">show spanning-tree root</span>
          <span class="pi">-</span> <span class="s">show etherchannel summary</span>
      <span class="na">register</span><span class="pi">:</span> <span class="s">device_status</span>
      
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Analyze redundancy configuration</span>
      <span class="na">set_fact</span><span class="pi">:</span>
        <span class="na">redundancy_analysis</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Check for single uplinks</span>
      <span class="na">ios_command</span><span class="pi">:</span>
        <span class="na">commands</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">show cdp neighbors</span>
          <span class="pi">-</span> <span class="s">show interface trunk</span>
      <span class="na">register</span><span class="pi">:</span> <span class="s">uplink_status</span>
      
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Identify SPOF risks</span>
      <span class="na">set_fact</span><span class="pi">:</span>
        <span class="na">spof_risks</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">loop</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">Single</span><span class="nv"> </span><span class="s">uplink</span><span class="nv"> </span><span class="s">detected"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">No</span><span class="nv"> </span><span class="s">redundant</span><span class="nv"> </span><span class="s">power"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">No</span><span class="nv"> </span><span class="s">EtherChannel"</span>
      <span class="na">vars</span><span class="pi">:</span>
        <span class="na">uplink_count</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">power_supplies</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">etherchannel_count</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Generate SPOF report</span>
      <span class="na">template</span><span class="pi">:</span>
        <span class="na">src</span><span class="pi">:</span> <span class="s">spof_report.j2</span>
        <span class="na">dest</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/tmp/spof_report_.html"</span>
      <span class="na">vars</span><span class="pi">:</span>
        <span class="na">device_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">check_date</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Send SPOF alert if critical issues found</span>
      <span class="na">mail</span><span class="pi">:</span>
        <span class="na">to</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">subject</span><span class="pi">:</span> <span class="s2">"</span><span class="s">CRITICAL:</span><span class="nv"> </span><span class="s">SPOF</span><span class="nv"> </span><span class="s">detected</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">"</span>
        <span class="na">body</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Critical</span><span class="nv"> </span><span class="s">single</span><span class="nv"> </span><span class="s">points</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">failure</span><span class="nv"> </span><span class="s">detected.</span><span class="nv"> </span><span class="s">See</span><span class="nv"> </span><span class="s">attached</span><span class="nv"> </span><span class="s">report."</span>
        <span class="na">attach</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/tmp/spof_report_.html"</span>
      <span class="na">when</span><span class="pi">:</span> <span class="s2">"</span><span class="s">'Single</span><span class="nv"> </span><span class="s">uplink</span><span class="nv"> </span><span class="s">detected'</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">spof_risks</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">'No</span><span class="nv"> </span><span class="s">redundant</span><span class="nv"> </span><span class="s">power'</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">spof_risks"</span>
</code></pre></div></div>

<h4 id="ë„¤íŠ¸ì›Œí¬-í† í´ë¡œì§€-ì‹œê°í™”">ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€ ì‹œê°í™”</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Graphvizë¥¼ ì´ìš©í•œ ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€ ìƒì„±</span>
<span class="c">#!/bin/bash</span>
<span class="c"># generate_network_topology.sh</span>

<span class="c"># SNMPë¥¼ í†µí•œ ë„¤íŠ¸ì›Œí¬ ë§µ ìƒì„±</span>
generate_dot_file<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">"digraph network {"</span> <span class="o">&gt;</span> network.dot
    <span class="nb">echo</span> <span class="s2">"  rankdir=TB;"</span> <span class="o">&gt;&gt;</span> network.dot
    <span class="nb">echo</span> <span class="s2">"  node [shape=box];"</span> <span class="o">&gt;&gt;</span> network.dot
    
    <span class="c"># ê° ì¥ë¹„ ì •ë³´ ìˆ˜ì§‘</span>
    <span class="k">for </span>ip <span class="k">in</span> <span class="si">$(</span>nmap <span class="nt">-sn</span> 192.168.1.0/24 | <span class="nb">grep</span> <span class="s2">"Nmap scan report"</span> | <span class="nb">awk</span> <span class="s1">'{print $5}'</span><span class="si">)</span><span class="p">;</span> <span class="k">do
        </span><span class="nv">device_name</span><span class="o">=</span><span class="si">$(</span>snmpget <span class="nt">-v2c</span> <span class="nt">-c</span> public <span class="nv">$ip</span> 1.3.6.1.2.1.1.5.0 2&gt;/dev/null | <span class="nb">cut</span> <span class="nt">-d</span><span class="s1">'"'</span> <span class="nt">-f2</span><span class="si">)</span>
        <span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$device_name</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"  </span><span class="se">\"</span><span class="nv">$device_name</span><span class="se">\"</span><span class="s2"> [label=</span><span class="se">\"</span><span class="nv">$device_name</span><span class="se">\\</span><span class="s2">n</span><span class="nv">$ip</span><span class="se">\"</span><span class="s2">];"</span> <span class="o">&gt;&gt;</span> network.dot
            
            <span class="c"># CDP ì •ë³´ë¡œ ì—°ê²° ê´€ê³„ í™•ì¸</span>
            <span class="nv">cdp_neighbors</span><span class="o">=</span><span class="si">$(</span>snmpwalk <span class="nt">-v2c</span> <span class="nt">-c</span> public <span class="nv">$ip</span> 1.3.6.1.4.1.9.9.23.1.2.1.1.6 2&gt;/dev/null<span class="si">)</span>
            <span class="k">while </span><span class="nb">read</span> <span class="nt">-r</span> neighbor<span class="p">;</span> <span class="k">do
                </span><span class="nv">neighbor_name</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$neighbor</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="s1">'"'</span> <span class="nt">-f2</span><span class="si">)</span>
                <span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$neighbor_name</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
                    </span><span class="nb">echo</span> <span class="s2">"  </span><span class="se">\"</span><span class="nv">$device_name</span><span class="se">\"</span><span class="s2"> -&gt; </span><span class="se">\"</span><span class="nv">$neighbor_name</span><span class="se">\"</span><span class="s2">;"</span> <span class="o">&gt;&gt;</span> network.dot
                <span class="k">fi
            done</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$cdp_neighbors</span><span class="s2">"</span>
        <span class="k">fi
    done
    
    </span><span class="nb">echo</span> <span class="s2">"}"</span> <span class="o">&gt;&gt;</span> network.dot
<span class="o">}</span>

<span class="c"># DOT íŒŒì¼ì„ ì´ë¯¸ì§€ë¡œ ë³€í™˜</span>
generate_dot_file
dot <span class="nt">-Tpng</span> network.dot <span class="nt">-o</span> network_topology.png
dot <span class="nt">-Tsvg</span> network.dot <span class="nt">-o</span> network_topology.svg

<span class="nb">echo</span> <span class="s2">"Network topology generated: network_topology.png"</span>

<span class="c"># SPOF í•˜ì´ë¼ì´íŠ¸ ë²„ì „ ìƒì„±</span>
<span class="nb">sed</span> <span class="s1">'s/node \[shape=box\];/node [shape=box]; edge [color=red, penwidth=3];/'</span> network.dot <span class="o">&gt;</span> network_spof.dot
dot <span class="nt">-Tpng</span> network_spof.dot <span class="nt">-o</span> network_spof.png

<span class="nb">echo</span> <span class="s2">"SPOF highlighted topology: network_spof.png"</span>
</code></pre></div></div>

<h4 id="ì‹¤ì‹œê°„-spof-ëª¨ë‹ˆí„°ë§">ì‹¤ì‹œê°„ SPOF ëª¨ë‹ˆí„°ë§</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># spof_monitor.py - ì‹¤ì‹œê°„ SPOF ëª¨ë‹ˆí„°ë§
</span><span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">threading</span>
<span class="kn">import</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="n">prometheus_client</span> <span class="kn">import</span> <span class="n">start_http_server</span><span class="p">,</span> <span class="n">Gauge</span><span class="p">,</span> <span class="n">Counter</span>

<span class="k">class</span> <span class="nc">SPOFMonitor</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spof_gauge</span> <span class="o">=</span> <span class="nc">Gauge</span><span class="p">(</span><span class="sh">'</span><span class="s">network_spof_count</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Number of detected SPOFs</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">link_status_gauge</span> <span class="o">=</span> <span class="nc">Gauge</span><span class="p">(</span><span class="sh">'</span><span class="s">network_link_status</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Link status</span><span class="sh">'</span><span class="p">,</span> <span class="p">[</span><span class="sh">'</span><span class="s">device</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">interface</span><span class="sh">'</span><span class="p">])</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spof_alert_counter</span> <span class="o">=</span> <span class="nc">Counter</span><span class="p">(</span><span class="sh">'</span><span class="s">network_spof_alerts_total</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Total SPOF alerts</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="n">logging</span><span class="p">.</span><span class="nf">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">monitor_links</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë§í¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§</span><span class="sh">"""</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">devices</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_monitored_devices</span><span class="p">()</span>
                
                <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
                    <span class="n">interfaces</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_device_interfaces</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
                    
                    <span class="k">for</span> <span class="n">interface</span> <span class="ow">in</span> <span class="n">interfaces</span><span class="p">:</span>
                        <span class="n">status</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">check_interface_status</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">interface</span><span class="p">)</span>
                        <span class="n">self</span><span class="p">.</span><span class="n">link_status_gauge</span><span class="p">.</span><span class="nf">labels</span><span class="p">(</span>
                            <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">],</span> 
                            <span class="n">interface</span><span class="o">=</span><span class="n">interface</span>
                        <span class="p">).</span><span class="nf">set</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="sh">'</span><span class="s">up</span><span class="sh">'</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
                        
                        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="sh">'</span><span class="s">down</span><span class="sh">'</span><span class="p">:</span>
                            <span class="n">self</span><span class="p">.</span><span class="nf">check_spof_impact</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">interface</span><span class="p">)</span>
                
                <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>  <span class="c1"># 30ì´ˆë§ˆë‹¤ ì²´í¬
</span>                
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Monitoring error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">check_spof_impact</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">failed_interface</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì¥ì•  ë°œìƒ ì‹œ SPOF ì˜í–¥ ë¶„ì„</span><span class="sh">"""</span>
        <span class="n">remaining_paths</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">calculate_remaining_paths</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">failed_interface</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">remaining_paths</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="nf">critical</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">SPOF ALERT: </span><span class="si">{</span><span class="n">device</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">failed_interface</span><span class="si">}</span><span class="s"> failure causes network partition</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">spof_alert_counter</span><span class="p">.</span><span class="nf">inc</span><span class="p">()</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">send_alert</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">failed_interface</span><span class="p">,</span> <span class="sh">'</span><span class="s">SPOF_CRITICAL</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">remaining_paths</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">SPOF WARNING: </span><span class="si">{</span><span class="n">device</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">failed_interface</span><span class="si">}</span><span class="s"> creates single path</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">send_alert</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">failed_interface</span><span class="p">,</span> <span class="sh">'</span><span class="s">SPOF_WARNING</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">start_monitoring</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ëª¨ë‹ˆí„°ë§ ì‹œì‘</span><span class="sh">"""</span>
        <span class="c1"># Prometheus ë©”íŠ¸ë¦­ ì„œë²„ ì‹œì‘
</span>        <span class="nf">start_http_server</span><span class="p">(</span><span class="mi">8000</span><span class="p">)</span>
        
        <span class="c1"># ë§í¬ ëª¨ë‹ˆí„°ë§ ì“°ë ˆë“œ ì‹œì‘
</span>        <span class="n">monitor_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">monitor_links</span><span class="p">)</span>
        <span class="n">monitor_thread</span><span class="p">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">monitor_thread</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">SPOF monitoring started on port 8000</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># ë©”ì¸ ë£¨í”„
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">KeyboardInterrupt</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Monitoring stopped</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">monitor</span> <span class="o">=</span> <span class="nc">SPOFMonitor</span><span class="p">()</span>
    <span class="n">monitor</span><span class="p">.</span><span class="nf">start_monitoring</span><span class="p">()</span>
</code></pre></div></div>

<h4 id="spof-ì œê±°-ìš°ì„ ìˆœìœ„-ë§¤íŠ¸ë¦­ìŠ¤">SPOF ì œê±° ìš°ì„ ìˆœìœ„ ë§¤íŠ¸ë¦­ìŠ¤</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># SPOF ìœ„í—˜ë„ í‰ê°€ ë§¤íŠ¸ë¦­ìŠ¤</span>
ìœ„í—˜ë„ <span class="o">=</span> <span class="o">(</span>ì˜í–¥ë„ Ã— ë°œìƒê°€ëŠ¥ì„±<span class="o">)</span> / ëŒ€ì‘ì‹œê°„

ì˜í–¥ë„ ì ìˆ˜:
- ì „ì²´ ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ: 10
- ë¶€ë¶„ ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ: 7  
- ì„±ëŠ¥ ì €í•˜: 4
- ì¼ë¶€ ì„œë¹„ìŠ¤ ì˜í–¥: 2

ë°œìƒê°€ëŠ¥ì„± ì ìˆ˜:
- ë§¤ìš° ë†’ìŒ <span class="o">(</span>ì›” 1íšŒ ì´ìƒ<span class="o">)</span>: 10
- ë†’ìŒ <span class="o">(</span>ë¶„ê¸° 1íšŒ<span class="o">)</span>: 7
- ë³´í†µ <span class="o">(</span>ì—° 2-3íšŒ<span class="o">)</span>: 4  
- ë‚®ìŒ <span class="o">(</span>ì—° 1íšŒ ì´í•˜<span class="o">)</span>: 2

ëŒ€ì‘ì‹œê°„ ì ìˆ˜:
- 4ì‹œê°„ ì´ìƒ: 1
- 2-4ì‹œê°„: 2
- 1-2ì‹œê°„: 4
- 1ì‹œê°„ ì´í•˜: 7

<span class="c"># ìš°ì„ ìˆœìœ„ ê²°ì •</span>
ìš°ì„ ìˆœìœ„ 1 <span class="o">(</span>ì¦‰ì‹œ<span class="o">)</span>: ìœ„í—˜ë„ <span class="o">&gt;</span> 35
ìš°ì„ ìˆœìœ„ 2 <span class="o">(</span>1ê°œì›”<span class="o">)</span>: ìœ„í—˜ë„ 20-35
ìš°ì„ ìˆœìœ„ 3 <span class="o">(</span>3ê°œì›”<span class="o">)</span>: ìœ„í—˜ë„ 10-20  
ìš°ì„ ìˆœìœ„ 4 <span class="o">(</span>1ë…„<span class="o">)</span>: ìœ„í—˜ë„ &lt; 10
</code></pre></div></div>]]></content><author><name>DevOps Engineer</name></author><category term="Networking" /><category term="Routing-Switching" /><category term="routing" /><category term="switching" /><category term="vlan" /><category term="stp" /><category term="ospf" /><category term="bgp" /><category term="vxlan" /><category term="network-protocols" /><summary type="html"><![CDATA[ë„¤íŠ¸ì›Œí¬ì˜ í•µì‹¬ì¸ ë¼ìš°íŒ…ê³¼ ìŠ¤ìœ„ì¹­ ê¸°ìˆ ì„ ì‹¬í™” í•™ìŠµí•˜ì—¬ ëŒ€ê·œëª¨ ë„¤íŠ¸ì›Œí¬ ìš´ì˜ ëŠ¥ë ¥ì„ ê°–ì¶°ë³´ê² ìŠµë‹ˆë‹¤. ë¼ìš°íŒ… í”„ë¡œí† ì½œ | Routing Protocols ğŸ—ºï¸ ë¼ìš°íŒ… ê¸°ë³¸ ê°œë… ë¼ìš°íŒ…ì€ íŒ¨í‚·ì´ ëª©ì ì§€ê¹Œì§€ ê°€ëŠ” ìµœì ì˜ ê²½ë¡œë¥¼ ì°¾ëŠ” ê³¼ì •ì…ë‹ˆë‹¤. # ë¼ìš°íŒ… í…Œì´ë¸” êµ¬ì„± ìš”ì†Œ ëª©ì ì§€ ë„¤íŠ¸ì›Œí¬ | ì„œë¸Œë„· ë§ˆìŠ¤í¬ | ê²Œì´íŠ¸ì›¨ì´ | ì¸í„°í˜ì´ìŠ¤ | ë©”íŠ¸ë¦­ 192.168.1.0 | /24 | ì§ì ‘ì—°ê²° | eth0 | 0 10.0.0.0 | /8 | 192.168.1.1| eth0 | 1 0.0.0.0 | /0 | 192.168.1.1| eth0 | 1 (ê¸°ë³¸ê²½ë¡œ) ğŸ“Š ë¼ìš°íŒ… í”„ë¡œí† ì½œ ë¶„ë¥˜ Distance Vector vs Link State Distance Vector (ê±°ë¦¬ ë²¡í„°): - RIP (Routing Information Protocol) - ë²¨ë§Œ-í¬ë“œ ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš© - í™‰ ì¹´ìš´íŠ¸ ê¸°ë°˜ ë©”íŠ¸ë¦­ - ë‹¨ìˆœí•˜ì§€ë§Œ ìˆ˜ë ´ ì†ë„ ëŠë¦¼ Link State (ë§í¬ ìƒíƒœ): - OSPF (Open Shortest Path First) - ë‹¤ìµìŠ¤íŠ¸ë¼ ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš© - ëŒ€ì—­í­ ê¸°ë°˜ ë©”íŠ¸ë¦­ - ë¹ ë¥¸ ìˆ˜ë ´, í™•ì¥ì„± ì¢‹ìŒ IGP vs EGP IGP (Interior Gateway Protocol): - ê°™ì€ ììœ¨ ì‹œìŠ¤í…œ(AS) ë‚´ë¶€ - RIP, OSPF, EIGRP EGP (Exterior Gateway Protocol): - ì„œë¡œ ë‹¤ë¥¸ AS ê°„ - BGP (Border Gateway Protocol) ğŸ”„ RIP (Routing Information Protocol) # Cisco ë¼ìš°í„° RIP ì„¤ì • Router(config)# router rip Router(config-router)# version 2 Router(config-router)# network 192.168.1.0 Router(config-router)# network 10.0.0.0 Router(config-router)# no auto-summary Router(config-router)# passive-interface fastethernet 0/0 # Linux Quagga/FRR RIP ì„¤ì • router rip version 2 network 192.168.1.0/24 network 10.0.0.0/8 redistribute connected redistribute static # RIP ì •ë³´ í™•ì¸ show ip route rip show ip rip database debug ip rip RIPì˜ íŠ¹ì§•ê³¼ í•œê³„ ì¥ì : - êµ¬ì„±ì´ ê°„ë‹¨í•¨ - ì†Œê·œëª¨ ë„¤íŠ¸ì›Œí¬ì— ì í•© - í‘œì¤€ í”„ë¡œí† ì½œ ë‹¨ì : - í™‰ ì¹´ìš´íŠ¸ ì œí•œ (15í™‰) - ëŠë¦° ìˆ˜ë ´ ì†ë„ - ëŒ€ì—­í­ ê³ ë ¤í•˜ì§€ ì•ŠìŒ - ë£¨í”„ ë°©ì§€ ë©”ì»¤ë‹ˆì¦˜ ì œí•œì  ğŸŒ OSPF (Open Shortest Path First) OSPFëŠ” ëŒ€ê·œëª¨ ë„¤íŠ¸ì›Œí¬ì—ì„œ ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ë§í¬ ìƒíƒœ ë¼ìš°íŒ… í”„ë¡œí† ì½œì…ë‹ˆë‹¤. OSPF ê¸°ë³¸ ê°œë… # OSPF ìš©ì–´ Area: ë¼ìš°í„°ë“¤ì˜ ë…¼ë¦¬ì  ê·¸ë£¹ ABR (Area Border Router): Area ê²½ê³„ ë¼ìš°í„° ASBR (Autonomous System Boundary Router): AS ê²½ê³„ ë¼ìš°í„° DR (Designated Router): ëŒ€í‘œ ë¼ìš°í„° BDR (Backup Designated Router): ë°±ì—… ëŒ€í‘œ ë¼ìš°í„° # LSA (Link State Advertisement) ìœ í˜• LSA Type 1: Router LSA (ë¼ìš°í„° ì •ë³´) LSA Type 2: Network LSA (ë„¤íŠ¸ì›Œí¬ ì •ë³´) LSA Type 3: Summary LSA (Area ê°„ ìš”ì•½) LSA Type 4: ASBR Summary LSA LSA Type 5: External LSA (ì™¸ë¶€ ë¼ìš°íŠ¸) OSPF ì„¤ì • ì‹¤ìŠµ # Cisco ë¼ìš°í„° OSPF ì„¤ì • Router(config)# router ospf 1 Router(config-router)# router-id 1.1.1.1 Router(config-router)# network 192.168.1.0 0.0.0.255 area 0 Router(config-router)# network 10.0.0.0 0.255.255.255 area 1 Router(config-router)# area 1 stub # ì¸í„°í˜ì´ìŠ¤ë³„ OSPF ì„¤ì • Router(config)# interface fastethernet 0/0 Router(config-if)# ip ospf cost 100 Router(config-if)# ip ospf priority 255 Router(config-if)# ip ospf hello-interval 5 Router(config-if)# ip ospf dead-interval 20 # Linux FRR OSPF ì„¤ì • router ospf ospf router-id 1.1.1.1 network 192.168.1.0/24 area 0.0.0.0 network 10.0.0.0/8 area 0.0.0.1 area 0.0.0.1 stub # OSPF ì •ë³´ í™•ì¸ show ip ospf neighbor show ip ospf database show ip ospf interface show ip route ospf OSPF Area ì„¤ê³„ # Multi-Area OSPF ì„¤ê³„ ì˜ˆì‹œ Area 0 (Backbone): 10.0.0.0/24 â”œâ”€â”€ Area 1 (Sales): 10.1.0.0/16 â”œâ”€â”€ Area 2 (Engineering): 10.2.0.0/16 â””â”€â”€ Area 3 (Guest): 10.3.0.0/16 # Area ìœ í˜• Standard Area: ëª¨ë“  LSA í—ˆìš© Stub Area: Type 5 LSA ì°¨ë‹¨, ê¸°ë³¸ ê²½ë¡œ ì£¼ì… Totally Stub: Type 3,4,5 LSA ì°¨ë‹¨ NSSA: Type 5 LSAë¥¼ Type 7ë¡œ ë³€í™˜ ğŸŒ BGP (Border Gateway Protocol) BGPëŠ” ì¸í„°ë„·ì˜ ë¼ìš°íŒ…ì„ ë‹´ë‹¹í•˜ëŠ” ê²½ë¡œ ë²¡í„° í”„ë¡œí† ì½œì…ë‹ˆë‹¤. BGP ê¸°ë³¸ ê°œë… # BGP ì†ì„± AS-Path: AS ë²ˆí˜¸ ê²½ë¡œ Next-Hop: ë‹¤ìŒ í™‰ ì£¼ì†Œ Local Preference: ë¡œì»¬ ìš°ì„ ìˆœìœ„ (ë†’ì„ìˆ˜ë¡ ì„ í˜¸) MED: Multi-Exit Discriminator (ë‚®ì„ìˆ˜ë¡ ì„ í˜¸) Origin: ê²½ë¡œ ë°œìƒì§€ (IGP &gt; EGP &gt; Incomplete) Community: ë¼ìš°íŒ… ì •ì±… íƒœê·¸ BGP ì„¤ì • ì˜ˆì‹œ # Cisco ë¼ìš°í„° BGP ì„¤ì • Router(config)# router bgp 65001 Router(config-router)# bgp router-id 1.1.1.1 Router(config-router)# neighbor 203.0.113.1 remote-as 65002 Router(config-router)# neighbor 203.0.113.1 description "ISP-A Connection" Router(config-router)# network 192.168.0.0 mask 255.255.0.0 Router(config-router)# aggregate-address 192.168.0.0 255.255.0.0 summary-only # BGP ê²½ë¡œ ì •ì±… ì„¤ì • Router(config)# ip prefix-list ALLOW-CUSTOMERS seq 10 permit 192.168.0.0/16 le 24 Router(config)# route-map CUSTOMER-IN permit 10 Router(config-route-map)# match ip address prefix-list ALLOW-CUSTOMERS Router(config-route-map)# set local-preference 200 Router(config)# router bgp 65001 Router(config-router)# neighbor 203.0.113.1 route-map CUSTOMER-IN in # Linux FRR BGP ì„¤ì • router bgp 65001 bgp router-id 1.1.1.1 neighbor 203.0.113.1 remote-as 65002 neighbor 203.0.113.1 description ISP-A address-family ipv4 unicast network 192.168.0.0/16 neighbor 203.0.113.1 activate ìŠ¤ìœ„ì¹­ ê¸°ìˆ  | Switching Technology ğŸ”Œ ì´ë”ë„· ìŠ¤ìœ„ì¹­ ê¸°ë³¸ MAC ì£¼ì†Œ í•™ìŠµ ê³¼ì • # 1ë‹¨ê³„: MAC ì£¼ì†Œ í…Œì´ë¸”ì´ ë¹„ì–´ìˆìŒ Switch# show mac address-table Mac Address Table ------------------------------------------- Vlan Mac Address Type Ports ---- ----------- -------- ----- # 2ë‹¨ê³„: PC-A(00:11:22:33:44:AA)ì—ì„œ PC-Bë¡œ í”„ë ˆì„ ì „ì†¡ # ìŠ¤ìœ„ì¹˜ê°€ í¬íŠ¸ 1ì—ì„œ ìˆ˜ì‹ , MAC ì£¼ì†Œ í•™ìŠµ # 3ë‹¨ê³„: MAC ì£¼ì†Œ í…Œì´ë¸” ì—…ë°ì´íŠ¸ Switch# show mac address-table Mac Address Table ------------------------------------------- Vlan Mac Address Type Ports ---- ----------- -------- ----- 1 0011.2233.44aa DYNAMIC Fa0/1 # 4ë‹¨ê³„: ëª©ì ì§€ MAC ì£¼ì†Œë¥¼ ëª¨ë¥´ë¯€ë¡œ í”ŒëŸ¬ë”© # 5ë‹¨ê³„: PC-Bê°€ ì‘ë‹µí•˜ë©´ í¬íŠ¸ 2ì—ì„œ í•™ìŠµ ìŠ¤ìœ„ì¹˜ í¬íŠ¸ ì„¤ì • # ì•¡ì„¸ìŠ¤ í¬íŠ¸ ì„¤ì • (ë‹¨ì¼ VLAN) Switch(config)# interface fastethernet 0/1 Switch(config-if)# switchport mode access Switch(config-if)# switchport access vlan 10 Switch(config-if)# switchport port-security Switch(config-if)# switchport port-security maximum 2 Switch(config-if)# switchport port-security violation shutdown # íŠ¸ë í¬ í¬íŠ¸ ì„¤ì • (ë‹¤ì¤‘ VLAN) Switch(config)# interface fastethernet 0/24 Switch(config-if)# switchport mode trunk Switch(config-if)# switchport trunk encapsulation dot1q Switch(config-if)# switchport trunk allowed vlan 10,20,30 Switch(config-if)# switchport trunk native vlan 1 ğŸ·ï¸ VLAN (Virtual Local Area Network) VLANì€ ë¬¼ë¦¬ì  ìœ„ì¹˜ì™€ ê´€ê³„ì—†ì´ ë…¼ë¦¬ì ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ë¥¼ ë¶„í• í•˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤. VLAN ì„¤ì • ë° ê´€ë¦¬ # VLAN ìƒì„± Switch(config)# vlan 10 Switch(config-vlan)# name SALES Switch(config-vlan)# vlan 20 Switch(config-vlan)# name ENGINEERING Switch(config-vlan)# vlan 30 Switch(config-vlan)# name GUEST # VLAN ì •ë³´ í™•ì¸ Switch# show vlan brief VLAN Name Status Ports ---- -------------------------------- --------- ------------------------------- 1 default active Fa0/5, Fa0/6, Fa0/7, Fa0/8 10 SALES active Fa0/1, Fa0/2 20 ENGINEERING active Fa0/3, Fa0/4 30 GUEST active 999 UNUSED active # ë™ì  VLAN í• ë‹¹ (VMPS) Switch(config)# vmps server 192.168.1.100 Switch(config)# interface range fastethernet 0/1-20 Switch(config-if-range)# switchport mode dynamic desirable Inter-VLAN ë¼ìš°íŒ… # ë¼ìš°í„°ì˜ ì„œë¸Œì¸í„°í˜ì´ìŠ¤ ì„¤ì • (Router-on-a-Stick) Router(config)# interface fastethernet 0/0 Router(config-if)# no shutdown Router(config-if)# interface fastethernet 0/0.10 Router(config-subif)# encapsulation dot1Q 10 Router(config-subif)# ip address 192.168.10.1 255.255.255.0 Router(config-subif)# interface fastethernet 0/0.20 Router(config-subif)# encapsulation dot1Q 20 Router(config-subif)# ip address 192.168.20.1 255.255.255.0 # SVI (Switched Virtual Interface) ì„¤ì • Switch(config)# ip routing Switch(config)# interface vlan 10 Switch(config-if)# ip address 192.168.10.1 255.255.255.0 Switch(config-if)# no shutdown Switch(config-if)# interface vlan 20 Switch(config-if)# ip address 192.168.20.1 255.255.255.0 Switch(config-if)# no shutdown ğŸŒ³ STP (Spanning Tree Protocol) STPëŠ” ìŠ¤ìœ„ì¹˜ ë„¤íŠ¸ì›Œí¬ì—ì„œ ë£¨í”„ë¥¼ ë°©ì§€í•˜ê³  ì´ì¤‘í™”ë¥¼ ì œê³µí•˜ëŠ” í”„ë¡œí† ì½œì…ë‹ˆë‹¤. STP ê¸°ë³¸ ê°œë… # STP í¬íŠ¸ ìƒíƒœ Disabled: í¬íŠ¸ ë¹„í™œì„±í™” Blocking: ë°ì´í„° ì „ì†¡ ì°¨ë‹¨, BPDU ìˆ˜ì‹ ë§Œ Listening: BPDU ì†¡ìˆ˜ì‹ , MAC ì£¼ì†Œ í•™ìŠµí•˜ì§€ ì•ŠìŒ Learning: MAC ì£¼ì†Œ í•™ìŠµ, ë°ì´í„° ì „ì†¡í•˜ì§€ ì•ŠìŒ Forwarding: ì •ìƒ ë°ì´í„° ì „ì†¡ # STP í¬íŠ¸ ì—­í•  Root Port: ë£¨íŠ¸ ë¸Œë¦¬ì§€ë¡œ ê°€ëŠ” ìµœë‹¨ ê²½ë¡œ Designated Port: ì„¸ê·¸ë¨¼íŠ¸ì˜ ëŒ€í‘œ í¬íŠ¸ Alternate Port: ë£¨íŠ¸ í¬íŠ¸ì˜ ë°±ì—… Backup Port: ê°™ì€ ìŠ¤ìœ„ì¹˜ì˜ ë‹¤ë¥¸ í¬íŠ¸ ë°±ì—… STP ì„¤ì • ë° ìµœì í™” # ë£¨íŠ¸ ë¸Œë¦¬ì§€ ì„¤ì • Switch(config)# spanning-tree vlan 1 root primary Switch(config)# spanning-tree vlan 1 priority 4096 # í¬íŠ¸ ìš°ì„ ìˆœìœ„ ë° ë¹„ìš© ì„¤ì • Switch(config)# interface fastethernet 0/1 Switch(config-if)# spanning-tree vlan 1 port-priority 128 Switch(config-if)# spanning-tree vlan 1 cost 19 # RSTP (Rapid Spanning Tree) ì„¤ì • Switch(config)# spanning-tree mode rapid-pvst # í¬íŠ¸ ìµœì í™” Switch(config)# interface range fastethernet 0/1-20 Switch(config-if-range)# spanning-tree portfast Switch(config-if-range)# spanning-tree bpduguard enable # STP ì •ë³´ í™•ì¸ Switch# show spanning-tree Switch# show spanning-tree vlan 1 Switch# show spanning-tree interface fastethernet 0/1 MST (Multiple Spanning Tree) # MST ì„¤ì • Switch(config)# spanning-tree mode mst Switch(config)# spanning-tree mst configuration Switch(config-mst)# name COMPANY Switch(config-mst)# revision 1 Switch(config-mst)# instance 1 vlan 10,20 Switch(config-mst)# instance 2 vlan 30,40 Switch(config-mst)# exit # MST ë£¨íŠ¸ ì„¤ì • Switch(config)# spanning-tree mst 1 root primary Switch(config)# spanning-tree mst 2 root secondary ê³ ê¸‰ ë„¤íŠ¸ì›Œí‚¹ ê¸°ìˆ  | Advanced Networking ğŸ”— Link Aggregation (EtherChannel) ì—¬ëŸ¬ ë¬¼ë¦¬ì  ë§í¬ë¥¼ ë…¼ë¦¬ì ìœ¼ë¡œ ë¬¶ì–´ ëŒ€ì—­í­ì„ ì¦ê°€ì‹œí‚¤ê³  ì´ì¤‘í™”ë¥¼ ì œê³µí•©ë‹ˆë‹¤. # LACP (Link Aggregation Control Protocol) ì„¤ì • Switch(config)# interface range fastethernet 0/1-2 Switch(config-if-range)# channel-group 1 mode active Switch(config-if-range)# exit Switch(config)# interface port-channel 1 Switch(config-if)# switchport mode trunk Switch(config-if)# switchport trunk allowed vlan 10,20,30 # PAgP (Port Aggregation Protocol) ì„¤ì • Switch(config)# interface range fastethernet 0/3-4 Switch(config-if-range)# channel-group 2 mode desirable # ì •ì  EtherChannel ì„¤ì • Switch(config)# interface range fastethernet 0/5-6 Switch(config-if-range)# channel-group 3 mode on # EtherChannel í™•ì¸ Switch# show etherchannel summary Switch# show etherchannel port-channel ğŸŒ VXLAN (Virtual Extensible LAN) í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ L2 ì˜¤ë²„ë ˆì´ ë„¤íŠ¸ì›Œí¬ë¥¼ êµ¬í˜„í•˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤. # Linuxì—ì„œ VXLAN ì„¤ì • # VXLAN ì¸í„°í˜ì´ìŠ¤ ìƒì„± ip link add vxlan10 type vxlan id 10 remote 192.168.1.2 local 192.168.1.1 dev eth0 dstport 4789 # VXLANì„ ë¸Œë¦¬ì§€ì— ì—°ê²° ip link add br0 type bridge ip link set vxlan10 master br0 ip link set eth1 master br0 # ì¸í„°í˜ì´ìŠ¤ í™œì„±í™” ip link set vxlan10 up ip link set br0 up # ë©€í‹°ìºìŠ¤íŠ¸ VXLAN ip link add vxlan20 type vxlan id 20 group 239.1.1.1 dev eth0 dstport 4789 # VXLAN ì •ë³´ í™•ì¸ bridge fdb show dev vxlan10 ip -d link show vxlan10 âš–ï¸ ë¡œë“œ ë°¸ëŸ°ì‹± HAProxy ì„¤ì • # HAProxy ì„¤ì • íŒŒì¼ (/etc/haproxy/haproxy.cfg) global daemon maxconn 4096 log 127.0.0.1:514 local0 defaults mode http timeout connect 5000ms timeout client 50000ms timeout server 50000ms option httplog frontend web_frontend bind *:80 bind *:443 ssl crt /etc/ssl/certs/website.pem redirect scheme https if !{ ssl_fc } default_backend web_servers backend web_servers balance roundrobin option httpchk GET /health server web1 192.168.1.10:80 check server web2 192.168.1.11:80 check server web3 192.168.1.12:80 check backup # í†µê³„ í˜ì´ì§€ listen stats bind *:8080 stats enable stats uri /stats stats refresh 30s NGINX ë¡œë“œ ë°¸ëŸ°ì‹± # /etc/nginx/nginx.conf upstream backend { least_conn; # ë¡œë“œ ë°¸ëŸ°ì‹± ë°©ë²• server 192.168.1.10:80 max_fails=3 fail_timeout=30s; server 192.168.1.11:80 max_fails=3 fail_timeout=30s; server 192.168.1.12:80 backup; } server { listen 80; location / { proxy_pass http://backend; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # í—¬ìŠ¤ ì²´í¬ proxy_connect_timeout 1s; proxy_send_timeout 1s; proxy_read_timeout 1s; } } ğŸ” ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ ì‹¬í™” í¬íŠ¸ ë³´ì•ˆ (Port Security) # MAC ì£¼ì†Œ ê¸°ë°˜ í¬íŠ¸ ë³´ì•ˆ Switch(config)# interface fastethernet 0/1 Switch(config-if)# switchport port-security Switch(config-if)# switchport port-security maximum 2 Switch(config-if)# switchport port-security mac-address sticky Switch(config-if)# switchport port-security violation restrict # 802.1X ì¸ì¦ ì„¤ì • Switch(config)# aaa new-model Switch(config)# aaa authentication dot1x default group radius Switch(config)# dot1x system-auth-control Switch(config)# interface fastethernet 0/1 Switch(config-if)# authentication port-control auto Switch(config-if)# dot1x pae authenticator ACL (Access Control List) ì‹¬í™” # í™•ì¥ ACL Router(config)# ip access-list extended BLOCK_SOCIAL Router(config-ext-nacl)# deny tcp any host 23.35.67.140 eq 80 Router(config-ext-nacl)# deny tcp any host 23.35.67.141 eq 443 Router(config-ext-nacl)# permit ip any any Router(config-ext-nacl)# exit Router(config)# interface fastethernet 0/1 Router(config-if)# ip access-group BLOCK_SOCIAL out # ì‹œê°„ ê¸°ë°˜ ACL Router(config)# time-range WORK_HOURS Router(config-time-range)# periodic weekdays 09:00 to 18:00 Router(config)# ip access-list extended TIME_BASED Router(config-ext-nacl)# permit tcp 192.168.1.0 0.0.0.255 any eq 80 time-range WORK_HOURS Router(config-ext-nacl)# deny tcp 192.168.1.0 0.0.0.255 any eq 80 # ë°˜ì‚¬í˜• ACL (Reflexive ACL) Router(config)# ip access-list extended OUTBOUND Router(config-ext-nacl)# permit tcp 192.168.1.0 0.0.0.255 any reflect TCP_TRAFFIC Router(config-ext-nacl)# permit icmp 192.168.1.0 0.0.0.255 any reflect ICMP_TRAFFIC Router(config)# ip access-list extended INBOUND Router(config-ext-nacl)# evaluate TCP_TRAFFIC Router(config-ext-nacl)# evaluate ICMP_TRAFFIC Router(config-ext-nacl)# deny ip any any ë„¤íŠ¸ì›Œí¬ ëª¨ë‹ˆí„°ë§ ë° ë¬¸ì œ í•´ê²° | Network Monitoring &amp; Troubleshooting ğŸ“Š SNMP (Simple Network Management Protocol) # SNMP v3 ì„¤ì • (Cisco) Router(config)# snmp-server view READONLY iso included Router(config)# snmp-server group ADMIN v3 auth read READONLY Router(config)# snmp-server user admin ADMIN v3 auth sha password123 priv aes 128 password456 Router(config)# snmp-server host 192.168.1.100 version 3 auth admin # Linux SNMP í´ë¼ì´ì–¸íŠ¸ # OIDë¥¼ ì´ìš©í•œ ì •ë³´ ì¡°íšŒ snmpwalk -v3 -u admin -a SHA -A password123 -x AES -X password456 -l authPriv 192.168.1.1 1.3.6.1.2.1.1 # ì¸í„°í˜ì´ìŠ¤ í†µê³„ ì¡°íšŒ snmpwalk -v3 -u admin -a SHA -A password123 -x AES -X password456 -l authPriv 192.168.1.1 1.3.6.1.2.1.2.2.1.10 ğŸ” ë„¤íŠ¸ì›Œí¬ ë¶„ì„ ë„êµ¬ Wireshark ê³ ê¸‰ í•„í„° # í”„ë¡œí† ì½œë³„ í•„í„° tcp.port == 80 # HTTP íŠ¸ë˜í”½ tcp.flags.syn == 1 and tcp.flags.ack == 0 # TCP SYN íŒ¨í‚· icmp.type == 8 # ICMP Echo Request dns.qry.name contains "google" # DNS ì¿¼ë¦¬ # ë„¤íŠ¸ì›Œí¬ë³„ í•„í„° ip.src == 192.168.1.0/24 # ì†ŒìŠ¤ ë„¤íŠ¸ì›Œí¬ ip.dst == 10.0.0.0/8 # ëª©ì ì§€ ë„¤íŠ¸ì›Œí¬ eth.addr == 00:11:22:33:44:55 # MAC ì£¼ì†Œ # ì„±ëŠ¥ ë¶„ì„ tcp.analysis.retransmission # TCP ì¬ì „ì†¡ tcp.analysis.duplicate_ack # ì¤‘ë³µ ACK tcp.analysis.zero_window # ì œë¡œ ìœˆë„ìš° ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ ì¸¡ì • # ëŒ€ì—­í­ ì¸¡ì • (iperf3) # ì„œë²„ ëª¨ë“œ iperf3 -s -p 5201 # í´ë¼ì´ì–¸íŠ¸ ëª¨ë“œ iperf3 -c 192.168.1.100 -p 5201 -t 60 -P 4 # UDP ì¸¡ì • iperf3 -c 192.168.1.100 -u -b 100M # ì§€ì—° ì‹œê°„ ì¸¡ì • (hping3) hping3 -S -p 80 -c 10 google.com hping3 -1 -c 100 -i u1000 192.168.1.1 # ë§ˆì´í¬ë¡œì´ˆ ê°„ê²© # MTU ê²½ë¡œ ë°œê²¬ tracepath google.com ping -M do -s 1472 google.com 2-3 IaC (Infrastructure as Code) | ì½”ë“œí˜• ì¸í”„ë¼ 2-3-1 IaC ì¢…ë¥˜ | Types of IaC IaCëŠ” ì¸í”„ë¼ë¥¼ ì½”ë“œë¡œ ì •ì˜í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë°©ë²•ë¡ ìœ¼ë¡œ, ë„¤íŠ¸ì›Œí¬ ì¸í”„ë¼ êµ¬ì¶•ê³¼ ê´€ë¦¬ë¥¼ ìë™í™”í•©ë‹ˆë‹¤. ğŸ› ï¸ ì£¼ìš” IaC ë„êµ¬ ë¶„ë¥˜ # ì„ ì–¸ì  vs ëª…ë ¹ì  ì„ ì–¸ì  (Declarative): - Terraform, CloudFormation, Ansible (ì¼ë¶€) - ìµœì¢… ìƒíƒœë¥¼ ì •ì˜ - ë” ì•ˆì •ì ì´ê³  ì˜ˆì¸¡ ê°€ëŠ¥ ëª…ë ¹ì  (Imperative): - Shell Scripts, Python Scripts - ì‹¤í–‰ ë‹¨ê³„ë¥¼ ì •ì˜ - ë” ìœ ì—°í•˜ì§€ë§Œ ë³µì¡í•¨ # ì—ì´ì „íŠ¸ ê¸°ë°˜ vs ì—ì´ì „íŠ¸ë¦¬ìŠ¤ ì—ì´ì „íŠ¸ ê¸°ë°˜: - Puppet, Chef - ëŒ€ìƒ ì‹œìŠ¤í…œì— ì—ì´ì „íŠ¸ ì„¤ì¹˜ í•„ìš” - ì§€ì†ì ì¸ ìƒíƒœ ê´€ë¦¬ ì—ì´ì „íŠ¸ë¦¬ìŠ¤: - Ansible, Terraform - SSH/WinRM ë“±ì„ í†µí•œ ì›ê²© ì‹¤í–‰ - ì„¤ì¹˜ ë¶€ë‹´ ì—†ìŒ Terraform # Provider ì„¤ì • terraform { required_version = "&gt;= 1.0" required_providers { aws = { source = "hashicorp/aws" version = "~&gt; 5.0" } cisco = { source = "CiscoDevNet/aci" version = "~&gt; 2.0" } } } # ë³€ìˆ˜ ì •ì˜ variable "vpc_cidr" { description = "CIDR block for VPC" type = string default = "10.0.0.0/16" } variable "environment" { description = "Environment name" type = string default = "production" } Ansible # ë„¤íŠ¸ì›Œí¬ ì¥ë¹„ ì¸ë²¤í† ë¦¬ (/etc/ansible/hosts) [switches] switch1 ansible_host=192.168.1.10 ansible_network_os=ios switch2 ansible_host=192.168.1.11 ansible_network_os=ios [routers] router1 ansible_host=192.168.1.1 ansible_network_os=ios router2 ansible_host=192.168.1.2 ansible_network_os=ios [network:children] switches routers [network:vars] ansible_user=admin ansible_password=password ansible_connection=network_cli ansible_become=yes ansible_become_method=enable CloudFormation (AWS) # AWS ë„¤íŠ¸ì›Œí¬ ì¸í”„ë¼ í…œí”Œë¦¿ AWSTemplateFormatVersion: '2010-09-09' Description: 'Network Infrastructure Template' Parameters: EnvironmentName: Description: Environment name prefix Type: String Default: Production Resources: VPC: Type: AWS::EC2::VPC Properties: CidrBlock: 10.0.0.0/16 EnableDnsHostnames: true EnableDnsSupport: true Tags: - Key: Name Value: !Sub ${EnvironmentName}-VPC Pulumi # Pythonì„ ì´ìš©í•œ IaC import pulumi import pulumi_aws as aws # VPC ìƒì„± vpc = aws.ec2.Vpc("main-vpc", cidr_block="10.0.0.0/16", enable_dns_hostnames=True, enable_dns_support=True, tags={ "Name": "main-vpc", "Environment": "production" } ) # ì„œë¸Œë„· ìƒì„± public_subnet = aws.ec2.Subnet("public-subnet", vpc_id=vpc.id, cidr_block="10.0.1.0/24", availability_zone="us-west-2a", map_public_ip_on_launch=True, tags={ "Name": "public-subnet", "Type": "Public" } ) CDK (Cloud Development Kit) // TypeScriptë¥¼ ì´ìš©í•œ AWS CDK import * as cdk from 'aws-cdk-lib'; import * as ec2 from 'aws-cdk-lib/aws-ec2'; export class NetworkStack extends cdk.Stack { constructor(scope: cdk.App, id: string, props?: cdk.StackProps) { super(scope, id, props); // VPC ìƒì„± const vpc = new ec2.Vpc(this, 'MainVpc', { maxAzs: 3, cidr: '10.0.0.0/16', subnetConfiguration: [ { cidrMask: 24, name: 'Public', subnetType: ec2.SubnetType.PUBLIC, }, { cidrMask: 24, name: 'Private', subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS, } ] }); } } 2-3-2 í…Œë¼í¼ìœ¼ë¡œ í™˜ê²½ êµ¬ì„± | Environment Setup with Terraform Terraformì„ ì‚¬ìš©í•˜ì—¬ ì™„ì „í•œ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì„ êµ¬ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤. ğŸ—ï¸ í”„ë¡œì íŠ¸ êµ¬ì¡° ì„¤ê³„ # ë””ë ‰í† ë¦¬ êµ¬ì¡° terraform-network/ â”œâ”€â”€ environments/ â”‚ â”œâ”€â”€ dev/ â”‚ â”‚ â”œâ”€â”€ main.tf â”‚ â”‚ â”œâ”€â”€ variables.tf â”‚ â”‚ â””â”€â”€ terraform.tfvars â”‚ â”œâ”€â”€ staging/ â”‚ â””â”€â”€ production/ â”œâ”€â”€ modules/ â”‚ â”œâ”€â”€ vpc/ â”‚ â”‚ â”œâ”€â”€ main.tf â”‚ â”‚ â”œâ”€â”€ variables.tf â”‚ â”‚ â””â”€â”€ outputs.tf â”‚ â”œâ”€â”€ security-groups/ â”‚ â””â”€â”€ load-balancer/ â”œâ”€â”€ global/ â”‚ â””â”€â”€ iam/ â””â”€â”€ shared/ â””â”€â”€ data.tf VPC ëª¨ë“ˆ êµ¬í˜„ # modules/vpc/main.tf resource "aws_vpc" "main" { cidr_block = var.cidr_block enable_dns_hostnames = var.enable_dns_hostnames enable_dns_support = var.enable_dns_support tags = merge(var.tags, { Name = "${var.name_prefix}-vpc" }) } # ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´ resource "aws_internet_gateway" "main" { vpc_id = aws_vpc.main.id tags = merge(var.tags, { Name = "${var.name_prefix}-igw" }) } # ê°€ìš© ì˜ì—­ë³„ í¼ë¸”ë¦­ ì„œë¸Œë„· resource "aws_subnet" "public" { count = length(var.public_subnets) vpc_id = aws_vpc.main.id cidr_block = var.public_subnets[count.index] availability_zone = var.availability_zones[count.index] map_public_ip_on_launch = true tags = merge(var.tags, { Name = "${var.name_prefix}-public-${count.index + 1}" Type = "Public" }) } # í”„ë¼ì´ë¹— ì„œë¸Œë„· resource "aws_subnet" "private" { count = length(var.private_subnets) vpc_id = aws_vpc.main.id cidr_block = var.private_subnets[count.index] availability_zone = var.availability_zones[count.index] tags = merge(var.tags, { Name = "${var.name_prefix}-private-${count.index + 1}" Type = "Private" }) } # NAT ê²Œì´íŠ¸ì›¨ì´ë¥¼ ìœ„í•œ EIP resource "aws_eip" "nat" { count = var.enable_nat_gateway ? length(var.public_subnets) : 0 domain = "vpc" depends_on = [aws_internet_gateway.main] tags = merge(var.tags, { Name = "${var.name_prefix}-nat-eip-${count.index + 1}" }) } # NAT ê²Œì´íŠ¸ì›¨ì´ resource "aws_nat_gateway" "main" { count = var.enable_nat_gateway ? length(var.public_subnets) : 0 allocation_id = aws_eip.nat[count.index].id subnet_id = aws_subnet.public[count.index].id tags = merge(var.tags, { Name = "${var.name_prefix}-nat-gw-${count.index + 1}" }) depends_on = [aws_internet_gateway.main] } # í¼ë¸”ë¦­ ë¼ìš°íŠ¸ í…Œì´ë¸” resource "aws_route_table" "public" { vpc_id = aws_vpc.main.id route { cidr_block = "0.0.0.0/0" gateway_id = aws_internet_gateway.main.id } tags = merge(var.tags, { Name = "${var.name_prefix}-public-rt" }) } # í”„ë¼ì´ë¹— ë¼ìš°íŠ¸ í…Œì´ë¸” resource "aws_route_table" "private" { count = var.enable_nat_gateway ? length(var.private_subnets) : 1 vpc_id = aws_vpc.main.id dynamic "route" { for_each = var.enable_nat_gateway ? [1] : [] content { cidr_block = "0.0.0.0/0" nat_gateway_id = aws_nat_gateway.main[count.index].id } } tags = merge(var.tags, { Name = "${var.name_prefix}-private-rt-${count.index + 1}" }) } # ë¼ìš°íŠ¸ í…Œì´ë¸” ì—°ê²° resource "aws_route_table_association" "public" { count = length(var.public_subnets) subnet_id = aws_subnet.public[count.index].id route_table_id = aws_route_table.public.id } resource "aws_route_table_association" "private" { count = length(var.private_subnets) subnet_id = aws_subnet.private[count.index].id route_table_id = var.enable_nat_gateway ? aws_route_table.private[count.index].id : aws_route_table.private[0].id } VPC ëª¨ë“ˆ ë³€ìˆ˜ # modules/vpc/variables.tf variable "name_prefix" { description = "Name prefix for all resources" type = string } variable "cidr_block" { description = "CIDR block for the VPC" type = string } variable "public_subnets" { description = "List of public subnet CIDR blocks" type = list(string) } variable "private_subnets" { description = "List of private subnet CIDR blocks" type = list(string) } variable "availability_zones" { description = "List of availability zones" type = list(string) } variable "enable_nat_gateway" { description = "Enable NAT Gateway for private subnets" type = bool default = true } variable "enable_dns_hostnames" { description = "Enable DNS hostnames in the VPC" type = bool default = true } variable "enable_dns_support" { description = "Enable DNS support in the VPC" type = bool default = true } variable "tags" { description = "Tags to apply to all resources" type = map(string) default = {} } VPC ëª¨ë“ˆ ì¶œë ¥ # modules/vpc/outputs.tf output "vpc_id" { description = "ID of the VPC" value = aws_vpc.main.id } output "vpc_cidr_block" { description = "CIDR block of the VPC" value = aws_vpc.main.cidr_block } output "public_subnet_ids" { description = "IDs of the public subnets" value = aws_subnet.public[*].id } output "private_subnet_ids" { description = "IDs of the private subnets" value = aws_subnet.private[*].id } output "internet_gateway_id" { description = "ID of the Internet Gateway" value = aws_internet_gateway.main.id } output "nat_gateway_ids" { description = "IDs of the NAT Gateways" value = aws_nat_gateway.main[*].id } ë³´ì•ˆ ê·¸ë£¹ ëª¨ë“ˆ # modules/security-groups/main.tf # ì›¹ ì„œë²„ ë³´ì•ˆ ê·¸ë£¹ resource "aws_security_group" "web" { name_prefix = "${var.name_prefix}-web-" vpc_id = var.vpc_id description = "Security group for web servers" ingress { description = "HTTP" from_port = 80 to_port = 80 protocol = "tcp" cidr_blocks = ["0.0.0.0/0"] } ingress { description = "HTTPS" from_port = 443 to_port = 443 protocol = "tcp" cidr_blocks = ["0.0.0.0/0"] } ingress { description = "SSH from management" from_port = 22 to_port = 22 protocol = "tcp" security_groups = [aws_security_group.management.id] } egress { from_port = 0 to_port = 0 protocol = "-1" cidr_blocks = ["0.0.0.0/0"] } tags = merge(var.tags, { Name = "${var.name_prefix}-web-sg" }) lifecycle { create_before_destroy = true } } # ë°ì´í„°ë² ì´ìŠ¤ ë³´ì•ˆ ê·¸ë£¹ resource "aws_security_group" "database" { name_prefix = "${var.name_prefix}-db-" vpc_id = var.vpc_id description = "Security group for database servers" ingress { description = "MySQL/MariaDB" from_port = 3306 to_port = 3306 protocol = "tcp" security_groups = [aws_security_group.web.id] } ingress { description = "PostgreSQL" from_port = 5432 to_port = 5432 protocol = "tcp" security_groups = [aws_security_group.web.id] } tags = merge(var.tags, { Name = "${var.name_prefix}-db-sg" }) } # ê´€ë¦¬ ë³´ì•ˆ ê·¸ë£¹ resource "aws_security_group" "management" { name_prefix = "${var.name_prefix}-mgmt-" vpc_id = var.vpc_id description = "Security group for management access" ingress { description = "SSH" from_port = 22 to_port = 22 protocol = "tcp" cidr_blocks = var.management_cidr_blocks } ingress { description = "RDP" from_port = 3389 to_port = 3389 protocol = "tcp" cidr_blocks = var.management_cidr_blocks } egress { from_port = 0 to_port = 0 protocol = "-1" cidr_blocks = ["0.0.0.0/0"] } tags = merge(var.tags, { Name = "${var.name_prefix}-mgmt-sg" }) } ë©”ì¸ í™˜ê²½ ì„¤ì • # environments/production/main.tf terraform { required_version = "&gt;= 1.0" backend "s3" { bucket = "company-terraform-state" key = "network/production/terraform.tfstate" region = "us-west-2" encrypt = true dynamodb_table = "terraform-locks" } required_providers { aws = { source = "hashicorp/aws" version = "~&gt; 5.0" } } } provider "aws" { region = var.aws_region default_tags { tags = { Environment = var.environment Project = var.project_name ManagedBy = "Terraform" CreatedBy = var.created_by CostCenter = var.cost_center } } } # ë°ì´í„° ì†ŒìŠ¤ data "aws_availability_zones" "available" { state = "available" } # VPC ëª¨ë“ˆ í˜¸ì¶œ module "vpc" { source = "../../modules/vpc" name_prefix = var.name_prefix cidr_block = var.vpc_cidr public_subnets = var.public_subnet_cidrs private_subnets = var.private_subnet_cidrs availability_zones = slice(data.aws_availability_zones.available.names, 0, 3) enable_nat_gateway = var.enable_nat_gateway tags = local.common_tags } # ë³´ì•ˆ ê·¸ë£¹ ëª¨ë“ˆ í˜¸ì¶œ module "security_groups" { source = "../../modules/security-groups" name_prefix = var.name_prefix vpc_id = module.vpc.vpc_id management_cidr_blocks = var.management_cidr_blocks tags = local.common_tags } # ë¡œì»¬ ê°’ locals { common_tags = { Environment = var.environment Project = var.project_name ManagedBy = "Terraform" } } í™˜ê²½ë³„ ë³€ìˆ˜ íŒŒì¼ # environments/production/variables.tf variable "aws_region" { description = "AWS region" type = string default = "us-west-2" } variable "environment" { description = "Environment name" type = string default = "production" } variable "project_name" { description = "Project name" type = string } variable "name_prefix" { description = "Name prefix for resources" type = string } variable "vpc_cidr" { description = "CIDR block for VPC" type = string } variable "public_subnet_cidrs" { description = "CIDR blocks for public subnets" type = list(string) } variable "private_subnet_cidrs" { description = "CIDR blocks for private subnets" type = list(string) } variable "enable_nat_gateway" { description = "Enable NAT Gateway" type = bool default = true } variable "management_cidr_blocks" { description = "CIDR blocks allowed for management access" type = list(string) } variable "created_by" { description = "Creator of the infrastructure" type = string } variable "cost_center" { description = "Cost center for billing" type = string } Terraform ì‹¤í–‰ ê°’ # environments/production/terraform.tfvars project_name = "company-web-app" name_prefix = "prod-webapp" vpc_cidr = "10.0.0.0/16" public_subnet_cidrs = [ "10.0.1.0/24", "10.0.2.0/24", "10.0.3.0/24" ] private_subnet_cidrs = [ "10.0.11.0/24", "10.0.12.0/24", "10.0.13.0/24" ] enable_nat_gateway = true management_cidr_blocks = [ "203.0.113.0/24", # íšŒì‚¬ ì‚¬ë¬´ì‹¤ "198.51.100.0/24" # VPN ë„¤íŠ¸ì›Œí¬ ] created_by = "devops-team" cost_center = "engineering" Terraform ì‹¤í–‰ ë° ê´€ë¦¬ # ì´ˆê¸°í™” terraform init # ê³„íš í™•ì¸ terraform plan -var-file="terraform.tfvars" # ì ìš© terraform apply -var-file="terraform.tfvars" # ìƒíƒœ í™•ì¸ terraform show terraform state list # ë¦¬ì†ŒìŠ¤ í™•ì¸ terraform state show module.vpc.aws_vpc.main # ì¶œë ¥ ê°’ í™•ì¸ terraform output # ë¦¬ì†ŒìŠ¤ ì‚­ì œ terraform destroy -var-file="terraform.tfvars" # ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ê´€ë¦¬ terraform workspace new staging terraform workspace select production terraform workspace list ê³ ê¸‰ Terraform ê¸°ëŠ¥ # ì¡°ê±´ë¶€ ë¦¬ì†ŒìŠ¤ ìƒì„± resource "aws_instance" "web" { count = var.environment == "production" ? 3 : 1 ami = data.aws_ami.amazon_linux.id instance_type = var.environment == "production" ? "t3.medium" : "t3.micro" tags = { Name = "${var.name_prefix}-web-${count.index + 1}" } } # ë™ì  ë¸”ë¡ resource "aws_security_group" "web" { name_prefix = "${var.name_prefix}-web-" vpc_id = var.vpc_id dynamic "ingress" { for_each = var.ingress_rules content { from_port = ingress.value.from_port to_port = ingress.value.to_port protocol = ingress.value.protocol cidr_blocks = ingress.value.cidr_blocks } } } # ë°ì´í„° ì†ŒìŠ¤ í™œìš© data "aws_ami" "amazon_linux" { most_recent = true owners = ["amazon"] filter { name = "name" values = ["amzn2-ami-hvm-*-x86_64-gp2"] } } # ì›ê²© ìƒíƒœ ì°¸ì¡° data "terraform_remote_state" "vpc" { backend = "s3" config = { bucket = "company-terraform-state" key = "network/production/terraform.tfstate" region = "us-west-2" } } 2-4 ë‹¨ì¼ ì¥ì•  ì§€ì  ì œê±° | Eliminating Single Points of Failure 2-4-1 SPOF ì°¾ê¸° | Identifying SPOF ë‹¨ì¼ ì¥ì•  ì§€ì (SPOF)ì€ ì‹œìŠ¤í…œì˜ í•œ êµ¬ì„± ìš”ì†Œê°€ ì‹¤íŒ¨í•  ë•Œ ì „ì²´ ì‹œìŠ¤í…œì´ ì‘ë™ì„ ë©ˆì¶”ê²Œ ë˜ëŠ” ì§€ì ì„ ë§í•©ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì¸í”„ë¼ì—ì„œ SPOFë¥¼ ì‹ë³„í•˜ê³  ì œê±°í•˜ëŠ” ê²ƒì€ ê³ ê°€ìš©ì„± í™•ë³´ì˜ í•µì‹¬ì…ë‹ˆë‹¤. ğŸ” SPOF ì‹ë³„ ë°©ë²•ë¡  # SPOF ë¶„ì„ ì²´í¬ë¦¬ìŠ¤íŠ¸ 1. ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€ ë¶„ì„ - ë‹¨ì¼ ì—°ê²°ì  í™•ì¸ - ë°±ì—… ê²½ë¡œ ì¡´ì¬ ì—¬ë¶€ - ëŒ€ì—­í­ ë³‘ëª© ì§€ì  2. í•˜ë“œì›¨ì–´ êµ¬ì„± ìš”ì†Œ ì ê²€ - ë‹¨ì¼ ìŠ¤ìœ„ì¹˜/ë¼ìš°í„° ì˜ì¡´ì„± - ì „ì› ê³µê¸‰ ì¥ì¹˜ - ì¼€ì´ë¸”ë§ ê²½ë¡œ 3. ì„œë¹„ìŠ¤ ì˜ì¡´ì„± ë¶„ì„ - DNS ì„œë²„ - DHCP ì„œë²„ - ì¸ì¦ ì„œë²„ (RADIUS/LDAP) 4. ì™¸ë¶€ ì—°ê²° ê²€í†  - ISP ì—°ê²° - WAN íšŒì„  - í´ë¼ìš°ë“œ ì—°ê²° ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€ SPOF ë¶„ì„ # í˜„ì¬ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸ # Linux í™˜ê²½ì—ì„œ ë„¤íŠ¸ì›Œí¬ ê²½ë¡œ ë¶„ì„ ip route show table main traceroute -n 8.8.8.8 mtr --report --report-cycles=100 google.com # ë¼ìš°íŒ… í…Œì´ë¸” ë¶„ì„ netstat -rn route -n # ì¸í„°í˜ì´ìŠ¤ ìƒíƒœ í™•ì¸ ip link show ip addr show ethtool eth0 # ë§í¬ ìƒíƒœ, ì†ë„ í™•ì¸ # Cisco ì¥ë¹„ì—ì„œ SPOF ë¶„ì„ show ip route show interface summary show spanning-tree root show etherchannel summary show redundancy # ëŒ€ì—­í­ ì‚¬ìš©ë¥  ëª¨ë‹ˆí„°ë§ show interface fastethernet 0/1 | include rate show processes cpu sorted show memory summary ì¼ë°˜ì ì¸ ë„¤íŠ¸ì›Œí¬ SPOF íŒ¨í„´ # 1. ë‹¨ì¼ ì—…ë§í¬ (Single Uplink) ë¬¸ì œ: í•˜ë‚˜ì˜ ì—…ìŠ¤íŠ¸ë¦¼ ì—°ê²°ë§Œ ì¡´ì¬ ì˜í–¥: í•´ë‹¹ ì—°ê²° ì‹¤íŒ¨ ì‹œ ì „ì²´ ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ í•´ê²°: ì´ì¤‘ ì—…ë§í¬ + ë¡œë“œë°¸ëŸ°ì‹± # 2. ë‹¨ì¼ ì½”ì–´ ìŠ¤ìœ„ì¹˜ (Single Core Switch) ë¬¸ì œ: ëª¨ë“  ì•¡ì„¸ìŠ¤ ìŠ¤ìœ„ì¹˜ê°€ í•˜ë‚˜ì˜ ì½”ì–´ì— ì—°ê²° ì˜í–¥: ì½”ì–´ ìŠ¤ìœ„ì¹˜ ì‹¤íŒ¨ ì‹œ ì „ì²´ ë„¤íŠ¸ì›Œí¬ ë§ˆë¹„ í•´ê²°: ì´ì¤‘ ì½”ì–´ ìŠ¤ìœ„ì¹˜ + HSRP/VRRP # 3. ë‹¨ì¼ VLAN (Single VLAN) ë¬¸ì œ: ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë„ë©”ì¸ ê³¼ë¶€í•˜ ì˜í–¥: ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ ì €í•˜, ì¥ì•  ì „íŒŒ í•´ê²°: VLAN ë¶„í•  + Inter-VLAN ë¼ìš°íŒ… # 4. ë‹¨ì¼ ISP (Single ISP) ë¬¸ì œ: í•˜ë‚˜ì˜ ì¸í„°ë„· ì„œë¹„ìŠ¤ ì œê³µì—…ì²´ ì˜í–¥: ISP ì¥ì•  ì‹œ ì¸í„°ë„· ì—°ê²° ë¶ˆê°€ í•´ê²°: ë©€í‹° ISP + BGP ë¼ìš°íŒ… SPOF íƒì§€ ë„êµ¬ì™€ ìŠ¤í¬ë¦½íŠ¸ #!/usr/bin/env python3 # spof_detector.py - ë„¤íŠ¸ì›Œí¬ SPOF íƒì§€ ë„êµ¬ import subprocess import json import sys from collections import defaultdict import networkx as nx class SPOFDetector: def __init__(self): self.network_graph = nx.Graph() self.devices = {} self.links = {} def scan_network_topology(self, network_range): """ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€ ìŠ¤ìº”""" print(f"Scanning network range: {network_range}") # SNMPì„ í†µí•œ ë„¤íŠ¸ì›Œí¬ ë””ìŠ¤ì»¤ë²„ë¦¬ devices = self.discover_devices(network_range) for device in devices: self.analyze_device(device) return self.identify_spof() def discover_devices(self, network_range): """SNMPë¥¼ í†µí•œ ë„¤íŠ¸ì›Œí¬ ì¥ë¹„ ë°œê²¬""" cmd = f"nmap -sn {network_range}" result = subprocess.run(cmd.split(), capture_output=True, text=True) devices = [] for line in result.stdout.split('\n'): if 'Nmap scan report' in line: ip = line.split()[-1] devices.append(ip) return devices def analyze_device(self, device_ip): """ê°œë³„ ì¥ë¹„ ë¶„ì„""" device_info = { 'ip': device_ip, 'type': self.detect_device_type(device_ip), 'interfaces': self.get_interfaces(device_ip), 'neighbors': self.get_neighbors(device_ip), 'redundancy': self.check_redundancy(device_ip) } self.devices[device_ip] = device_info self.network_graph.add_node(device_ip, **device_info) def detect_device_type(self, device_ip): """ì¥ë¹„ ìœ í˜• ê°ì§€ (ë¼ìš°í„°/ìŠ¤ìœ„ì¹˜/ë°©í™”ë²½)""" # SNMP OIDë¥¼ í†µí•œ ì¥ë¹„ ìœ í˜• í™•ì¸ snmp_cmd = f"snmpget -v2c -c public {device_ip} 1.3.6.1.2.1.1.1.0" result = subprocess.run(snmp_cmd.split(), capture_output=True, text=True) if 'cisco' in result.stdout.lower(): if 'router' in result.stdout.lower(): return 'router' elif 'switch' in result.stdout.lower(): return 'switch' return 'unknown' def get_interfaces(self, device_ip): """ì¸í„°í˜ì´ìŠ¤ ì •ë³´ ìˆ˜ì§‘""" # SNMPë¥¼ í†µí•œ ì¸í„°í˜ì´ìŠ¤ ìƒíƒœ í™•ì¸ interfaces = {} # ì¸í„°í˜ì´ìŠ¤ ì´ë¦„ (1.3.6.1.2.1.2.2.1.2) # ì¸í„°í˜ì´ìŠ¤ ìƒíƒœ (1.3.6.1.2.1.2.2.1.8) # ì¸í„°í˜ì´ìŠ¤ ì†ë„ (1.3.6.1.2.1.2.2.1.5) return interfaces def get_neighbors(self, device_ip): """ì¸ì ‘ ì¥ë¹„ ì •ë³´ ìˆ˜ì§‘ (CDP/LLDP)""" neighbors = [] # CDP ì •ë³´ ìˆ˜ì§‘ (1.3.6.1.4.1.9.9.23.1.2.1.1.6) # LLDP ì •ë³´ ìˆ˜ì§‘ (1.0.8802.1.1.2.1.4.1.1.9) return neighbors def check_redundancy(self, device_ip): """ì´ì¤‘í™” êµ¬ì„± í™•ì¸""" redundancy_info = { 'power_supplies': self.check_power_supplies(device_ip), 'uplinks': self.check_uplinks(device_ip), 'protocols': self.check_redundancy_protocols(device_ip) } return redundancy_info def identify_spof(self): """SPOF ì‹ë³„""" spof_list = [] # 1. ì—°ê²°ì„± ë¶„ì„ - ë‹¨ì¼ ì—°ê²°ì  ì°¾ê¸° for node in self.network_graph.nodes(): if self.network_graph.degree(node) == 1: spof_list.append({ 'type': 'single_connection', 'device': node, 'risk': 'high', 'description': f'Device {node} has only one connection' }) # 2. ë¸Œë¦¬ì§€ í¬ì¸íŠ¸ ë¶„ì„ bridges = list(nx.bridges(self.network_graph)) for bridge in bridges: spof_list.append({ 'type': 'bridge_link', 'link': bridge, 'risk': 'critical', 'description': f'Link between {bridge[0]} and {bridge[1]} is critical' }) # 3. ì ˆë‹¨ì  ë¶„ì„ (Articulation Points) articulation_points = list(nx.articulation_points(self.network_graph)) for point in articulation_points: spof_list.append({ 'type': 'articulation_point', 'device': point, 'risk': 'critical', 'description': f'Device {point} is a critical junction point' }) return spof_list def generate_report(self, spof_list): """SPOF ë¶„ì„ ë³´ê³ ì„œ ìƒì„±""" report = { 'timestamp': subprocess.run(['date'], capture_output=True, text=True).stdout.strip(), 'total_devices': len(self.devices), 'total_spof_issues': len(spof_list), 'critical_issues': len([s for s in spof_list if s['risk'] == 'critical']), 'high_issues': len([s for s in spof_list if s['risk'] == 'high']), 'spof_details': spof_list, 'recommendations': self.generate_recommendations(spof_list) } return report def main(): if len(sys.argv) != 2: print("Usage: python3 spof_detector.py &lt;network_range&gt;") print("Example: python3 spof_detector.py 192.168.1.0/24") sys.exit(1) network_range = sys.argv[1] detector = SPOFDetector() print("Starting SPOF detection...") spof_list = detector.scan_network_topology(network_range) report = detector.generate_report(spof_list) # JSON í˜•íƒœë¡œ ê²°ê³¼ ì¶œë ¥ print(json.dumps(report, indent=2)) # ìš”ì•½ ì¶œë ¥ print(f"\n=== SPOF Detection Summary ===") print(f"Total devices scanned: {report['total_devices']}") print(f"SPOF issues found: {report['total_spof_issues']}") print(f"Critical issues: {report['critical_issues']}") print(f"High risk issues: {report['high_issues']}") if __name__ == "__main__": main() Ansibleì„ ì´ìš©í•œ SPOF ì ê²€ ìë™í™” --- # spof_check.yml - SPOF ì ê²€ í”Œë ˆì´ë¶ - name: Network SPOF Assessment hosts: network_devices gather_facts: no vars: spof_report: [] tasks: - name: Check device redundancy status ios_command: commands: - show redundancy - show environment power - show interface summary - show spanning-tree root - show etherchannel summary register: device_status - name: Analyze redundancy configuration set_fact: redundancy_analysis: "" - name: Check for single uplinks ios_command: commands: - show cdp neighbors - show interface trunk register: uplink_status - name: Identify SPOF risks set_fact: spof_risks: "" loop: - "Single uplink detected" - "No redundant power" - "No EtherChannel" vars: uplink_count: "" power_supplies: "" etherchannel_count: "" - name: Generate SPOF report template: src: spof_report.j2 dest: "/tmp/spof_report_.html" vars: device_name: "" check_date: "" - name: Send SPOF alert if critical issues found mail: to: "" subject: "CRITICAL: SPOF detected on " body: "Critical single points of failure detected. See attached report." attach: "/tmp/spof_report_.html" when: "'Single uplink detected' in spof_risks or 'No redundant power' in spof_risks" ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€ ì‹œê°í™” # Graphvizë¥¼ ì´ìš©í•œ ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€ ìƒì„± #!/bin/bash # generate_network_topology.sh # SNMPë¥¼ í†µí•œ ë„¤íŠ¸ì›Œí¬ ë§µ ìƒì„± generate_dot_file() { echo "digraph network {" &gt; network.dot echo " rankdir=TB;" &gt;&gt; network.dot echo " node [shape=box];" &gt;&gt; network.dot # ê° ì¥ë¹„ ì •ë³´ ìˆ˜ì§‘ for ip in $(nmap -sn 192.168.1.0/24 | grep "Nmap scan report" | awk '{print $5}'); do device_name=$(snmpget -v2c -c public $ip 1.3.6.1.2.1.1.5.0 2&gt;/dev/null | cut -d'"' -f2) if [ ! -z "$device_name" ]; then echo " \"$device_name\" [label=\"$device_name\\n$ip\"];" &gt;&gt; network.dot # CDP ì •ë³´ë¡œ ì—°ê²° ê´€ê³„ í™•ì¸ cdp_neighbors=$(snmpwalk -v2c -c public $ip 1.3.6.1.4.1.9.9.23.1.2.1.1.6 2&gt;/dev/null) while read -r neighbor; do neighbor_name=$(echo $neighbor | cut -d'"' -f2) if [ ! -z "$neighbor_name" ]; then echo " \"$device_name\" -&gt; \"$neighbor_name\";" &gt;&gt; network.dot fi done &lt;&lt;&lt; "$cdp_neighbors" fi done echo "}" &gt;&gt; network.dot } # DOT íŒŒì¼ì„ ì´ë¯¸ì§€ë¡œ ë³€í™˜ generate_dot_file dot -Tpng network.dot -o network_topology.png dot -Tsvg network.dot -o network_topology.svg echo "Network topology generated: network_topology.png" # SPOF í•˜ì´ë¼ì´íŠ¸ ë²„ì „ ìƒì„± sed 's/node \[shape=box\];/node [shape=box]; edge [color=red, penwidth=3];/' network.dot &gt; network_spof.dot dot -Tpng network_spof.dot -o network_spof.png echo "SPOF highlighted topology: network_spof.png" ì‹¤ì‹œê°„ SPOF ëª¨ë‹ˆí„°ë§ # spof_monitor.py - ì‹¤ì‹œê°„ SPOF ëª¨ë‹ˆí„°ë§ import time import threading import logging from prometheus_client import start_http_server, Gauge, Counter class SPOFMonitor: def __init__(self): self.spof_gauge = Gauge('network_spof_count', 'Number of detected SPOFs') self.link_status_gauge = Gauge('network_link_status', 'Link status', ['device', 'interface']) self.spof_alert_counter = Counter('network_spof_alerts_total', 'Total SPOF alerts') logging.basicConfig(level=logging.INFO) self.logger = logging.getLogger(__name__) def monitor_links(self): """ë§í¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§""" while True: try: devices = self.get_monitored_devices() for device in devices: interfaces = self.get_device_interfaces(device) for interface in interfaces: status = self.check_interface_status(device, interface) self.link_status_gauge.labels( device=device['name'], interface=interface ).set(1 if status == 'up' else 0) if status == 'down': self.check_spof_impact(device, interface) time.sleep(30) # 30ì´ˆë§ˆë‹¤ ì²´í¬ except Exception as e: self.logger.error(f"Monitoring error: {e}") time.sleep(60) def check_spof_impact(self, device, failed_interface): """ì¥ì•  ë°œìƒ ì‹œ SPOF ì˜í–¥ ë¶„ì„""" remaining_paths = self.calculate_remaining_paths(device, failed_interface) if remaining_paths == 0: self.logger.critical(f"SPOF ALERT: {device['name']} {failed_interface} failure causes network partition") self.spof_alert_counter.inc() self.send_alert(device, failed_interface, 'SPOF_CRITICAL') elif remaining_paths == 1: self.logger.warning(f"SPOF WARNING: {device['name']} {failed_interface} creates single path") self.send_alert(device, failed_interface, 'SPOF_WARNING') def start_monitoring(self): """ëª¨ë‹ˆí„°ë§ ì‹œì‘""" # Prometheus ë©”íŠ¸ë¦­ ì„œë²„ ì‹œì‘ start_http_server(8000) # ë§í¬ ëª¨ë‹ˆí„°ë§ ì“°ë ˆë“œ ì‹œì‘ monitor_thread = threading.Thread(target=self.monitor_links) monitor_thread.daemon = True monitor_thread.start() self.logger.info("SPOF monitoring started on port 8000") # ë©”ì¸ ë£¨í”„ try: while True: time.sleep(1) except KeyboardInterrupt: self.logger.info("Monitoring stopped") if __name__ == "__main__": monitor = SPOFMonitor() monitor.start_monitoring() SPOF ì œê±° ìš°ì„ ìˆœìœ„ ë§¤íŠ¸ë¦­ìŠ¤ # SPOF ìœ„í—˜ë„ í‰ê°€ ë§¤íŠ¸ë¦­ìŠ¤ ìœ„í—˜ë„ = (ì˜í–¥ë„ Ã— ë°œìƒê°€ëŠ¥ì„±) / ëŒ€ì‘ì‹œê°„ ì˜í–¥ë„ ì ìˆ˜: - ì „ì²´ ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ: 10 - ë¶€ë¶„ ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ: 7 - ì„±ëŠ¥ ì €í•˜: 4 - ì¼ë¶€ ì„œë¹„ìŠ¤ ì˜í–¥: 2 ë°œìƒê°€ëŠ¥ì„± ì ìˆ˜: - ë§¤ìš° ë†’ìŒ (ì›” 1íšŒ ì´ìƒ): 10 - ë†’ìŒ (ë¶„ê¸° 1íšŒ): 7 - ë³´í†µ (ì—° 2-3íšŒ): 4 - ë‚®ìŒ (ì—° 1íšŒ ì´í•˜): 2 ëŒ€ì‘ì‹œê°„ ì ìˆ˜: - 4ì‹œê°„ ì´ìƒ: 1 - 2-4ì‹œê°„: 2 - 1-2ì‹œê°„: 4 - 1ì‹œê°„ ì´í•˜: 7 # ìš°ì„ ìˆœìœ„ ê²°ì • ìš°ì„ ìˆœìœ„ 1 (ì¦‰ì‹œ): ìœ„í—˜ë„ &gt; 35 ìš°ì„ ìˆœìœ„ 2 (1ê°œì›”): ìœ„í—˜ë„ 20-35 ìš°ì„ ìˆœìœ„ 3 (3ê°œì›”): ìœ„í—˜ë„ 10-20 ìš°ì„ ìˆœìœ„ 4 (1ë…„): ìœ„í—˜ë„ &lt; 10]]></summary></entry><entry><title type="html">ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ 1í¸ - ê¸°ì´ˆ ë³´ì•ˆ ì„¤ì • | Linux Security Guide Part 1 - Basic Security Configuration</title><link href="https://leeyonghe.github.io/infra-blog/blog/2024/10/26/linux-security-guide-part1.html" rel="alternate" type="text/html" title="ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ 1í¸ - ê¸°ì´ˆ ë³´ì•ˆ ì„¤ì • | Linux Security Guide Part 1 - Basic Security Configuration" /><published>2024-10-26T00:00:00+00:00</published><updated>2024-10-26T00:00:00+00:00</updated><id>https://leeyonghe.github.io/infra-blog/blog/2024/10/26/linux-security-guide-part1</id><content type="html" xml:base="https://leeyonghe.github.io/infra-blog/blog/2024/10/26/linux-security-guide-part1.html"><![CDATA[<p>ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œ ë³´ì•ˆì˜ ì²« ë²ˆì§¸ ë‹¨ê³„ì¸ ê¸°ì´ˆ ë³´ì•ˆ ì„¤ì •ì„ ì™„ë²½í•˜ê²Œ ë§ˆìŠ¤í„°í•´ë³´ê² ìŠµë‹ˆë‹¤. ì‚¬ìš©ì ê³„ì • ê´€ë¦¬ë¶€í„° SSH ë³´ì•ˆ ê°•í™”ê¹Œì§€ ì‹¤ë¬´ì—ì„œ ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ë‚´ìš©ìœ¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.</p>

<h2 id="ì‚¬ìš©ì-ê³„ì •-ë³´ì•ˆ-ê°•í™”--user-account-security">ì‚¬ìš©ì ê³„ì • ë³´ì•ˆ ê°•í™” | User Account Security</h2>

<h3 id="-ì‚¬ìš©ì-ê³„ì •-ê´€ë¦¬-ê¸°ì´ˆ">ğŸ‘¤ ì‚¬ìš©ì ê³„ì • ê´€ë¦¬ ê¸°ì´ˆ</h3>

<h4 id="ì•ˆì „í•œ-ì‚¬ìš©ì-ìƒì„±-ë°-ê´€ë¦¬">ì•ˆì „í•œ ì‚¬ìš©ì ìƒì„± ë° ê´€ë¦¬</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë³´ì•ˆì„ ê³ ë ¤í•œ ì‚¬ìš©ì ìƒì„±</span>
<span class="c"># ì‹œìŠ¤í…œ ì‚¬ìš©ì (ì„œë¹„ìŠ¤ìš©)</span>
useradd <span class="nt">-r</span> <span class="nt">-s</span> /usr/sbin/nologin <span class="nt">-d</span> /var/lib/myservice <span class="nt">-c</span> <span class="s2">"MyService System User"</span> myservice

<span class="c"># ì¼ë°˜ ì‚¬ìš©ì ìƒì„± (í™ˆ ë””ë ‰í† ë¦¬ ê¶Œí•œ ê°•í™”)</span>
useradd <span class="nt">-m</span> <span class="nt">-s</span> /bin/bash <span class="nt">-c</span> <span class="s2">"John Doe"</span> <span class="nt">-G</span> <span class="nb">users </span>john
<span class="nb">chmod </span>750 /home/john
<span class="nb">chown </span>john:john /home/john

<span class="c"># ì‚¬ìš©ì ì •ë³´ í™•ì¸</span>
<span class="nb">id </span>john
<span class="nb">groups </span>john
finger john
last john

<span class="c"># ì‚¬ìš©ì ê³„ì • ì ê¸ˆ/í•´ì œ</span>
usermod <span class="nt">-L</span> john    <span class="c"># ê³„ì • ì ê¸ˆ</span>
usermod <span class="nt">-U</span> john    <span class="c"># ê³„ì • í•´ì œ</span>
passwd <span class="nt">-l</span> john     <span class="c"># íŒ¨ìŠ¤ì›Œë“œ ì ê¸ˆ</span>
passwd <span class="nt">-u</span> john     <span class="c"># íŒ¨ìŠ¤ì›Œë“œ í•´ì œ</span>

<span class="c"># ê³„ì • ë§Œë£Œ ì„¤ì •</span>
usermod <span class="nt">-e</span> 2024-12-31 john    <span class="c"># ê³„ì • ë§Œë£Œì¼ ì„¤ì •</span>
chage <span class="nt">-E</span> 2024-12-31 john      <span class="c"># ë™ì¼í•œ ê¸°ëŠ¥</span>

<span class="c"># ë¹„í™œì„± ì‚¬ìš©ì ê³„ì • ì°¾ê¸°</span>
lastlog | <span class="nb">awk</span> <span class="s1">'$2 == "Never" || $2 &lt; "'</span><span class="si">$(</span><span class="nb">date</span> <span class="nt">-d</span> <span class="s1">'90 days ago'</span> <span class="s1">'+%Y-%m-%d'</span><span class="si">)</span><span class="s1">'" {print $1}'</span>

<span class="c"># ë¶ˆí•„ìš”í•œ ê³„ì • ì œê±°</span>
userdel <span class="nt">-r</span> olduser    <span class="c"># í™ˆ ë””ë ‰í† ë¦¬ë„ í•¨ê»˜ ì‚­ì œ</span>
</code></pre></div></div>

<h4 id="ê°•ë ¥í•œ-íŒ¨ìŠ¤ì›Œë“œ-ì •ì±…-êµ¬í˜„">ê°•ë ¥í•œ íŒ¨ìŠ¤ì›Œë“œ ì •ì±… êµ¬í˜„</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># PAM ê¸°ë°˜ íŒ¨ìŠ¤ì›Œë“œ ë³µì¡ì„± ì„¤ì •</span>
<span class="c"># /etc/pam.d/common-password (Ubuntu/Debian)</span>
password requisite pam_pwquality.so <span class="nv">retry</span><span class="o">=</span>3 <span class="nv">minlen</span><span class="o">=</span>14 <span class="nv">minclass</span><span class="o">=</span>4 <span class="nv">maxrepeat</span><span class="o">=</span>2 <span class="nv">ucredit</span><span class="o">=</span><span class="nt">-2</span> <span class="nv">lcredit</span><span class="o">=</span><span class="nt">-2</span> <span class="nv">dcredit</span><span class="o">=</span><span class="nt">-2</span> <span class="nv">ocredit</span><span class="o">=</span><span class="nt">-2</span> <span class="nv">difok</span><span class="o">=</span>4 <span class="nv">gecoscheck</span><span class="o">=</span>1 <span class="nv">dictcheck</span><span class="o">=</span>1

<span class="c"># /etc/security/pwquality.conf ìƒì„¸ ì„¤ì •</span>
<span class="c"># íŒ¨ìŠ¤ì›Œë“œ ê¸¸ì´ ë° ë³µì¡ì„±</span>
minlen <span class="o">=</span> 14              <span class="c"># ìµœì†Œ 14ì</span>
minclass <span class="o">=</span> 4             <span class="c"># 4ê°œ ë¬¸ì í´ë˜ìŠ¤ ëª¨ë‘ í¬í•¨</span>
maxrepeat <span class="o">=</span> 2            <span class="c"># ì—°ì† ë™ì¼ ë¬¸ì 2ê°œ ì´í•˜</span>
maxclasssrepeat <span class="o">=</span> 3      <span class="c"># ë™ì¼ í´ë˜ìŠ¤ ì—°ì† 3ê°œ ì´í•˜</span>

<span class="c"># ë¬¸ìë³„ ìµœì†Œ ê°œìˆ˜ (ìŒìˆ˜ëŠ” í•„ìˆ˜)</span>
ucredit <span class="o">=</span> <span class="nt">-2</span>             <span class="c"># ëŒ€ë¬¸ì ìµœì†Œ 2ê°œ</span>
lcredit <span class="o">=</span> <span class="nt">-2</span>             <span class="c"># ì†Œë¬¸ì ìµœì†Œ 2ê°œ  </span>
dcredit <span class="o">=</span> <span class="nt">-2</span>             <span class="c"># ìˆ«ì ìµœì†Œ 2ê°œ</span>
ocredit <span class="o">=</span> <span class="nt">-2</span>             <span class="c"># íŠ¹ìˆ˜ë¬¸ì ìµœì†Œ 2ê°œ</span>

<span class="c"># íŒ¨ìŠ¤ì›Œë“œ í’ˆì§ˆ ê²€ì‚¬</span>
difok <span class="o">=</span> 4                <span class="c"># ì´ì „ íŒ¨ìŠ¤ì›Œë“œì™€ ìµœì†Œ 4ê¸€ì ì°¨ì´</span>
gecoscheck <span class="o">=</span> 1           <span class="c"># GECOS í•„ë“œ(ì´ë¦„ ë“±) í¬í•¨ ê¸ˆì§€</span>
dictcheck <span class="o">=</span> 1            <span class="c"># ì‚¬ì „ ë‹¨ì–´ ì‚¬ìš© ê¸ˆì§€</span>
usercheck <span class="o">=</span> 1            <span class="c"># ì‚¬ìš©ìëª… í¬í•¨ ê¸ˆì§€</span>
enforcing <span class="o">=</span> 1            <span class="c"># ì—„ê²©í•œ ì •ì±… ì ìš©</span>

<span class="c"># ê¸ˆì§€ íŒ¨ìŠ¤ì›Œë“œ ëª©ë¡</span>
badwords <span class="o">=</span> password 123456 qwerty admin root

<span class="c"># íŒ¨ìŠ¤ì›Œë“œ ì—ì´ì§• ì •ì±… (ê³ ê¸‰)</span>
<span class="c"># /etc/login.defs</span>
PASS_MAX_DAYS   60       <span class="c"># ìµœëŒ€ 60ì¼ ìœ íš¨</span>
PASS_MIN_DAYS   7        <span class="c"># ìµœì†Œ 7ì¼ í›„ ë³€ê²½ ê°€ëŠ¥</span>
PASS_MIN_LEN    14       <span class="c"># ìµœì†Œ 14ì</span>
PASS_WARN_AGE   7        <span class="c"># ë§Œë£Œ 7ì¼ ì „ ê²½ê³ </span>
ENCRYPT_METHOD  SHA512   <span class="c"># ê°•ë ¥í•œ í•´ì‹œ ì•Œê³ ë¦¬ì¦˜</span>

<span class="c"># ê¸°ì¡´ ì‚¬ìš©ìì—ê²Œ ì •ì±… ì ìš© ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="k">for </span>user <span class="k">in</span> <span class="si">$(</span><span class="nb">cut</span> <span class="nt">-d</span>: <span class="nt">-f1</span> /etc/passwd | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"^#"</span> | <span class="nb">sort</span><span class="si">)</span><span class="p">;</span> <span class="k">do</span>
    <span class="c"># ì‹œìŠ¤í…œ ê³„ì •ì€ ì œì™¸ (UID 1000 ë¯¸ë§Œ)</span>
    <span class="nv">uid</span><span class="o">=</span><span class="si">$(</span><span class="nb">id</span> <span class="nt">-u</span> <span class="s2">"</span><span class="nv">$user</span><span class="s2">"</span> 2&gt;/dev/null<span class="si">)</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="nv">$uid</span> <span class="nt">-ge</span> 1000 <span class="o">&amp;&amp;</span> <span class="nv">$uid</span> <span class="nt">-le</span> 60000 <span class="o">]]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Applying password policy to </span><span class="nv">$user</span><span class="s2">..."</span>
        chage <span class="nt">-M</span> 60 <span class="nt">-m</span> 7 <span class="nt">-W</span> 7 <span class="s2">"</span><span class="nv">$user</span><span class="s2">"</span>
        <span class="c"># ë‹¤ìŒ ë¡œê·¸ì¸ ì‹œ íŒ¨ìŠ¤ì›Œë“œ ë³€ê²½ ê°•ì œ</span>
        chage <span class="nt">-d</span> 0 <span class="s2">"</span><span class="nv">$user</span><span class="s2">"</span>
    <span class="k">fi
done</span>
</code></pre></div></div>

<h4 id="ê³„ì •-ì ê¸ˆ-ë°-ë¸Œë£¨íŠ¸í¬ìŠ¤-ë°©ì§€">ê³„ì • ì ê¸ˆ ë° ë¸Œë£¨íŠ¸í¬ìŠ¤ ë°©ì§€</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># PAM ê¸°ë°˜ ê³„ì • ì ê¸ˆ ì„¤ì • (ìµœì‹  ë°©ì‹)</span>
<span class="c"># /etc/pam.d/common-auth</span>
auth required pam_faillock.so preauth silent audit <span class="nv">deny</span><span class="o">=</span>5 <span class="nv">unlock_time</span><span class="o">=</span>900 <span class="nv">fail_interval</span><span class="o">=</span>900
auth <span class="o">[</span><span class="nv">default</span><span class="o">=</span>die] pam_faillock.so authfail audit <span class="nv">deny</span><span class="o">=</span>5 <span class="nv">unlock_time</span><span class="o">=</span>900 <span class="nv">fail_interval</span><span class="o">=</span>900
auth sufficient pam_unix.so nullok_secure
auth <span class="o">[</span><span class="nv">default</span><span class="o">=</span>die] pam_faillock.so authsucc audit <span class="nv">deny</span><span class="o">=</span>5 <span class="nv">unlock_time</span><span class="o">=</span>900 <span class="nv">fail_interval</span><span class="o">=</span>900

<span class="c"># /etc/pam.d/common-accountì— ì¶”ê°€</span>
account required pam_faillock.so

<span class="c"># faillock ì„¤ì • íŒŒì¼</span>
<span class="c"># /etc/security/faillock.conf</span>
<span class="nb">dir</span> <span class="o">=</span> /var/run/faillock
audit
silent
deny <span class="o">=</span> 5
fail_interval <span class="o">=</span> 900      <span class="c"># 15ë¶„ ê°„ê²©</span>
unlock_time <span class="o">=</span> 1800       <span class="c"># 30ë¶„ ì ê¸ˆ</span>
even_deny_root          <span class="c"># ë£¨íŠ¸ë„ ì ê¸ˆ ì ìš©</span>
root_unlock_time <span class="o">=</span> 60    <span class="c"># ë£¨íŠ¸ëŠ” 1ë¶„ë§Œ ì ê¸ˆ</span>

<span class="c"># faillock ê´€ë¦¬ ëª…ë ¹</span>
faillock <span class="nt">--user</span> john     <span class="c"># ì‚¬ìš©ì ì‹¤íŒ¨ íšŸìˆ˜ í™•ì¸</span>
faillock <span class="nt">--user</span> john <span class="nt">--reset</span>   <span class="c"># ì‚¬ìš©ì ì ê¸ˆ í•´ì œ</span>
faillock <span class="nt">--reset</span>        <span class="c"># ëª¨ë“  ì‚¬ìš©ì ì ê¸ˆ í•´ì œ</span>

<span class="c"># ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/monitor-auth-failures.sh</span>
<span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">"/var/log/auth.log"</span>
<span class="nv">ALERT_THRESHOLD</span><span class="o">=</span>3

<span class="nb">tail</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$LOG_FILE</span><span class="s2">"</span> | <span class="k">while </span><span class="nb">read </span>line<span class="p">;</span> <span class="k">do
    if </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"authentication failure"</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">user</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-o</span> <span class="s2">"user=[^ ]*"</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="o">=</span> <span class="nt">-f2</span><span class="si">)</span>
        <span class="nv">ip</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-o</span> <span class="s2">"rhost=[^ ]*"</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="o">=</span> <span class="nt">-f2</span><span class="si">)</span>
        
        <span class="c"># ìµœê·¼ 5ë¶„ê°„ ì‹¤íŒ¨ íšŸìˆ˜ ê³„ì‚°</span>
        <span class="nv">failures</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-c</span> <span class="s2">"authentication failure.*user=</span><span class="nv">$user</span><span class="s2">.*rhost=</span><span class="nv">$ip</span><span class="s2">"</span> <span class="se">\</span>
                  &lt;<span class="o">(</span><span class="nb">tail</span> <span class="nt">-n</span> 1000 <span class="s2">"</span><span class="nv">$LOG_FILE</span><span class="s2">"</span> | <span class="se">\</span>
                    <span class="nb">awk</span> <span class="nt">-v</span> <span class="nv">since</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">date</span> <span class="nt">-d</span> <span class="s1">'5 minutes ago'</span> <span class="s1">'+%b %d %H:%M'</span><span class="si">)</span><span class="s2">"</span> <span class="se">\</span>
                    <span class="s1">'$0 &gt;= since'</span><span class="o">)</span><span class="si">)</span>
        
        <span class="k">if</span> <span class="o">[[</span> <span class="nv">$failures</span> <span class="nt">-ge</span> <span class="nv">$ALERT_THRESHOLD</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">: ALERT - Multiple auth failures for user </span><span class="nv">$user</span><span class="s2"> from </span><span class="nv">$ip</span><span class="s2"> (</span><span class="nv">$failures</span><span class="s2"> attempts)"</span>
            <span class="c"># ì•Œë¦¼ ë°œì†¡ (ì„ íƒì‚¬í•­)</span>
            <span class="c"># echo "Authentication attack detected: $user from $ip" | \</span>
            <span class="c"># mail -s "Security Alert" admin@company.com</span>
        <span class="k">fi
    fi
done</span>
</code></pre></div></div>

<h3 id="-ë£¨íŠ¸-ê³„ì •-ë³´ì•ˆ-ê°•í™”">ğŸ” ë£¨íŠ¸ ê³„ì • ë³´ì•ˆ ê°•í™”</h3>

<h4 id="ë£¨íŠ¸-ì ‘ê·¼-ì œí•œ-ë°-sudo-êµ¬ì„±">ë£¨íŠ¸ ì ‘ê·¼ ì œí•œ ë° sudo êµ¬ì„±</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë£¨íŠ¸ ì§ì ‘ ë¡œê·¸ì¸ ì™„ì „ ì°¨ë‹¨</span>
<span class="c"># /etc/ssh/sshd_config</span>
PermitRootLogin no

<span class="c"># ì½˜ì†” ë£¨íŠ¸ ë¡œê·¸ì¸ ì œí•œ</span>
<span class="c"># /etc/securetty (ë¹„ì–´ìˆê²Œ í•˜ë©´ ì½˜ì†” ë¡œê·¸ì¸ ì°¨ë‹¨)</span>
<span class="o">&gt;</span> /etc/securetty

<span class="c"># ë˜ëŠ” íŠ¹ì • í„°ë¯¸ë„ë§Œ í—ˆìš©</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/securetty <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
console
tty1
</span><span class="no">EOF

</span><span class="c"># sudo ê¶Œí•œ ì„¸ë°€í•œ ì œì–´</span>
<span class="c"># /etc/sudoers.d/custom-rules</span>

<span class="c"># 1. ê·¸ë£¹ ê¸°ë°˜ ê¶Œí•œ ì„¤ì •</span>
%wheel <span class="nv">ALL</span><span class="o">=(</span>ALL:ALL<span class="o">)</span> ALL
%admin <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> NOPASSWD: /usr/bin/systemctl restart <span class="k">*</span>, /usr/bin/systemctl reload <span class="k">*</span>

<span class="c"># 2. ì‚¬ìš©ìë³„ ì„¸ë¶€ ê¶Œí•œ</span>
<span class="c"># ì›¹ ì„œë²„ ê´€ë¦¬ì</span>
webadmin <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> /usr/sbin/service apache2 <span class="k">*</span>, /usr/sbin/service nginx <span class="k">*</span>, <span class="se">\</span>
              /usr/bin/systemctl restart apache2, /usr/bin/systemctl reload nginx, <span class="se">\</span>
              /usr/bin/tail <span class="nt">-f</span> /var/log/apache2/<span class="k">*</span>, /usr/bin/tail <span class="nt">-f</span> /var/log/nginx/<span class="k">*</span>

<span class="c"># ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ì  </span>
dbadmin <span class="nv">ALL</span><span class="o">=(</span>postgres<span class="o">)</span> NOPASSWD: /usr/bin/psql, /usr/bin/pg_dump, /usr/bin/pg_restore
dbadmin <span class="nv">ALL</span><span class="o">=(</span>mysql<span class="o">)</span> NOPASSWD: /usr/bin/mysql, /usr/bin/mysqldump

<span class="c"># ë°±ì—… ê´€ë¦¬ì</span>
backup <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> NOPASSWD: /usr/bin/rsync, /bin/tar, /bin/gzip, /usr/bin/find /home <span class="nt">-name</span> <span class="s2">"*"</span>

<span class="c"># 3. ëª…ë ¹ ì œí•œ ë° ì¸ìˆ˜ ì œí•œ</span>
developer <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> /usr/bin/systemctl status <span class="k">*</span>, <span class="o">!</span>/usr/bin/systemctl <span class="k">*</span> <span class="nt">--force</span>

<span class="c"># 4. ì‹œê°„ ì œí•œ</span>
nightshift <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> NOPASSWD: /usr/bin/systemctl restart <span class="k">*</span> <span class="se">\</span>
    <span class="c"># ì•¼ê°„ ê·¼ë¬´ ì‹œê°„ì—ë§Œ í—ˆìš© (ì˜ˆì‹œ)</span>

<span class="c"># 5. í˜¸ìŠ¤íŠ¸ ê¸°ë°˜ ì œí•œ</span>
john <span class="nv">server1</span><span class="o">=(</span>ALL<span class="o">)</span> /bin/ls, /bin/cat /var/log/<span class="k">*</span>

<span class="c"># sudo ë¡œê¹… ê°•í™”</span>
<span class="c"># /etc/sudoersì— ì¶”ê°€</span>
Defaults    <span class="nv">logfile</span><span class="o">=</span><span class="s2">"/var/log/sudo.log"</span>
Defaults    log_input, log_output      <span class="c"># ì…ì¶œë ¥ ë¡œê¹…</span>
Defaults    <span class="nv">iolog_dir</span><span class="o">=</span><span class="s2">"/var/log/sudo-io/%{user}/%{time}"</span>
Defaults    <span class="nv">timestamp_timeout</span><span class="o">=</span>0        <span class="c"># ìºì‹œ ë¹„í™œì„±í™”</span>
Defaults    <span class="nv">passwd_tries</span><span class="o">=</span>3            <span class="c"># 3íšŒ ì‹œë„ í›„ ì‹¤íŒ¨</span>
Defaults    <span class="nv">passwd_timeout</span><span class="o">=</span>5          <span class="c"># 5ë¶„ íƒ€ì„ì•„ì›ƒ</span>
Defaults    env_reset                 <span class="c"># í™˜ê²½ë³€ìˆ˜ ì´ˆê¸°í™”</span>
Defaults    mail_badpass              <span class="c"># ì˜ëª»ëœ íŒ¨ìŠ¤ì›Œë“œ ì‹œ ë©”ì¼</span>
Defaults    <span class="nv">secure_path</span><span class="o">=</span><span class="s2">"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span>

<span class="c"># sudo ì„¸ì…˜ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/sudo-monitor.sh</span>
<span class="nv">SUDO_LOG</span><span class="o">=</span><span class="s2">"/var/log/sudo.log"</span>
<span class="nv">ALERT_EMAIL</span><span class="o">=</span><span class="s2">"admin@company.com"</span>

<span class="c"># ìœ„í—˜í•œ ëª…ë ¹ì–´ íŒ¨í„´</span>
<span class="nv">DANGEROUS_PATTERNS</span><span class="o">=(</span>
    <span class="s2">"rm -rf /"</span>
    <span class="s2">"dd if="</span>
    <span class="s2">"mkfs</span><span class="se">\.</span><span class="s2">"</span>
    <span class="s2">"fdisk"</span>
    <span class="s2">"parted"</span>
    <span class="s2">"chmod 777"</span>
    <span class="s2">"chown root"</span>
    <span class="s2">"/bin/bash"</span>
    <span class="s2">"/bin/sh"</span>
    <span class="s2">"su -"</span>
    <span class="s2">"passwd root"</span>
    <span class="s2">"userdel"</span>
    <span class="s2">"usermod -u 0"</span>
<span class="o">)</span>

<span class="nb">tail</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$SUDO_LOG</span><span class="s2">"</span> | <span class="k">while </span><span class="nb">read </span>line<span class="p">;</span> <span class="k">do
    for </span>pattern <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">DANGEROUS_PATTERNS</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
        if </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-i</span> <span class="s2">"</span><span class="nv">$pattern</span><span class="s2">"</span> <span class="o">&gt;</span>/dev/null<span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">: DANGEROUS SUDO COMMAND DETECTED: </span><span class="nv">$line</span><span class="s2">"</span>
            <span class="nb">echo</span> <span class="s2">"Dangerous sudo command executed: </span><span class="nv">$line</span><span class="s2">"</span> | <span class="se">\</span>
            mail <span class="nt">-s</span> <span class="s2">"SECURITY ALERT: Dangerous Command"</span> <span class="s2">"</span><span class="nv">$ALERT_EMAIL</span><span class="s2">"</span>
        <span class="k">fi
    done
done</span>
</code></pre></div></div>

<h3 id="-ê³ ê¸‰-ì¸ì¦-ë©”ì»¤ë‹ˆì¦˜">ğŸ”‘ ê³ ê¸‰ ì¸ì¦ ë©”ì»¤ë‹ˆì¦˜</h3>

<h4 id="ë‹¤ì¤‘-ì¸ì¦-ìš”ì†Œ-mfa-êµ¬í˜„">ë‹¤ì¤‘ ì¸ì¦ ìš”ì†Œ (MFA) êµ¬í˜„</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Google Authenticator (TOTP) ì„¤ì •</span>
<span class="c"># 1. íŒ¨í‚¤ì§€ ì„¤ì¹˜</span>
apt-get <span class="nb">install </span>libpam-google-authenticator

<span class="c"># 2. ì‚¬ìš©ìë³„ ì„¤ì • (ê° ì‚¬ìš©ìê°€ ì‹¤í–‰)</span>
google-authenticator
<span class="c"># - ì‹œê°„ ê¸°ë°˜ í† í° ì‚¬ìš©: y</span>
<span class="c"># - QR ì½”ë“œ í‘œì‹œ í›„ ì•±ì— ë“±ë¡</span>
<span class="c"># - ê¸´ê¸‰ ìŠ¤í¬ë˜ì¹˜ ì½”ë“œ ì €ì¥</span>
<span class="c"># - í† í° ì¬ì‚¬ìš© ë°©ì§€: y</span>
<span class="c"># - ì‹œê°„ í—ˆìš© ì˜¤ì°¨: y</span>

<span class="c"># 3. SSHì—ì„œ MFA í™œì„±í™”</span>
<span class="c"># /etc/pam.d/sshdì— ì¶”ê°€ (password ì¤„ ìœ„ì—)</span>
auth required pam_google_authenticator.so

<span class="c"># /etc/ssh/sshd_config ìˆ˜ì •</span>
ChallengeResponseAuthentication <span class="nb">yes
</span>AuthenticationMethods publickey,keyboard-interactive

<span class="c"># 4. sudoì—ì„œ MFA ì ìš©</span>
<span class="c"># /etc/pam.d/sudoì— ì¶”ê°€</span>
auth required pam_google_authenticator.so

<span class="c"># 5. MFA ë°±ì—… ë° ë³µêµ¬</span>
<span class="c"># ì‚¬ìš©ìë³„ ì„¤ì • ë°±ì—…</span>
<span class="nb">cp</span> ~/.google_authenticator ~/.google_authenticator.backup

<span class="c"># ê´€ë¦¬ììš© ê¸´ê¸‰ ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/mfa-recovery.sh</span>
<span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"Username: "</span> username
<span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"Emergency scratch code: "</span> scratch_code

<span class="k">if </span><span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"</span><span class="nv">$scratch_code</span><span class="s2">"</span> <span class="s2">"/home/</span><span class="nv">$username</span><span class="s2">/.google_authenticator"</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"Valid scratch code. Temporarily disabling MFA..."</span>
    <span class="nb">mv</span> <span class="s2">"/home/</span><span class="nv">$username</span><span class="s2">/.google_authenticator"</span> <span class="s2">"/home/</span><span class="nv">$username</span><span class="s2">/.google_authenticator.disabled"</span>
    <span class="nb">echo</span> <span class="s2">"MFA disabled for </span><span class="nv">$username</span><span class="s2">. Re-enable after password reset."</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"Invalid scratch code."</span>
<span class="k">fi</span>
</code></pre></div></div>

<h4 id="ldapactive-directory-í†µí•©-ì¸ì¦">LDAP/Active Directory í†µí•© ì¸ì¦</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># SSSDë¥¼ ì´ìš©í•œ AD í†µí•© (Ubuntu/CentOS)</span>
<span class="c"># 1. í•„ìš” íŒ¨í‚¤ì§€ ì„¤ì¹˜</span>
apt-get <span class="nb">install </span>sssd sssd-tools realmd adcli packagekit

<span class="c"># 2. ë„ë©”ì¸ ë°œê²¬ ë° ê°€ì…</span>
realm discover company.local
realm <span class="nb">join</span> <span class="nt">-U</span> administrator company.local

<span class="c"># 3. SSSD êµ¬ì„±</span>
<span class="c"># /etc/sssd/sssd.conf</span>
<span class="o">[</span>sssd]
domains <span class="o">=</span> company.local
config_file_version <span class="o">=</span> 2
services <span class="o">=</span> nss, pam

<span class="o">[</span>domain/company.local]
default_shell <span class="o">=</span> /bin/bash
krb5_store_password_if_offline <span class="o">=</span> True
cache_credentials <span class="o">=</span> True
krb5_realm <span class="o">=</span> COMPANY.LOCAL
realmd_tags <span class="o">=</span> manages-system joined-with-adcli
id_provider <span class="o">=</span> ad
fallback_homedir <span class="o">=</span> /home/%u@%d
ad_domain <span class="o">=</span> company.local
use_fully_qualified_names <span class="o">=</span> True
ldap_id_mapping <span class="o">=</span> True
access_provider <span class="o">=</span> ad

<span class="c"># íŠ¹ì • ê·¸ë£¹ë§Œ í—ˆìš©</span>
ad_access_filter <span class="o">=</span> <span class="o">(</span><span class="nv">memberOf</span><span class="o">=</span><span class="nv">CN</span><span class="o">=</span>Linux-Users,OU<span class="o">=</span>Groups,DC<span class="o">=</span>company,DC<span class="o">=</span><span class="nb">local</span><span class="o">)</span>

<span class="nb">chmod </span>600 /etc/sssd/sssd.conf
systemctl <span class="nb">enable </span>sssd
systemctl start sssd

<span class="c"># 4. í™ˆ ë””ë ‰í† ë¦¬ ìë™ ìƒì„±</span>
<span class="c"># /etc/pam.d/common-sessionì— ì¶”ê°€</span>
session required pam_mkhomedir.so <span class="nv">skel</span><span class="o">=</span>/etc/skel <span class="nb">umask</span><span class="o">=</span>0022

<span class="c"># 5. sudo ê¶Œí•œ ì„¤ì • (AD ê·¸ë£¹ ê¸°ë°˜)</span>
<span class="c"># /etc/sudoers.d/ad-groups</span>
%domain<span class="se">\ </span>admins@company.local <span class="nv">ALL</span><span class="o">=(</span>ALL:ALL<span class="o">)</span> ALL
%linux-administrators@company.local <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> NOPASSWD: /usr/bin/systemctl <span class="k">*</span>, /usr/sbin/service <span class="k">*</span>

<span class="c"># 6. ì—°ê²° í…ŒìŠ¤íŠ¸</span>
getent passwd user@company.local
<span class="nb">id </span>user@company.local
su - user@company.local
</code></pre></div></div>

<h3 id="-ì„¸ì…˜-ë°-ë¡œê·¸ì¸-ì œì–´">ğŸ›‚ ì„¸ì…˜ ë° ë¡œê·¸ì¸ ì œì–´</h3>

<h4 id="ê³ ê¸‰-ë¡œê·¸ì¸-ì œì–´-ì„¤ì •">ê³ ê¸‰ ë¡œê·¸ì¸ ì œì–´ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/security/access.conf - ì•¡ì„¸ìŠ¤ ì œì–´</span>
<span class="c"># í˜•ì‹: ê¶Œí•œ:ì‚¬ìš©ì/ê·¸ë£¹:í„°ë¯¸ë„/í˜¸ìŠ¤íŠ¸</span>

<span class="c"># ë£¨íŠ¸ëŠ” ë¡œì»¬ì—ì„œë§Œ ë¡œê·¸ì¸ í—ˆìš©</span>
+ : root : LOCAL
- : root : ALL

<span class="c"># admin ê·¸ë£¹ì€ íŠ¹ì • IPì—ì„œë§Œ</span>
+ : @admin : 192.168.1.0/24
- : @admin : ALL

<span class="c"># íŠ¹ì • ì‚¬ìš©ìëŠ” íŠ¹ì • ì‹œê°„ì—ë§Œ</span>
+ : nightshift : ALL EXCEPT HOLIDAYS
- : nightshift : Wl0800-1800

<span class="c"># ì‹œê°„ ê¸°ë°˜ ì ‘ê·¼ ì œì–´</span>
<span class="c"># /etc/security/time.conf</span>
login<span class="p">;</span><span class="k">*</span><span class="p">;</span><span class="nb">users</span><span class="p">;</span>Al0800-1800
sshd<span class="p">;</span><span class="k">*</span><span class="p">;</span>developers<span class="p">;</span>MoTuWeThFr0900-1800

<span class="c"># ë¡œê·¸ì¸ ì‹œë„ ì œí•œ</span>
<span class="c"># /etc/security/limits.conf</span>
<span class="c"># ì‚¬ìš©ìë³„ ë™ì‹œ ë¡œê·¸ì¸ ì„¸ì…˜ ì œí•œ</span>
@users hard maxlogins 2
john hard maxlogins 1

<span class="c"># í”„ë¡œì„¸ìŠ¤ ìˆ˜ ì œí•œ (í¬í¬ í­íƒ„ ë°©ì§€)</span>
@users hard <span class="nb">nproc </span>1024
@developers hard <span class="nb">nproc </span>2048

<span class="c"># ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì œí•œ</span>
@users hard as 1048576    <span class="c"># 1GB</span>

<span class="c"># íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ì œí•œ</span>
@users hard nofile 4096

<span class="c"># ì½”ì–´ ë¤í”„ ë¹„í™œì„±í™”</span>
<span class="k">*</span> hard core 0

<span class="c"># ë¡œê·¸ì¸ ë°°ë„ˆ ì„¤ì •</span>
<span class="c"># /etc/issue (ì½˜ì†” ë¡œê·¸ì¸)</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/issue <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
**********************************************************************
*                        WARNING NOTICE                             *
*                                                                    *
* This system is for authorized users only. All activities may be   *
* monitored and recorded. Unauthorized access is prohibited and     *
* will be prosecuted to the full extent of the law.                *
*                                                                    *
**********************************************************************
</span><span class="no">
EOF

</span><span class="c"># /etc/issue.net (ë„¤íŠ¸ì›Œí¬ ë¡œê·¸ì¸)</span>
<span class="nb">cp</span> /etc/issue /etc/issue.net

<span class="c"># /etc/motd (ë¡œê·¸ì¸ í›„ ë©”ì‹œì§€)</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/motd <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
System Information:
- Last system update: </span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="sh">
- Security policy: https://company.com/security-policy
- Report security incidents: security@company.com
</span><span class="no">
EOF

</span><span class="c"># ë™ì  MOTD ìƒì„± ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /etc/update-motd.d/10-sysinfo</span>
<span class="nb">echo</span> <span class="s2">"System Status as of </span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"======================================"</span>
<span class="nb">echo</span> <span class="s2">"Hostname: </span><span class="si">$(</span><span class="nb">hostname</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Kernel: </span><span class="si">$(</span><span class="nb">uname</span> <span class="nt">-r</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Uptime: </span><span class="si">$(</span><span class="nb">uptime</span> <span class="nt">-p</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Load: </span><span class="si">$(</span><span class="nb">cat</span> /proc/loadavg | <span class="nb">awk</span> <span class="s1">'{print $1", "$2", "$3}'</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Memory: </span><span class="si">$(</span>free <span class="nt">-h</span> | <span class="nb">awk</span> <span class="s1">'NR==2{printf "%.1fG/%.1fG (%.1f%%)", $3/1024, $2/1024, $3*100/$2}'</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Disk: </span><span class="si">$(</span><span class="nb">df</span> <span class="nt">-h</span> / | <span class="nb">awk</span> <span class="s1">'NR==2{printf "%s/%s (%s)", $3, $2, $5}'</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">""</span>

<span class="c"># ë³´ì•ˆ ìƒíƒœ í™•ì¸</span>
<span class="k">if </span>systemctl is-active <span class="nt">--quiet</span> fail2ban<span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"âœ“ Fail2ban: Active"</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"âœ— Fail2ban: Inactive"</span>
<span class="k">fi

if </span>systemctl is-active <span class="nt">--quiet</span> sshd<span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"âœ“ SSH: Active"</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"âœ— SSH: Inactive"</span>  
<span class="k">fi

</span><span class="nb">echo</span> <span class="s2">"======================================"</span>
<span class="nb">echo</span> <span class="s2">""</span>

<span class="nb">chmod</span> +x /etc/update-motd.d/10-sysinfo
</code></pre></div></div>

<h3 id="-ì¸ì¦-ë¡œê·¸-ëª¨ë‹ˆí„°ë§-ë°-ë¶„ì„">ğŸ“Š ì¸ì¦ ë¡œê·¸ ëª¨ë‹ˆí„°ë§ ë° ë¶„ì„</h3>

<h4 id="ì‹¤ì‹œê°„-ë¡œê·¸ì¸-ëª¨ë‹ˆí„°ë§-ì‹œìŠ¤í…œ">ì‹¤ì‹œê°„ ë¡œê·¸ì¸ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
# /usr/local/bin/auth-monitor.py
</span><span class="kn">import</span> <span class="n">re</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">subprocess</span>
<span class="kn">import</span> <span class="n">smtplib</span>
<span class="kn">from</span> <span class="n">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>
<span class="kn">from</span> <span class="n">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">deque</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="k">class</span> <span class="nc">AuthenticationMonitor</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">failed_attempts</span> <span class="o">=</span> <span class="nf">defaultdict</span><span class="p">(</span><span class="n">deque</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">successful_logins</span> <span class="o">=</span> <span class="nf">defaultdict</span><span class="p">(</span><span class="n">deque</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">suspicious_ips</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">alert_threshold</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">self</span><span class="p">.</span><span class="n">time_window</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># 5 minutes
</span>        
    <span class="k">def</span> <span class="nf">parse_log_line</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¡œê·¸ ë¼ì¸ íŒŒì‹±</span><span class="sh">"""</span>
        <span class="n">patterns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">failed_password</span><span class="sh">'</span><span class="p">:</span> <span class="sa">r</span><span class="sh">'</span><span class="s">(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*Failed password for (\w+) from (\d+\.\d+\.\d+\.\d+)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">accepted_password</span><span class="sh">'</span><span class="p">:</span> <span class="sa">r</span><span class="sh">'</span><span class="s">(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*Accepted password for (\w+) from (\d+\.\d+\.\d+\.\d+)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">invalid_user</span><span class="sh">'</span><span class="p">:</span> <span class="sa">r</span><span class="sh">'</span><span class="s">(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*Invalid user (\w+) from (\d+\.\d+\.\d+\.\d+)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">sudo_command</span><span class="sh">'</span><span class="p">:</span> <span class="sa">r</span><span class="sh">'</span><span class="s">(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*sudo.*USER=(\w+).*COMMAND=(.*)</span><span class="sh">'</span>
        <span class="p">}</span>
        
        <span class="k">for</span> <span class="n">event_type</span><span class="p">,</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">event_type</span><span class="p">,</span> <span class="k">match</span><span class="p">.</span><span class="nf">groups</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">is_suspicious_ip</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì˜ì‹¬ìŠ¤ëŸ¬ìš´ IP íŒë³„</span><span class="sh">"""</span>
        <span class="c1"># ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ IPëŠ” ì œì™¸
</span>        <span class="n">internal_ranges</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sh">'</span><span class="s">192.168.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">10.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.16.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.17.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.18.</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">172.19.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.20.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.21.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.22.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.23.</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">172.24.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.25.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.26.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.27.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.28.</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">172.29.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.30.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">172.31.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">127.</span><span class="sh">'</span>
        <span class="p">]</span>
        
        <span class="k">return</span> <span class="ow">not</span> <span class="nf">any</span><span class="p">(</span><span class="n">ip</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">internal_ranges</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">check_brute_force</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¸Œë£¨íŠ¸í¬ìŠ¤ ê³µê²© í™•ì¸</span><span class="sh">"""</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        
        <span class="c1"># ì˜¤ë˜ëœ ì‹œë„ ì œê±°
</span>        <span class="nf">while </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span> <span class="ow">and</span> 
               <span class="n">now</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">ip</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">self</span><span class="p">.</span><span class="n">time_window</span><span class="p">):</span>
            <span class="n">self</span><span class="p">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">ip</span><span class="p">].</span><span class="nf">popleft</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">ip</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">alert_threshold</span>
    
    <span class="k">def</span> <span class="nf">send_alert</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">alert_type</span><span class="p">,</span> <span class="n">details</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì•Œë¦¼ ë°œì†¡</span><span class="sh">"""</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"""</span><span class="s">
Security Alert: </span><span class="si">{</span><span class="n">alert_type</span><span class="si">}</span><span class="s">

Time: </span><span class="si">{</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%Y-%m-%d %H</span><span class="si">:</span><span class="o">%</span><span class="n">M</span><span class="si">:</span><span class="o">%</span><span class="n">S</span><span class="sh">'</span><span class="s">)</span><span class="si">}</span><span class="s">
Details: </span><span class="si">{</span><span class="n">details</span><span class="si">}</span><span class="s">

System: </span><span class="si">{</span><span class="n">subprocess</span><span class="p">.</span><span class="nf">check_output</span><span class="p">(</span><span class="sh">'</span><span class="s">hostname</span><span class="sh">'</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="nf">decode</span><span class="p">().</span><span class="nf">strip</span><span class="p">()</span><span class="si">}</span><span class="s">

Please investigate immediately.
        </span><span class="sh">"""</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ALERT: </span><span class="si">{</span><span class="n">alert_type</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">details</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># ì´ë©”ì¼ ë°œì†¡ (ì„ íƒì‚¬í•­)
</span>        <span class="c1"># self.send_email("Security Alert", message)
</span>        
        <span class="c1"># ë¡œê·¸ ê¸°ë¡
</span>        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">/var/log/security-alerts.log</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">isoformat</span><span class="p">()</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">alert_type</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">details</span><span class="si">}</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">monitor_log</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">log_file</span><span class="o">=</span><span class="sh">'</span><span class="s">/var/log/auth.log</span><span class="sh">'</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¡œê·¸ ëª¨ë‹ˆí„°ë§ ë©”ì¸ ë£¨í”„</span><span class="sh">"""</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Starting authentication monitoring on </span><span class="si">{</span><span class="n">log_file</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># ê¸°ì¡´ ë¡œê·¸ ì²˜ë¦¬ (ë§ˆì§€ë§‰ 100ì¤„)
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">readlines</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:]:</span>
                    <span class="n">self</span><span class="p">.</span><span class="nf">process_line</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="nf">strip</span><span class="p">())</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Log file </span><span class="si">{</span><span class="n">log_file</span><span class="si">}</span><span class="s"> not found</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
</span>        <span class="n">proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="nc">Popen</span><span class="p">([</span><span class="sh">'</span><span class="s">tail</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">-f</span><span class="sh">'</span><span class="p">,</span> <span class="n">log_file</span><span class="p">],</span> 
                               <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span> 
                               <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span>
                               <span class="n">universal_newlines</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nf">iter</span><span class="p">(</span><span class="n">proc</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">readline</span><span class="p">,</span> <span class="sh">''</span><span class="p">):</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">process_line</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="nf">strip</span><span class="p">())</span>
        <span class="k">except</span> <span class="nb">KeyboardInterrupt</span><span class="p">:</span>
            <span class="n">proc</span><span class="p">.</span><span class="nf">terminate</span><span class="p">()</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Monitoring stopped</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">process_line</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¡œê·¸ ë¼ì¸ ì²˜ë¦¬</span><span class="sh">"""</span>
        <span class="n">event_type</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">parse_log_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">event_type</span><span class="p">:</span>
            <span class="k">return</span>
            
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">event_type</span> <span class="o">==</span> <span class="sh">'</span><span class="s">failed_password</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">timestamp</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">self</span><span class="p">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">ip</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">current_time</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="nf">is_suspicious_ip</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="ow">and</span> <span class="n">self</span><span class="p">.</span><span class="nf">check_brute_force</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">send_alert</span><span class="p">(</span>
                    <span class="sh">"</span><span class="s">Brute Force Attack Detected</span><span class="sh">"</span><span class="p">,</span>
                    <span class="sa">f</span><span class="sh">"</span><span class="s">IP </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s"> failed </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">ip</span><span class="p">])</span><span class="si">}</span><span class="s"> login attempts for user </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="sh">"</span>
                <span class="p">)</span>
                <span class="n">self</span><span class="p">.</span><span class="n">suspicious_ips</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="sh">'</span><span class="s">accepted_password</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">timestamp</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">data</span>
            
            <span class="k">if</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">suspicious_ips</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">send_alert</span><span class="p">(</span>
                    <span class="sh">"</span><span class="s">Successful Login from Suspicious IP</span><span class="sh">"</span><span class="p">,</span>
                    <span class="sa">f</span><span class="sh">"</span><span class="s">User </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s"> logged in from previously suspicious IP </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="sh">"</span>
                <span class="p">)</span>
            
            <span class="c1"># ë¹„ì •ìƒ ì‹œê°„ëŒ€ ë¡œê·¸ì¸ í™•ì¸
</span>            <span class="n">current_hour</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="n">hour</span>
            <span class="k">if</span> <span class="n">current_hour</span> <span class="o">&lt;</span> <span class="mi">6</span> <span class="ow">or</span> <span class="n">current_hour</span> <span class="o">&gt;</span> <span class="mi">22</span><span class="p">:</span>  <span class="c1"># ì˜¤ì „ 6ì‹œ ì´ì „, ì˜¤í›„ 10ì‹œ ì´í›„
</span>                <span class="n">self</span><span class="p">.</span><span class="nf">send_alert</span><span class="p">(</span>
                    <span class="sh">"</span><span class="s">Off-Hours Login</span><span class="sh">"</span><span class="p">,</span>
                    <span class="sa">f</span><span class="sh">"</span><span class="s">User </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s"> logged in from </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s"> at unusual time: </span><span class="si">{</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%H</span><span class="si">:</span><span class="o">%</span><span class="n">M</span><span class="sh">'</span><span class="s">)</span><span class="si">}</span><span class="sh">"</span>
                <span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="sh">'</span><span class="s">invalid_user</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">timestamp</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">send_alert</span><span class="p">(</span>
                <span class="sh">"</span><span class="s">Invalid User Login Attempt</span><span class="sh">"</span><span class="p">,</span>
                <span class="sa">f</span><span class="sh">"</span><span class="s">Attempt to login as non-existent user </span><span class="sh">'</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="sh">'</span><span class="s"> from </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="sh">"</span>
            <span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="sh">'</span><span class="s">sudo_command</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">timestamp</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="n">data</span>
            
            <span class="c1"># ìœ„í—˜í•œ ëª…ë ¹ì–´ ê°ì§€
</span>            <span class="n">dangerous_patterns</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">rm -rf</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">dd if=</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">mkfs</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">fdisk</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">passwd root</span><span class="sh">'</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">dangerous_patterns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">command</span><span class="p">:</span>
                    <span class="n">self</span><span class="p">.</span><span class="nf">send_alert</span><span class="p">(</span>
                        <span class="sh">"</span><span class="s">Dangerous Sudo Command</span><span class="sh">"</span><span class="p">,</span>
                        <span class="sa">f</span><span class="sh">"</span><span class="s">User </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s"> executed: </span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="sh">"</span>
                    <span class="p">)</span>
                    <span class="k">break</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">monitor</span> <span class="o">=</span> <span class="nc">AuthenticationMonitor</span><span class="p">()</span>
    <span class="n">monitor</span><span class="p">.</span><span class="nf">monitor_log</span><span class="p">()</span>
</code></pre></div></div>

<h4 id="ë¡œê·¸ì¸-í†µê³„-ë°-ë¶„ì„-ë„êµ¬">ë¡œê·¸ì¸ í†µê³„ ë° ë¶„ì„ ë„êµ¬</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/auth-stats.sh</span>
<span class="c"># ì¸ì¦ ë¡œê·¸ í†µê³„ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸</span>

<span class="nb">echo</span> <span class="s2">"=== Linux Authentication Statistics Report ==="</span>
<span class="nb">echo</span> <span class="s2">"Generated on: </span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"=============================================="</span>
<span class="nb">echo</span>

<span class="c"># 1. ìµœê·¼ ì„±ê³µí•œ ë¡œê·¸ì¸</span>
<span class="nb">echo</span> <span class="s2">"ğŸ”‘ Recent Successful Logins (Last 24 hours):"</span>
last <span class="nt">-s</span> yesterday | <span class="nb">head</span> <span class="nt">-20</span>
<span class="nb">echo</span>

<span class="c"># 2. ì‹¤íŒ¨í•œ ë¡œê·¸ì¸ ì‹œë„ í†µê³„</span>
<span class="nb">echo</span> <span class="s2">"âŒ Failed Login Attempts (Last 7 days):"</span>
<span class="nb">grep</span> <span class="s2">"Failed password"</span> /var/log/auth.log<span class="k">*</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="s1">'{print $1, $2, $11}'</span> | <span class="se">\</span>
<span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="nb">sort</span> <span class="nt">-nr</span> | <span class="nb">head</span> <span class="nt">-10</span>
<span class="nb">echo</span>

<span class="c"># 3. ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ì‚¬ìš©ìëª… ì‹œë„</span>
<span class="nb">echo</span> <span class="s2">"ğŸ‘¤ Invalid User Attempts:"</span>
<span class="nb">grep</span> <span class="s2">"Invalid user"</span> /var/log/auth.log<span class="k">*</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="s1">'{print $8}'</span> | <span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="nb">sort</span> <span class="nt">-nr</span> | <span class="nb">head</span> <span class="nt">-10</span>
<span class="nb">echo</span>

<span class="c"># 4. IPë³„ ì ‘ê·¼ ì‹œë„ í†µê³„</span>
<span class="nb">echo</span> <span class="s2">"ğŸŒ Access Attempts by IP:"</span>
<span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"(Failed password|Accepted password)"</span> /var/log/auth.log<span class="k">*</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="s1">'{print $NF}'</span> | <span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="nb">sort</span> <span class="nt">-nr</span> | <span class="nb">head</span> <span class="nt">-10</span>
<span class="nb">echo</span>

<span class="c"># 5. ì‹œê°„ëŒ€ë³„ ë¡œê·¸ì¸ íŒ¨í„´</span>
<span class="nb">echo</span> <span class="s2">"â° Login Pattern by Hour:"</span>
<span class="nb">grep</span> <span class="s2">"Accepted password"</span> /var/log/auth.log<span class="k">*</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="s1">'{print $3}'</span> | <span class="nb">cut</span> <span class="nt">-d</span>: <span class="nt">-f1</span> | <span class="nb">sort</span> <span class="nt">-n</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="se">\</span>
<span class="k">while </span><span class="nb">read </span>count hour<span class="p">;</span> <span class="k">do
    </span><span class="nb">printf</span> <span class="s2">"%02d:00 %s %s</span><span class="se">\n</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$hour</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$count</span><span class="s2">"</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">printf</span> <span class="s2">"%*s"</span> <span class="k">$((</span>count/2<span class="k">))</span> <span class="s2">""</span> | <span class="nb">tr</span> <span class="s2">" "</span> <span class="s2">"â–‡"</span><span class="si">)</span><span class="s2">"</span>
<span class="k">done
</span><span class="nb">echo</span>

<span class="c"># 6. sudo ì‚¬ìš© í†µê³„</span>
<span class="nb">echo</span> <span class="s2">"ğŸ”§ Sudo Command Usage:"</span>
<span class="nb">grep</span> <span class="s2">"sudo"</span> /var/log/auth.log<span class="k">*</span> | <span class="se">\</span>
<span class="nb">grep</span> <span class="s2">"COMMAND="</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="nt">-F</span><span class="s1">'COMMAND='</span> <span class="s1">'{print $2}'</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="s1">'{print $1}'</span> | <span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="nb">sort</span> <span class="nt">-nr</span> | <span class="nb">head</span> <span class="nt">-10</span>
<span class="nb">echo</span>

<span class="c"># 7. ë³´ì•ˆ ì´ë²¤íŠ¸ ìš”ì•½</span>
<span class="nb">echo</span> <span class="s2">"ğŸš¨ Security Events Summary:"</span>
<span class="nv">total_failed</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-c</span> <span class="s2">"Failed password"</span> /var/log/auth.log<span class="k">*</span><span class="si">)</span>
<span class="nv">total_invalid</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-c</span> <span class="s2">"Invalid user"</span> /var/log/auth.log<span class="k">*</span><span class="si">)</span>
<span class="nv">total_sudo</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-c</span> <span class="s2">"sudo.*COMMAND="</span> /var/log/auth.log<span class="k">*</span><span class="si">)</span>

<span class="nb">echo</span> <span class="s2">"   Failed password attempts: </span><span class="nv">$total_failed</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"   Invalid user attempts: </span><span class="nv">$total_invalid</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"   Sudo commands executed: </span><span class="nv">$total_sudo</span><span class="s2">"</span>

<span class="c"># 8. ì¶”ì²œ ë³´ì•ˆ ì¡°ì¹˜</span>
<span class="nb">echo
echo</span> <span class="s2">"ğŸ’¡ Security Recommendations:"</span>

<span class="c"># ë†’ì€ ì‹¤íŒ¨ ì‹œë„ê°€ ìˆëŠ” IP í™•ì¸</span>
<span class="nv">high_fail_ips</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="s2">"Failed password"</span> /var/log/auth.log<span class="k">*</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="s1">'{print $NF}'</span> | <span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="s1">'$1 &gt; 50 {print $2}'</span> | <span class="nb">wc</span> <span class="nt">-l</span><span class="si">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$high_fail_ips</span> <span class="nt">-gt</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"   - Consider blocking IPs with high failure rates"</span>
<span class="k">fi</span>

<span class="c"># ë¹„ì •ìƒì ì¸ ì‹œê°„ëŒ€ ì ‘ê·¼ í™•ì¸</span>
<span class="nv">night_logins</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="s2">"Accepted password"</span> /var/log/auth.log<span class="k">*</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="s1">'{print $3}'</span> | <span class="nb">cut</span> <span class="nt">-d</span>: <span class="nt">-f1</span> | <span class="se">\</span>
<span class="nb">awk</span> <span class="s1">'$1 &lt; 6 || $1 &gt; 22'</span> | <span class="nb">wc</span> <span class="nt">-l</span><span class="si">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$night_logins</span> <span class="nt">-gt</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"   - Review off-hours login activity"</span>
<span class="k">fi

</span><span class="nb">echo</span> <span class="s2">"=============================================="</span>
</code></pre></div></div>

<h2 id="ë‹¤ìŒ-í¸-ì˜ˆê³ ">ë‹¤ìŒ í¸ ì˜ˆê³ </h2>

<p>ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” <strong>SSH ê³ ê¸‰ ë³´ì•ˆ ì„¤ì •ê³¼ í‚¤ ê´€ë¦¬</strong>ë¥¼ ìƒì„¸íˆ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤:</p>
<ul>
  <li>SSH í‚¤ ê¸°ë°˜ ì¸ì¦ êµ¬ì¶•</li>
  <li>SSH Certificate Authority ì„¤ì •</li>
  <li>í¬íŠ¸ í¬ì›Œë”© ë° í„°ë„ë§ ë³´ì•ˆ</li>
  <li>SSH ì ‘ê·¼ ì œì–´ ê³ ê¸‰ ê¸°ë²•</li>
</ul>

<p>ë¦¬ëˆ…ìŠ¤ ê¸°ì´ˆ ë³´ì•ˆ ì„¤ì •ì„ ì™„ë²½í•˜ê²Œ ë§ˆìŠ¤í„°í•˜ì…¨ë‚˜ìš”? ğŸ”âœ¨</p>]]></content><author><name>DevOps Engineer</name></author><category term="Security" /><category term="Linux" /><category term="linux-security" /><category term="user-management" /><category term="password-policy" /><category term="ssh" /><category term="authentication" /><summary type="html"><![CDATA[ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œ ë³´ì•ˆì˜ ì²« ë²ˆì§¸ ë‹¨ê³„ì¸ ê¸°ì´ˆ ë³´ì•ˆ ì„¤ì •ì„ ì™„ë²½í•˜ê²Œ ë§ˆìŠ¤í„°í•´ë³´ê² ìŠµë‹ˆë‹¤. ì‚¬ìš©ì ê³„ì • ê´€ë¦¬ë¶€í„° SSH ë³´ì•ˆ ê°•í™”ê¹Œì§€ ì‹¤ë¬´ì—ì„œ ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ë‚´ìš©ìœ¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤. ì‚¬ìš©ì ê³„ì • ë³´ì•ˆ ê°•í™” | User Account Security ğŸ‘¤ ì‚¬ìš©ì ê³„ì • ê´€ë¦¬ ê¸°ì´ˆ ì•ˆì „í•œ ì‚¬ìš©ì ìƒì„± ë° ê´€ë¦¬ # ë³´ì•ˆì„ ê³ ë ¤í•œ ì‚¬ìš©ì ìƒì„± # ì‹œìŠ¤í…œ ì‚¬ìš©ì (ì„œë¹„ìŠ¤ìš©) useradd -r -s /usr/sbin/nologin -d /var/lib/myservice -c "MyService System User" myservice # ì¼ë°˜ ì‚¬ìš©ì ìƒì„± (í™ˆ ë””ë ‰í† ë¦¬ ê¶Œí•œ ê°•í™”) useradd -m -s /bin/bash -c "John Doe" -G users john chmod 750 /home/john chown john:john /home/john # ì‚¬ìš©ì ì •ë³´ í™•ì¸ id john groups john finger john last john # ì‚¬ìš©ì ê³„ì • ì ê¸ˆ/í•´ì œ usermod -L john # ê³„ì • ì ê¸ˆ usermod -U john # ê³„ì • í•´ì œ passwd -l john # íŒ¨ìŠ¤ì›Œë“œ ì ê¸ˆ passwd -u john # íŒ¨ìŠ¤ì›Œë“œ í•´ì œ # ê³„ì • ë§Œë£Œ ì„¤ì • usermod -e 2024-12-31 john # ê³„ì • ë§Œë£Œì¼ ì„¤ì • chage -E 2024-12-31 john # ë™ì¼í•œ ê¸°ëŠ¥ # ë¹„í™œì„± ì‚¬ìš©ì ê³„ì • ì°¾ê¸° lastlog | awk '$2 == "Never" || $2 &lt; "'$(date -d '90 days ago' '+%Y-%m-%d')'" {print $1}' # ë¶ˆí•„ìš”í•œ ê³„ì • ì œê±° userdel -r olduser # í™ˆ ë””ë ‰í† ë¦¬ë„ í•¨ê»˜ ì‚­ì œ ê°•ë ¥í•œ íŒ¨ìŠ¤ì›Œë“œ ì •ì±… êµ¬í˜„ # PAM ê¸°ë°˜ íŒ¨ìŠ¤ì›Œë“œ ë³µì¡ì„± ì„¤ì • # /etc/pam.d/common-password (Ubuntu/Debian) password requisite pam_pwquality.so retry=3 minlen=14 minclass=4 maxrepeat=2 ucredit=-2 lcredit=-2 dcredit=-2 ocredit=-2 difok=4 gecoscheck=1 dictcheck=1 # /etc/security/pwquality.conf ìƒì„¸ ì„¤ì • # íŒ¨ìŠ¤ì›Œë“œ ê¸¸ì´ ë° ë³µì¡ì„± minlen = 14 # ìµœì†Œ 14ì minclass = 4 # 4ê°œ ë¬¸ì í´ë˜ìŠ¤ ëª¨ë‘ í¬í•¨ maxrepeat = 2 # ì—°ì† ë™ì¼ ë¬¸ì 2ê°œ ì´í•˜ maxclasssrepeat = 3 # ë™ì¼ í´ë˜ìŠ¤ ì—°ì† 3ê°œ ì´í•˜ # ë¬¸ìë³„ ìµœì†Œ ê°œìˆ˜ (ìŒìˆ˜ëŠ” í•„ìˆ˜) ucredit = -2 # ëŒ€ë¬¸ì ìµœì†Œ 2ê°œ lcredit = -2 # ì†Œë¬¸ì ìµœì†Œ 2ê°œ dcredit = -2 # ìˆ«ì ìµœì†Œ 2ê°œ ocredit = -2 # íŠ¹ìˆ˜ë¬¸ì ìµœì†Œ 2ê°œ # íŒ¨ìŠ¤ì›Œë“œ í’ˆì§ˆ ê²€ì‚¬ difok = 4 # ì´ì „ íŒ¨ìŠ¤ì›Œë“œì™€ ìµœì†Œ 4ê¸€ì ì°¨ì´ gecoscheck = 1 # GECOS í•„ë“œ(ì´ë¦„ ë“±) í¬í•¨ ê¸ˆì§€ dictcheck = 1 # ì‚¬ì „ ë‹¨ì–´ ì‚¬ìš© ê¸ˆì§€ usercheck = 1 # ì‚¬ìš©ìëª… í¬í•¨ ê¸ˆì§€ enforcing = 1 # ì—„ê²©í•œ ì •ì±… ì ìš© # ê¸ˆì§€ íŒ¨ìŠ¤ì›Œë“œ ëª©ë¡ badwords = password 123456 qwerty admin root # íŒ¨ìŠ¤ì›Œë“œ ì—ì´ì§• ì •ì±… (ê³ ê¸‰) # /etc/login.defs PASS_MAX_DAYS 60 # ìµœëŒ€ 60ì¼ ìœ íš¨ PASS_MIN_DAYS 7 # ìµœì†Œ 7ì¼ í›„ ë³€ê²½ ê°€ëŠ¥ PASS_MIN_LEN 14 # ìµœì†Œ 14ì PASS_WARN_AGE 7 # ë§Œë£Œ 7ì¼ ì „ ê²½ê³  ENCRYPT_METHOD SHA512 # ê°•ë ¥í•œ í•´ì‹œ ì•Œê³ ë¦¬ì¦˜ # ê¸°ì¡´ ì‚¬ìš©ìì—ê²Œ ì •ì±… ì ìš© ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash for user in $(cut -d: -f1 /etc/passwd | grep -v "^#" | sort); do # ì‹œìŠ¤í…œ ê³„ì •ì€ ì œì™¸ (UID 1000 ë¯¸ë§Œ) uid=$(id -u "$user" 2&gt;/dev/null) if [[ $uid -ge 1000 &amp;&amp; $uid -le 60000 ]]; then echo "Applying password policy to $user..." chage -M 60 -m 7 -W 7 "$user" # ë‹¤ìŒ ë¡œê·¸ì¸ ì‹œ íŒ¨ìŠ¤ì›Œë“œ ë³€ê²½ ê°•ì œ chage -d 0 "$user" fi done ê³„ì • ì ê¸ˆ ë° ë¸Œë£¨íŠ¸í¬ìŠ¤ ë°©ì§€ # PAM ê¸°ë°˜ ê³„ì • ì ê¸ˆ ì„¤ì • (ìµœì‹  ë°©ì‹) # /etc/pam.d/common-auth auth required pam_faillock.so preauth silent audit deny=5 unlock_time=900 fail_interval=900 auth [default=die] pam_faillock.so authfail audit deny=5 unlock_time=900 fail_interval=900 auth sufficient pam_unix.so nullok_secure auth [default=die] pam_faillock.so authsucc audit deny=5 unlock_time=900 fail_interval=900 # /etc/pam.d/common-accountì— ì¶”ê°€ account required pam_faillock.so # faillock ì„¤ì • íŒŒì¼ # /etc/security/faillock.conf dir = /var/run/faillock audit silent deny = 5 fail_interval = 900 # 15ë¶„ ê°„ê²© unlock_time = 1800 # 30ë¶„ ì ê¸ˆ even_deny_root # ë£¨íŠ¸ë„ ì ê¸ˆ ì ìš© root_unlock_time = 60 # ë£¨íŠ¸ëŠ” 1ë¶„ë§Œ ì ê¸ˆ # faillock ê´€ë¦¬ ëª…ë ¹ faillock --user john # ì‚¬ìš©ì ì‹¤íŒ¨ íšŸìˆ˜ í™•ì¸ faillock --user john --reset # ì‚¬ìš©ì ì ê¸ˆ í•´ì œ faillock --reset # ëª¨ë“  ì‚¬ìš©ì ì ê¸ˆ í•´ì œ # ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # /usr/local/bin/monitor-auth-failures.sh LOG_FILE="/var/log/auth.log" ALERT_THRESHOLD=3 tail -f "$LOG_FILE" | while read line; do if echo "$line" | grep -q "authentication failure"; then user=$(echo "$line" | grep -o "user=[^ ]*" | cut -d= -f2) ip=$(echo "$line" | grep -o "rhost=[^ ]*" | cut -d= -f2) # ìµœê·¼ 5ë¶„ê°„ ì‹¤íŒ¨ íšŸìˆ˜ ê³„ì‚° failures=$(grep -c "authentication failure.*user=$user.*rhost=$ip" \ &lt;(tail -n 1000 "$LOG_FILE" | \ awk -v since="$(date -d '5 minutes ago' '+%b %d %H:%M')" \ '$0 &gt;= since')) if [[ $failures -ge $ALERT_THRESHOLD ]]; then echo "$(date): ALERT - Multiple auth failures for user $user from $ip ($failures attempts)" # ì•Œë¦¼ ë°œì†¡ (ì„ íƒì‚¬í•­) # echo "Authentication attack detected: $user from $ip" | \ # mail -s "Security Alert" admin@company.com fi fi done ğŸ” ë£¨íŠ¸ ê³„ì • ë³´ì•ˆ ê°•í™” ë£¨íŠ¸ ì ‘ê·¼ ì œí•œ ë° sudo êµ¬ì„± # ë£¨íŠ¸ ì§ì ‘ ë¡œê·¸ì¸ ì™„ì „ ì°¨ë‹¨ # /etc/ssh/sshd_config PermitRootLogin no # ì½˜ì†” ë£¨íŠ¸ ë¡œê·¸ì¸ ì œí•œ # /etc/securetty (ë¹„ì–´ìˆê²Œ í•˜ë©´ ì½˜ì†” ë¡œê·¸ì¸ ì°¨ë‹¨) &gt; /etc/securetty # ë˜ëŠ” íŠ¹ì • í„°ë¯¸ë„ë§Œ í—ˆìš© cat &gt; /etc/securetty &lt;&lt; 'EOF' console tty1 EOF # sudo ê¶Œí•œ ì„¸ë°€í•œ ì œì–´ # /etc/sudoers.d/custom-rules # 1. ê·¸ë£¹ ê¸°ë°˜ ê¶Œí•œ ì„¤ì • %wheel ALL=(ALL:ALL) ALL %admin ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart *, /usr/bin/systemctl reload * # 2. ì‚¬ìš©ìë³„ ì„¸ë¶€ ê¶Œí•œ # ì›¹ ì„œë²„ ê´€ë¦¬ì webadmin ALL=(ALL) /usr/sbin/service apache2 *, /usr/sbin/service nginx *, \ /usr/bin/systemctl restart apache2, /usr/bin/systemctl reload nginx, \ /usr/bin/tail -f /var/log/apache2/*, /usr/bin/tail -f /var/log/nginx/* # ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ì dbadmin ALL=(postgres) NOPASSWD: /usr/bin/psql, /usr/bin/pg_dump, /usr/bin/pg_restore dbadmin ALL=(mysql) NOPASSWD: /usr/bin/mysql, /usr/bin/mysqldump # ë°±ì—… ê´€ë¦¬ì backup ALL=(ALL) NOPASSWD: /usr/bin/rsync, /bin/tar, /bin/gzip, /usr/bin/find /home -name "*" # 3. ëª…ë ¹ ì œí•œ ë° ì¸ìˆ˜ ì œí•œ developer ALL=(ALL) /usr/bin/systemctl status *, !/usr/bin/systemctl * --force # 4. ì‹œê°„ ì œí•œ nightshift ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart * \ # ì•¼ê°„ ê·¼ë¬´ ì‹œê°„ì—ë§Œ í—ˆìš© (ì˜ˆì‹œ) # 5. í˜¸ìŠ¤íŠ¸ ê¸°ë°˜ ì œí•œ john server1=(ALL) /bin/ls, /bin/cat /var/log/* # sudo ë¡œê¹… ê°•í™” # /etc/sudoersì— ì¶”ê°€ Defaults logfile="/var/log/sudo.log" Defaults log_input, log_output # ì…ì¶œë ¥ ë¡œê¹… Defaults iolog_dir="/var/log/sudo-io/%{user}/%{time}" Defaults timestamp_timeout=0 # ìºì‹œ ë¹„í™œì„±í™” Defaults passwd_tries=3 # 3íšŒ ì‹œë„ í›„ ì‹¤íŒ¨ Defaults passwd_timeout=5 # 5ë¶„ íƒ€ì„ì•„ì›ƒ Defaults env_reset # í™˜ê²½ë³€ìˆ˜ ì´ˆê¸°í™” Defaults mail_badpass # ì˜ëª»ëœ íŒ¨ìŠ¤ì›Œë“œ ì‹œ ë©”ì¼ Defaults secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin" # sudo ì„¸ì…˜ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # /usr/local/bin/sudo-monitor.sh SUDO_LOG="/var/log/sudo.log" ALERT_EMAIL="admin@company.com" # ìœ„í—˜í•œ ëª…ë ¹ì–´ íŒ¨í„´ DANGEROUS_PATTERNS=( "rm -rf /" "dd if=" "mkfs\." "fdisk" "parted" "chmod 777" "chown root" "/bin/bash" "/bin/sh" "su -" "passwd root" "userdel" "usermod -u 0" ) tail -f "$SUDO_LOG" | while read line; do for pattern in "${DANGEROUS_PATTERNS[@]}"; do if echo "$line" | grep -i "$pattern" &gt;/dev/null; then echo "$(date): DANGEROUS SUDO COMMAND DETECTED: $line" echo "Dangerous sudo command executed: $line" | \ mail -s "SECURITY ALERT: Dangerous Command" "$ALERT_EMAIL" fi done done ğŸ”‘ ê³ ê¸‰ ì¸ì¦ ë©”ì»¤ë‹ˆì¦˜ ë‹¤ì¤‘ ì¸ì¦ ìš”ì†Œ (MFA) êµ¬í˜„ # Google Authenticator (TOTP) ì„¤ì • # 1. íŒ¨í‚¤ì§€ ì„¤ì¹˜ apt-get install libpam-google-authenticator # 2. ì‚¬ìš©ìë³„ ì„¤ì • (ê° ì‚¬ìš©ìê°€ ì‹¤í–‰) google-authenticator # - ì‹œê°„ ê¸°ë°˜ í† í° ì‚¬ìš©: y # - QR ì½”ë“œ í‘œì‹œ í›„ ì•±ì— ë“±ë¡ # - ê¸´ê¸‰ ìŠ¤í¬ë˜ì¹˜ ì½”ë“œ ì €ì¥ # - í† í° ì¬ì‚¬ìš© ë°©ì§€: y # - ì‹œê°„ í—ˆìš© ì˜¤ì°¨: y # 3. SSHì—ì„œ MFA í™œì„±í™” # /etc/pam.d/sshdì— ì¶”ê°€ (password ì¤„ ìœ„ì—) auth required pam_google_authenticator.so # /etc/ssh/sshd_config ìˆ˜ì • ChallengeResponseAuthentication yes AuthenticationMethods publickey,keyboard-interactive # 4. sudoì—ì„œ MFA ì ìš© # /etc/pam.d/sudoì— ì¶”ê°€ auth required pam_google_authenticator.so # 5. MFA ë°±ì—… ë° ë³µêµ¬ # ì‚¬ìš©ìë³„ ì„¤ì • ë°±ì—… cp ~/.google_authenticator ~/.google_authenticator.backup # ê´€ë¦¬ììš© ê¸´ê¸‰ ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # /usr/local/bin/mfa-recovery.sh read -p "Username: " username read -p "Emergency scratch code: " scratch_code if grep -q "$scratch_code" "/home/$username/.google_authenticator"; then echo "Valid scratch code. Temporarily disabling MFA..." mv "/home/$username/.google_authenticator" "/home/$username/.google_authenticator.disabled" echo "MFA disabled for $username. Re-enable after password reset." else echo "Invalid scratch code." fi LDAP/Active Directory í†µí•© ì¸ì¦ # SSSDë¥¼ ì´ìš©í•œ AD í†µí•© (Ubuntu/CentOS) # 1. í•„ìš” íŒ¨í‚¤ì§€ ì„¤ì¹˜ apt-get install sssd sssd-tools realmd adcli packagekit # 2. ë„ë©”ì¸ ë°œê²¬ ë° ê°€ì… realm discover company.local realm join -U administrator company.local # 3. SSSD êµ¬ì„± # /etc/sssd/sssd.conf [sssd] domains = company.local config_file_version = 2 services = nss, pam [domain/company.local] default_shell = /bin/bash krb5_store_password_if_offline = True cache_credentials = True krb5_realm = COMPANY.LOCAL realmd_tags = manages-system joined-with-adcli id_provider = ad fallback_homedir = /home/%u@%d ad_domain = company.local use_fully_qualified_names = True ldap_id_mapping = True access_provider = ad # íŠ¹ì • ê·¸ë£¹ë§Œ í—ˆìš© ad_access_filter = (memberOf=CN=Linux-Users,OU=Groups,DC=company,DC=local) chmod 600 /etc/sssd/sssd.conf systemctl enable sssd systemctl start sssd # 4. í™ˆ ë””ë ‰í† ë¦¬ ìë™ ìƒì„± # /etc/pam.d/common-sessionì— ì¶”ê°€ session required pam_mkhomedir.so skel=/etc/skel umask=0022 # 5. sudo ê¶Œí•œ ì„¤ì • (AD ê·¸ë£¹ ê¸°ë°˜) # /etc/sudoers.d/ad-groups %domain\ admins@company.local ALL=(ALL:ALL) ALL %linux-administrators@company.local ALL=(ALL) NOPASSWD: /usr/bin/systemctl *, /usr/sbin/service * # 6. ì—°ê²° í…ŒìŠ¤íŠ¸ getent passwd user@company.local id user@company.local su - user@company.local ğŸ›‚ ì„¸ì…˜ ë° ë¡œê·¸ì¸ ì œì–´ ê³ ê¸‰ ë¡œê·¸ì¸ ì œì–´ ì„¤ì • # /etc/security/access.conf - ì•¡ì„¸ìŠ¤ ì œì–´ # í˜•ì‹: ê¶Œí•œ:ì‚¬ìš©ì/ê·¸ë£¹:í„°ë¯¸ë„/í˜¸ìŠ¤íŠ¸ # ë£¨íŠ¸ëŠ” ë¡œì»¬ì—ì„œë§Œ ë¡œê·¸ì¸ í—ˆìš© + : root : LOCAL - : root : ALL # admin ê·¸ë£¹ì€ íŠ¹ì • IPì—ì„œë§Œ + : @admin : 192.168.1.0/24 - : @admin : ALL # íŠ¹ì • ì‚¬ìš©ìëŠ” íŠ¹ì • ì‹œê°„ì—ë§Œ + : nightshift : ALL EXCEPT HOLIDAYS - : nightshift : Wl0800-1800 # ì‹œê°„ ê¸°ë°˜ ì ‘ê·¼ ì œì–´ # /etc/security/time.conf login;*;users;Al0800-1800 sshd;*;developers;MoTuWeThFr0900-1800 # ë¡œê·¸ì¸ ì‹œë„ ì œí•œ # /etc/security/limits.conf # ì‚¬ìš©ìë³„ ë™ì‹œ ë¡œê·¸ì¸ ì„¸ì…˜ ì œí•œ @users hard maxlogins 2 john hard maxlogins 1 # í”„ë¡œì„¸ìŠ¤ ìˆ˜ ì œí•œ (í¬í¬ í­íƒ„ ë°©ì§€) @users hard nproc 1024 @developers hard nproc 2048 # ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì œí•œ @users hard as 1048576 # 1GB # íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ì œí•œ @users hard nofile 4096 # ì½”ì–´ ë¤í”„ ë¹„í™œì„±í™” * hard core 0 # ë¡œê·¸ì¸ ë°°ë„ˆ ì„¤ì • # /etc/issue (ì½˜ì†” ë¡œê·¸ì¸) cat &gt; /etc/issue &lt;&lt; 'EOF' ********************************************************************** * WARNING NOTICE * * * * This system is for authorized users only. All activities may be * * monitored and recorded. Unauthorized access is prohibited and * * will be prosecuted to the full extent of the law. * * * ********************************************************************** EOF # /etc/issue.net (ë„¤íŠ¸ì›Œí¬ ë¡œê·¸ì¸) cp /etc/issue /etc/issue.net # /etc/motd (ë¡œê·¸ì¸ í›„ ë©”ì‹œì§€) cat &gt; /etc/motd &lt;&lt; 'EOF' System Information: - Last system update: $(date) - Security policy: https://company.com/security-policy - Report security incidents: security@company.com EOF # ë™ì  MOTD ìƒì„± ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # /etc/update-motd.d/10-sysinfo echo "System Status as of $(date)" echo "======================================" echo "Hostname: $(hostname)" echo "Kernel: $(uname -r)" echo "Uptime: $(uptime -p)" echo "Load: $(cat /proc/loadavg | awk '{print $1", "$2", "$3}')" echo "Memory: $(free -h | awk 'NR==2{printf "%.1fG/%.1fG (%.1f%%)", $3/1024, $2/1024, $3*100/$2}')" echo "Disk: $(df -h / | awk 'NR==2{printf "%s/%s (%s)", $3, $2, $5}')" echo "" # ë³´ì•ˆ ìƒíƒœ í™•ì¸ if systemctl is-active --quiet fail2ban; then echo "âœ“ Fail2ban: Active" else echo "âœ— Fail2ban: Inactive" fi if systemctl is-active --quiet sshd; then echo "âœ“ SSH: Active" else echo "âœ— SSH: Inactive" fi echo "======================================" echo "" chmod +x /etc/update-motd.d/10-sysinfo ğŸ“Š ì¸ì¦ ë¡œê·¸ ëª¨ë‹ˆí„°ë§ ë° ë¶„ì„ ì‹¤ì‹œê°„ ë¡œê·¸ì¸ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ #!/usr/bin/env python3 # /usr/local/bin/auth-monitor.py import re import time import subprocess import smtplib from email.mime.text import MIMEText from collections import defaultdict, deque from datetime import datetime, timedelta class AuthenticationMonitor: def __init__(self): self.failed_attempts = defaultdict(deque) self.successful_logins = defaultdict(deque) self.suspicious_ips = set() self.alert_threshold = 5 self.time_window = 300 # 5 minutes def parse_log_line(self, line): """ë¡œê·¸ ë¼ì¸ íŒŒì‹±""" patterns = { 'failed_password': r'(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*Failed password for (\w+) from (\d+\.\d+\.\d+\.\d+)', 'accepted_password': r'(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*Accepted password for (\w+) from (\d+\.\d+\.\d+\.\d+)', 'invalid_user': r'(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*Invalid user (\w+) from (\d+\.\d+\.\d+\.\d+)', 'sudo_command': r'(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*sudo.*USER=(\w+).*COMMAND=(.*)' } for event_type, pattern in patterns.items(): match = re.search(pattern, line) if match: return event_type, match.groups() return None, None def is_suspicious_ip(self, ip): """ì˜ì‹¬ìŠ¤ëŸ¬ìš´ IP íŒë³„""" # ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ IPëŠ” ì œì™¸ internal_ranges = [ '192.168.', '10.', '172.16.', '172.17.', '172.18.', '172.19.', '172.20.', '172.21.', '172.22.', '172.23.', '172.24.', '172.25.', '172.26.', '172.27.', '172.28.', '172.29.', '172.30.', '172.31.', '127.' ] return not any(ip.startswith(prefix) for prefix in internal_ranges) def check_brute_force(self, ip): """ë¸Œë£¨íŠ¸í¬ìŠ¤ ê³µê²© í™•ì¸""" now = time.time() # ì˜¤ë˜ëœ ì‹œë„ ì œê±° while (self.failed_attempts[ip] and now - self.failed_attempts[ip][0] &gt; self.time_window): self.failed_attempts[ip].popleft() return len(self.failed_attempts[ip]) &gt;= self.alert_threshold def send_alert(self, alert_type, details): """ì•Œë¦¼ ë°œì†¡""" message = f""" Security Alert: {alert_type} Time: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} Details: {details} System: {subprocess.check_output('hostname', shell=True).decode().strip()} Please investigate immediately. """ print(f"ALERT: {alert_type} - {details}") # ì´ë©”ì¼ ë°œì†¡ (ì„ íƒì‚¬í•­) # self.send_email("Security Alert", message) # ë¡œê·¸ ê¸°ë¡ with open('/var/log/security-alerts.log', 'a') as f: f.write(f"{datetime.now().isoformat()} - {alert_type}: {details}\n") def monitor_log(self, log_file='/var/log/auth.log'): """ë¡œê·¸ ëª¨ë‹ˆí„°ë§ ë©”ì¸ ë£¨í”„""" print(f"Starting authentication monitoring on {log_file}") # ê¸°ì¡´ ë¡œê·¸ ì²˜ë¦¬ (ë§ˆì§€ë§‰ 100ì¤„) try: with open(log_file, 'r') as f: lines = f.readlines() for line in lines[-100:]: self.process_line(line.strip()) except FileNotFoundError: print(f"Log file {log_file} not found") return # ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ proc = subprocess.Popen(['tail', '-f', log_file], stdout=subprocess.PIPE, stderr=subprocess.PIPE, universal_newlines=True) try: for line in iter(proc.stdout.readline, ''): self.process_line(line.strip()) except KeyboardInterrupt: proc.terminate() print("\nMonitoring stopped") def process_line(self, line): """ë¡œê·¸ ë¼ì¸ ì²˜ë¦¬""" event_type, data = self.parse_log_line(line) if not event_type: return current_time = time.time() if event_type == 'failed_password': timestamp, user, ip = data self.failed_attempts[ip].append(current_time) if self.is_suspicious_ip(ip) and self.check_brute_force(ip): self.send_alert( "Brute Force Attack Detected", f"IP {ip} failed {len(self.failed_attempts[ip])} login attempts for user {user}" ) self.suspicious_ips.add(ip) elif event_type == 'accepted_password': timestamp, user, ip = data if ip in self.suspicious_ips: self.send_alert( "Successful Login from Suspicious IP", f"User {user} logged in from previously suspicious IP {ip}" ) # ë¹„ì •ìƒ ì‹œê°„ëŒ€ ë¡œê·¸ì¸ í™•ì¸ current_hour = datetime.now().hour if current_hour &lt; 6 or current_hour &gt; 22: # ì˜¤ì „ 6ì‹œ ì´ì „, ì˜¤í›„ 10ì‹œ ì´í›„ self.send_alert( "Off-Hours Login", f"User {user} logged in from {ip} at unusual time: {datetime.now().strftime('%H:%M')}" ) elif event_type == 'invalid_user': timestamp, user, ip = data self.send_alert( "Invalid User Login Attempt", f"Attempt to login as non-existent user '{user}' from {ip}" ) elif event_type == 'sudo_command': timestamp, user, command = data # ìœ„í—˜í•œ ëª…ë ¹ì–´ ê°ì§€ dangerous_patterns = ['rm -rf', 'dd if=', 'mkfs', 'fdisk', 'passwd root'] for pattern in dangerous_patterns: if pattern in command: self.send_alert( "Dangerous Sudo Command", f"User {user} executed: {command}" ) break if __name__ == '__main__': monitor = AuthenticationMonitor() monitor.monitor_log() ë¡œê·¸ì¸ í†µê³„ ë° ë¶„ì„ ë„êµ¬ #!/bin/bash # /usr/local/bin/auth-stats.sh # ì¸ì¦ ë¡œê·¸ í†µê³„ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸ echo "=== Linux Authentication Statistics Report ===" echo "Generated on: $(date)" echo "==============================================" echo # 1. ìµœê·¼ ì„±ê³µí•œ ë¡œê·¸ì¸ echo "ğŸ”‘ Recent Successful Logins (Last 24 hours):" last -s yesterday | head -20 echo # 2. ì‹¤íŒ¨í•œ ë¡œê·¸ì¸ ì‹œë„ í†µê³„ echo "âŒ Failed Login Attempts (Last 7 days):" grep "Failed password" /var/log/auth.log* | \ awk '{print $1, $2, $11}' | \ sort | uniq -c | sort -nr | head -10 echo # 3. ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ì‚¬ìš©ìëª… ì‹œë„ echo "ğŸ‘¤ Invalid User Attempts:" grep "Invalid user" /var/log/auth.log* | \ awk '{print $8}' | sort | uniq -c | sort -nr | head -10 echo # 4. IPë³„ ì ‘ê·¼ ì‹œë„ í†µê³„ echo "ğŸŒ Access Attempts by IP:" grep -E "(Failed password|Accepted password)" /var/log/auth.log* | \ awk '{print $NF}' | sort | uniq -c | sort -nr | head -10 echo # 5. ì‹œê°„ëŒ€ë³„ ë¡œê·¸ì¸ íŒ¨í„´ echo "â° Login Pattern by Hour:" grep "Accepted password" /var/log/auth.log* | \ awk '{print $3}' | cut -d: -f1 | sort -n | uniq -c | \ while read count hour; do printf "%02d:00 %s %s\n" "$hour" "$count" "$(printf "%*s" $((count/2)) "" | tr " " "â–‡")" done echo # 6. sudo ì‚¬ìš© í†µê³„ echo "ğŸ”§ Sudo Command Usage:" grep "sudo" /var/log/auth.log* | \ grep "COMMAND=" | \ awk -F'COMMAND=' '{print $2}' | \ awk '{print $1}' | sort | uniq -c | sort -nr | head -10 echo # 7. ë³´ì•ˆ ì´ë²¤íŠ¸ ìš”ì•½ echo "ğŸš¨ Security Events Summary:" total_failed=$(grep -c "Failed password" /var/log/auth.log*) total_invalid=$(grep -c "Invalid user" /var/log/auth.log*) total_sudo=$(grep -c "sudo.*COMMAND=" /var/log/auth.log*) echo " Failed password attempts: $total_failed" echo " Invalid user attempts: $total_invalid" echo " Sudo commands executed: $total_sudo" # 8. ì¶”ì²œ ë³´ì•ˆ ì¡°ì¹˜ echo echo "ğŸ’¡ Security Recommendations:" # ë†’ì€ ì‹¤íŒ¨ ì‹œë„ê°€ ìˆëŠ” IP í™•ì¸ high_fail_ips=$(grep "Failed password" /var/log/auth.log* | \ awk '{print $NF}' | sort | uniq -c | \ awk '$1 &gt; 50 {print $2}' | wc -l) if [ $high_fail_ips -gt 0 ]; then echo " - Consider blocking IPs with high failure rates" fi # ë¹„ì •ìƒì ì¸ ì‹œê°„ëŒ€ ì ‘ê·¼ í™•ì¸ night_logins=$(grep "Accepted password" /var/log/auth.log* | \ awk '{print $3}' | cut -d: -f1 | \ awk '$1 &lt; 6 || $1 &gt; 22' | wc -l) if [ $night_logins -gt 0 ]; then echo " - Review off-hours login activity" fi echo "==============================================" ë‹¤ìŒ í¸ ì˜ˆê³  ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” SSH ê³ ê¸‰ ë³´ì•ˆ ì„¤ì •ê³¼ í‚¤ ê´€ë¦¬ë¥¼ ìƒì„¸íˆ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤: SSH í‚¤ ê¸°ë°˜ ì¸ì¦ êµ¬ì¶• SSH Certificate Authority ì„¤ì • í¬íŠ¸ í¬ì›Œë”© ë° í„°ë„ë§ ë³´ì•ˆ SSH ì ‘ê·¼ ì œì–´ ê³ ê¸‰ ê¸°ë²• ë¦¬ëˆ…ìŠ¤ ê¸°ì´ˆ ë³´ì•ˆ ì„¤ì •ì„ ì™„ë²½í•˜ê²Œ ë§ˆìŠ¤í„°í•˜ì…¨ë‚˜ìš”? ğŸ”âœ¨]]></summary></entry><entry><title type="html">ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ | Complete Linux Security Guide - ì‹œìŠ¤í…œ ë³´ì•ˆë¶€í„° ê³ ê¸‰ ë³´ì•ˆ ê¸°ë²•ê¹Œì§€</title><link href="https://leeyonghe.github.io/infra-blog/blog/2024/09/14/linux-security-guide.html" rel="alternate" type="text/html" title="ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ì™„ì „ ê°€ì´ë“œ | Complete Linux Security Guide - ì‹œìŠ¤í…œ ë³´ì•ˆë¶€í„° ê³ ê¸‰ ë³´ì•ˆ ê¸°ë²•ê¹Œì§€" /><published>2024-09-14T03:00:00+00:00</published><updated>2024-09-14T03:00:00+00:00</updated><id>https://leeyonghe.github.io/infra-blog/blog/2024/09/14/linux-security-guide</id><content type="html" xml:base="https://leeyonghe.github.io/infra-blog/blog/2024/09/14/linux-security-guide.html"><![CDATA[<p>ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œì˜ ë³´ì•ˆì„ ì²´ê³„ì ìœ¼ë¡œ êµ¬ì¶•í•˜ê³  ê´€ë¦¬í•˜ëŠ” ì™„ì „í•œ ê°€ì´ë“œì…ë‹ˆë‹¤. ê¸°ì´ˆë¶€í„° ê³ ê¸‰ ë³´ì•ˆ ê¸°ë²•ê¹Œì§€ ì‹¤ë¬´ì— ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ë‚´ìš©ìœ¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.</p>

<h2 id="ë¦¬ëˆ…ìŠ¤-ë³´ì•ˆ-ê¸°ì´ˆ--linux-security-fundamentals">ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ê¸°ì´ˆ | Linux Security Fundamentals</h2>

<h3 id="-ì‚¬ìš©ì-ê³„ì •-ë³´ì•ˆ">ğŸ” ì‚¬ìš©ì ê³„ì • ë³´ì•ˆ</h3>

<h4 id="íŒ¨ìŠ¤ì›Œë“œ-ì •ì±…-ê°•í™”">íŒ¨ìŠ¤ì›Œë“œ ì •ì±… ê°•í™”</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># íŒ¨ìŠ¤ì›Œë“œ ë³µì¡ì„± ì •ì±… ì„¤ì •</span>
<span class="c"># /etc/pam.d/common-password (Ubuntu/Debian)</span>
password requisite pam_pwquality.so <span class="nv">retry</span><span class="o">=</span>3 <span class="nv">minlen</span><span class="o">=</span>12 <span class="nv">minclass</span><span class="o">=</span>3 <span class="nv">maxrepeat</span><span class="o">=</span>2 <span class="nv">ucredit</span><span class="o">=</span><span class="nt">-1</span> <span class="nv">lcredit</span><span class="o">=</span><span class="nt">-1</span> <span class="nv">dcredit</span><span class="o">=</span><span class="nt">-1</span> <span class="nv">ocredit</span><span class="o">=</span><span class="nt">-1</span>

<span class="c"># /etc/security/pwquality.conf</span>
minlen <span class="o">=</span> 12
minclass <span class="o">=</span> 3
maxrepeat <span class="o">=</span> 2
maxclasssrepeat <span class="o">=</span> 4
ucredit <span class="o">=</span> <span class="nt">-1</span>    <span class="c"># ìµœì†Œ ëŒ€ë¬¸ì 1ê°œ</span>
lcredit <span class="o">=</span> <span class="nt">-1</span>    <span class="c"># ìµœì†Œ ì†Œë¬¸ì 1ê°œ  </span>
dcredit <span class="o">=</span> <span class="nt">-1</span>    <span class="c"># ìµœì†Œ ìˆ«ì 1ê°œ</span>
ocredit <span class="o">=</span> <span class="nt">-1</span>    <span class="c"># ìµœì†Œ íŠ¹ìˆ˜ë¬¸ì 1ê°œ</span>
difok <span class="o">=</span> 3       <span class="c"># ì´ì „ íŒ¨ìŠ¤ì›Œë“œì™€ 3ê¸€ì ì´ìƒ ë‹¬ë¼ì•¼ í•¨</span>

<span class="c"># íŒ¨ìŠ¤ì›Œë“œ ì—ì´ì§• ì •ì±…</span>
<span class="c"># /etc/login.defs</span>
PASS_MAX_DAYS   90     <span class="c"># ìµœëŒ€ ìœ íš¨ê¸°ê°„</span>
PASS_MIN_DAYS   1      <span class="c"># ìµœì†Œ ë³€ê²½ ì£¼ê¸°</span>
PASS_MIN_LEN    12     <span class="c"># ìµœì†Œ ê¸¸ì´</span>
PASS_WARN_AGE   7      <span class="c"># ë§Œë£Œ ê²½ê³  ê¸°ê°„</span>

<span class="c"># ê¸°ì¡´ ì‚¬ìš©ìì—ê²Œ ì •ì±… ì ìš©</span>
chage <span class="nt">-M</span> 90 <span class="nt">-m</span> 1 <span class="nt">-W</span> 7 username

<span class="c"># ê³„ì • ì ê¸ˆ ì •ì±… (ì‹¤íŒ¨ ì‹œë„ ì œí•œ)</span>
<span class="c"># /etc/pam.d/common-auth</span>
auth required pam_tally2.so <span class="nv">deny</span><span class="o">=</span>5 <span class="nv">unlock_time</span><span class="o">=</span>1800 <span class="nv">onerr</span><span class="o">=</span>fail

<span class="c"># ì ê¸´ ê³„ì • í™•ì¸ ë° í•´ì œ</span>
pam_tally2 <span class="nt">--user</span> username
pam_tally2 <span class="nt">--user</span> username <span class="nt">--reset</span>
</code></pre></div></div>

<h4 id="ë£¨íŠ¸-ê³„ì •-ë³´ì•ˆ">ë£¨íŠ¸ ê³„ì • ë³´ì•ˆ</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë£¨íŠ¸ ì§ì ‘ ë¡œê·¸ì¸ ì°¨ë‹¨</span>
<span class="c"># /etc/ssh/sshd_config</span>
PermitRootLogin no
PasswordAuthentication no
PubkeyAuthentication <span class="nb">yes</span>

<span class="c"># ì½˜ì†” ë£¨íŠ¸ ë¡œê·¸ì¸ ì œí•œ</span>
<span class="c"># /etc/securetty (í—ˆìš©í•  í„°ë¯¸ë„ë§Œ ë‚¨ê¸°ê¸°)</span>
console
tty1

<span class="c"># sudo ê¶Œí•œ ì„¸ë°€í•˜ê²Œ ì œì–´</span>
<span class="c"># /etc/sudoers</span>
<span class="c"># íŠ¹ì • ëª…ë ¹ë§Œ í—ˆìš©</span>
webadmin <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> /usr/sbin/service apache2 <span class="k">*</span>, /usr/sbin/service nginx <span class="k">*</span>
<span class="c"># íŒ¨ìŠ¤ì›Œë“œ ì—†ì´ íŠ¹ì • ëª…ë ¹ ì‹¤í–‰</span>
backup <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> NOPASSWD: /usr/bin/rsync, /bin/tar

<span class="c"># sudo ì‚¬ìš© ë¡œê·¸ ê°•í™”</span>
<span class="c"># /etc/rsyslog.conf ë˜ëŠ” /etc/rsyslog.d/50-default.conf</span>
local2.<span class="k">*</span>                        /var/log/sudo.log

<span class="c"># /etc/sudoersì— ì¶”ê°€</span>
Defaults    <span class="nv">logfile</span><span class="o">=</span><span class="s2">"/var/log/sudo.log"</span>
Defaults    log_input, log_output
Defaults    <span class="nv">iolog_dir</span><span class="o">=</span><span class="s2">"/var/log/sudo-io"</span>
</code></pre></div></div>

<h3 id="-ssh-ë³´ì•ˆ-ê°•í™”">ğŸ”’ SSH ë³´ì•ˆ ê°•í™”</h3>

<h4 id="ssh-ì„œë²„-ë³´ì•ˆ-ì„¤ì •">SSH ì„œë²„ ë³´ì•ˆ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/ssh/sshd_config ë³´ì•ˆ ì„¤ì •</span>
Protocol 2
Port 2222                    <span class="c"># ê¸°ë³¸ í¬íŠ¸ ë³€ê²½</span>
PermitRootLogin no
PasswordAuthentication no
PubkeyAuthentication <span class="nb">yes
</span>AuthorizedKeysFile .ssh/authorized_keys
MaxAuthTries 3
MaxSessions 3
MaxStartups 3
LoginGraceTime 60
ClientAliveInterval 300
ClientAliveCountMax 2
UsePAM <span class="nb">yes
</span>X11Forwarding no
AllowTcpForwarding no
GatewayPorts no
PermitTunnel no

<span class="c"># íŠ¹ì • ì‚¬ìš©ì/ê·¸ë£¹ë§Œ SSH ì ‘ê·¼ í—ˆìš©</span>
AllowUsers admin developer
AllowGroups sshusers
DenyUsers guest anonymous
DenyGroups wheel

<span class="c"># íŠ¹ì • IPì—ì„œë§Œ ì ‘ê·¼ í—ˆìš©</span>
Match Address 192.168.1.0/24,10.0.0.0/8
    PasswordAuthentication <span class="nb">yes
    
</span>Match Address <span class="k">*</span>,!192.168.1.0/24,!10.0.0.0/8
    DenyUsers <span class="k">*</span>

<span class="c"># ì„œë¹„ìŠ¤ ì¬ì‹œì‘</span>
systemctl restart sshd
</code></pre></div></div>

<h4 id="ssh-í‚¤-ê¸°ë°˜-ì¸ì¦-êµ¬ì¶•">SSH í‚¤ ê¸°ë°˜ ì¸ì¦ êµ¬ì¶•</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í´ë¼ì´ì–¸íŠ¸ì—ì„œ í‚¤ ìƒì„± (ED25519 ê¶Œì¥)</span>
ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-b</span> 4096 <span class="nt">-C</span> <span class="s2">"your-email@domain.com"</span>
<span class="c"># ë˜ëŠ” RSA í‚¤ (ìµœì†Œ 4096ë¹„íŠ¸)</span>
ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-b</span> 4096 <span class="nt">-C</span> <span class="s2">"your-email@domain.com"</span>

<span class="c"># ê³µê°œí‚¤ ì„œë²„ì— ë³µì‚¬</span>
ssh-copy-id <span class="nt">-i</span> ~/.ssh/id_ed25519.pub username@server-ip

<span class="c"># ìˆ˜ë™ìœ¼ë¡œ ê³µê°œí‚¤ ì„¤ì •</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> ~/.ssh
<span class="nb">chmod </span>700 ~/.ssh
<span class="nb">cat</span> <span class="o">&gt;&gt;</span> ~/.ssh/authorized_keys <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIG... your-email@domain.com
</span><span class="no">EOF
</span><span class="nb">chmod </span>600 ~/.ssh/authorized_keys
<span class="nb">chown </span>username:username ~/.ssh <span class="nt">-R</span>

<span class="c"># SSH í‚¤ ê´€ë¦¬ - í‚¤ë³„ ì œí•œ ì„¤ì •</span>
<span class="c"># ~/.ssh/authorized_keys</span>
<span class="nb">command</span><span class="o">=</span><span class="s2">"/usr/local/bin/backup-script"</span>,no-port-forwarding,no-X11-forwarding,no-agent-forwarding ssh-rsa AAAAB3... backup@server
<span class="nv">from</span><span class="o">=</span><span class="s2">"192.168.1.100"</span>,no-port-forwarding ssh-rsa AAAAB3... admin@workstation

<span class="c"># SSH Certificate Authority êµ¬ì¶•</span>
<span class="c"># CA í‚¤ ìƒì„±</span>
ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-b</span> 4096 <span class="nt">-f</span> /etc/ssh/ca_key

<span class="c"># ì‚¬ìš©ì ì¸ì¦ì„œ ë°œê¸‰</span>
ssh-keygen <span class="nt">-s</span> /etc/ssh/ca_key <span class="nt">-I</span> <span class="s2">"user-certificate"</span> <span class="nt">-n</span> username <span class="nt">-V</span> +1w ~/.ssh/id_rsa.pub

<span class="c"># ì„œë²„ ì„¤ì •ì—ì„œ CA ì‹ ë¢°</span>
<span class="c"># /etc/ssh/sshd_config</span>
TrustedUserCAKeys /etc/ssh/ca_key.pub
</code></pre></div></div>

<h3 id="ï¸-ë°©í™”ë²½-ì„¤ì •">ğŸ›¡ï¸ ë°©í™”ë²½ ì„¤ì •</h3>

<h4 id="iptables-ê¸°ë³¸-ë³´ì•ˆ-ì„¤ì •">iptables ê¸°ë³¸ ë³´ì•ˆ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># ê°•ë ¥í•œ iptables ë³´ì•ˆ ì„¤ì •</span>

<span class="c"># ëª¨ë“  ê¸°ì¡´ ê·œì¹™ ì´ˆê¸°í™”</span>
iptables <span class="nt">-F</span>
iptables <span class="nt">-X</span>
iptables <span class="nt">-t</span> nat <span class="nt">-F</span>
iptables <span class="nt">-t</span> nat <span class="nt">-X</span>
iptables <span class="nt">-t</span> mangle <span class="nt">-F</span>
iptables <span class="nt">-t</span> mangle <span class="nt">-X</span>

<span class="c"># ê¸°ë³¸ ì •ì±…: ëª¨ë“  íŠ¸ë˜í”½ ì°¨ë‹¨</span>
iptables <span class="nt">-P</span> INPUT DROP
iptables <span class="nt">-P</span> FORWARD DROP
iptables <span class="nt">-P</span> OUTPUT DROP

<span class="c"># Loopback í—ˆìš©</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-i</span> lo <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-o</span> lo <span class="nt">-j</span> ACCEPT

<span class="c"># ê¸°ì¡´ ì—°ê²° ìœ ì§€</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED,RELATED <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> ESTABLISHED <span class="nt">-j</span> ACCEPT

<span class="c"># SSH ì ‘ê·¼ í—ˆìš© (ë¸Œë£¨íŠ¸í¬ìŠ¤ ë°©ì§€)</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 2222 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW <span class="nt">-m</span> recent <span class="nt">--set</span> <span class="nt">--name</span> SSH
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 2222 <span class="nt">-m</span> conntrack <span class="nt">--ctstate</span> NEW <span class="nt">-m</span> recent <span class="nt">--update</span> <span class="nt">--seconds</span> 60 <span class="nt">--hitcount</span> 4 <span class="nt">--name</span> SSH <span class="nt">-j</span> DROP
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 2222 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--sport</span> 2222 <span class="nt">-j</span> ACCEPT

<span class="c"># DNS í—ˆìš© (í•„ìˆ˜)</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> udp <span class="nt">--dport</span> 53 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 53 <span class="nt">-j</span> ACCEPT

<span class="c"># NTP í—ˆìš©</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> udp <span class="nt">--dport</span> 123 <span class="nt">-j</span> ACCEPT

<span class="c"># HTTP/HTTPS ì•„ì›ƒë°”ìš´ë“œ í—ˆìš©</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 80 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 443 <span class="nt">-j</span> ACCEPT

<span class="c"># ì›¹ ì„œë²„ê°€ ìˆë‹¤ë©´ ì¸ë°”ìš´ë“œë„ í—ˆìš©</span>
<span class="c"># iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span>
<span class="c"># iptables -A INPUT -p tcp --dport 443 -j ACCEPT</span>

<span class="c"># ICMP ì œí•œì  í—ˆìš© (ping)</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> icmp <span class="nt">--icmp-type</span> echo-request <span class="nt">-m</span> limit <span class="nt">--limit</span> 1/second <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> icmp <span class="nt">--icmp-type</span> echo-reply <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> icmp <span class="nt">--icmp-type</span> echo-request <span class="nt">-j</span> ACCEPT

<span class="c"># ë¡œê¹… ì„¤ì • (DDoS ë°©ì§€)</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-m</span> limit <span class="nt">--limit</span> 5/min <span class="nt">-j</span> LOG <span class="nt">--log-prefix</span> <span class="s2">"iptables INPUT denied: "</span> <span class="nt">--log-level</span> 7

<span class="c"># ì„¤ì • ì €ì¥</span>
iptables-save <span class="o">&gt;</span> /etc/iptables/rules.v4

<span class="c"># ë¶€íŒ… ì‹œ ìë™ ë¡œë“œ</span>
<span class="nb">echo</span> <span class="s1">'#!/bin/bash'</span> <span class="o">&gt;</span> /etc/network/if-pre-up.d/iptables
<span class="nb">echo</span> <span class="s1">'iptables-restore &lt; /etc/iptables/rules.v4'</span> <span class="o">&gt;&gt;</span> /etc/network/if-pre-up.d/iptables
<span class="nb">chmod</span> +x /etc/network/if-pre-up.d/iptables
</code></pre></div></div>

<h4 id="ufw-uncomplicated-firewall-í™œìš©">UFW (Uncomplicated Firewall) í™œìš©</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># UFW ì´ˆê¸°í™” ë° ê¸°ë³¸ ì„¤ì •</span>
ufw <span class="nt">--force</span> reset
ufw default deny incoming
ufw default deny outgoing
ufw default deny forward

<span class="c"># í•„ìˆ˜ ì•„ì›ƒë°”ìš´ë“œ í—ˆìš©</span>
ufw allow out 53      <span class="c"># DNS</span>
ufw allow out 80      <span class="c"># HTTP</span>
ufw allow out 443     <span class="c"># HTTPS</span>
ufw allow out 123     <span class="c"># NTP</span>

<span class="c"># SSH ì ‘ê·¼ í—ˆìš© (í¬íŠ¸ ë³€ê²½í–ˆë‹¤ë©´)</span>
ufw allow from 192.168.1.0/24 to any port 2222

<span class="c"># ì• í”Œë¦¬ì¼€ì´ì…˜ë³„ í—ˆìš©</span>
ufw allow <span class="s2">"Apache Full"</span>
ufw allow <span class="s2">"Nginx Full"</span>

<span class="c"># ê³ ê¸‰ ê·œì¹™</span>
ufw allow from 10.0.0.0/8 to any port 3306  <span class="c"># MySQL</span>
ufw deny from 192.168.1.100                 <span class="c"># íŠ¹ì • IP ì°¨ë‹¨</span>

<span class="c"># ë¡œê¹… í™œì„±í™”</span>
ufw logging on

<span class="c"># ë°©í™”ë²½ í™œì„±í™”</span>
ufw <span class="nb">enable</span>

<span class="c"># ìƒíƒœ í™•ì¸</span>
ufw status verbose
ufw status numbered
</code></pre></div></div>

<h2 id="selinuxapparmor-ë³´ì•ˆ--mandatory-access-control">SELinux/AppArmor ë³´ì•ˆ | Mandatory Access Control</h2>

<h3 id="-selinux-êµ¬ì„±-ë°-ê´€ë¦¬">ğŸ” SELinux êµ¬ì„± ë° ê´€ë¦¬</h3>

<h4 id="selinux-ê¸°ë³¸-ì„¤ì •">SELinux ê¸°ë³¸ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># SELinux ìƒíƒœ í™•ì¸</span>
sestatus
getenforce

<span class="c"># SELinux ëª¨ë“œ ë³€ê²½</span>
<span class="c"># /etc/selinux/config</span>
<span class="nv">SELINUX</span><span class="o">=</span>enforcing     <span class="c"># enforcing, permissive, disabled</span>
<span class="nv">SELINUXTYPE</span><span class="o">=</span>targeted  <span class="c"># targeted, minimum, mls</span>

<span class="c"># ì„ì‹œ ëª¨ë“œ ë³€ê²½</span>
setenforce 1  <span class="c"># enforcing</span>
setenforce 0  <span class="c"># permissive</span>

<span class="c"># ì»¨í…ìŠ¤íŠ¸ í™•ì¸</span>
<span class="nb">ls</span> <span class="nt">-lZ</span> /var/www/html/
ps auxZ | <span class="nb">grep </span>httpd
<span class="nb">id</span> <span class="nt">-Z</span>

<span class="c"># íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ ë³µì›</span>
restorecon <span class="nt">-Rv</span> /var/www/html/
restorecon <span class="nt">-Rv</span> /home/username/

<span class="c"># ì»¨í…ìŠ¤íŠ¸ ìˆ˜ë™ ì„¤ì •</span>
<span class="nb">chcon</span> <span class="nt">-t</span> httpd_exec_t /usr/local/apache2/bin/httpd
semanage fcontext <span class="nt">-a</span> <span class="nt">-t</span> httpd_exec_t <span class="s2">"/usr/local/apache2/bin/httpd"</span>
</code></pre></div></div>

<h4 id="selinux-ì •ì±…-ê´€ë¦¬">SELinux ì •ì±… ê´€ë¦¬</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë¶ˆë¦° ê°’ í™•ì¸ ë° ì„¤ì •</span>
getsebool <span class="nt">-a</span> | <span class="nb">grep </span>httpd
setsebool <span class="nt">-P</span> httpd_can_network_connect on
setsebool <span class="nt">-P</span> httpd_can_sendmail on

<span class="c"># í¬íŠ¸ ë¼ë²¨ ê´€ë¦¬</span>
semanage port <span class="nt">-l</span> | <span class="nb">grep </span>http
semanage port <span class="nt">-a</span> <span class="nt">-t</span> http_port_t <span class="nt">-p</span> tcp 8080

<span class="c"># ì‚¬ìš©ì ë§¤í•‘</span>
semanage login <span class="nt">-l</span>
semanage user <span class="nt">-l</span>
semanage login <span class="nt">-a</span> <span class="nt">-s</span> user_u regularuser

<span class="c"># ì»¤ìŠ¤í…€ ì •ì±… ëª¨ë“ˆ ìƒì„±</span>
<span class="c"># audit.logì—ì„œ ì •ì±… ìƒì„±</span>
<span class="nb">grep </span>httpd /var/log/audit/audit.log | audit2allow <span class="nt">-m</span> myhttpd
<span class="nb">grep </span>httpd /var/log/audit/audit.log | audit2allow <span class="nt">-M</span> myhttpd
semodule <span class="nt">-i</span> myhttpd.pp

<span class="c"># ì •ì±… ëª¨ë“ˆ ê´€ë¦¬</span>
semodule <span class="nt">-l</span> | <span class="nb">grep </span>my
semodule <span class="nt">-r</span> myhttpd
</code></pre></div></div>

<h3 id="ï¸-apparmor-í”„ë¡œíŒŒì¼-ì‘ì„±">ğŸ›¡ï¸ AppArmor í”„ë¡œíŒŒì¼ ì‘ì„±</h3>

<h4 id="apparmor-ê¸°ë³¸-ê´€ë¦¬">AppArmor ê¸°ë³¸ ê´€ë¦¬</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># AppArmor ìƒíƒœ í™•ì¸</span>
aa-status
aa-enabled

<span class="c"># í”„ë¡œíŒŒì¼ ëª¨ë“œ í™•ì¸</span>
aa-status | <span class="nb">grep </span>profiles

<span class="c"># í”„ë¡œíŒŒì¼ ëª¨ë“œ ë³€ê²½</span>
aa-enforce /etc/apparmor.d/usr.bin.firefox
aa-complain /etc/apparmor.d/usr.bin.firefox
aa-disable /etc/apparmor.d/usr.bin.firefox

<span class="c"># í”„ë¡œíŒŒì¼ ì¬ë¡œë“œ</span>
apparmor_parser <span class="nt">-r</span> /etc/apparmor.d/usr.bin.firefox
</code></pre></div></div>

<h4 id="ì»¤ìŠ¤í…€-apparmor-í”„ë¡œíŒŒì¼-ì‘ì„±">ì»¤ìŠ¤í…€ AppArmor í”„ë¡œíŒŒì¼ ì‘ì„±</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ìƒˆë¡œìš´ ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œíŒŒì¼ ìƒì„±</span>
<span class="c"># /etc/apparmor.d/usr.local.bin.myapp</span>
<span class="c">#include &lt;tunables/global&gt;</span>

/usr/local/bin/myapp <span class="o">{</span>
  <span class="c">#include &lt;abstractions/base&gt;</span>
  <span class="c">#include &lt;abstractions/nameservice&gt;</span>
  
  <span class="c"># ì‹¤í–‰ íŒŒì¼</span>
  /usr/local/bin/myapp mr,
  
  <span class="c"># ë¼ì´ë¸ŒëŸ¬ë¦¬</span>
  /lib<span class="o">{</span>,32,64<span class="o">}</span>/<span class="k">**</span> mr,
  /usr/lib<span class="o">{</span>,32,64<span class="o">}</span>/<span class="k">**</span> mr,
  
  <span class="c"># ì„¤ì • íŒŒì¼ (ì½ê¸° ì „ìš©)</span>
  /etc/myapp/<span class="k">**</span> r,
  owner /home/<span class="k">*</span>/.myapp/<span class="k">**</span> rw,
  
  <span class="c"># ë°ì´í„° ë””ë ‰í† ë¦¬</span>
  /var/lib/myapp/<span class="k">**</span> rw,
  /var/log/myapp/<span class="k">**</span> w,
  
  <span class="c"># ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼</span>
  network inet stream,
  network inet6 stream,
  
  <span class="c"># í”„ë¡œì„¸ìŠ¤ ì œì–´</span>
  capability setuid,
  capability setgid,
  
  <span class="c"># ì„ì‹œ íŒŒì¼</span>
  /tmp/myapp.<span class="k">**</span> rw,
  owner /tmp/myapp-<span class="k">**</span> rw,
  
  <span class="c"># ê±°ë¶€í•  ì ‘ê·¼</span>
  deny /etc/passwd r,
  deny /etc/shadow r,
  deny owner /home/<span class="k">*</span>/.ssh/<span class="k">**</span> rw,
  
  <span class="c"># í•˜ìœ„ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰</span>
  /bin/dash ix,
  /usr/bin/python3 ix,
<span class="o">}</span>

<span class="c"># í”„ë¡œíŒŒì¼ ë¡œë“œ ë° í™œì„±í™”</span>
apparmor_parser <span class="nt">-r</span> /etc/apparmor.d/usr.local.bin.myapp
aa-enforce /etc/apparmor.d/usr.local.bin.myapp

<span class="c"># í”„ë¡œíŒŒì¼ ê°œë°œ ëª¨ë“œ (í•™ìŠµ)</span>
aa-genprof /usr/local/bin/myapp
<span class="c"># ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰í•˜ë©° ë™ì‘ í™•ì¸</span>
aa-logprof
</code></pre></div></div>

<h2 id="ì‹œìŠ¤í…œ-í•˜ë“œë‹--system-hardening">ì‹œìŠ¤í…œ í•˜ë“œë‹ | System Hardening</h2>

<h3 id="-ì»¤ë„-ë³´ì•ˆ-ë§¤ê°œë³€ìˆ˜-ì¡°ì •">ğŸ”§ ì»¤ë„ ë³´ì•ˆ ë§¤ê°œë³€ìˆ˜ ì¡°ì •</h3>

<h4 id="sysctl-ë³´ì•ˆ-ì„¤ì •">sysctl ë³´ì•ˆ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/sysctl.d/99-security.conf</span>
<span class="c"># ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ</span>
net.ipv4.ip_forward <span class="o">=</span> 0
net.ipv4.conf.all.send_redirects <span class="o">=</span> 0
net.ipv4.conf.default.send_redirects <span class="o">=</span> 0
net.ipv4.conf.all.accept_redirects <span class="o">=</span> 0
net.ipv4.conf.default.accept_redirects <span class="o">=</span> 0
net.ipv4.conf.all.secure_redirects <span class="o">=</span> 0
net.ipv4.conf.default.secure_redirects <span class="o">=</span> 0
net.ipv6.conf.all.accept_redirects <span class="o">=</span> 0
net.ipv6.conf.default.accept_redirects <span class="o">=</span> 0
net.ipv4.conf.all.accept_source_route <span class="o">=</span> 0
net.ipv4.conf.default.accept_source_route <span class="o">=</span> 0
net.ipv6.conf.all.accept_source_route <span class="o">=</span> 0
net.ipv6.conf.default.accept_source_route <span class="o">=</span> 0

<span class="c"># SYN í”ŒëŸ¬ë“œ ë°©ì§€</span>
net.ipv4.tcp_syncookies <span class="o">=</span> 1
net.ipv4.tcp_max_syn_backlog <span class="o">=</span> 2048
net.ipv4.tcp_synack_retries <span class="o">=</span> 2
net.ipv4.tcp_syn_retries <span class="o">=</span> 5

<span class="c"># ICMP ë³´ì•ˆ</span>
net.ipv4.icmp_echo_ignore_broadcasts <span class="o">=</span> 1
net.ipv4.icmp_ignore_bogus_error_responses <span class="o">=</span> 1
net.ipv4.icmp_echo_ignore_all <span class="o">=</span> 0

<span class="c"># IP ìŠ¤í‘¸í•‘ ë°©ì§€</span>
net.ipv4.conf.all.rp_filter <span class="o">=</span> 1
net.ipv4.conf.default.rp_filter <span class="o">=</span> 1

<span class="c"># IPv6 ë³´ì•ˆ</span>
net.ipv6.conf.all.disable_ipv6 <span class="o">=</span> 1
net.ipv6.conf.default.disable_ipv6 <span class="o">=</span> 1

<span class="c"># ë©”ëª¨ë¦¬ ë³´ì•ˆ</span>
kernel.randomize_va_space <span class="o">=</span> 2
kernel.exec-shield <span class="o">=</span> 1
kernel.dmesg_restrict <span class="o">=</span> 1
kernel.kptr_restrict <span class="o">=</span> 2

<span class="c"># í”„ë¡œì„¸ìŠ¤ ë³´ì•ˆ  </span>
fs.suid_dumpable <span class="o">=</span> 0
kernel.core_uses_pid <span class="o">=</span> 1
kernel.ctrl-alt-del <span class="o">=</span> 0

<span class="c"># ì„¤ì • ì ìš©</span>
sysctl <span class="nt">-p</span> /etc/sysctl.d/99-security.conf
</code></pre></div></div>

<h4 id="íŒŒì¼-ì‹œìŠ¤í…œ-ë³´ì•ˆ">íŒŒì¼ ì‹œìŠ¤í…œ ë³´ì•ˆ</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì¤‘ìš” ë””ë ‰í† ë¦¬ ë§ˆìš´íŠ¸ ì˜µì…˜ ê°•í™”</span>
<span class="c"># /etc/fstab</span>
/tmp        /tmp        tmpfs   defaults,nodev,nosuid,noexec    0 0
/var/tmp    /var/tmp    tmpfs   defaults,nodev,nosuid,noexec    0 0
/dev/shm    /dev/shm    tmpfs   defaults,nodev,nosuid,noexec    0 0

<span class="c"># íŒŒì¼ ê¶Œí•œ ê°•í™”</span>
<span class="nb">chmod </span>700 /root
<span class="nb">chmod </span>600 /etc/ssh/sshd_config
<span class="nb">chmod </span>600 /etc/passwd-
<span class="nb">chmod </span>600 /etc/shadow
<span class="nb">chmod </span>600 /etc/gshadow
<span class="nb">chmod </span>644 /etc/group

<span class="c"># ë¶ˆí•„ìš”í•œ SUID/SGID ì œê±°</span>
find / <span class="nt">-type</span> f <span class="se">\(</span> <span class="nt">-perm</span> <span class="nt">-4000</span> <span class="nt">-o</span> <span class="nt">-perm</span> <span class="nt">-2000</span> <span class="se">\)</span> <span class="nt">-print</span> <span class="o">&gt;</span> /tmp/suid_sgid_files
<span class="c"># ê²€í†  í›„ í•„ìš”ì—†ëŠ” ê²ƒë“¤ ì œê±°</span>
<span class="nb">chmod </span>u-s /usr/bin/unnecessary-suid-program

<span class="c"># ìˆ¨ê²¨ì§„ íŒŒì¼ ë° ë””ë ‰í† ë¦¬ ê²€ì‚¬</span>
find / <span class="nt">-name</span> <span class="s2">".*"</span> <span class="nt">-type</span> f <span class="nt">-exec</span> <span class="nb">ls</span> <span class="nt">-la</span> <span class="o">{}</span> <span class="se">\;</span> 2&gt;/dev/null
find / <span class="nt">-name</span> <span class="s2">".*"</span> <span class="nt">-type</span> d <span class="nt">-exec</span> <span class="nb">ls</span> <span class="nt">-lad</span> <span class="o">{}</span> <span class="se">\;</span> 2&gt;/dev/null

<span class="c"># ëŒ€ìš©ëŸ‰ íŒŒì¼ ê²€ì‚¬ (backdoor ê°€ëŠ¥ì„±)</span>
find / <span class="nt">-size</span> +10M <span class="nt">-type</span> f <span class="nt">-exec</span> <span class="nb">ls</span> <span class="nt">-la</span> <span class="o">{}</span> <span class="se">\;</span> 2&gt;/dev/null

<span class="c"># ìµœê·¼ ìˆ˜ì •ëœ íŒŒì¼ ê²€ì‚¬</span>
find / <span class="nt">-mtime</span> <span class="nt">-7</span> <span class="nt">-type</span> f <span class="nt">-exec</span> <span class="nb">ls</span> <span class="nt">-la</span> <span class="o">{}</span> <span class="se">\;</span> 2&gt;/dev/null
</code></pre></div></div>

<h3 id="-ì„œë¹„ìŠ¤-ë°-ë°ëª¬-ë³´ì•ˆ">ğŸ” ì„œë¹„ìŠ¤ ë° ë°ëª¬ ë³´ì•ˆ</h3>

<h4 id="ë¶ˆí•„ìš”í•œ-ì„œë¹„ìŠ¤-ì œê±°">ë¶ˆí•„ìš”í•œ ì„œë¹„ìŠ¤ ì œê±°</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤ í™•ì¸</span>
systemctl list-units <span class="nt">--type</span><span class="o">=</span>service <span class="nt">--state</span><span class="o">=</span>running
netstat <span class="nt">-tulpn</span>
ss <span class="nt">-tulpn</span>

<span class="c"># ë¶ˆí•„ìš”í•œ ì„œë¹„ìŠ¤ ì¤‘ì§€ ë° ë¹„í™œì„±í™”</span>
systemctl stop cups
systemctl disable cups
systemctl mask cups

<span class="c"># ìœ„í—˜í•œ ì„œë¹„ìŠ¤ë“¤ (ì¼ë°˜ì ìœ¼ë¡œ ë¹„í™œì„±í™”)</span>
<span class="nv">services_to_disable</span><span class="o">=(</span>
    <span class="s2">"telnet"</span>
    <span class="s2">"rsh"</span>
    <span class="s2">"rlogin"</span>
    <span class="s2">"tftp"</span>
    <span class="s2">"xinetd"</span>
    <span class="s2">"sendmail"</span>
    <span class="s2">"postfix"</span>
    <span class="s2">"dovecot"</span>
    <span class="s2">"cups"</span>
    <span class="s2">"avahi-daemon"</span>
    <span class="s2">"bluetooth"</span>
<span class="o">)</span>

<span class="k">for </span>service <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">services_to_disable</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
    if </span>systemctl is-enabled <span class="s2">"</span><span class="nv">$service</span><span class="s2">"</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Disabling </span><span class="nv">$service</span><span class="s2">..."</span>
        systemctl stop <span class="s2">"</span><span class="nv">$service</span><span class="s2">"</span>
        systemctl disable <span class="s2">"</span><span class="nv">$service</span><span class="s2">"</span>
        systemctl mask <span class="s2">"</span><span class="nv">$service</span><span class="s2">"</span>
    <span class="k">fi
done</span>

<span class="c"># ë„¤íŠ¸ì›Œí¬ ì„œë¹„ìŠ¤ ì ê²€</span>
lsof <span class="nt">-i</span>
netstat <span class="nt">-anp</span> | <span class="nb">grep </span>LISTEN
</code></pre></div></div>

<h4 id="ì• í”Œë¦¬ì¼€ì´ì…˜ë³„-ë³´ì•ˆ-ì„¤ì •">ì• í”Œë¦¬ì¼€ì´ì…˜ë³„ ë³´ì•ˆ ì„¤ì •</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Apache ë³´ì•ˆ ì„¤ì •</span>
<span class="c"># /etc/apache2/conf-available/security.conf</span>
ServerTokens Prod
ServerSignature Off
TraceEnable Off
Header always <span class="nb">set </span>X-Content-Type-Options nosniff
Header always <span class="nb">set </span>X-Frame-Options DENY
Header always <span class="nb">set </span>X-XSS-Protection <span class="s2">"1; mode=block"</span>
Header always <span class="nb">set </span>Strict-Transport-Security <span class="s2">"max-age=63072000; includeSubDomains; preload"</span>

<span class="c"># Nginx ë³´ì•ˆ ì„¤ì •</span>
<span class="c"># /etc/nginx/nginx.conf</span>
server_tokens off<span class="p">;</span>
add_header X-Frame-Options DENY<span class="p">;</span>
add_header X-Content-Type-Options nosniff<span class="p">;</span>
add_header X-XSS-Protection <span class="s2">"1; mode=block"</span><span class="p">;</span>
add_header Strict-Transport-Security <span class="s2">"max-age=63072000; includeSubDomains; preload"</span><span class="p">;</span>

<span class="c"># MySQL/MariaDB ë³´ì•ˆ</span>
mysql_secure_installation

<span class="c"># PostgreSQL ë³´ì•ˆ ì„¤ì •</span>
<span class="c"># /etc/postgresql/*/main/postgresql.conf</span>
ssl <span class="o">=</span> on
ssl_ciphers <span class="o">=</span> <span class="s1">'HIGH:MEDIUM:+3DES:!aNULL'</span>
ssl_prefer_server_ciphers <span class="o">=</span> on

<span class="c"># /etc/postgresql/*/main/pg_hba.conf</span>
<span class="c"># TYPE  DATABASE        USER            ADDRESS                 METHOD</span>
<span class="nb">local   </span>all             all                                     md5
host    all             all             127.0.0.1/32            md5
host    all             all             ::1/128                 md5
</code></pre></div></div>

<h2 id="ì¹¨ì…-íƒì§€-ì‹œìŠ¤í…œ--intrusion-detection-systems">ì¹¨ì… íƒì§€ ì‹œìŠ¤í…œ | Intrusion Detection Systems</h2>

<h3 id="-aide-advanced-intrusion-detection-environment">ğŸš¨ AIDE (Advanced Intrusion Detection Environment)</h3>

<h4 id="aide-ì„¤ì¹˜-ë°-êµ¬ì„±">AIDE ì„¤ì¹˜ ë° êµ¬ì„±</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># AIDE ì„¤ì¹˜</span>
apt-get <span class="nb">install </span>aide aide-common

<span class="c"># ì„¤ì • íŒŒì¼ ìˆ˜ì •</span>
<span class="c"># /etc/aide/aide.conf</span>
<span class="nv">database</span><span class="o">=</span>file:/var/lib/aide/aide.db
<span class="nv">database_out</span><span class="o">=</span>file:/var/lib/aide/aide.db.new
<span class="nv">gzip_dbout</span><span class="o">=</span><span class="nb">yes
</span><span class="nv">report_url</span><span class="o">=</span>file:/var/log/aide/aide.log
<span class="nv">report_url</span><span class="o">=</span>stdout

<span class="c"># ê·œì¹™ ì •ì˜</span>
/boot   f+p+u+g+s+b+m+c+md5+sha1
/bin    f+p+u+g+s+b+m+c+md5+sha1
/sbin   f+p+u+g+s+b+m+c+md5+sha1
/lib    f+p+u+g+s+b+m+c+md5+sha1
/opt    f+p+u+g+s+b+m+c+md5+sha1
/usr    f+p+u+g+s+b+m+c+md5+sha1
/root   f+p+u+g+s+b+m+c+md5+sha1
/etc    f+p+u+g+s+b+m+c+md5+sha1

<span class="c"># ì œì™¸í•  ë””ë ‰í† ë¦¬</span>
<span class="o">!</span>/var/log/.<span class="k">*</span>
<span class="o">!</span>/var/spool/.<span class="k">*</span>
<span class="o">!</span>/var/run/.<span class="k">*</span>
<span class="o">!</span>/var/lock/.<span class="k">*</span>
<span class="o">!</span>/proc/.<span class="k">*</span>
<span class="o">!</span>/sys/.<span class="k">*</span>
<span class="o">!</span>/dev/.<span class="k">*</span>
<span class="o">!</span>/tmp/.<span class="k">*</span>

<span class="c"># ì´ˆê¸° ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±</span>
aideinit

<span class="c"># ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸</span>
<span class="nb">cp</span> /var/lib/aide/aide.db.new /var/lib/aide/aide.db

<span class="c"># ë¬´ê²°ì„± ê²€ì‚¬ ì‹¤í–‰</span>
aide <span class="nt">--check</span>

<span class="c"># ìë™í™” ìŠ¤í¬ë¦½íŠ¸</span>
<span class="c">#!/bin/bash</span>
<span class="c"># /usr/local/bin/aide-check.sh</span>
<span class="nv">AIDE_LOG</span><span class="o">=</span><span class="s2">"/var/log/aide/aide-</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d<span class="si">)</span><span class="s2">.log"</span>

aide <span class="nt">--check</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$AIDE_LOG</span><span class="s2">"</span> 2&gt;&amp;1
<span class="nv">EXIT_CODE</span><span class="o">=</span><span class="nv">$?</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$EXIT_CODE</span> <span class="nt">-ne</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"AIDE detected changes on </span><span class="si">$(</span><span class="nb">hostname</span><span class="si">)</span><span class="s2">"</span> | <span class="se">\</span>
    mail <span class="nt">-s</span> <span class="s2">"AIDE Alert - File Integrity Check Failed"</span> admin@company.com <span class="se">\</span>
    <span class="nt">-A</span> <span class="s2">"</span><span class="nv">$AIDE_LOG</span><span class="s2">"</span>
<span class="k">fi</span>

<span class="c"># cron ì„¤ì •</span>
<span class="c"># /etc/cron.d/aide</span>
0 2 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> root /usr/local/bin/aide-check.sh
</code></pre></div></div>

<h3 id="-fail2ban-ì„¤ì •">ğŸ” Fail2Ban ì„¤ì •</h3>

<h4 id="fail2ban-êµ¬ì„±-ë°-ì»¤ìŠ¤í„°ë§ˆì´ì§•">Fail2Ban êµ¬ì„± ë° ì»¤ìŠ¤í„°ë§ˆì´ì§•</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Fail2Ban ì„¤ì¹˜</span>
apt-get <span class="nb">install </span>fail2ban

<span class="c"># ê¸°ë³¸ ì„¤ì • íŒŒì¼ ë³µì‚¬</span>
<span class="nb">cp</span> /etc/fail2ban/jail.conf /etc/fail2ban/jail.local

<span class="c"># /etc/fail2ban/jail.local ì„¤ì •</span>
<span class="o">[</span>DEFAULT]
bantime <span class="o">=</span> 3600
findtime <span class="o">=</span> 600
maxretry <span class="o">=</span> 3
backend <span class="o">=</span> systemd
banaction <span class="o">=</span> iptables-multiport
banaction_allports <span class="o">=</span> iptables-allports
ignoreip <span class="o">=</span> 127.0.0.1/8 192.168.1.0/24 10.0.0.0/8

<span class="c"># SSH ë³´í˜¸</span>
<span class="o">[</span>sshd]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> 2222
logpath <span class="o">=</span> /var/log/auth.log
maxretry <span class="o">=</span> 3
bantime <span class="o">=</span> 3600

<span class="c"># Apache ë³´í˜¸</span>
<span class="o">[</span>apache-auth]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> http,https
logpath <span class="o">=</span> /var/log/apache2/error.log

<span class="o">[</span>apache-badbots]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> http,https
logpath <span class="o">=</span> /var/log/apache2/access.log

<span class="o">[</span>apache-noscript]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> http,https
logpath <span class="o">=</span> /var/log/apache2/access.log

<span class="c"># ì»¤ìŠ¤í…€ í•„í„° ìƒì„±</span>
<span class="c"># /etc/fail2ban/filter.d/custom-app.conf</span>
<span class="o">[</span>Definition]
failregex <span class="o">=</span> ^.<span class="k">*</span>Failed login attempt from &lt;HOST&gt;.<span class="k">*</span><span class="err">$</span>
            ^.<span class="k">*</span>Invalid user .<span class="k">*</span> from &lt;HOST&gt;.<span class="k">*</span><span class="err">$</span>
            ^.<span class="k">*</span>authentication failure.<span class="k">*</span><span class="nv">rhost</span><span class="o">=</span>&lt;HOST&gt;.<span class="k">*</span><span class="err">$</span>
ignoreregex <span class="o">=</span>

<span class="c"># ì»¤ìŠ¤í…€ jail ì„¤ì •</span>
<span class="c"># /etc/fail2ban/jail.localì— ì¶”ê°€</span>
<span class="o">[</span>custom-app]
enabled <span class="o">=</span> <span class="nb">true
</span>port <span class="o">=</span> 8080
logpath <span class="o">=</span> /var/log/custom-app.log
filter <span class="o">=</span> custom-app
maxretry <span class="o">=</span> 5
bantime <span class="o">=</span> 7200

<span class="c"># Fail2Ban ê´€ë¦¬ ëª…ë ¹</span>
fail2ban-client status
fail2ban-client status sshd
fail2ban-client unban 192.168.1.100
fail2ban-client reload
</code></pre></div></div>

<h3 id="-ossecwazuh-ì„¤ì¹˜">ğŸ” OSSEC/Wazuh ì„¤ì¹˜</h3>

<h4 id="wazuh-agent-ì„¤ì¹˜-ë°-êµ¬ì„±">Wazuh Agent ì„¤ì¹˜ ë° êµ¬ì„±</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Wazuh ì €ì¥ì†Œ ì¶”ê°€</span>
curl <span class="nt">-s</span> https://packages.wazuh.com/key/GPG-KEY-WAZUH | apt-key add -
<span class="nb">echo</span> <span class="s2">"deb https://packages.wazuh.com/4.x/apt/ stable main"</span> <span class="o">&gt;</span> /etc/apt/sources.list.d/wazuh.list
apt-get update

<span class="c"># Wazuh Agent ì„¤ì¹˜</span>
apt-get <span class="nb">install </span>wazuh-agent

<span class="c"># ì—ì´ì „íŠ¸ ì„¤ì •</span>
<span class="c"># /var/ossec/etc/ossec.conf</span>
&lt;ossec_config&gt;
  &lt;client&gt;
    &lt;server&gt;
      &lt;address&gt;MANAGER_IP&lt;/address&gt;
      &lt;port&gt;1514&lt;/port&gt;
      &lt;protocol&gt;tcp&lt;/protocol&gt;
    &lt;/server&gt;
    &lt;config-profile&gt;linux, ubuntu, ubuntu20,&lt;/config-profile&gt;
    &lt;notify_time&gt;10&lt;/notify_time&gt;
    &lt;time-reconnect&gt;60&lt;/time-reconnect&gt;
    &lt;auto_restart&gt;yes&lt;/auto_restart&gt;
    &lt;crypto_method&gt;aes&lt;/crypto_method&gt;
  &lt;/client&gt;

  &lt;<span class="o">!</span><span class="nt">--</span> ë¡œê·¸ ëª¨ë‹ˆí„°ë§ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;localfile&gt;
    &lt;log_format&gt;syslog&lt;/log_format&gt;
    &lt;location&gt;/var/log/auth.log&lt;/location&gt;
  &lt;/localfile&gt;

  &lt;localfile&gt;
    &lt;log_format&gt;syslog&lt;/log_format&gt;
    &lt;location&gt;/var/log/syslog&lt;/location&gt;
  &lt;/localfile&gt;

  &lt;localfile&gt;
    &lt;log_format&gt;apache&lt;/log_format&gt;
    &lt;location&gt;/var/log/apache2/access.log&lt;/location&gt;
  &lt;/localfile&gt;

  &lt;<span class="o">!</span><span class="nt">--</span> íŒŒì¼ ë¬´ê²°ì„± ëª¨ë‹ˆí„°ë§ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;syscheck&gt;
    &lt;disabled&gt;no&lt;/disabled&gt;
    &lt;frequency&gt;43200&lt;/frequency&gt;
    &lt;scan_on_start&gt;yes&lt;/scan_on_start&gt;
    
    &lt;directories <span class="nv">check_all</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">realtime</span><span class="o">=</span><span class="s2">"yes"</span><span class="o">&gt;</span>/etc&lt;/directories&gt;
    &lt;directories <span class="nv">check_all</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">realtime</span><span class="o">=</span><span class="s2">"yes"</span><span class="o">&gt;</span>/usr/bin&lt;/directories&gt;
    &lt;directories <span class="nv">check_all</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">realtime</span><span class="o">=</span><span class="s2">"yes"</span><span class="o">&gt;</span>/usr/sbin&lt;/directories&gt;
    &lt;directories <span class="nv">check_all</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">realtime</span><span class="o">=</span><span class="s2">"yes"</span><span class="o">&gt;</span>/bin&lt;/directories&gt;
    &lt;directories <span class="nv">check_all</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">realtime</span><span class="o">=</span><span class="s2">"yes"</span><span class="o">&gt;</span>/sbin&lt;/directories&gt;
    
    &lt;ignore&gt;/etc/mtab&lt;/ignore&gt;
    &lt;ignore&gt;/etc/hosts.deny&lt;/ignore&gt;
    &lt;ignore&gt;/etc/mail/statistics&lt;/ignore&gt;
    &lt;ignore&gt;/etc/random-seed&lt;/ignore&gt;
    &lt;ignore&gt;/etc/adjtime&lt;/ignore&gt;
  &lt;/syscheck&gt;

  &lt;<span class="o">!</span><span class="nt">--</span> ë£¨íŠ¸í‚· íƒì§€ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;rootcheck&gt;
    &lt;disabled&gt;no&lt;/disabled&gt;
    &lt;check_files&gt;yes&lt;/check_files&gt;
    &lt;check_trojans&gt;yes&lt;/check_trojans&gt;
    &lt;check_dev&gt;yes&lt;/check_dev&gt;
    &lt;check_sys&gt;yes&lt;/check_sys&gt;
    &lt;check_pids&gt;yes&lt;/check_pids&gt;
    &lt;check_ports&gt;yes&lt;/check_ports&gt;
    &lt;check_if&gt;yes&lt;/check_if&gt;
  &lt;/rootcheck&gt;

  &lt;<span class="o">!</span><span class="nt">--</span> í™œì„± ì‘ë‹µ <span class="nt">--</span><span class="o">&gt;</span>
  &lt;active-response&gt;
    &lt;disabled&gt;no&lt;/disabled&gt;
    &lt;ca_store&gt;/var/ossec/etc/wpk_root.pem&lt;/ca_store&gt;
    &lt;ca_verification&gt;yes&lt;/ca_verification&gt;
  &lt;/active-response&gt;
&lt;/ossec_config&gt;

<span class="c"># ì„œë¹„ìŠ¤ ì‹œì‘</span>
systemctl <span class="nb">enable </span>wazuh-agent
systemctl start wazuh-agent

<span class="c"># ìƒíƒœ í™•ì¸</span>
systemctl status wazuh-agent
/var/ossec/bin/ossec-control status
</code></pre></div></div>

<h2 id="ì»¨í…Œì´ë„ˆ-ë³´ì•ˆ--container-security">ì»¨í…Œì´ë„ˆ ë³´ì•ˆ | Container Security</h2>

<h3 id="-docker-ë³´ì•ˆ-ì„¤ì •">ğŸ³ Docker ë³´ì•ˆ ì„¤ì •</h3>

<h4 id="docker-ë°ëª¬-ë³´ì•ˆ-ê°•í™”">Docker ë°ëª¬ ë³´ì•ˆ ê°•í™”</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Docker ë°ëª¬ ì„¤ì •</span>
<span class="c"># /etc/docker/daemon.json</span>
<span class="o">{</span>
    <span class="s2">"icc"</span>: <span class="nb">false</span>,
    <span class="s2">"userns-remap"</span>: <span class="s2">"default"</span>,
    <span class="s2">"no-new-privileges"</span>: <span class="nb">true</span>,
    <span class="s2">"seccomp-profile"</span>: <span class="s2">"/etc/docker/seccomp.json"</span>,
    <span class="s2">"selinux-enabled"</span>: <span class="nb">true</span>,
    <span class="s2">"disable-legacy-registry"</span>: <span class="nb">true</span>,
    <span class="s2">"live-restore"</span>: <span class="nb">true</span>,
    <span class="s2">"userland-proxy"</span>: <span class="nb">false</span>,
    <span class="s2">"experimental"</span>: <span class="nb">false</span>,
    <span class="s2">"metrics-addr"</span>: <span class="s2">"127.0.0.1:9323"</span>,
    <span class="s2">"log-driver"</span>: <span class="s2">"json-file"</span>,
    <span class="s2">"log-opts"</span>: <span class="o">{</span>
        <span class="s2">"max-size"</span>: <span class="s2">"10m"</span>,
        <span class="s2">"max-file"</span>: <span class="s2">"3"</span>
    <span class="o">}</span>,
    <span class="s2">"storage-driver"</span>: <span class="s2">"overlay2"</span>,
    <span class="s2">"default-ulimits"</span>: <span class="o">{</span>
        <span class="s2">"nofile"</span>: <span class="o">{</span>
            <span class="s2">"name"</span>: <span class="s2">"nofile"</span>,
            <span class="s2">"hard"</span>: 64000,
            <span class="s2">"soft"</span>: 64000
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c"># ì‹œìŠ¤í…œ ì¬ì‹œì‘</span>
systemctl restart docker

<span class="c"># ë³´ì•ˆ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì˜ˆì‹œ</span>
docker run <span class="nt">-d</span> <span class="se">\</span>
  <span class="nt">--name</span> secure-app <span class="se">\</span>
  <span class="nt">--read-only</span> <span class="se">\</span>
  <span class="nt">--tmpfs</span> /tmp <span class="se">\</span>
  <span class="nt">--tmpfs</span> /var/run <span class="se">\</span>
  <span class="nt">--tmpfs</span> /var/lock <span class="se">\</span>
  <span class="nt">--user</span> 1000:1000 <span class="se">\</span>
  <span class="nt">--cap-drop</span> ALL <span class="se">\</span>
  <span class="nt">--cap-add</span> NET_BIND_SERVICE <span class="se">\</span>
  <span class="nt">--security-opt</span> no-new-privileges:true <span class="se">\</span>
  <span class="nt">--security-opt</span> apparmor:docker-default <span class="se">\</span>
  <span class="nt">--memory</span> 512m <span class="se">\</span>
  <span class="nt">--cpus</span><span class="o">=</span><span class="s2">"0.5"</span> <span class="se">\</span>
  <span class="nt">--pids-limit</span> 100 <span class="se">\</span>
  <span class="nt">--restart</span> unless-stopped <span class="se">\</span>
  nginx:alpine
</code></pre></div></div>

<h4 id="dockerfile-ë³´ì•ˆ-ëª¨ë²”-ì‚¬ë¡€">Dockerfile ë³´ì•ˆ ëª¨ë²” ì‚¬ë¡€</h4>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë³´ì•ˆ ê°•í™” Dockerfile ì˜ˆì‹œ</span>
<span class="k">FROM</span><span class="s"> alpine:3.18</span>

<span class="c"># ë³´ì•ˆ ì—…ë°ì´íŠ¸ ì ìš©</span>
<span class="k">RUN </span>apk update <span class="o">&amp;&amp;</span> apk upgrade <span class="o">&amp;&amp;</span> <span class="se">\
</span>    apk add <span class="nt">--no-cache</span> tini <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">rm</span> <span class="nt">-rf</span> /var/cache/apk/<span class="k">*</span>

<span class="c"># ë¹„íŠ¹ê¶Œ ì‚¬ìš©ì ìƒì„±</span>
<span class="k">RUN </span>addgroup <span class="nt">-g</span> 1000 <span class="nt">-S</span> appgroup <span class="o">&amp;&amp;</span> <span class="se">\
</span>    adduser <span class="nt">-u</span> 1000 <span class="nt">-S</span> appuser <span class="nt">-G</span> appgroup

<span class="c"># ì• í”Œë¦¬ì¼€ì´ì…˜ ë””ë ‰í† ë¦¬ ìƒì„± ë° ê¶Œí•œ ì„¤ì •</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> --chown=appuser:appgroup . .</span>

<span class="c"># ì‹¤í–‰ íŒŒì¼ ê¶Œí•œë§Œ ë¶€ì—¬</span>
<span class="k">RUN </span><span class="nb">chmod </span>755 /app/entrypoint.sh <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">chmod </span>644 /app/<span class="k">*</span>.conf

<span class="c"># ë¹„íŠ¹ê¶Œ ì‚¬ìš©ìë¡œ ì „í™˜</span>
<span class="k">USER</span><span class="s"> appuser:appgroup</span>

<span class="c"># ì‹œê·¸ë„ ì²˜ë¦¬ë¥¼ ìœ„í•œ tini ì‚¬ìš©</span>
<span class="k">ENTRYPOINT</span><span class="s"> ["/sbin/tini", "--"]</span>
<span class="k">CMD</span><span class="s"> ["./entrypoint.sh"]</span>

<span class="c"># ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ í¬íŠ¸ ë…¸ì¶œ ê¸ˆì§€</span>
<span class="c"># EXPOSE 80 (í•„ìš”í•œ ê²½ìš°ë§Œ)</span>

<span class="c"># í—¬ìŠ¤ì²´í¬ ì¶”ê°€</span>
<span class="k">HEALTHCHECK</span><span class="s"> --interval=30s --timeout=3s --start-period=5s --retries=3 \</span>
  CMD curl -f http://localhost:8080/health || exit 1
</code></pre></div></div>

<h3 id="-kubernetes-ë³´ì•ˆ">âš“ Kubernetes ë³´ì•ˆ</h3>

<h4 id="pod-security-standards-ì ìš©">Pod Security Standards ì ìš©</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Pod Security Policy (deprecated, use Pod Security Standards)</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Namespace</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">secure-namespace</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">pod-security.kubernetes.io/enforce</span><span class="pi">:</span> <span class="s">restricted</span>
    <span class="na">pod-security.kubernetes.io/audit</span><span class="pi">:</span> <span class="s">restricted</span>
    <span class="na">pod-security.kubernetes.io/warn</span><span class="pi">:</span> <span class="s">restricted</span>

<span class="nn">---</span>
<span class="c1"># ë³´ì•ˆ ê°•í™” Pod ì˜ˆì‹œ</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">secure-pod</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">secure-namespace</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">securityContext</span><span class="pi">:</span>
    <span class="na">runAsNonRoot</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">1000</span>
    <span class="na">runAsGroup</span><span class="pi">:</span> <span class="m">1000</span>
    <span class="na">fsGroup</span><span class="pi">:</span> <span class="m">1000</span>
    <span class="na">seccompProfile</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">RuntimeDefault</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">app</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
    <span class="na">securityContext</span><span class="pi">:</span>
      <span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="kc">false</span>
      <span class="na">readOnlyRootFilesystem</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="na">runAsNonRoot</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">1000</span>
      <span class="na">capabilities</span><span class="pi">:</span>
        <span class="na">drop</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">ALL</span>
        <span class="na">add</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">NET_BIND_SERVICE</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">limits</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">256Mi"</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">200m"</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">128Mi"</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">100m"</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">tmp-volume</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/tmp</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">var-cache-nginx</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/cache/nginx</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">var-run</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/run</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">tmp-volume</span>
    <span class="na">emptyDir</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">var-cache-nginx</span>
    <span class="na">emptyDir</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">var-run</span>
    <span class="na">emptyDir</span><span class="pi">:</span> <span class="pi">{}</span>

<span class="nn">---</span>
<span class="c1"># Network Policy</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NetworkPolicy</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">default-deny-all</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">secure-namespace</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">podSelector</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="na">policyTypes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">Ingress</span>
  <span class="pi">-</span> <span class="s">Egress</span>

<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NetworkPolicy</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">allow-web-traffic</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">secure-namespace</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">podSelector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">web</span>
  <span class="na">policyTypes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">Ingress</span>
  <span class="pi">-</span> <span class="s">Egress</span>
  <span class="na">ingress</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">from</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">namespaceSelector</span><span class="pi">:</span>
        <span class="na">matchLabels</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">ingress-system</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
  <span class="na">egress</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">to</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">podSelector</span><span class="pi">:</span>
        <span class="na">matchLabels</span><span class="pi">:</span>
          <span class="na">app</span><span class="pi">:</span> <span class="s">database</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">5432</span>
  <span class="pi">-</span> <span class="na">to</span><span class="pi">:</span> <span class="pi">{}</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">UDP</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">53</span>
</code></pre></div></div>

<h2 id="ì»´í”Œë¼ì´ì–¸ìŠ¤ì™€-ê°ì‚¬--compliance-and-auditing">ì»´í”Œë¼ì´ì–¸ìŠ¤ì™€ ê°ì‚¬ | Compliance and Auditing</h2>

<h3 id="-cis-benchmark-ì ìš©">ğŸ“‹ CIS Benchmark ì ìš©</h3>

<h4 id="cis-controls-ìë™í™”-ìŠ¤í¬ë¦½íŠ¸">CIS Controls ìë™í™” ìŠ¤í¬ë¦½íŠ¸</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># CIS Ubuntu 20.04 LTS Benchmark ìë™ ì ìš© ìŠ¤í¬ë¦½íŠ¸</span>

<span class="nb">echo</span> <span class="s2">"CIS Benchmark ìë™ ì ìš©ì„ ì‹œì‘í•©ë‹ˆë‹¤..."</span>

<span class="c"># 1. íŒŒì¼ ì‹œìŠ¤í…œ êµ¬ì„±</span>
<span class="nb">echo</span> <span class="s2">"1. íŒŒì¼ ì‹œìŠ¤í…œ ë³´ì•ˆ ì„¤ì •..."</span>

<span class="c"># 1.1 ì„ì‹œ íŒŒì¼ ì‹œìŠ¤í…œ ë³´ì•ˆ</span>
<span class="k">if</span> <span class="o">!</span> <span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"/tmp.*nodev"</span> /etc/fstab<span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"/tmp /tmp tmpfs defaults,rw,nosuid,nodev,noexec,relatime 0 0"</span> <span class="o">&gt;&gt;</span> /etc/fstab
<span class="k">fi</span>

<span class="c"># 1.2 ë¶ˆí•„ìš”í•œ íŒŒì¼ ì‹œìŠ¤í…œ ë¹„í™œì„±í™”</span>
<span class="nb">cat</span> <span class="o">&gt;&gt;</span> /etc/modprobe.d/blacklist-rare-filesystems.conf <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
install cramfs /bin/true
install freevxfs /bin/true
install jffs2 /bin/true
install hfs /bin/true
install hfsplus /bin/true
install squashfs /bin/true
install udf /bin/true
install fat /bin/true
install vfat /bin/true
install usb-storage /bin/true
</span><span class="no">EOF

</span><span class="c"># 2. ì„œë¹„ìŠ¤ ì„¤ì •</span>
<span class="nb">echo</span> <span class="s2">"2. ì„œë¹„ìŠ¤ ë³´ì•ˆ ì„¤ì •..."</span>

<span class="c"># 2.1 ì‹œê°„ ë™ê¸°í™”</span>
systemctl <span class="nb">enable </span>ntp
systemctl start ntp

<span class="c"># 2.2 ë¶ˆí•„ìš”í•œ ì„œë¹„ìŠ¤ ë¹„í™œì„±í™”</span>
<span class="nv">services_to_disable</span><span class="o">=(</span>
    <span class="s2">"autofs"</span>
    <span class="s2">"avahi-daemon"</span> 
    <span class="s2">"cups"</span>
    <span class="s2">"dhcpd"</span>
    <span class="s2">"slapd"</span>
    <span class="s2">"nfs"</span>
    <span class="s2">"rpcbind"</span>
    <span class="s2">"bind9"</span>
    <span class="s2">"vsftpd"</span>
    <span class="s2">"apache2"</span>
    <span class="s2">"dovecot"</span>
    <span class="s2">"smbd"</span>
    <span class="s2">"squid"</span>
    <span class="s2">"snmpd"</span>
    <span class="s2">"rsync"</span>
<span class="o">)</span>

<span class="k">for </span>service <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">services_to_disable</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
    if </span>systemctl is-enabled <span class="s2">"</span><span class="nv">$service</span><span class="s2">"</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
        </span>systemctl disable <span class="s2">"</span><span class="nv">$service</span><span class="s2">"</span>
        systemctl stop <span class="s2">"</span><span class="nv">$service</span><span class="s2">"</span>
    <span class="k">fi
done</span>

<span class="c"># 3. ë„¤íŠ¸ì›Œí¬ ë§¤ê°œë³€ìˆ˜ ì„¤ì •</span>
<span class="nb">echo</span> <span class="s2">"3. ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ ì„¤ì •..."</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/sysctl.d/99-cis.conf <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
net.ipv4.ip_forward = 0
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.secure_redirects = 0
net.ipv4.conf.all.log_martians = 1
net.ipv4.conf.default.log_martians = 1
net.ipv4.icmp_echo_ignore_broadcasts = 1
net.ipv4.icmp_ignore_bogus_error_responses = 1
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.default.rp_filter = 1
net.ipv4.tcp_syncookies = 1
net.ipv6.conf.all.accept_ra = 0
net.ipv6.conf.default.accept_ra = 0
net.ipv6.conf.all.accept_redirects = 0
net.ipv6.conf.default.accept_redirects = 0
net.ipv6.conf.all.disable_ipv6 = 1
</span><span class="no">EOF

</span>sysctl <span class="nt">-p</span> /etc/sysctl.d/99-cis.conf

<span class="c"># 4. ë¡œê¹… ë° ê°ì‚¬ ì„¤ì •</span>
<span class="nb">echo</span> <span class="s2">"4. ë¡œê¹… ë° ê°ì‚¬ ì„¤ì •..."</span>

<span class="c"># 4.1 auditd ì„¤ì¹˜ ë° êµ¬ì„±</span>
apt-get <span class="nb">install</span> <span class="nt">-y</span> auditd audispd-plugins

<span class="nb">cat</span> <span class="o">&gt;</span> /etc/audit/rules.d/cis.rules <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
# ì‹œê°„ ë³€ê²½ ê°ì‚¬
-a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time-change
-a always,exit -F arch=b32 -S adjtimex -S settimeofday -S stime -k time-change
-a always,exit -F arch=b64 -S clock_settime -k time-change
-a always,exit -F arch=b32 -S clock_settime -k time-change
-w /etc/localtime -p wa -k time-change

# ì‚¬ìš©ì/ê·¸ë£¹ ì •ë³´ ê°ì‚¬
-w /etc/group -p wa -k identity
-w /etc/passwd -p wa -k identity
-w /etc/gshadow -p wa -k identity
-w /etc/shadow -p wa -k identity
-w /etc/security/opasswd -p wa -k identity

# ë„¤íŠ¸ì›Œí¬ í™˜ê²½ ê°ì‚¬
-a always,exit -F arch=b64 -S sethostname -S setdomainname -k system-locale
-a always,exit -F arch=b32 -S sethostname -S setdomainname -k system-locale
-w /etc/issue -p wa -k system-locale
-w /etc/issue.net -p wa -k system-locale
-w /etc/hosts -p wa -k system-locale
-w /etc/network -p wa -k system-locale

# MAC ì •ì±… ë³€ê²½ ê°ì‚¬
-w /etc/selinux/ -p wa -k MAC-policy
-w /usr/share/selinux/ -p wa -k MAC-policy

# ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ê°ì‚¬
-w /var/log/faillog -p wa -k logins
-w /var/log/lastlog -p wa -k logins
-w /var/log/tallylog -p wa -k logins

# ì„¸ì…˜ ì‹œì‘ ì •ë³´ ê°ì‚¬
-w /var/run/utmp -p wa -k session
-w /var/log/wtmp -p wa -k logins
-w /var/log/btmp -p wa -k logins

# ê¶Œí•œ ë³€ê²½ ê°ì‚¬
-a always,exit -F arch=b64 -S chmod -S fchmod -S fchmodat -F auid&gt;=1000 -F auid!=4294967295 -k perm_mod
-a always,exit -F arch=b32 -S chmod -S fchmod -S fchmodat -F auid&gt;=1000 -F auid!=4294967295 -k perm_mod
-a always,exit -F arch=b64 -S chown -S fchown -S fchownat -S lchown -F auid&gt;=1000 -F auid!=4294967295 -k perm_mod
-a always,exit -F arch=b32 -S chown -S fchown -S fchownat -S lchown -F auid&gt;=1000 -F auid!=4294967295 -k perm_mod

# ê´€ë¦¬ì ì•¡ì„¸ìŠ¤ ê°ì‚¬
-w /etc/sudoers -p wa -k scope
-w /etc/sudoers.d/ -p wa -k scope

# ì»¤ë„ ëª¨ë“ˆ ë¡œë”©/ì–¸ë¡œë”© ê°ì‚¬
-w /sbin/insmod -p x -k modules
-w /sbin/rmmod -p x -k modules
-w /sbin/modprobe -p x -k modules
-a always,exit -F arch=b64 -S init_module -S delete_module -k modules

# íŒŒì¼ ì‚­ì œ ê°ì‚¬
-a always,exit -F arch=b64 -S unlink -S unlinkat -S rename -S renameat -F auid&gt;=1000 -F auid!=4294967295 -k delete
-a always,exit -F arch=b32 -S unlink -S unlinkat -S rename -S renameat -F auid&gt;=1000 -F auid!=4294967295 -k delete

# ì„¤ì • ë¶ˆë³€ì„±
-e 2
</span><span class="no">EOF

</span>systemctl <span class="nb">enable </span>auditd
systemctl start auditd

<span class="c"># 5. ì•¡ì„¸ìŠ¤ ì œì–´ ì„¤ì •</span>
<span class="nb">echo</span> <span class="s2">"5. ì•¡ì„¸ìŠ¤ ì œì–´ ì„¤ì •..."</span>

<span class="c"># 5.1 cron ì ‘ê·¼ ì œí•œ</span>
<span class="nb">echo</span> <span class="s2">"root"</span> <span class="o">&gt;</span> /etc/cron.allow
<span class="nb">chmod </span>600 /etc/cron.allow
<span class="nb">rm</span> <span class="nt">-f</span> /etc/cron.deny

<span class="c"># 5.2 SSH ë³´ì•ˆ ê°•í™” (ì´ë¯¸ ì•ì—ì„œ ë‹¤ë£¸)</span>
<span class="c"># 5.3 PAM ì„¤ì • ê°•í™” (ì´ë¯¸ ì•ì—ì„œ ë‹¤ë£¸)</span>

<span class="c"># 6. ì‹œìŠ¤í…œ ìœ ì§€ë³´ìˆ˜</span>
<span class="nb">echo</span> <span class="s2">"6. ì‹œìŠ¤í…œ ìœ ì§€ë³´ìˆ˜ ì„¤ì •..."</span>

<span class="c"># 6.1 íŒŒì¼ ê¶Œí•œ ì ê²€</span>
find /etc <span class="nt">-type</span> f <span class="nt">-perm</span> /g+w,o+w <span class="nt">-exec</span> <span class="nb">chmod </span>go-w <span class="o">{}</span> <span class="se">\;</span>

<span class="c"># 6.2 SUID/SGID ì ê²€ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /usr/local/bin/check-suid-sgid.sh <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
#!/bin/bash
find / </span><span class="se">\(</span><span class="sh"> -perm -4000 -o -perm -2000 </span><span class="se">\)</span><span class="sh"> -type f -exec ls -ld {} </span><span class="se">\;</span><span class="sh"> 2&gt;/dev/null | </span><span class="se">\</span><span class="sh">
while read line; do
    echo "</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="sh">: </span><span class="nv">$line</span><span class="sh">" &gt;&gt; /var/log/suid-sgid.log
done
</span><span class="no">EOF

</span><span class="nb">chmod</span> +x /usr/local/bin/check-suid-sgid.sh

<span class="c"># 6.3 ì •ê¸° ë³´ì•ˆ ì ê²€ cron ì„¤ì •</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/cron.daily/security-check <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
#!/bin/bash
/usr/local/bin/check-suid-sgid.sh
/usr/bin/aide --check 2&gt;&amp;1 | logger -t aide
</span><span class="no">EOF

</span><span class="nb">chmod</span> +x /etc/cron.daily/security-check

<span class="nb">echo</span> <span class="s2">"CIS Benchmark ì ìš© ì™„ë£Œ!"</span>
<span class="nb">echo</span> <span class="s2">"ì‹œìŠ¤í…œì„ ì¬ë¶€íŒ…í•˜ì—¬ ëª¨ë“  ì„¤ì •ì„ ì ìš©í•˜ì„¸ìš”."</span>
</code></pre></div></div>

<h3 id="-ë³´ì•ˆ-ëª¨ë‹ˆí„°ë§-ëŒ€ì‹œë³´ë“œ">ğŸ“Š ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</h3>

<h4 id="prometheus--grafana-ë³´ì•ˆ-ë©”íŠ¸ë¦­">Prometheus + Grafana ë³´ì•ˆ ë©”íŠ¸ë¦­</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># prometheus-rules.yml</span>
<span class="na">groups</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">security_rules</span>
  <span class="na">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">alert</span><span class="pi">:</span> <span class="s">HighFailedLoginRate</span>
    <span class="na">expr</span><span class="pi">:</span> <span class="s">rate(node_auth_failed_total[5m]) &gt; </span><span class="m">0.1</span>
    <span class="na">for</span><span class="pi">:</span> <span class="s">2m</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">severity</span><span class="pi">:</span> <span class="s">warning</span>
    <span class="na">annotations</span><span class="pi">:</span>
      <span class="na">summary</span><span class="pi">:</span> <span class="s2">"</span><span class="s">High</span><span class="nv"> </span><span class="s">failed</span><span class="nv"> </span><span class="s">login</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">detected"</span>
      <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.instance</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">has</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">high</span><span class="nv"> </span><span class="s">failed</span><span class="nv"> </span><span class="s">login</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">per</span><span class="nv"> </span><span class="s">second"</span>

  <span class="pi">-</span> <span class="na">alert</span><span class="pi">:</span> <span class="s">RootLoginDetected</span>
    <span class="na">expr</span><span class="pi">:</span> <span class="s">increase(node_auth_success_total{user="root"}[1m]) &gt; </span><span class="m">0</span>
    <span class="na">for</span><span class="pi">:</span> <span class="s">0m</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">severity</span><span class="pi">:</span> <span class="s">critical</span>
    <span class="na">annotations</span><span class="pi">:</span>
      <span class="na">summary</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Root</span><span class="nv"> </span><span class="s">login</span><span class="nv"> </span><span class="s">detected"</span>
      <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Root</span><span class="nv"> </span><span class="s">user</span><span class="nv"> </span><span class="s">login</span><span class="nv"> </span><span class="s">detected</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.instance</span><span class="nv"> </span><span class="s">}}"</span>

  <span class="pi">-</span> <span class="na">alert</span><span class="pi">:</span> <span class="s">SudoCommandExecuted</span>
    <span class="na">expr</span><span class="pi">:</span> <span class="s">increase(node_sudo_commands_total[1m]) &gt; </span><span class="m">0</span>
    <span class="na">for</span><span class="pi">:</span> <span class="s">0m</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">severity</span><span class="pi">:</span> <span class="s">info</span>
    <span class="na">annotations</span><span class="pi">:</span>
      <span class="na">summary</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Sudo</span><span class="nv"> </span><span class="s">command</span><span class="nv"> </span><span class="s">executed"</span>
      <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Sudo</span><span class="nv"> </span><span class="s">command</span><span class="nv"> </span><span class="s">executed</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.instance</span><span class="nv"> </span><span class="s">}}"</span>

  <span class="pi">-</span> <span class="na">alert</span><span class="pi">:</span> <span class="s">FileSystemModification</span>
    <span class="na">expr</span><span class="pi">:</span> <span class="s">rate(node_filesystem_files_free[5m]) &lt; -0.1</span>
    <span class="na">for</span><span class="pi">:</span> <span class="s">5m</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">severity</span><span class="pi">:</span> <span class="s">warning</span>
    <span class="na">annotations</span><span class="pi">:</span>
      <span class="na">summary</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Rapid</span><span class="nv"> </span><span class="s">file</span><span class="nv"> </span><span class="s">system</span><span class="nv"> </span><span class="s">changes</span><span class="nv"> </span><span class="s">detected"</span>
      <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Rapid</span><span class="nv"> </span><span class="s">file</span><span class="nv"> </span><span class="s">system</span><span class="nv"> </span><span class="s">changes</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.instance</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.mountpoint</span><span class="nv"> </span><span class="s">}}"</span>
</code></pre></div></div>

<h4 id="ë³´ì•ˆ-ë¡œê·¸-ë¶„ì„-ìŠ¤í¬ë¦½íŠ¸">ë³´ì•ˆ ë¡œê·¸ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="n">re</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="n">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="n">argparse</span>

<span class="k">class</span> <span class="nc">SecurityLogAnalyzer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">failed_logins</span> <span class="o">=</span> <span class="nf">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">successful_logins</span> <span class="o">=</span> <span class="nf">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sudo_commands</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">self</span><span class="p">.</span><span class="n">suspicious_activities</span> <span class="o">=</span> <span class="p">[]</span>
        
    <span class="k">def</span> <span class="nf">parse_auth_log</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">log_file</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì¸ì¦ ë¡œê·¸ íŒŒì‹±</span><span class="sh">"""</span>
        <span class="n">patterns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">failed_login</span><span class="sh">'</span><span class="p">:</span> <span class="sa">r</span><span class="sh">'</span><span class="s">(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*Failed password for (\w+) from (\d+\.\d+\.\d+\.\d+)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">successful_login</span><span class="sh">'</span><span class="p">:</span> <span class="sa">r</span><span class="sh">'</span><span class="s">(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*Accepted password for (\w+) from (\d+\.\d+\.\d+\.\d+)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">sudo_command</span><span class="sh">'</span><span class="p">:</span> <span class="sa">r</span><span class="sh">'</span><span class="s">(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*sudo.*USER=(\w+).*COMMAND=(.*)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">invalid_user</span><span class="sh">'</span><span class="p">:</span> <span class="sa">r</span><span class="sh">'</span><span class="s">(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*Invalid user (\w+) from (\d+\.\d+\.\d+\.\d+)</span><span class="sh">'</span>
        <span class="p">}</span>
        
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="c1"># ì‹¤íŒ¨í•œ ë¡œê·¸ì¸ ì‹œë„
</span>                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">patterns</span><span class="p">[</span><span class="sh">'</span><span class="s">failed_login</span><span class="sh">'</span><span class="p">],</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">timestamp</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">ip</span> <span class="o">=</span> <span class="k">match</span><span class="p">.</span><span class="nf">groups</span><span class="p">()</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">failed_logins</span><span class="p">[</span><span class="n">ip</span><span class="p">].</span><span class="nf">append</span><span class="p">({</span>
                        <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">ip</span><span class="sh">'</span><span class="p">:</span> <span class="n">ip</span>
                    <span class="p">})</span>
                
                <span class="c1"># ì„±ê³µí•œ ë¡œê·¸ì¸
</span>                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">patterns</span><span class="p">[</span><span class="sh">'</span><span class="s">successful_login</span><span class="sh">'</span><span class="p">],</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">timestamp</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">ip</span> <span class="o">=</span> <span class="k">match</span><span class="p">.</span><span class="nf">groups</span><span class="p">()</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">successful_logins</span><span class="p">[</span><span class="n">ip</span><span class="p">].</span><span class="nf">append</span><span class="p">({</span>
                        <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">ip</span><span class="sh">'</span><span class="p">:</span> <span class="n">ip</span>
                    <span class="p">})</span>
                
                <span class="c1"># sudo ëª…ë ¹
</span>                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">patterns</span><span class="p">[</span><span class="sh">'</span><span class="s">sudo_command</span><span class="sh">'</span><span class="p">],</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">timestamp</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="k">match</span><span class="p">.</span><span class="nf">groups</span><span class="p">()</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">sudo_commands</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                        <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">command</span><span class="sh">'</span><span class="p">:</span> <span class="n">command</span>
                    <span class="p">})</span>
                
                <span class="c1"># ì˜ëª»ëœ ì‚¬ìš©ì
</span>                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">patterns</span><span class="p">[</span><span class="sh">'</span><span class="s">invalid_user</span><span class="sh">'</span><span class="p">],</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">timestamp</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">ip</span> <span class="o">=</span> <span class="k">match</span><span class="p">.</span><span class="nf">groups</span><span class="p">()</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">suspicious_activities</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                        <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">invalid_user</span><span class="sh">'</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">ip</span><span class="sh">'</span><span class="p">:</span> <span class="n">ip</span>
                    <span class="p">})</span>
    
    <span class="k">def</span> <span class="nf">detect_brute_force</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¸Œë£¨íŠ¸í¬ìŠ¤ ê³µê²© íƒì§€</span><span class="sh">"""</span>
        <span class="n">brute_force_ips</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">attempts</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">failed_logins</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">attempts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="n">brute_force_ips</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">'</span><span class="s">ip</span><span class="sh">'</span><span class="p">:</span> <span class="n">ip</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">attempts</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">attempts</span><span class="p">),</span>
                    <span class="sh">'</span><span class="s">users_targeted</span><span class="sh">'</span><span class="p">:</span> <span class="nf">list</span><span class="p">(</span><span class="nf">set</span><span class="p">([</span><span class="n">attempt</span><span class="p">[</span><span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">]</span> <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="n">attempts</span><span class="p">])),</span>
                    <span class="sh">'</span><span class="s">first_attempt</span><span class="sh">'</span><span class="p">:</span> <span class="n">attempts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">],</span>
                    <span class="sh">'</span><span class="s">last_attempt</span><span class="sh">'</span><span class="p">:</span> <span class="n">attempts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">]</span>
                <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">brute_force_ips</span>
    
    <span class="k">def</span> <span class="nf">detect_privilege_escalation</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ê¶Œí•œ ìƒìŠ¹ íƒì§€</span><span class="sh">"""</span>
        <span class="n">privilege_escalations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">dangerous_commands</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sh">'</span><span class="s">passwd</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">useradd</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">usermod</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">userdel</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">chmod 777</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">chmod 4755</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">chown root</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">systemctl</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">service</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">crontab -e</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">/bin/bash</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">/bin/sh</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">su -</span><span class="sh">'</span>
        <span class="p">]</span>
        
        <span class="k">for</span> <span class="n">sudo_cmd</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">sudo_commands</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dangerous_cmd</span> <span class="ow">in</span> <span class="n">dangerous_commands</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dangerous_cmd</span> <span class="ow">in</span> <span class="n">sudo_cmd</span><span class="p">[</span><span class="sh">'</span><span class="s">command</span><span class="sh">'</span><span class="p">]:</span>
                    <span class="n">privilege_escalations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                        <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">sudo_cmd</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">],</span>
                        <span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">:</span> <span class="n">sudo_cmd</span><span class="p">[</span><span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">],</span>
                        <span class="sh">'</span><span class="s">command</span><span class="sh">'</span><span class="p">:</span> <span class="n">sudo_cmd</span><span class="p">[</span><span class="sh">'</span><span class="s">command</span><span class="sh">'</span><span class="p">],</span>
                        <span class="sh">'</span><span class="s">risk_level</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span> <span class="k">if</span> <span class="n">dangerous_cmd</span> <span class="ow">in</span> <span class="p">[</span><span class="sh">'</span><span class="s">passwd</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">useradd</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">/bin/bash</span><span class="sh">'</span><span class="p">]</span> <span class="k">else</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span>
                    <span class="p">})</span>
                    <span class="k">break</span>
        
        <span class="k">return</span> <span class="n">privilege_escalations</span>
    
    <span class="k">def</span> <span class="nf">analyze_login_patterns</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¡œê·¸ì¸ íŒ¨í„´ ë¶„ì„</span><span class="sh">"""</span>
        <span class="n">patterns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">geographic_anomalies</span><span class="sh">'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="sh">'</span><span class="s">time_anomalies</span><span class="sh">'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="sh">'</span><span class="s">user_anomalies</span><span class="sh">'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        
        <span class="c1"># ì‚¬ìš©ìë³„ ë¡œê·¸ì¸ ë¹ˆë„ ë¶„ì„
</span>        <span class="n">user_login_count</span> <span class="o">=</span> <span class="nc">Counter</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ip</span><span class="p">,</span> <span class="n">logins</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">successful_logins</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">login</span> <span class="ow">in</span> <span class="n">logins</span><span class="p">:</span>
                <span class="n">user_login_count</span><span class="p">[</span><span class="n">login</span><span class="p">[</span><span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># ë¹„ì •ìƒì ìœ¼ë¡œ ë§ì€ ë¡œê·¸ì¸
</span>        <span class="n">avg_logins</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">user_login_count</span><span class="p">.</span><span class="nf">values</span><span class="p">())</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">user_login_count</span><span class="p">)</span> <span class="k">if</span> <span class="n">user_login_count</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">user</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">user_login_count</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">avg_logins</span> <span class="o">*</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># í‰ê· ì˜ 3ë°° ì´ìƒ
</span>                <span class="n">patterns</span><span class="p">[</span><span class="sh">'</span><span class="s">user_anomalies</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">login_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">anomaly_type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">excessive_logins</span><span class="sh">'</span>
                <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">patterns</span>
    
    <span class="k">def</span> <span class="nf">generate_report</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë³´ì•ˆ ë¶„ì„ ë¦¬í¬íŠ¸ ìƒì„±</span><span class="sh">"""</span>
        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">analysis_date</span><span class="sh">'</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">isoformat</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">total_failed_logins</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">attempts</span><span class="p">)</span> <span class="k">for</span> <span class="n">attempts</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">failed_logins</span><span class="p">.</span><span class="nf">values</span><span class="p">()),</span>
                <span class="sh">'</span><span class="s">total_successful_logins</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">logins</span><span class="p">)</span> <span class="k">for</span> <span class="n">logins</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">successful_logins</span><span class="p">.</span><span class="nf">values</span><span class="p">()),</span>
                <span class="sh">'</span><span class="s">total_sudo_commands</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">sudo_commands</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">suspicious_activities</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">suspicious_activities</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="sh">'</span><span class="s">brute_force_attacks</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">detect_brute_force</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">privilege_escalations</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">detect_privilege_escalation</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">login_patterns</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">analyze_login_patterns</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">suspicious_activities</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">suspicious_activities</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        
        <span class="c1"># ì¶”ì²œì‚¬í•­ ìƒì„±
</span>        <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="sh">'</span><span class="s">brute_force_attacks</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">report</span><span class="p">[</span><span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span>
                <span class="sh">"</span><span class="s">ë¸Œë£¨íŠ¸í¬ìŠ¤ ê³µê²©ì´ íƒì§€ë˜ì—ˆìŠµë‹ˆë‹¤. fail2ban ì„¤ì •ì„ ê²€í† í•˜ê³  IP ì°¨ë‹¨ì„ ê³ ë ¤í•˜ì„¸ìš”.</span><span class="sh">"</span>
            <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="sh">'</span><span class="s">privilege_escalations</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">report</span><span class="p">[</span><span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span>
                <span class="sh">"</span><span class="s">ê¶Œí•œ ìƒìŠ¹ í™œë™ì´ íƒì§€ë˜ì—ˆìŠµë‹ˆë‹¤. sudo ì‚¬ìš©ì„ ê²€í† í•˜ê³  í•„ìš”ì‹œ ê¶Œí•œì„ ì œí•œí•˜ì„¸ìš”.</span><span class="sh">"</span>
            <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">total_failed_logins</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">report</span><span class="p">[</span><span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span>
                <span class="sh">"</span><span class="s">ê³¼ë„í•œ ì‹¤íŒ¨ ë¡œê·¸ì¸ ì‹œë„ê°€ ìˆìŠµë‹ˆë‹¤. íŒ¨ìŠ¤ì›Œë“œ ì •ì±…ì„ ê°•í™”í•˜ì„¸ìš”.</span><span class="sh">"</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">report</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="nc">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sh">'</span><span class="s">Security Log Analyzer</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">--log-file</span><span class="sh">'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="sh">'</span><span class="s">/var/log/auth.log</span><span class="sh">'</span><span class="p">,</span> 
                       <span class="nb">help</span><span class="o">=</span><span class="sh">'</span><span class="s">Path to authentication log file</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">--output</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">-o</span><span class="sh">'</span><span class="p">,</span> <span class="nb">help</span><span class="o">=</span><span class="sh">'</span><span class="s">Output file for JSON report</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">--threshold</span><span class="sh">'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                       <span class="nb">help</span><span class="o">=</span><span class="sh">'</span><span class="s">Brute force detection threshold</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="nf">parse_args</span><span class="p">()</span>
    
    <span class="n">analyzer</span> <span class="o">=</span> <span class="nc">SecurityLogAnalyzer</span><span class="p">()</span>
    <span class="n">analyzer</span><span class="p">.</span><span class="nf">parse_auth_log</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">log_file</span><span class="p">)</span>
    
    <span class="n">report</span> <span class="o">=</span> <span class="n">analyzer</span><span class="p">.</span><span class="nf">generate_report</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">output</span><span class="p">:</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">output</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="ë§ˆë¬´ë¦¬ì™€-ë‹¤ìŒ-ë‹¨ê³„">ë§ˆë¬´ë¦¬ì™€ ë‹¤ìŒ ë‹¨ê³„</h2>

<p>ì´ ì¢…í•©ì ì¸ ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ê°€ì´ë“œë¥¼ í†µí•´ ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ ë‹¤ë¤˜ìŠµë‹ˆë‹¤:</p>

<h3 id="-ë‹¤ë£¬-ì£¼ìš”-ë‚´ìš©">âœ… ë‹¤ë£¬ ì£¼ìš” ë‚´ìš©</h3>
<ul>
  <li><strong>ê¸°ì´ˆ ë³´ì•ˆ</strong>: ì‚¬ìš©ì ê³„ì •, SSH, ë°©í™”ë²½ ì„¤ì •</li>
  <li><strong>ê³ ê¸‰ ë³´ì•ˆ</strong>: SELinux/AppArmor, ì‹œìŠ¤í…œ í•˜ë“œë‹</li>
  <li><strong>ì¹¨ì… íƒì§€</strong>: AIDE, Fail2Ban, Wazuh êµ¬ì¶•</li>
  <li><strong>ì»¨í…Œì´ë„ˆ ë³´ì•ˆ</strong>: Docker/Kubernetes ë³´ì•ˆ ì„¤ì •</li>
  <li><strong>ì»´í”Œë¼ì´ì–¸ìŠ¤</strong>: CIS Benchmark ì ìš©</li>
  <li><strong>ëª¨ë‹ˆí„°ë§</strong>: ë³´ì•ˆ ë¡œê·¸ ë¶„ì„ ë° ëŒ€ì‹œë³´ë“œ</li>
</ul>

<h3 id="-ë‹¤ìŒ-ë‹¨ê³„-ê¶Œì¥ì‚¬í•­">ğŸš€ ë‹¤ìŒ ë‹¨ê³„ ê¶Œì¥ì‚¬í•­</h3>

<ol>
  <li><strong>ì •ê¸°ì ì¸ ë³´ì•ˆ ì ê²€</strong> - ì›”ê°„ ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸ ìš´ì˜</li>
  <li><strong>ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸</strong> - ë¶„ê¸°ë³„ ëª¨ì˜ í•´í‚¹ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰</li>
  <li><strong>ë³´ì•ˆ êµìœ¡</strong> - íŒ€ì› ëŒ€ìƒ ë³´ì•ˆ ì¸ì‹ êµìœ¡</li>
  <li><strong>ì¸ì‹œë˜íŠ¸ ëŒ€ì‘</strong> - ë³´ì•ˆ ì‚¬ê³  ëŒ€ì‘ ì ˆì°¨ ìˆ˜ë¦½</li>
  <li><strong>ë°±ì—… ë° ë³µêµ¬</strong> - ì •ê¸°ì ì¸ ë°±ì—… ë° ë³µêµ¬ í…ŒìŠ¤íŠ¸</li>
</ol>

<h3 id="-ì¶”ê°€-í•™ìŠµ-ìë£Œ">ğŸ“š ì¶”ê°€ í•™ìŠµ ìë£Œ</h3>
<ul>
  <li><strong>ì¸ì¦</strong>: CompTIA Security+, CISSP, CEH</li>
  <li><strong>ë„êµ¬</strong>: Metasploit, Nessus, OpenVAS</li>
  <li><strong>í‘œì¤€</strong>: NIST Cybersecurity Framework, ISO 27001</li>
</ul>

<p>ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆì€ ì§€ì†ì ì¸ ê³¼ì •ì…ë‹ˆë‹¤. í•­ìƒ ìµœì‹  ìœ„í˜‘ ë™í–¥ì„ íŒŒì•…í•˜ê³  ë³´ì•ˆ ì„¤ì •ì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”! ğŸ”’ğŸ›¡ï¸</p>]]></content><author><name>DevOps Engineer</name></author><category term="Security" /><category term="Linux" /><category term="linux-security" /><category term="firewall" /><category term="selinux" /><category term="hardening" /><category term="intrusion-detection" /><category term="container-security" /><category term="compliance" /><summary type="html"><![CDATA[ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œì˜ ë³´ì•ˆì„ ì²´ê³„ì ìœ¼ë¡œ êµ¬ì¶•í•˜ê³  ê´€ë¦¬í•˜ëŠ” ì™„ì „í•œ ê°€ì´ë“œì…ë‹ˆë‹¤. ê¸°ì´ˆë¶€í„° ê³ ê¸‰ ë³´ì•ˆ ê¸°ë²•ê¹Œì§€ ì‹¤ë¬´ì— ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ë‚´ìš©ìœ¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤. ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ê¸°ì´ˆ | Linux Security Fundamentals ğŸ” ì‚¬ìš©ì ê³„ì • ë³´ì•ˆ íŒ¨ìŠ¤ì›Œë“œ ì •ì±… ê°•í™” # íŒ¨ìŠ¤ì›Œë“œ ë³µì¡ì„± ì •ì±… ì„¤ì • # /etc/pam.d/common-password (Ubuntu/Debian) password requisite pam_pwquality.so retry=3 minlen=12 minclass=3 maxrepeat=2 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1 # /etc/security/pwquality.conf minlen = 12 minclass = 3 maxrepeat = 2 maxclasssrepeat = 4 ucredit = -1 # ìµœì†Œ ëŒ€ë¬¸ì 1ê°œ lcredit = -1 # ìµœì†Œ ì†Œë¬¸ì 1ê°œ dcredit = -1 # ìµœì†Œ ìˆ«ì 1ê°œ ocredit = -1 # ìµœì†Œ íŠ¹ìˆ˜ë¬¸ì 1ê°œ difok = 3 # ì´ì „ íŒ¨ìŠ¤ì›Œë“œì™€ 3ê¸€ì ì´ìƒ ë‹¬ë¼ì•¼ í•¨ # íŒ¨ìŠ¤ì›Œë“œ ì—ì´ì§• ì •ì±… # /etc/login.defs PASS_MAX_DAYS 90 # ìµœëŒ€ ìœ íš¨ê¸°ê°„ PASS_MIN_DAYS 1 # ìµœì†Œ ë³€ê²½ ì£¼ê¸° PASS_MIN_LEN 12 # ìµœì†Œ ê¸¸ì´ PASS_WARN_AGE 7 # ë§Œë£Œ ê²½ê³  ê¸°ê°„ # ê¸°ì¡´ ì‚¬ìš©ìì—ê²Œ ì •ì±… ì ìš© chage -M 90 -m 1 -W 7 username # ê³„ì • ì ê¸ˆ ì •ì±… (ì‹¤íŒ¨ ì‹œë„ ì œí•œ) # /etc/pam.d/common-auth auth required pam_tally2.so deny=5 unlock_time=1800 onerr=fail # ì ê¸´ ê³„ì • í™•ì¸ ë° í•´ì œ pam_tally2 --user username pam_tally2 --user username --reset ë£¨íŠ¸ ê³„ì • ë³´ì•ˆ # ë£¨íŠ¸ ì§ì ‘ ë¡œê·¸ì¸ ì°¨ë‹¨ # /etc/ssh/sshd_config PermitRootLogin no PasswordAuthentication no PubkeyAuthentication yes # ì½˜ì†” ë£¨íŠ¸ ë¡œê·¸ì¸ ì œí•œ # /etc/securetty (í—ˆìš©í•  í„°ë¯¸ë„ë§Œ ë‚¨ê¸°ê¸°) console tty1 # sudo ê¶Œí•œ ì„¸ë°€í•˜ê²Œ ì œì–´ # /etc/sudoers # íŠ¹ì • ëª…ë ¹ë§Œ í—ˆìš© webadmin ALL=(ALL) /usr/sbin/service apache2 *, /usr/sbin/service nginx * # íŒ¨ìŠ¤ì›Œë“œ ì—†ì´ íŠ¹ì • ëª…ë ¹ ì‹¤í–‰ backup ALL=(ALL) NOPASSWD: /usr/bin/rsync, /bin/tar # sudo ì‚¬ìš© ë¡œê·¸ ê°•í™” # /etc/rsyslog.conf ë˜ëŠ” /etc/rsyslog.d/50-default.conf local2.* /var/log/sudo.log # /etc/sudoersì— ì¶”ê°€ Defaults logfile="/var/log/sudo.log" Defaults log_input, log_output Defaults iolog_dir="/var/log/sudo-io" ğŸ”’ SSH ë³´ì•ˆ ê°•í™” SSH ì„œë²„ ë³´ì•ˆ ì„¤ì • # /etc/ssh/sshd_config ë³´ì•ˆ ì„¤ì • Protocol 2 Port 2222 # ê¸°ë³¸ í¬íŠ¸ ë³€ê²½ PermitRootLogin no PasswordAuthentication no PubkeyAuthentication yes AuthorizedKeysFile .ssh/authorized_keys MaxAuthTries 3 MaxSessions 3 MaxStartups 3 LoginGraceTime 60 ClientAliveInterval 300 ClientAliveCountMax 2 UsePAM yes X11Forwarding no AllowTcpForwarding no GatewayPorts no PermitTunnel no # íŠ¹ì • ì‚¬ìš©ì/ê·¸ë£¹ë§Œ SSH ì ‘ê·¼ í—ˆìš© AllowUsers admin developer AllowGroups sshusers DenyUsers guest anonymous DenyGroups wheel # íŠ¹ì • IPì—ì„œë§Œ ì ‘ê·¼ í—ˆìš© Match Address 192.168.1.0/24,10.0.0.0/8 PasswordAuthentication yes Match Address *,!192.168.1.0/24,!10.0.0.0/8 DenyUsers * # ì„œë¹„ìŠ¤ ì¬ì‹œì‘ systemctl restart sshd SSH í‚¤ ê¸°ë°˜ ì¸ì¦ êµ¬ì¶• # í´ë¼ì´ì–¸íŠ¸ì—ì„œ í‚¤ ìƒì„± (ED25519 ê¶Œì¥) ssh-keygen -t ed25519 -b 4096 -C "your-email@domain.com" # ë˜ëŠ” RSA í‚¤ (ìµœì†Œ 4096ë¹„íŠ¸) ssh-keygen -t rsa -b 4096 -C "your-email@domain.com" # ê³µê°œí‚¤ ì„œë²„ì— ë³µì‚¬ ssh-copy-id -i ~/.ssh/id_ed25519.pub username@server-ip # ìˆ˜ë™ìœ¼ë¡œ ê³µê°œí‚¤ ì„¤ì • mkdir -p ~/.ssh chmod 700 ~/.ssh cat &gt;&gt; ~/.ssh/authorized_keys &lt;&lt; 'EOF' ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIG... your-email@domain.com EOF chmod 600 ~/.ssh/authorized_keys chown username:username ~/.ssh -R # SSH í‚¤ ê´€ë¦¬ - í‚¤ë³„ ì œí•œ ì„¤ì • # ~/.ssh/authorized_keys command="/usr/local/bin/backup-script",no-port-forwarding,no-X11-forwarding,no-agent-forwarding ssh-rsa AAAAB3... backup@server from="192.168.1.100",no-port-forwarding ssh-rsa AAAAB3... admin@workstation # SSH Certificate Authority êµ¬ì¶• # CA í‚¤ ìƒì„± ssh-keygen -t rsa -b 4096 -f /etc/ssh/ca_key # ì‚¬ìš©ì ì¸ì¦ì„œ ë°œê¸‰ ssh-keygen -s /etc/ssh/ca_key -I "user-certificate" -n username -V +1w ~/.ssh/id_rsa.pub # ì„œë²„ ì„¤ì •ì—ì„œ CA ì‹ ë¢° # /etc/ssh/sshd_config TrustedUserCAKeys /etc/ssh/ca_key.pub ğŸ›¡ï¸ ë°©í™”ë²½ ì„¤ì • iptables ê¸°ë³¸ ë³´ì•ˆ ì„¤ì • #!/bin/bash # ê°•ë ¥í•œ iptables ë³´ì•ˆ ì„¤ì • # ëª¨ë“  ê¸°ì¡´ ê·œì¹™ ì´ˆê¸°í™” iptables -F iptables -X iptables -t nat -F iptables -t nat -X iptables -t mangle -F iptables -t mangle -X # ê¸°ë³¸ ì •ì±…: ëª¨ë“  íŠ¸ë˜í”½ ì°¨ë‹¨ iptables -P INPUT DROP iptables -P FORWARD DROP iptables -P OUTPUT DROP # Loopback í—ˆìš© iptables -A INPUT -i lo -j ACCEPT iptables -A OUTPUT -o lo -j ACCEPT # ê¸°ì¡´ ì—°ê²° ìœ ì§€ iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT iptables -A OUTPUT -m conntrack --ctstate ESTABLISHED -j ACCEPT # SSH ì ‘ê·¼ í—ˆìš© (ë¸Œë£¨íŠ¸í¬ìŠ¤ ë°©ì§€) iptables -A INPUT -p tcp --dport 2222 -m conntrack --ctstate NEW -m recent --set --name SSH iptables -A INPUT -p tcp --dport 2222 -m conntrack --ctstate NEW -m recent --update --seconds 60 --hitcount 4 --name SSH -j DROP iptables -A INPUT -p tcp --dport 2222 -j ACCEPT iptables -A OUTPUT -p tcp --sport 2222 -j ACCEPT # DNS í—ˆìš© (í•„ìˆ˜) iptables -A OUTPUT -p udp --dport 53 -j ACCEPT iptables -A OUTPUT -p tcp --dport 53 -j ACCEPT # NTP í—ˆìš© iptables -A OUTPUT -p udp --dport 123 -j ACCEPT # HTTP/HTTPS ì•„ì›ƒë°”ìš´ë“œ í—ˆìš© iptables -A OUTPUT -p tcp --dport 80 -j ACCEPT iptables -A OUTPUT -p tcp --dport 443 -j ACCEPT # ì›¹ ì„œë²„ê°€ ìˆë‹¤ë©´ ì¸ë°”ìš´ë“œë„ í—ˆìš© # iptables -A INPUT -p tcp --dport 80 -j ACCEPT # iptables -A INPUT -p tcp --dport 443 -j ACCEPT # ICMP ì œí•œì  í—ˆìš© (ping) iptables -A INPUT -p icmp --icmp-type echo-request -m limit --limit 1/second -j ACCEPT iptables -A OUTPUT -p icmp --icmp-type echo-reply -j ACCEPT iptables -A OUTPUT -p icmp --icmp-type echo-request -j ACCEPT # ë¡œê¹… ì„¤ì • (DDoS ë°©ì§€) iptables -A INPUT -m limit --limit 5/min -j LOG --log-prefix "iptables INPUT denied: " --log-level 7 # ì„¤ì • ì €ì¥ iptables-save &gt; /etc/iptables/rules.v4 # ë¶€íŒ… ì‹œ ìë™ ë¡œë“œ echo '#!/bin/bash' &gt; /etc/network/if-pre-up.d/iptables echo 'iptables-restore &lt; /etc/iptables/rules.v4' &gt;&gt; /etc/network/if-pre-up.d/iptables chmod +x /etc/network/if-pre-up.d/iptables UFW (Uncomplicated Firewall) í™œìš© # UFW ì´ˆê¸°í™” ë° ê¸°ë³¸ ì„¤ì • ufw --force reset ufw default deny incoming ufw default deny outgoing ufw default deny forward # í•„ìˆ˜ ì•„ì›ƒë°”ìš´ë“œ í—ˆìš© ufw allow out 53 # DNS ufw allow out 80 # HTTP ufw allow out 443 # HTTPS ufw allow out 123 # NTP # SSH ì ‘ê·¼ í—ˆìš© (í¬íŠ¸ ë³€ê²½í–ˆë‹¤ë©´) ufw allow from 192.168.1.0/24 to any port 2222 # ì• í”Œë¦¬ì¼€ì´ì…˜ë³„ í—ˆìš© ufw allow "Apache Full" ufw allow "Nginx Full" # ê³ ê¸‰ ê·œì¹™ ufw allow from 10.0.0.0/8 to any port 3306 # MySQL ufw deny from 192.168.1.100 # íŠ¹ì • IP ì°¨ë‹¨ # ë¡œê¹… í™œì„±í™” ufw logging on # ë°©í™”ë²½ í™œì„±í™” ufw enable # ìƒíƒœ í™•ì¸ ufw status verbose ufw status numbered SELinux/AppArmor ë³´ì•ˆ | Mandatory Access Control ğŸ” SELinux êµ¬ì„± ë° ê´€ë¦¬ SELinux ê¸°ë³¸ ì„¤ì • # SELinux ìƒíƒœ í™•ì¸ sestatus getenforce # SELinux ëª¨ë“œ ë³€ê²½ # /etc/selinux/config SELINUX=enforcing # enforcing, permissive, disabled SELINUXTYPE=targeted # targeted, minimum, mls # ì„ì‹œ ëª¨ë“œ ë³€ê²½ setenforce 1 # enforcing setenforce 0 # permissive # ì»¨í…ìŠ¤íŠ¸ í™•ì¸ ls -lZ /var/www/html/ ps auxZ | grep httpd id -Z # íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ ë³µì› restorecon -Rv /var/www/html/ restorecon -Rv /home/username/ # ì»¨í…ìŠ¤íŠ¸ ìˆ˜ë™ ì„¤ì • chcon -t httpd_exec_t /usr/local/apache2/bin/httpd semanage fcontext -a -t httpd_exec_t "/usr/local/apache2/bin/httpd" SELinux ì •ì±… ê´€ë¦¬ # ë¶ˆë¦° ê°’ í™•ì¸ ë° ì„¤ì • getsebool -a | grep httpd setsebool -P httpd_can_network_connect on setsebool -P httpd_can_sendmail on # í¬íŠ¸ ë¼ë²¨ ê´€ë¦¬ semanage port -l | grep http semanage port -a -t http_port_t -p tcp 8080 # ì‚¬ìš©ì ë§¤í•‘ semanage login -l semanage user -l semanage login -a -s user_u regularuser # ì»¤ìŠ¤í…€ ì •ì±… ëª¨ë“ˆ ìƒì„± # audit.logì—ì„œ ì •ì±… ìƒì„± grep httpd /var/log/audit/audit.log | audit2allow -m myhttpd grep httpd /var/log/audit/audit.log | audit2allow -M myhttpd semodule -i myhttpd.pp # ì •ì±… ëª¨ë“ˆ ê´€ë¦¬ semodule -l | grep my semodule -r myhttpd ğŸ›¡ï¸ AppArmor í”„ë¡œíŒŒì¼ ì‘ì„± AppArmor ê¸°ë³¸ ê´€ë¦¬ # AppArmor ìƒíƒœ í™•ì¸ aa-status aa-enabled # í”„ë¡œíŒŒì¼ ëª¨ë“œ í™•ì¸ aa-status | grep profiles # í”„ë¡œíŒŒì¼ ëª¨ë“œ ë³€ê²½ aa-enforce /etc/apparmor.d/usr.bin.firefox aa-complain /etc/apparmor.d/usr.bin.firefox aa-disable /etc/apparmor.d/usr.bin.firefox # í”„ë¡œíŒŒì¼ ì¬ë¡œë“œ apparmor_parser -r /etc/apparmor.d/usr.bin.firefox ì»¤ìŠ¤í…€ AppArmor í”„ë¡œíŒŒì¼ ì‘ì„± # ìƒˆë¡œìš´ ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œíŒŒì¼ ìƒì„± # /etc/apparmor.d/usr.local.bin.myapp #include &lt;tunables/global&gt; /usr/local/bin/myapp { #include &lt;abstractions/base&gt; #include &lt;abstractions/nameservice&gt; # ì‹¤í–‰ íŒŒì¼ /usr/local/bin/myapp mr, # ë¼ì´ë¸ŒëŸ¬ë¦¬ /lib{,32,64}/** mr, /usr/lib{,32,64}/** mr, # ì„¤ì • íŒŒì¼ (ì½ê¸° ì „ìš©) /etc/myapp/** r, owner /home/*/.myapp/** rw, # ë°ì´í„° ë””ë ‰í† ë¦¬ /var/lib/myapp/** rw, /var/log/myapp/** w, # ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ network inet stream, network inet6 stream, # í”„ë¡œì„¸ìŠ¤ ì œì–´ capability setuid, capability setgid, # ì„ì‹œ íŒŒì¼ /tmp/myapp.** rw, owner /tmp/myapp-** rw, # ê±°ë¶€í•  ì ‘ê·¼ deny /etc/passwd r, deny /etc/shadow r, deny owner /home/*/.ssh/** rw, # í•˜ìœ„ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ /bin/dash ix, /usr/bin/python3 ix, } # í”„ë¡œíŒŒì¼ ë¡œë“œ ë° í™œì„±í™” apparmor_parser -r /etc/apparmor.d/usr.local.bin.myapp aa-enforce /etc/apparmor.d/usr.local.bin.myapp # í”„ë¡œíŒŒì¼ ê°œë°œ ëª¨ë“œ (í•™ìŠµ) aa-genprof /usr/local/bin/myapp # ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰í•˜ë©° ë™ì‘ í™•ì¸ aa-logprof ì‹œìŠ¤í…œ í•˜ë“œë‹ | System Hardening ğŸ”§ ì»¤ë„ ë³´ì•ˆ ë§¤ê°œë³€ìˆ˜ ì¡°ì • sysctl ë³´ì•ˆ ì„¤ì • # /etc/sysctl.d/99-security.conf # ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ net.ipv4.ip_forward = 0 net.ipv4.conf.all.send_redirects = 0 net.ipv4.conf.default.send_redirects = 0 net.ipv4.conf.all.accept_redirects = 0 net.ipv4.conf.default.accept_redirects = 0 net.ipv4.conf.all.secure_redirects = 0 net.ipv4.conf.default.secure_redirects = 0 net.ipv6.conf.all.accept_redirects = 0 net.ipv6.conf.default.accept_redirects = 0 net.ipv4.conf.all.accept_source_route = 0 net.ipv4.conf.default.accept_source_route = 0 net.ipv6.conf.all.accept_source_route = 0 net.ipv6.conf.default.accept_source_route = 0 # SYN í”ŒëŸ¬ë“œ ë°©ì§€ net.ipv4.tcp_syncookies = 1 net.ipv4.tcp_max_syn_backlog = 2048 net.ipv4.tcp_synack_retries = 2 net.ipv4.tcp_syn_retries = 5 # ICMP ë³´ì•ˆ net.ipv4.icmp_echo_ignore_broadcasts = 1 net.ipv4.icmp_ignore_bogus_error_responses = 1 net.ipv4.icmp_echo_ignore_all = 0 # IP ìŠ¤í‘¸í•‘ ë°©ì§€ net.ipv4.conf.all.rp_filter = 1 net.ipv4.conf.default.rp_filter = 1 # IPv6 ë³´ì•ˆ net.ipv6.conf.all.disable_ipv6 = 1 net.ipv6.conf.default.disable_ipv6 = 1 # ë©”ëª¨ë¦¬ ë³´ì•ˆ kernel.randomize_va_space = 2 kernel.exec-shield = 1 kernel.dmesg_restrict = 1 kernel.kptr_restrict = 2 # í”„ë¡œì„¸ìŠ¤ ë³´ì•ˆ fs.suid_dumpable = 0 kernel.core_uses_pid = 1 kernel.ctrl-alt-del = 0 # ì„¤ì • ì ìš© sysctl -p /etc/sysctl.d/99-security.conf íŒŒì¼ ì‹œìŠ¤í…œ ë³´ì•ˆ # ì¤‘ìš” ë””ë ‰í† ë¦¬ ë§ˆìš´íŠ¸ ì˜µì…˜ ê°•í™” # /etc/fstab /tmp /tmp tmpfs defaults,nodev,nosuid,noexec 0 0 /var/tmp /var/tmp tmpfs defaults,nodev,nosuid,noexec 0 0 /dev/shm /dev/shm tmpfs defaults,nodev,nosuid,noexec 0 0 # íŒŒì¼ ê¶Œí•œ ê°•í™” chmod 700 /root chmod 600 /etc/ssh/sshd_config chmod 600 /etc/passwd- chmod 600 /etc/shadow chmod 600 /etc/gshadow chmod 644 /etc/group # ë¶ˆí•„ìš”í•œ SUID/SGID ì œê±° find / -type f \( -perm -4000 -o -perm -2000 \) -print &gt; /tmp/suid_sgid_files # ê²€í†  í›„ í•„ìš”ì—†ëŠ” ê²ƒë“¤ ì œê±° chmod u-s /usr/bin/unnecessary-suid-program # ìˆ¨ê²¨ì§„ íŒŒì¼ ë° ë””ë ‰í† ë¦¬ ê²€ì‚¬ find / -name ".*" -type f -exec ls -la {} \; 2&gt;/dev/null find / -name ".*" -type d -exec ls -lad {} \; 2&gt;/dev/null # ëŒ€ìš©ëŸ‰ íŒŒì¼ ê²€ì‚¬ (backdoor ê°€ëŠ¥ì„±) find / -size +10M -type f -exec ls -la {} \; 2&gt;/dev/null # ìµœê·¼ ìˆ˜ì •ëœ íŒŒì¼ ê²€ì‚¬ find / -mtime -7 -type f -exec ls -la {} \; 2&gt;/dev/null ğŸ” ì„œë¹„ìŠ¤ ë° ë°ëª¬ ë³´ì•ˆ ë¶ˆí•„ìš”í•œ ì„œë¹„ìŠ¤ ì œê±° # ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤ í™•ì¸ systemctl list-units --type=service --state=running netstat -tulpn ss -tulpn # ë¶ˆí•„ìš”í•œ ì„œë¹„ìŠ¤ ì¤‘ì§€ ë° ë¹„í™œì„±í™” systemctl stop cups systemctl disable cups systemctl mask cups # ìœ„í—˜í•œ ì„œë¹„ìŠ¤ë“¤ (ì¼ë°˜ì ìœ¼ë¡œ ë¹„í™œì„±í™”) services_to_disable=( "telnet" "rsh" "rlogin" "tftp" "xinetd" "sendmail" "postfix" "dovecot" "cups" "avahi-daemon" "bluetooth" ) for service in "${services_to_disable[@]}"; do if systemctl is-enabled "$service" &gt;/dev/null 2&gt;&amp;1; then echo "Disabling $service..." systemctl stop "$service" systemctl disable "$service" systemctl mask "$service" fi done # ë„¤íŠ¸ì›Œí¬ ì„œë¹„ìŠ¤ ì ê²€ lsof -i netstat -anp | grep LISTEN ì• í”Œë¦¬ì¼€ì´ì…˜ë³„ ë³´ì•ˆ ì„¤ì • # Apache ë³´ì•ˆ ì„¤ì • # /etc/apache2/conf-available/security.conf ServerTokens Prod ServerSignature Off TraceEnable Off Header always set X-Content-Type-Options nosniff Header always set X-Frame-Options DENY Header always set X-XSS-Protection "1; mode=block" Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" # Nginx ë³´ì•ˆ ì„¤ì • # /etc/nginx/nginx.conf server_tokens off; add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection "1; mode=block"; add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"; # MySQL/MariaDB ë³´ì•ˆ mysql_secure_installation # PostgreSQL ë³´ì•ˆ ì„¤ì • # /etc/postgresql/*/main/postgresql.conf ssl = on ssl_ciphers = 'HIGH:MEDIUM:+3DES:!aNULL' ssl_prefer_server_ciphers = on # /etc/postgresql/*/main/pg_hba.conf # TYPE DATABASE USER ADDRESS METHOD local all all md5 host all all 127.0.0.1/32 md5 host all all ::1/128 md5 ì¹¨ì… íƒì§€ ì‹œìŠ¤í…œ | Intrusion Detection Systems ğŸš¨ AIDE (Advanced Intrusion Detection Environment) AIDE ì„¤ì¹˜ ë° êµ¬ì„± # AIDE ì„¤ì¹˜ apt-get install aide aide-common # ì„¤ì • íŒŒì¼ ìˆ˜ì • # /etc/aide/aide.conf database=file:/var/lib/aide/aide.db database_out=file:/var/lib/aide/aide.db.new gzip_dbout=yes report_url=file:/var/log/aide/aide.log report_url=stdout # ê·œì¹™ ì •ì˜ /boot f+p+u+g+s+b+m+c+md5+sha1 /bin f+p+u+g+s+b+m+c+md5+sha1 /sbin f+p+u+g+s+b+m+c+md5+sha1 /lib f+p+u+g+s+b+m+c+md5+sha1 /opt f+p+u+g+s+b+m+c+md5+sha1 /usr f+p+u+g+s+b+m+c+md5+sha1 /root f+p+u+g+s+b+m+c+md5+sha1 /etc f+p+u+g+s+b+m+c+md5+sha1 # ì œì™¸í•  ë””ë ‰í† ë¦¬ !/var/log/.* !/var/spool/.* !/var/run/.* !/var/lock/.* !/proc/.* !/sys/.* !/dev/.* !/tmp/.* # ì´ˆê¸° ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± aideinit # ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ cp /var/lib/aide/aide.db.new /var/lib/aide/aide.db # ë¬´ê²°ì„± ê²€ì‚¬ ì‹¤í–‰ aide --check # ìë™í™” ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # /usr/local/bin/aide-check.sh AIDE_LOG="/var/log/aide/aide-$(date +%Y%m%d).log" aide --check &gt; "$AIDE_LOG" 2&gt;&amp;1 EXIT_CODE=$? if [ $EXIT_CODE -ne 0 ]; then echo "AIDE detected changes on $(hostname)" | \ mail -s "AIDE Alert - File Integrity Check Failed" admin@company.com \ -A "$AIDE_LOG" fi # cron ì„¤ì • # /etc/cron.d/aide 0 2 * * * root /usr/local/bin/aide-check.sh ğŸ” Fail2Ban ì„¤ì • Fail2Ban êµ¬ì„± ë° ì»¤ìŠ¤í„°ë§ˆì´ì§• # Fail2Ban ì„¤ì¹˜ apt-get install fail2ban # ê¸°ë³¸ ì„¤ì • íŒŒì¼ ë³µì‚¬ cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local # /etc/fail2ban/jail.local ì„¤ì • [DEFAULT] bantime = 3600 findtime = 600 maxretry = 3 backend = systemd banaction = iptables-multiport banaction_allports = iptables-allports ignoreip = 127.0.0.1/8 192.168.1.0/24 10.0.0.0/8 # SSH ë³´í˜¸ [sshd] enabled = true port = 2222 logpath = /var/log/auth.log maxretry = 3 bantime = 3600 # Apache ë³´í˜¸ [apache-auth] enabled = true port = http,https logpath = /var/log/apache2/error.log [apache-badbots] enabled = true port = http,https logpath = /var/log/apache2/access.log [apache-noscript] enabled = true port = http,https logpath = /var/log/apache2/access.log # ì»¤ìŠ¤í…€ í•„í„° ìƒì„± # /etc/fail2ban/filter.d/custom-app.conf [Definition] failregex = ^.*Failed login attempt from &lt;HOST&gt;.*$ ^.*Invalid user .* from &lt;HOST&gt;.*$ ^.*authentication failure.*rhost=&lt;HOST&gt;.*$ ignoreregex = # ì»¤ìŠ¤í…€ jail ì„¤ì • # /etc/fail2ban/jail.localì— ì¶”ê°€ [custom-app] enabled = true port = 8080 logpath = /var/log/custom-app.log filter = custom-app maxretry = 5 bantime = 7200 # Fail2Ban ê´€ë¦¬ ëª…ë ¹ fail2ban-client status fail2ban-client status sshd fail2ban-client unban 192.168.1.100 fail2ban-client reload ğŸ” OSSEC/Wazuh ì„¤ì¹˜ Wazuh Agent ì„¤ì¹˜ ë° êµ¬ì„± # Wazuh ì €ì¥ì†Œ ì¶”ê°€ curl -s https://packages.wazuh.com/key/GPG-KEY-WAZUH | apt-key add - echo "deb https://packages.wazuh.com/4.x/apt/ stable main" &gt; /etc/apt/sources.list.d/wazuh.list apt-get update # Wazuh Agent ì„¤ì¹˜ apt-get install wazuh-agent # ì—ì´ì „íŠ¸ ì„¤ì • # /var/ossec/etc/ossec.conf &lt;ossec_config&gt; &lt;client&gt; &lt;server&gt; &lt;address&gt;MANAGER_IP&lt;/address&gt; &lt;port&gt;1514&lt;/port&gt; &lt;protocol&gt;tcp&lt;/protocol&gt; &lt;/server&gt; &lt;config-profile&gt;linux, ubuntu, ubuntu20,&lt;/config-profile&gt; &lt;notify_time&gt;10&lt;/notify_time&gt; &lt;time-reconnect&gt;60&lt;/time-reconnect&gt; &lt;auto_restart&gt;yes&lt;/auto_restart&gt; &lt;crypto_method&gt;aes&lt;/crypto_method&gt; &lt;/client&gt; &lt;!-- ë¡œê·¸ ëª¨ë‹ˆí„°ë§ --&gt; &lt;localfile&gt; &lt;log_format&gt;syslog&lt;/log_format&gt; &lt;location&gt;/var/log/auth.log&lt;/location&gt; &lt;/localfile&gt; &lt;localfile&gt; &lt;log_format&gt;syslog&lt;/log_format&gt; &lt;location&gt;/var/log/syslog&lt;/location&gt; &lt;/localfile&gt; &lt;localfile&gt; &lt;log_format&gt;apache&lt;/log_format&gt; &lt;location&gt;/var/log/apache2/access.log&lt;/location&gt; &lt;/localfile&gt; &lt;!-- íŒŒì¼ ë¬´ê²°ì„± ëª¨ë‹ˆí„°ë§ --&gt; &lt;syscheck&gt; &lt;disabled&gt;no&lt;/disabled&gt; &lt;frequency&gt;43200&lt;/frequency&gt; &lt;scan_on_start&gt;yes&lt;/scan_on_start&gt; &lt;directories check_all="yes" realtime="yes"&gt;/etc&lt;/directories&gt; &lt;directories check_all="yes" realtime="yes"&gt;/usr/bin&lt;/directories&gt; &lt;directories check_all="yes" realtime="yes"&gt;/usr/sbin&lt;/directories&gt; &lt;directories check_all="yes" realtime="yes"&gt;/bin&lt;/directories&gt; &lt;directories check_all="yes" realtime="yes"&gt;/sbin&lt;/directories&gt; &lt;ignore&gt;/etc/mtab&lt;/ignore&gt; &lt;ignore&gt;/etc/hosts.deny&lt;/ignore&gt; &lt;ignore&gt;/etc/mail/statistics&lt;/ignore&gt; &lt;ignore&gt;/etc/random-seed&lt;/ignore&gt; &lt;ignore&gt;/etc/adjtime&lt;/ignore&gt; &lt;/syscheck&gt; &lt;!-- ë£¨íŠ¸í‚· íƒì§€ --&gt; &lt;rootcheck&gt; &lt;disabled&gt;no&lt;/disabled&gt; &lt;check_files&gt;yes&lt;/check_files&gt; &lt;check_trojans&gt;yes&lt;/check_trojans&gt; &lt;check_dev&gt;yes&lt;/check_dev&gt; &lt;check_sys&gt;yes&lt;/check_sys&gt; &lt;check_pids&gt;yes&lt;/check_pids&gt; &lt;check_ports&gt;yes&lt;/check_ports&gt; &lt;check_if&gt;yes&lt;/check_if&gt; &lt;/rootcheck&gt; &lt;!-- í™œì„± ì‘ë‹µ --&gt; &lt;active-response&gt; &lt;disabled&gt;no&lt;/disabled&gt; &lt;ca_store&gt;/var/ossec/etc/wpk_root.pem&lt;/ca_store&gt; &lt;ca_verification&gt;yes&lt;/ca_verification&gt; &lt;/active-response&gt; &lt;/ossec_config&gt; # ì„œë¹„ìŠ¤ ì‹œì‘ systemctl enable wazuh-agent systemctl start wazuh-agent # ìƒíƒœ í™•ì¸ systemctl status wazuh-agent /var/ossec/bin/ossec-control status ì»¨í…Œì´ë„ˆ ë³´ì•ˆ | Container Security ğŸ³ Docker ë³´ì•ˆ ì„¤ì • Docker ë°ëª¬ ë³´ì•ˆ ê°•í™” # Docker ë°ëª¬ ì„¤ì • # /etc/docker/daemon.json { "icc": false, "userns-remap": "default", "no-new-privileges": true, "seccomp-profile": "/etc/docker/seccomp.json", "selinux-enabled": true, "disable-legacy-registry": true, "live-restore": true, "userland-proxy": false, "experimental": false, "metrics-addr": "127.0.0.1:9323", "log-driver": "json-file", "log-opts": { "max-size": "10m", "max-file": "3" }, "storage-driver": "overlay2", "default-ulimits": { "nofile": { "name": "nofile", "hard": 64000, "soft": 64000 } } } # ì‹œìŠ¤í…œ ì¬ì‹œì‘ systemctl restart docker # ë³´ì•ˆ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì˜ˆì‹œ docker run -d \ --name secure-app \ --read-only \ --tmpfs /tmp \ --tmpfs /var/run \ --tmpfs /var/lock \ --user 1000:1000 \ --cap-drop ALL \ --cap-add NET_BIND_SERVICE \ --security-opt no-new-privileges:true \ --security-opt apparmor:docker-default \ --memory 512m \ --cpus="0.5" \ --pids-limit 100 \ --restart unless-stopped \ nginx:alpine Dockerfile ë³´ì•ˆ ëª¨ë²” ì‚¬ë¡€ # ë³´ì•ˆ ê°•í™” Dockerfile ì˜ˆì‹œ FROM alpine:3.18 # ë³´ì•ˆ ì—…ë°ì´íŠ¸ ì ìš© RUN apk update &amp;&amp; apk upgrade &amp;&amp; \ apk add --no-cache tini &amp;&amp; \ rm -rf /var/cache/apk/* # ë¹„íŠ¹ê¶Œ ì‚¬ìš©ì ìƒì„± RUN addgroup -g 1000 -S appgroup &amp;&amp; \ adduser -u 1000 -S appuser -G appgroup # ì• í”Œë¦¬ì¼€ì´ì…˜ ë””ë ‰í† ë¦¬ ìƒì„± ë° ê¶Œí•œ ì„¤ì • WORKDIR /app COPY --chown=appuser:appgroup . . # ì‹¤í–‰ íŒŒì¼ ê¶Œí•œë§Œ ë¶€ì—¬ RUN chmod 755 /app/entrypoint.sh &amp;&amp; \ chmod 644 /app/*.conf # ë¹„íŠ¹ê¶Œ ì‚¬ìš©ìë¡œ ì „í™˜ USER appuser:appgroup # ì‹œê·¸ë„ ì²˜ë¦¬ë¥¼ ìœ„í•œ tini ì‚¬ìš© ENTRYPOINT ["/sbin/tini", "--"] CMD ["./entrypoint.sh"] # ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ í¬íŠ¸ ë…¸ì¶œ ê¸ˆì§€ # EXPOSE 80 (í•„ìš”í•œ ê²½ìš°ë§Œ) # í—¬ìŠ¤ì²´í¬ ì¶”ê°€ HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \ CMD curl -f http://localhost:8080/health || exit 1 âš“ Kubernetes ë³´ì•ˆ Pod Security Standards ì ìš© # Pod Security Policy (deprecated, use Pod Security Standards) apiVersion: v1 kind: Namespace metadata: name: secure-namespace labels: pod-security.kubernetes.io/enforce: restricted pod-security.kubernetes.io/audit: restricted pod-security.kubernetes.io/warn: restricted --- # ë³´ì•ˆ ê°•í™” Pod ì˜ˆì‹œ apiVersion: v1 kind: Pod metadata: name: secure-pod namespace: secure-namespace spec: securityContext: runAsNonRoot: true runAsUser: 1000 runAsGroup: 1000 fsGroup: 1000 seccompProfile: type: RuntimeDefault containers: - name: app image: nginx:alpine securityContext: allowPrivilegeEscalation: false readOnlyRootFilesystem: true runAsNonRoot: true runAsUser: 1000 capabilities: drop: - ALL add: - NET_BIND_SERVICE resources: limits: memory: "256Mi" cpu: "200m" requests: memory: "128Mi" cpu: "100m" volumeMounts: - name: tmp-volume mountPath: /tmp - name: var-cache-nginx mountPath: /var/cache/nginx - name: var-run mountPath: /var/run volumes: - name: tmp-volume emptyDir: {} - name: var-cache-nginx emptyDir: {} - name: var-run emptyDir: {} --- # Network Policy apiVersion: networking.k8s.io/v1 kind: NetworkPolicy metadata: name: default-deny-all namespace: secure-namespace spec: podSelector: {} policyTypes: - Ingress - Egress --- apiVersion: networking.k8s.io/v1 kind: NetworkPolicy metadata: name: allow-web-traffic namespace: secure-namespace spec: podSelector: matchLabels: app: web policyTypes: - Ingress - Egress ingress: - from: - namespaceSelector: matchLabels: name: ingress-system ports: - protocol: TCP port: 80 egress: - to: - podSelector: matchLabels: app: database ports: - protocol: TCP port: 5432 - to: {} ports: - protocol: UDP port: 53 ì»´í”Œë¼ì´ì–¸ìŠ¤ì™€ ê°ì‚¬ | Compliance and Auditing ğŸ“‹ CIS Benchmark ì ìš© CIS Controls ìë™í™” ìŠ¤í¬ë¦½íŠ¸ #!/bin/bash # CIS Ubuntu 20.04 LTS Benchmark ìë™ ì ìš© ìŠ¤í¬ë¦½íŠ¸ echo "CIS Benchmark ìë™ ì ìš©ì„ ì‹œì‘í•©ë‹ˆë‹¤..." # 1. íŒŒì¼ ì‹œìŠ¤í…œ êµ¬ì„± echo "1. íŒŒì¼ ì‹œìŠ¤í…œ ë³´ì•ˆ ì„¤ì •..." # 1.1 ì„ì‹œ íŒŒì¼ ì‹œìŠ¤í…œ ë³´ì•ˆ if ! grep -q "/tmp.*nodev" /etc/fstab; then echo "/tmp /tmp tmpfs defaults,rw,nosuid,nodev,noexec,relatime 0 0" &gt;&gt; /etc/fstab fi # 1.2 ë¶ˆí•„ìš”í•œ íŒŒì¼ ì‹œìŠ¤í…œ ë¹„í™œì„±í™” cat &gt;&gt; /etc/modprobe.d/blacklist-rare-filesystems.conf &lt;&lt; 'EOF' install cramfs /bin/true install freevxfs /bin/true install jffs2 /bin/true install hfs /bin/true install hfsplus /bin/true install squashfs /bin/true install udf /bin/true install fat /bin/true install vfat /bin/true install usb-storage /bin/true EOF # 2. ì„œë¹„ìŠ¤ ì„¤ì • echo "2. ì„œë¹„ìŠ¤ ë³´ì•ˆ ì„¤ì •..." # 2.1 ì‹œê°„ ë™ê¸°í™” systemctl enable ntp systemctl start ntp # 2.2 ë¶ˆí•„ìš”í•œ ì„œë¹„ìŠ¤ ë¹„í™œì„±í™” services_to_disable=( "autofs" "avahi-daemon" "cups" "dhcpd" "slapd" "nfs" "rpcbind" "bind9" "vsftpd" "apache2" "dovecot" "smbd" "squid" "snmpd" "rsync" ) for service in "${services_to_disable[@]}"; do if systemctl is-enabled "$service" &gt;/dev/null 2&gt;&amp;1; then systemctl disable "$service" systemctl stop "$service" fi done # 3. ë„¤íŠ¸ì›Œí¬ ë§¤ê°œë³€ìˆ˜ ì„¤ì • echo "3. ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ ì„¤ì •..." cat &gt; /etc/sysctl.d/99-cis.conf &lt;&lt; 'EOF' net.ipv4.ip_forward = 0 net.ipv4.conf.all.send_redirects = 0 net.ipv4.conf.default.send_redirects = 0 net.ipv4.conf.all.accept_source_route = 0 net.ipv4.conf.default.accept_source_route = 0 net.ipv4.conf.all.accept_redirects = 0 net.ipv4.conf.default.accept_redirects = 0 net.ipv4.conf.all.secure_redirects = 0 net.ipv4.conf.default.secure_redirects = 0 net.ipv4.conf.all.log_martians = 1 net.ipv4.conf.default.log_martians = 1 net.ipv4.icmp_echo_ignore_broadcasts = 1 net.ipv4.icmp_ignore_bogus_error_responses = 1 net.ipv4.conf.all.rp_filter = 1 net.ipv4.conf.default.rp_filter = 1 net.ipv4.tcp_syncookies = 1 net.ipv6.conf.all.accept_ra = 0 net.ipv6.conf.default.accept_ra = 0 net.ipv6.conf.all.accept_redirects = 0 net.ipv6.conf.default.accept_redirects = 0 net.ipv6.conf.all.disable_ipv6 = 1 EOF sysctl -p /etc/sysctl.d/99-cis.conf # 4. ë¡œê¹… ë° ê°ì‚¬ ì„¤ì • echo "4. ë¡œê¹… ë° ê°ì‚¬ ì„¤ì •..." # 4.1 auditd ì„¤ì¹˜ ë° êµ¬ì„± apt-get install -y auditd audispd-plugins cat &gt; /etc/audit/rules.d/cis.rules &lt;&lt; 'EOF' # ì‹œê°„ ë³€ê²½ ê°ì‚¬ -a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time-change -a always,exit -F arch=b32 -S adjtimex -S settimeofday -S stime -k time-change -a always,exit -F arch=b64 -S clock_settime -k time-change -a always,exit -F arch=b32 -S clock_settime -k time-change -w /etc/localtime -p wa -k time-change # ì‚¬ìš©ì/ê·¸ë£¹ ì •ë³´ ê°ì‚¬ -w /etc/group -p wa -k identity -w /etc/passwd -p wa -k identity -w /etc/gshadow -p wa -k identity -w /etc/shadow -p wa -k identity -w /etc/security/opasswd -p wa -k identity # ë„¤íŠ¸ì›Œí¬ í™˜ê²½ ê°ì‚¬ -a always,exit -F arch=b64 -S sethostname -S setdomainname -k system-locale -a always,exit -F arch=b32 -S sethostname -S setdomainname -k system-locale -w /etc/issue -p wa -k system-locale -w /etc/issue.net -p wa -k system-locale -w /etc/hosts -p wa -k system-locale -w /etc/network -p wa -k system-locale # MAC ì •ì±… ë³€ê²½ ê°ì‚¬ -w /etc/selinux/ -p wa -k MAC-policy -w /usr/share/selinux/ -p wa -k MAC-policy # ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ê°ì‚¬ -w /var/log/faillog -p wa -k logins -w /var/log/lastlog -p wa -k logins -w /var/log/tallylog -p wa -k logins # ì„¸ì…˜ ì‹œì‘ ì •ë³´ ê°ì‚¬ -w /var/run/utmp -p wa -k session -w /var/log/wtmp -p wa -k logins -w /var/log/btmp -p wa -k logins # ê¶Œí•œ ë³€ê²½ ê°ì‚¬ -a always,exit -F arch=b64 -S chmod -S fchmod -S fchmodat -F auid&gt;=1000 -F auid!=4294967295 -k perm_mod -a always,exit -F arch=b32 -S chmod -S fchmod -S fchmodat -F auid&gt;=1000 -F auid!=4294967295 -k perm_mod -a always,exit -F arch=b64 -S chown -S fchown -S fchownat -S lchown -F auid&gt;=1000 -F auid!=4294967295 -k perm_mod -a always,exit -F arch=b32 -S chown -S fchown -S fchownat -S lchown -F auid&gt;=1000 -F auid!=4294967295 -k perm_mod # ê´€ë¦¬ì ì•¡ì„¸ìŠ¤ ê°ì‚¬ -w /etc/sudoers -p wa -k scope -w /etc/sudoers.d/ -p wa -k scope # ì»¤ë„ ëª¨ë“ˆ ë¡œë”©/ì–¸ë¡œë”© ê°ì‚¬ -w /sbin/insmod -p x -k modules -w /sbin/rmmod -p x -k modules -w /sbin/modprobe -p x -k modules -a always,exit -F arch=b64 -S init_module -S delete_module -k modules # íŒŒì¼ ì‚­ì œ ê°ì‚¬ -a always,exit -F arch=b64 -S unlink -S unlinkat -S rename -S renameat -F auid&gt;=1000 -F auid!=4294967295 -k delete -a always,exit -F arch=b32 -S unlink -S unlinkat -S rename -S renameat -F auid&gt;=1000 -F auid!=4294967295 -k delete # ì„¤ì • ë¶ˆë³€ì„± -e 2 EOF systemctl enable auditd systemctl start auditd # 5. ì•¡ì„¸ìŠ¤ ì œì–´ ì„¤ì • echo "5. ì•¡ì„¸ìŠ¤ ì œì–´ ì„¤ì •..." # 5.1 cron ì ‘ê·¼ ì œí•œ echo "root" &gt; /etc/cron.allow chmod 600 /etc/cron.allow rm -f /etc/cron.deny # 5.2 SSH ë³´ì•ˆ ê°•í™” (ì´ë¯¸ ì•ì—ì„œ ë‹¤ë£¸) # 5.3 PAM ì„¤ì • ê°•í™” (ì´ë¯¸ ì•ì—ì„œ ë‹¤ë£¸) # 6. ì‹œìŠ¤í…œ ìœ ì§€ë³´ìˆ˜ echo "6. ì‹œìŠ¤í…œ ìœ ì§€ë³´ìˆ˜ ì„¤ì •..." # 6.1 íŒŒì¼ ê¶Œí•œ ì ê²€ find /etc -type f -perm /g+w,o+w -exec chmod go-w {} \; # 6.2 SUID/SGID ì ê²€ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± cat &gt; /usr/local/bin/check-suid-sgid.sh &lt;&lt; 'EOF' #!/bin/bash find / \( -perm -4000 -o -perm -2000 \) -type f -exec ls -ld {} \; 2&gt;/dev/null | \ while read line; do echo "$(date): $line" &gt;&gt; /var/log/suid-sgid.log done EOF chmod +x /usr/local/bin/check-suid-sgid.sh # 6.3 ì •ê¸° ë³´ì•ˆ ì ê²€ cron ì„¤ì • cat &gt; /etc/cron.daily/security-check &lt;&lt; 'EOF' #!/bin/bash /usr/local/bin/check-suid-sgid.sh /usr/bin/aide --check 2&gt;&amp;1 | logger -t aide EOF chmod +x /etc/cron.daily/security-check echo "CIS Benchmark ì ìš© ì™„ë£Œ!" echo "ì‹œìŠ¤í…œì„ ì¬ë¶€íŒ…í•˜ì—¬ ëª¨ë“  ì„¤ì •ì„ ì ìš©í•˜ì„¸ìš”." ğŸ“Š ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ Prometheus + Grafana ë³´ì•ˆ ë©”íŠ¸ë¦­ # prometheus-rules.yml groups: - name: security_rules rules: - alert: HighFailedLoginRate expr: rate(node_auth_failed_total[5m]) &gt; 0.1 for: 2m labels: severity: warning annotations: summary: "High failed login rate detected" description: "{{ $labels.instance }} has a high failed login rate of {{ $value }} per second" - alert: RootLoginDetected expr: increase(node_auth_success_total{user="root"}[1m]) &gt; 0 for: 0m labels: severity: critical annotations: summary: "Root login detected" description: "Root user login detected on {{ $labels.instance }}" - alert: SudoCommandExecuted expr: increase(node_sudo_commands_total[1m]) &gt; 0 for: 0m labels: severity: info annotations: summary: "Sudo command executed" description: "Sudo command executed on {{ $labels.instance }}" - alert: FileSystemModification expr: rate(node_filesystem_files_free[5m]) &lt; -0.1 for: 5m labels: severity: warning annotations: summary: "Rapid file system changes detected" description: "Rapid file system changes on {{ $labels.instance }} at {{ $labels.mountpoint }}" ë³´ì•ˆ ë¡œê·¸ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸ #!/usr/bin/env python3 import re import json import datetime from collections import defaultdict, Counter import argparse class SecurityLogAnalyzer: def __init__(self): self.failed_logins = defaultdict(list) self.successful_logins = defaultdict(list) self.sudo_commands = [] self.suspicious_activities = [] def parse_auth_log(self, log_file): """ì¸ì¦ ë¡œê·¸ íŒŒì‹±""" patterns = { 'failed_login': r'(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*Failed password for (\w+) from (\d+\.\d+\.\d+\.\d+)', 'successful_login': r'(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*Accepted password for (\w+) from (\d+\.\d+\.\d+\.\d+)', 'sudo_command': r'(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*sudo.*USER=(\w+).*COMMAND=(.*)', 'invalid_user': r'(\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}).*Invalid user (\w+) from (\d+\.\d+\.\d+\.\d+)' } with open(log_file, 'r') as f: for line in f: # ì‹¤íŒ¨í•œ ë¡œê·¸ì¸ ì‹œë„ match = re.search(patterns['failed_login'], line) if match: timestamp, user, ip = match.groups() self.failed_logins[ip].append({ 'timestamp': timestamp, 'user': user, 'ip': ip }) # ì„±ê³µí•œ ë¡œê·¸ì¸ match = re.search(patterns['successful_login'], line) if match: timestamp, user, ip = match.groups() self.successful_logins[ip].append({ 'timestamp': timestamp, 'user': user, 'ip': ip }) # sudo ëª…ë ¹ match = re.search(patterns['sudo_command'], line) if match: timestamp, user, command = match.groups() self.sudo_commands.append({ 'timestamp': timestamp, 'user': user, 'command': command }) # ì˜ëª»ëœ ì‚¬ìš©ì match = re.search(patterns['invalid_user'], line) if match: timestamp, user, ip = match.groups() self.suspicious_activities.append({ 'type': 'invalid_user', 'timestamp': timestamp, 'user': user, 'ip': ip }) def detect_brute_force(self, threshold=10): """ë¸Œë£¨íŠ¸í¬ìŠ¤ ê³µê²© íƒì§€""" brute_force_ips = [] for ip, attempts in self.failed_logins.items(): if len(attempts) &gt;= threshold: brute_force_ips.append({ 'ip': ip, 'attempts': len(attempts), 'users_targeted': list(set([attempt['user'] for attempt in attempts])), 'first_attempt': attempts[0]['timestamp'], 'last_attempt': attempts[-1]['timestamp'] }) return brute_force_ips def detect_privilege_escalation(self): """ê¶Œí•œ ìƒìŠ¹ íƒì§€""" privilege_escalations = [] dangerous_commands = [ 'passwd', 'useradd', 'usermod', 'userdel', 'chmod 777', 'chmod 4755', 'chown root', 'systemctl', 'service', 'crontab -e', '/bin/bash', '/bin/sh', 'su -' ] for sudo_cmd in self.sudo_commands: for dangerous_cmd in dangerous_commands: if dangerous_cmd in sudo_cmd['command']: privilege_escalations.append({ 'timestamp': sudo_cmd['timestamp'], 'user': sudo_cmd['user'], 'command': sudo_cmd['command'], 'risk_level': 'high' if dangerous_cmd in ['passwd', 'useradd', '/bin/bash'] else 'medium' }) break return privilege_escalations def analyze_login_patterns(self): """ë¡œê·¸ì¸ íŒ¨í„´ ë¶„ì„""" patterns = { 'geographic_anomalies': [], 'time_anomalies': [], 'user_anomalies': [] } # ì‚¬ìš©ìë³„ ë¡œê·¸ì¸ ë¹ˆë„ ë¶„ì„ user_login_count = Counter() for ip, logins in self.successful_logins.items(): for login in logins: user_login_count[login['user']] += 1 # ë¹„ì •ìƒì ìœ¼ë¡œ ë§ì€ ë¡œê·¸ì¸ avg_logins = sum(user_login_count.values()) / len(user_login_count) if user_login_count else 0 for user, count in user_login_count.items(): if count &gt; avg_logins * 3: # í‰ê· ì˜ 3ë°° ì´ìƒ patterns['user_anomalies'].append({ 'user': user, 'login_count': count, 'anomaly_type': 'excessive_logins' }) return patterns def generate_report(self): """ë³´ì•ˆ ë¶„ì„ ë¦¬í¬íŠ¸ ìƒì„±""" report = { 'analysis_date': datetime.datetime.now().isoformat(), 'summary': { 'total_failed_logins': sum(len(attempts) for attempts in self.failed_logins.values()), 'total_successful_logins': sum(len(logins) for logins in self.successful_logins.values()), 'total_sudo_commands': len(self.sudo_commands), 'suspicious_activities': len(self.suspicious_activities) }, 'brute_force_attacks': self.detect_brute_force(), 'privilege_escalations': self.detect_privilege_escalation(), 'login_patterns': self.analyze_login_patterns(), 'suspicious_activities': self.suspicious_activities, 'recommendations': [] } # ì¶”ì²œì‚¬í•­ ìƒì„± if report['brute_force_attacks']: report['recommendations'].append( "ë¸Œë£¨íŠ¸í¬ìŠ¤ ê³µê²©ì´ íƒì§€ë˜ì—ˆìŠµë‹ˆë‹¤. fail2ban ì„¤ì •ì„ ê²€í† í•˜ê³  IP ì°¨ë‹¨ì„ ê³ ë ¤í•˜ì„¸ìš”." ) if report['privilege_escalations']: report['recommendations'].append( "ê¶Œí•œ ìƒìŠ¹ í™œë™ì´ íƒì§€ë˜ì—ˆìŠµë‹ˆë‹¤. sudo ì‚¬ìš©ì„ ê²€í† í•˜ê³  í•„ìš”ì‹œ ê¶Œí•œì„ ì œí•œí•˜ì„¸ìš”." ) if report['summary']['total_failed_logins'] &gt; 100: report['recommendations'].append( "ê³¼ë„í•œ ì‹¤íŒ¨ ë¡œê·¸ì¸ ì‹œë„ê°€ ìˆìŠµë‹ˆë‹¤. íŒ¨ìŠ¤ì›Œë“œ ì •ì±…ì„ ê°•í™”í•˜ì„¸ìš”." ) return report def main(): parser = argparse.ArgumentParser(description='Security Log Analyzer') parser.add_argument('--log-file', default='/var/log/auth.log', help='Path to authentication log file') parser.add_argument('--output', '-o', help='Output file for JSON report') parser.add_argument('--threshold', type=int, default=10, help='Brute force detection threshold') args = parser.parse_args() analyzer = SecurityLogAnalyzer() analyzer.parse_auth_log(args.log_file) report = analyzer.generate_report() if args.output: with open(args.output, 'w') as f: json.dump(report, f, indent=2) else: print(json.dumps(report, indent=2)) if __name__ == '__main__': main() ë§ˆë¬´ë¦¬ì™€ ë‹¤ìŒ ë‹¨ê³„ ì´ ì¢…í•©ì ì¸ ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆ ê°€ì´ë“œë¥¼ í†µí•´ ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ ë‹¤ë¤˜ìŠµë‹ˆë‹¤: âœ… ë‹¤ë£¬ ì£¼ìš” ë‚´ìš© ê¸°ì´ˆ ë³´ì•ˆ: ì‚¬ìš©ì ê³„ì •, SSH, ë°©í™”ë²½ ì„¤ì • ê³ ê¸‰ ë³´ì•ˆ: SELinux/AppArmor, ì‹œìŠ¤í…œ í•˜ë“œë‹ ì¹¨ì… íƒì§€: AIDE, Fail2Ban, Wazuh êµ¬ì¶• ì»¨í…Œì´ë„ˆ ë³´ì•ˆ: Docker/Kubernetes ë³´ì•ˆ ì„¤ì • ì»´í”Œë¼ì´ì–¸ìŠ¤: CIS Benchmark ì ìš© ëª¨ë‹ˆí„°ë§: ë³´ì•ˆ ë¡œê·¸ ë¶„ì„ ë° ëŒ€ì‹œë³´ë“œ ğŸš€ ë‹¤ìŒ ë‹¨ê³„ ê¶Œì¥ì‚¬í•­ ì •ê¸°ì ì¸ ë³´ì•ˆ ì ê²€ - ì›”ê°„ ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸ ìš´ì˜ ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸ - ë¶„ê¸°ë³„ ëª¨ì˜ í•´í‚¹ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰ ë³´ì•ˆ êµìœ¡ - íŒ€ì› ëŒ€ìƒ ë³´ì•ˆ ì¸ì‹ êµìœ¡ ì¸ì‹œë˜íŠ¸ ëŒ€ì‘ - ë³´ì•ˆ ì‚¬ê³  ëŒ€ì‘ ì ˆì°¨ ìˆ˜ë¦½ ë°±ì—… ë° ë³µêµ¬ - ì •ê¸°ì ì¸ ë°±ì—… ë° ë³µêµ¬ í…ŒìŠ¤íŠ¸ ğŸ“š ì¶”ê°€ í•™ìŠµ ìë£Œ ì¸ì¦: CompTIA Security+, CISSP, CEH ë„êµ¬: Metasploit, Nessus, OpenVAS í‘œì¤€: NIST Cybersecurity Framework, ISO 27001 ë¦¬ëˆ…ìŠ¤ ë³´ì•ˆì€ ì§€ì†ì ì¸ ê³¼ì •ì…ë‹ˆë‹¤. í•­ìƒ ìµœì‹  ìœ„í˜‘ ë™í–¥ì„ íŒŒì•…í•˜ê³  ë³´ì•ˆ ì„¤ì •ì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”! ğŸ”’ğŸ›¡ï¸]]></summary></entry></feed>